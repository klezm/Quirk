<!DOCTYPE html>
<html>
    <head lang="en">
        <meta charset="UTF-8">
        <meta name="keywords" content="quantum,circuit,simulator,quirk">
        <meta name="description" content="Quirk is an open-source drag-and-drop quantum circuit simulator for exploring and understanding small quantum circuits.">
        <title>Quirk: Quantum Circuit Simulator</title>
        <link rel="shortcut icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAJGUlEQVRYw6WXa2xUZRrHf+fM6ZyZdmY6M50yhdJSoLWtWUkLQmvF1W2AaAvpiss2Gy9LrLIJGq/EWyKJbnYDiTHRbDXULWtEN1sNYMuWRaAuKoyASitgOr1bLG1HhplhzrRz6XTOfmjniG3xts/59J7znuf5v+9z+z8CPyBNTU3U1tYCUFFRgc/vswIlQCFQDjimt3qBk0AX0GG32QMul2uWjrlEuNaH5uZmampqKCouShpFNsr3RsPRnLKKsrx0W7pceF1hNkBPb4+il/T+lv0tF2Wj3B0NR/dMq+lwd7oDSV0/GUBjYyN1dXVJ4w/mLMlZs/WRratMVpPV6XTiPuum7NYyPAMeAJyLnZz66BRFy4rweDyEAqFA/av1p4f6h44Cb7g73YGkzpmimwtAd0+31ZHpKF+Qt2D7fXX3bdm2fVvxdddfZ8hakMVA5wCKpFBcWIzP4wMga1EWvaO9iOMiJWUl5OXnGW5ff/vS9PT0m1ApiEVjl10uV8Dr9UZ+FMD0qTevXrP6oYcfebi67NYyvdliBiDoDzIyOsKK0hWkyCn4PX4AbFk2suxZDA8PY7FYMBgNxMZjSDpJnzkv8waz1Zzf4+6RHZkO90wQuquvvbun2wpsvu2O2+599oVny3KX5iLLsra5v78fYpC9OBudqNNuICMrA1Encnn4MoZUA109XTz7xFMcP3WY8+52ll2/PDcj0zGvv7dfdGQ63Dt37oy0tLQAICYDbto/JavXrL7r6e1PL7ekW2YEi4CaUDGZTUiSNMttkiRhMpvQp+nZ9vBjWG8+y7q/DlH90hBvN79Ebl7u8qrfVt0FlNTV1dHc3DwFoKmpSYv2BXkLttx9z92rZxqfQiri9/ixOq3XTClHtoM3X3kL/cJRNj1lwZKlw5wt8OBbaZzo+DcrVq1YXbyseEtRcZG1pqaGpqYmxNraWi3a77zrzg2LixZfI10EImMRzFbzNQFkZmQyOZkgrIQ5dyLM6SaFeFglPqGiTggsK11G5drKDcCDRcVF1tra2ikXACULlyxcs2HTBlMy4GYajxNHVEVMsglp+tGJOnSiTluLiNy4cjme3gm+PDSGIzcFW6qOT5tCqFEjJouJDZs2mPKvz1+TrC3SdIVj6yNbV11tXEBARNSMH3EdQVVVuvq6CIfCRMYjtO5rBaB6YzXGNCPxeJzG3X/H2x/nxD/H6Dk5wZGGELGh+bz8tyew2KZce/+W+1c999hzVFRUIPn8PqtslO81W81WVVUJ+oNcHLmImlDxe/xExiKIqoiqqjAJY74xUuQU7Jl2qmqqprJgXga7d+3mixNfcNp1mrV3rKXugQfoaD+LTtSxueE+iKpc8V3BYrOQZkkz6A363/v8vg4JKImGo0udTidnT54lPBFG1smYzCYKbyjEbDVjkk109XUx5hujdGUpCRIAJMYSSIJEZnYm/X39tH/RzvKVy9n2wjYqVlZwx8bbuXT5EufPnMdkNBGdjGJMMTJ/wfxELBJbBJRI01eic591M2mZpKK0AkOqYVaqhUNhUuQUEiRQUbX3kZQIT/7pST7Y9wGV1ZXc88d7MOgNJEgQJ44tw8Yta24hHo8TGY/ganfhPetN3fLQlryG+oZCCVg3PDL8q9r7azFZTKioCHO0iMh4BHumXVurqEzGJ9n+5Hba2tqoqa3h5V0v4/f6ufzt5TnrRJoljXW3riMUDOH6i2sBsEgCKMgvMHsGPIwyOmd66UQdrftaqaqpIjGWAHUKQOv7rbS1tVFZWcnjzzxO4EIA7xUvB5sPovgUchbmzKlPURQK8gvMhziExC8QSZQYDYyiQ8ejzzzKpt9tIkVIIZ6I/3xdyX6+vna99VoukJCo3liNPdNOQX4B/nE/J988SdnaMuzpdgqWFSAIAgICfb19VG+spvymcuJ8H1BSdygYovVAq5IEcDg3N7fm1EenrD8UhIZUA2ElzDdD3/D5fz+nanMVvl4f8UQcQfgOcHQ8iiHVMOukVwehLqgjOzd7GBiUABrqG3zv/uddvMNeznec19LQ6rRqaWhMMzLoHsTr8XLjb27ElmrjW/VbENBuTERkIjpBmj1tKnCjEZSAQsATIKSEiE5GceqdOJY52P70dh/QJQEdslHu9ng8q0vLS7VCFEvE6DrXpRWiOHFOfXyKmytvxn/JTyQSwa9M8YG+3j6i41EmohOMDo7CEAyeGyQhJDCkGbA5bchWmSXzl2CxWWj/rJ1p6tYh2W32gM/v2xMKhDYKgmBNt6eTbk+fKsU3fFeK9x3ZR9mvy1hUtIjwWBjfJR8Hmw9qpdiQapg6+RAIToHKikokJFTUWbVDCSiBaDi6x26zBySXy0VRcRH1r9afLi0vXZfsByoqk0xqfWHj2o18+P6HFOYXfqfIpwBQflO59m7w3CCVFZUa8FkpGFR47dXXTgO4XC6tG3YM9Q8dPfDegZASVGb9pKIiIZEQEoSiIeLTT87CHHIW5mjrUDREQkhoJ5/L+IH3DoSmyWqHRkjcne4A8Mb+vfsPDLgH5sxXFRVDmgEloFwzp5WAgiHNMKdxgAH3APv37j+QZMoaIWlubsbd6Q4Mfz3c8M7b7xwPXgnO+jlBApvTRsATuCaAgCeAzWnTmtXVErwSZM/be44Pfz3ckJwVNEJSU1NDY2MjQMfxo8f37nhxx5mZIFRUBFEgpISIx+Nz5nlICSGIwqwbCF4JsuPFHWdcR117gY7GxkZtUNFYcUtLC16vN+LIdLgHewfFwcFBkzPDmZtqTtWYsV7SM+oZxZ5hn0XLw6EwIyMjLFm6BIPRoPm868su6l+pP/7J4U/+Bbzp7nQHkox4zrkgCeJC/4XO9o52WVTFxXn5eXpZlpENMr4RH+6LbvLz8r9Hy4+dPIZVbyW3IBdBELSA2/X6rr1fnfnqJeDQdKz9+GS0c+fOyO7G3V/LKXLbZ59+Fjr24THV6XBm+Hw+w7z58/Bd8DFv/jxGvhkhFothtpoZ7h4mZ2mOt6+nL7X7q+7A8089/3HbwbZ/KAHlz+5O9/dmgV88nOqN+j/EwjHH+jvXl07GJ235+flmgK7urouSTlIOthw8Jxvl8f97OP0J4znAuhnbDyeN/pzx/H9hJ0Pb7MiyZAAAAABJRU5ErkJggg==">

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <!-- Whatever is between these start/end analytic tags is stripped by the 'downloading offline copy' code. -->
        <!-- Start Analytics -->
        <!-- End Analytics -->
    </head>
    <body style="margin: 0">
        <!-- Primary content -->
        <div id="inspectorDiv" style="display: none">
            <!-- Buttons -->
            <div style="margin: 5px;">
                <button id="menu-button" style="min-width: 50px; min-height: 30px;">Menu</button>
                &nbsp;
                &nbsp;
                <button id="export-button" style="min-width: 50px; min-height: 30px;">Export</button>
                &nbsp;
                &nbsp;
                <button id="clear-circuit-button" style="min-width: 50px; min-height: 30px;">Clear Circuit</button>
                <button id="clear-all-button" style="min-width: 50px; min-height: 30px;">Clear ALL</button>
                &nbsp;
                &nbsp;
                <button id="undo-button" style="min-width: 50px; min-height: 30px;" title="Undo (Ctrl + Z)">Undo</button>
                <button id="redo-button" style="min-width: 50px; min-height: 30px;" title="Redo (Ctrl + Shift + Z)">Redo</button>
                &nbsp;
                &nbsp;
                <button id="gate-forge-button" style="min-width: 50px; min-height: 30px;">Make Gate</button>
                &nbsp;
                &nbsp;
                &nbsp;
                &nbsp;
                <span style="color:#BBB">Version 2.3</span>
            </div>

            <!-- Circuit drawing area -->
            <div id="canvasDiv" style="width: 100%; touch-action: manipulation; tab-index: 0; position: relative;">
                <canvas id="drawCanvas"></canvas>
            </div>

            <div id="export-div" style="display:none;">
    <div id="export-overlay" style="position:fixed; left: 0; top: 0; height: 100vh; width: 100vw; background: rgba(0, 0, 0, 0.7);">
    </div>
    <div style="position: absolute; top: 20px; left: 50px; padding: 20px; background-color: white; border: 1px solid black;">
        <strong>Escaped Link</strong> - Link to current circuit, without special characters that confuse forums.
        <div style="margin: 10px 0 30px 20px;">
            <button tabindex="100" id="export-link-copy-button">Copy to Clipboard</button>&nbsp;&nbsp;<span id="export-link-copy-result"></span>
            <div style="overflow:auto; word-wrap:break-word; max-height:60px; max-width:600px; border: 1px solid black; padding: 10px; margin: 2px;"><a tabindex="101" id="export-escaped-anchor"></a></div>
        </div>

        <strong>Offline Copy</strong> - Html file containing Quirk and the current circuit.
        <div style="margin: 10px 0 30px 20px;">
            <button tabindex="102" id="download-offline-copy-button" style="width:600px; height:60px;">Download ...</button>
        </div>

        <strong>Circuit JSON</strong> - Parsable representation of current circuit.
        <div style="margin: 10px 0 0 20px;">
            <button tabindex="103" id="export-json-copy-button">Copy to Clipboard</button>&nbsp;&nbsp;<span id="export-json-copy-result"></span>
            <br>
            <pre tabindex="104" id="export-circuit-json-pre" style="overflow:auto; max-width:600px; max-height:60px; border: 1px solid black; padding:5px; margin:2px;"></pre>
        </div>

        <br>
        <strong>Simulation Data JSON</strong> - Output amplitudes, detector results, display data, etc.
        <div style="margin: 10px 0 0 20px;">
            <button tabindex="105" id="export-amplitudes-button">Generate and Copy to Clipboard</button>&nbsp;<span id="export-amplitudes-result"></span>
            <input type="checkbox" tabindex="106" id="export-amplitudes-use-amps" style="float: right; margin-right: 10px;">
            <label style="float: right" for="export-amplitudes-use-amps">Skip output amplitudes</label>
            <br>
            <pre tabindex="107" id="export-amplitudes-pre" style="overflow:auto; max-width:600px; max-height:60px; border: 1px solid black; padding:5px; margin:2px;"></pre>
        </div>
    </div>
</div>


            <div id="gate-forge-div" style="display:none">
    <div id="gate-forge-overlay" style="position:fixed; left: 0; top: 0; height: 100vh; width: 100vw; background: rgba(0, 0, 0, 0.7);">
    </div>
    <div style="position: absolute; top: 20px; left: 50px; padding: 20px; background-color: white; border: 1px solid black;">
        <style scoped>
            th {
                font-size: 20px;
            }
        </style>
        <table cellspacing="0">
            <colgroup>
                <col style="background-color:#EEE;"/>
                <col/>
                <col style="background-color:#EEE;"/>
                <col/>
                <col style="background-color:#EEE;"/>
            </colgroup>
            <tr>
                <th>From Rotation</th>
                <th></th>
                <th>From Matrix</th>
                <th></th>
                <th>From Circuit</th>
            </tr>
            <tr>
                <td>
                    <input tabindex="100" id='gate-forge-rotation-axis' type="text" size="8" placeholder="X+Z"> axis<br/>
                    <input tabindex="101" id='gate-forge-rotation-angle' type="text" size="8" placeholder="45" style="margin:0.5em 0 0 0;">° angle<br/>
                    <input tabindex="102" id='gate-forge-rotation-phase' type="text" size="8" placeholder="0" style="margin:0.5em 0 0 0;">° global phase
                </td>
                <td></td>
                <td>
                    <style scoped>
                        input[id="gate-forge-matrix-fix"]:not(:checked) + label {
                            font-weight: bold;
                            background-color: pink;
                        }
                    </style>

                    <textarea tabindex="200" id="gate-forge-matrix" cols="25" rows="5" placeholder="1, i,  i, 1"></textarea><br/>

                    <input tabindex="201" id="gate-forge-matrix-fix" type="checkbox" checked>
                    <label for="gate-forge-matrix-fix">ensure unitary (by SVD)</label>
                </td>
                <td></td>
                <td>
                    From part of current circuit:<br/>
                    <input tabindex="300" id="gate-forge-circuit-cols" type="text" size="4" placeholder="1:∞" style="margin:0.5em 0 0 0;"> column range<br/>
                    <input tabindex="301" id="gate-forge-circuit-rows" type="text" size="4" placeholder="1:∞" style="margin:0.5em 0 0.5em 0;"> wire range<br/>
                    Inputs: <span id="gate-forge-circuit-inputs">(none)</span>, Weight: <span id="gate-forge-circuit-weight">0</span>
                </td>
            </tr>
            <tr>
                <td>
                    <canvas id="gate-forge-rotation-canvas" style="border:1px black solid;width:195px;height:100px;margin:10px 0 0 0;"></canvas>
                </td>
                <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>OR</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
                <td>
                    <canvas id="gate-forge-matrix-canvas" style="border:1px black solid;width:195px;height:100px;margin:10px 0 0 0;"></canvas>
                </td>
                <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>OR</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
                <td>
                    <canvas id="gate-forge-circuit-canvas" style="border:1px black solid;width:195px;height:100px;margin:10px 0 0 0;"></canvas>
                </td>
            </tr>
            <tr>
                <td>
                    <br/><input tabindex="110" id='gate-forge-rotation-name' type="text" placeholder="[the matrix]" style="width:7em;">  circuit symbol<br/><br/>
                </td>
                <td></td>
                <td>
                    <br/><input tabindex="210" id='gate-forge-matrix-name' type="text" placeholder="[the matrix]" style="width:7em;"> circuit symbol<br/><br/>
                </td>
                <td></td>
                <td>
                    <br/><input tabindex="310" id='gate-forge-circuit-name' type="text" placeholder="[the circuit]" style="width:7em;"> circuit symbol<br/><br/>
                </td>
            </tr>
            <tr>
                <td>
                    <button tabindex="120" id="gate-forge-rotation-button" style="width:100%;height:30px;">Create Rotation Gate</button>
                </td>
                <td></td>
                <td>
                    <button tabindex="220" id="gate-forge-matrix-button" style="width:100%;height:30px;">Create Matrix Gate</button>
                </td>
                <td></td>
                <td>
                    <button tabindex="320" id="gate-forge-circuit-button" style="width:100%;height:30px;">Create Circuit Gate</button>
                </td>
            </tr>
        </table>
    </div>
</div>

        </div>

        <div id="menu-div" style="display:block;">
    <div id="menu-overlay" style="position:fixed; left: 0; top: 0; height: 100vh; width: 100vw; background: rgba(0, 0, 0, 0.8);">
    </div>
    <div style="position:absolute; top:20px; left:50px; margin:0;">
        <div style="display:inline-block; padding:20px; background-color:white; border:1px solid black; text-align:center;">
            <div style="font-size: 32px;">
                <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAJGUlEQVRYw6WXa2xUZRrHf+fM6ZyZdmY6M50yhdJSoLWtWUkLQmvF1W2AaAvpiss2Gy9LrLIJGq/EWyKJbnYDiTHRbDXULWtEN1sNYMuWRaAuKoyASitgOr1bLG1HhplhzrRz6XTOfmjniG3xts/59J7znuf5v+9z+z8CPyBNTU3U1tYCUFFRgc/vswIlQCFQDjimt3qBk0AX0GG32QMul2uWjrlEuNaH5uZmampqKCouShpFNsr3RsPRnLKKsrx0W7pceF1hNkBPb4+il/T+lv0tF2Wj3B0NR/dMq+lwd7oDSV0/GUBjYyN1dXVJ4w/mLMlZs/WRratMVpPV6XTiPuum7NYyPAMeAJyLnZz66BRFy4rweDyEAqFA/av1p4f6h44Cb7g73YGkzpmimwtAd0+31ZHpKF+Qt2D7fXX3bdm2fVvxdddfZ8hakMVA5wCKpFBcWIzP4wMga1EWvaO9iOMiJWUl5OXnGW5ff/vS9PT0m1ApiEVjl10uV8Dr9UZ+FMD0qTevXrP6oYcfebi67NYyvdliBiDoDzIyOsKK0hWkyCn4PX4AbFk2suxZDA8PY7FYMBgNxMZjSDpJnzkv8waz1Zzf4+6RHZkO90wQuquvvbun2wpsvu2O2+599oVny3KX5iLLsra5v78fYpC9OBudqNNuICMrA1Encnn4MoZUA109XTz7xFMcP3WY8+52ll2/PDcj0zGvv7dfdGQ63Dt37oy0tLQAICYDbto/JavXrL7r6e1PL7ekW2YEi4CaUDGZTUiSNMttkiRhMpvQp+nZ9vBjWG8+y7q/DlH90hBvN79Ebl7u8qrfVt0FlNTV1dHc3DwFoKmpSYv2BXkLttx9z92rZxqfQiri9/ixOq3XTClHtoM3X3kL/cJRNj1lwZKlw5wt8OBbaZzo+DcrVq1YXbyseEtRcZG1pqaGpqYmxNraWi3a77zrzg2LixZfI10EImMRzFbzNQFkZmQyOZkgrIQ5dyLM6SaFeFglPqGiTggsK11G5drKDcCDRcVF1tra2ikXACULlyxcs2HTBlMy4GYajxNHVEVMsglp+tGJOnSiTluLiNy4cjme3gm+PDSGIzcFW6qOT5tCqFEjJouJDZs2mPKvz1+TrC3SdIVj6yNbV11tXEBARNSMH3EdQVVVuvq6CIfCRMYjtO5rBaB6YzXGNCPxeJzG3X/H2x/nxD/H6Dk5wZGGELGh+bz8tyew2KZce/+W+1c999hzVFRUIPn8PqtslO81W81WVVUJ+oNcHLmImlDxe/xExiKIqoiqqjAJY74xUuQU7Jl2qmqqprJgXga7d+3mixNfcNp1mrV3rKXugQfoaD+LTtSxueE+iKpc8V3BYrOQZkkz6A363/v8vg4JKImGo0udTidnT54lPBFG1smYzCYKbyjEbDVjkk109XUx5hujdGUpCRIAJMYSSIJEZnYm/X39tH/RzvKVy9n2wjYqVlZwx8bbuXT5EufPnMdkNBGdjGJMMTJ/wfxELBJbBJRI01eic591M2mZpKK0AkOqYVaqhUNhUuQUEiRQUbX3kZQIT/7pST7Y9wGV1ZXc88d7MOgNJEgQJ44tw8Yta24hHo8TGY/ganfhPetN3fLQlryG+oZCCVg3PDL8q9r7azFZTKioCHO0iMh4BHumXVurqEzGJ9n+5Hba2tqoqa3h5V0v4/f6ufzt5TnrRJoljXW3riMUDOH6i2sBsEgCKMgvMHsGPIwyOmd66UQdrftaqaqpIjGWAHUKQOv7rbS1tVFZWcnjzzxO4EIA7xUvB5sPovgUchbmzKlPURQK8gvMhziExC8QSZQYDYyiQ8ejzzzKpt9tIkVIIZ6I/3xdyX6+vna99VoukJCo3liNPdNOQX4B/nE/J988SdnaMuzpdgqWFSAIAgICfb19VG+spvymcuJ8H1BSdygYovVAq5IEcDg3N7fm1EenrD8UhIZUA2ElzDdD3/D5fz+nanMVvl4f8UQcQfgOcHQ8iiHVMOukVwehLqgjOzd7GBiUABrqG3zv/uddvMNeznec19LQ6rRqaWhMMzLoHsTr8XLjb27ElmrjW/VbENBuTERkIjpBmj1tKnCjEZSAQsATIKSEiE5GceqdOJY52P70dh/QJQEdslHu9ng8q0vLS7VCFEvE6DrXpRWiOHFOfXyKmytvxn/JTyQSwa9M8YG+3j6i41EmohOMDo7CEAyeGyQhJDCkGbA5bchWmSXzl2CxWWj/rJ1p6tYh2W32gM/v2xMKhDYKgmBNt6eTbk+fKsU3fFeK9x3ZR9mvy1hUtIjwWBjfJR8Hmw9qpdiQapg6+RAIToHKikokJFTUWbVDCSiBaDi6x26zBySXy0VRcRH1r9afLi0vXZfsByoqk0xqfWHj2o18+P6HFOYXfqfIpwBQflO59m7w3CCVFZUa8FkpGFR47dXXTgO4XC6tG3YM9Q8dPfDegZASVGb9pKIiIZEQEoSiIeLTT87CHHIW5mjrUDREQkhoJ5/L+IH3DoSmyWqHRkjcne4A8Mb+vfsPDLgH5sxXFRVDmgEloFwzp5WAgiHNMKdxgAH3APv37j+QZMoaIWlubsbd6Q4Mfz3c8M7b7xwPXgnO+jlBApvTRsATuCaAgCeAzWnTmtXVErwSZM/be44Pfz3ckJwVNEJSU1NDY2MjQMfxo8f37nhxx5mZIFRUBFEgpISIx+Nz5nlICSGIwqwbCF4JsuPFHWdcR117gY7GxkZtUNFYcUtLC16vN+LIdLgHewfFwcFBkzPDmZtqTtWYsV7SM+oZxZ5hn0XLw6EwIyMjLFm6BIPRoPm868su6l+pP/7J4U/+Bbzp7nQHkox4zrkgCeJC/4XO9o52WVTFxXn5eXpZlpENMr4RH+6LbvLz8r9Hy4+dPIZVbyW3IBdBELSA2/X6rr1fnfnqJeDQdKz9+GS0c+fOyO7G3V/LKXLbZ59+Fjr24THV6XBm+Hw+w7z58/Bd8DFv/jxGvhkhFothtpoZ7h4mZ2mOt6+nL7X7q+7A8089/3HbwbZ/KAHlz+5O9/dmgV88nOqN+j/EwjHH+jvXl07GJ235+flmgK7urouSTlIOthw8Jxvl8f97OP0J4znAuhnbDyeN/pzx/H9hJ0Pb7MiyZAAAAABJRU5ErkJggg=="/>
                Welcome to Quirk
            </div>

            A drag-and-drop quantum circuit simulator.

            <div style="margin:20px;">
                <div id="loading-div" style="color:#D90; font-size:40px; display:block; height:120px; width:410px;">
                    Loading...
                </div>
                <button tabindex="50" id="close-menu-button" style="width:410px; height:120px; font-size:20px; display:none;">Edit Circuit</button>
            </div>

            <div style="display:inline-block; text-align:center; border:1px solid black; padding:2px;">
                <a tabindex="51" href="https://github.com/Strilanc/Quirk/wiki/How-to-use-Quirk">
                    <div style="width:128px;">
                        <svg version="1.1" viewBox="0 0 20 25" width="48" height="48">
                          <text x="5" y="9" style="font-size: 8px;">???</text>
                          <path d="M0 0 h20 v25 h-20 v-25 M3 13 h14 M3 17 h14 M3 21 h14" stroke="black" fill="transparent"></path>
                        </svg>
                        <div>How to Use</div>
                    </div>
                </a>
            </div>

            <div style="display:inline-block; text-align:center; border:1px solid black; padding:2px;">
                <a tabindex="52" href="https://www.youtube.com/watch?v=aloFwlBUwsQ">
                    <div style="width:128px;">
                        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAACt0lEQVQoz+3SP09TYRQG8IOL4RsgSNvbv4C4uMAkLgbippEw6CKwqIuGwW/gZEI6kIiDo0MnEk1MmEBLRQFbCnJLa6WlFK6K2kKrBarH55p7TUWa1vgm8pqe5Jc0vbfneZ+8JWYmmUl9+FqBWoFagf+hwP5Jn/TUQw/cgmG4Dz54DH4IQQwSkIaMgf+Q+bu0sStm7PYbWT4je9g4i36meio3a+2eOrgBGeBDKmOcse63Aql29yiwJO79cvjVE+4+YMn0/SyQbHNPA0tm+sfhV9rcdmBJOehNq2sQWFKDFG91eYEl5aXXLS4fsKR8FPM4A8BCtLq3hO2qToCiHqcKLMJOKrW3NnTzZbTFlRO1swKVlt1ODViEr9ks65NPpQor/VeCyx5XQdTuMjSKuBw5YBHMAvoU9/Z4MxzejvdeDOJZUVTGPjlS8UGUYkkBc/JbW7weCGRi53rm8c43kXk6euV0sCgHFTBv46OmcXp8/F3kTNeCyExadDhYlHIFSm/jbTLJqbGx9aWOjoiITFpw2FmUSgXM2/iwscFaIsHRgf7I32ZS2G5nUaopoM+237+61Nm5JCKT5hU7i1LxLxQKaerprrDITAopCotSrsAXVX0f6e4OiswyUdCmsCj7C+wkk9no+QtzeFYUmVOK5qxKDlgEs8CupuWjly7P4LtdUbvLyNGsVdGARSisJArxq9dmZ232gqidFWg0Y7GpwEJYlbywXdVR6UWzbQpYUlP0vNnmA5aUj6aPW73AkvLSsybrALCkBijQZFWAJaWQPlONlgCwZAJkztNGSy+wZHqpdJ4cs4wAS2KEDprJBssgJIEPqU24DnVUbiYamo/AKeiH23AXHsAjmISQIQ4J0CBjyAJX4bPx/idjh27R2DsBD43MUbgDQ3AWjv52YGaWWq1ArUCtQK3Av/UdR/1BF+14cggAAAAASUVORK5CYII=">
                        <div>Tutorial Video</div>
                    </div>
                </a>
            </div>

            <div style="display:inline-block; text-align:center; border:1px solid black; padding:2px;">
                <a tabindex="53" href="https://github.com/Strilanc/Quirk">
                    <div style="width:128px;">
                        <svg version="1.1" viewBox="0 0 16 16" width="48" height="48">
                            <path fill-rule="evenodd"
                                  d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z">
                            </path>
                        </svg>
                        <div>Source Code</div>
                    </div>
                </a>
            </div>
        </div>
        <div style="display:inline-block; vertical-align:top; line-height:1.8; padding:13px 15px 13px 5px; background-color:#DDD; border:1px solid gray; margin:0 0 0 -5px;">
            Example Circuits<br>
            <a id="example-anchor-grover">Grover Search</a><br>
            <a id="example-anchor-shor">Shor Period Finding</a><br>
            <a id="example-chsh-test">Bell Inequality Test (CHSH)</a><br>
            <a id="example-anchor-teleport">Quantum Teleportation</a><br>
            <a id="example-superdense-coding">Superdense Coding</a><br>
            <a id="example-anchor-delayed-eraser">Delayed Choice Eraser</a><br>
            <a id="example-symmetry-break">Symmetry Breaking</a><br>
            <a id="example-qft">Quantum Fourier Transform</a><br>
            <a id="example-addition">Reversible Addition</a><br>
            <a id="example-anchor-distill">Magic State Distillation</a><br>
        </div>

        <div style="/* display: inline-block; */ vertical-align: top; /* line-height: 1.8; */ padding: 13px 15px 13px 5px; background-color: white; border: 1px solid white; /* margin: 0 0 0 -5px; */ font-family: sans-serif; font-size: small">
          <!-- <h3>Shortcuts</h3> -->
          <table>
            <thead>
              <tr>
                <th>Shortcut</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><kbd>Ctrl</kbd> + <kbd>z</kbd></td>
                <td>Undo</td>
              </tr>
              <tr>
                <td><kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>z</kbd> (or <kbd>Ctrl</kbd> + <kbd>y</kbd>)</td>
                <td>Redo</td>
              </tr>
              <tr>
                <td><kbd>Middle Mouse Button</kbd> on gate in circuit</td>
                <td>Delete gate</td>
              </tr>
              <tr>
                <td><kbd>Shift</kbd> + <kbd>Left Mouse</kbd> on gate in circuit</td>
                <td>Duplicate gate</td>
              </tr>
              <tr>
                <td><kbd>Ctrl</kbd> / <kbd>Meta</kbd> + drag gate in circuit</td>
                <td>Move dependent gates together (e.g. controlled gates)</td>
              </tr>
              <tr>
                <td><kbd>Shift</kbd> + <kbd>Ctrl</kbd> / <kbd>Meta</kbd> + drag gate in circuit</td>
                <td>Duplicate &amp; move gate</td>
              </tr>
            </tbody>
          </table>
        </div>

    </div>
</div>


        <div id="error-div" style="display:none; font-size:24px; font-family:monospace; color:red;">
    <div id="error-happened-div">An error happened. :(</div>
    <div id="error-message-div" style="font-size: 16px;"></div>
    <div id="error-known-div" style="font-size: 18px;">
        <br>
        <a id="error-known-issue-anchor">See more / complain about this issue on github</a>.
        <br>
        <br>
    </div>
    <div id="error-report-div">
        <br>
        Please report it:
        <ul style="font-size: 18px;">
            <li>
                <a id="error-github-anchor">Create an issue on github</a>
                (requires an account)
                (repository: <a href="https://github.com/Strilanc/Quirk">Strilanc/Quirk</a>)
            </li>
            <li>
                or <a id="error-mailto-anchor"></a>
            </li>
        </ul>
        <br>
        <br>
        Useful details to mention (auto-included if you use the create/email links above):
        <div style="font-size: 16px;">
            <br>
            <div id="error-description-div"></div>
            <br>
            PRE-DRAWN
            <br>
            <img id="error-image-pre" src="#" style="max-height: 250px; max-width: 600px"/>
            <br>
            POST-DRAWN
            <br>
            <img id="error-image-post" src="#" style="max-height: 250px; max-width: 600px"/>
        </div>
    </div>
</div>


        <!-- Javascript detection -->
        <div id="noscript-div" class="noscript-warning" style="
                        animation-duration: 3.0s;
                   -moz-animation-duration: 3.0s;
                -webkit-animation-duration: 3.0s;
                     -o-animation-duration: 3.0s;
                        animation-name: delay-showing-before-hide-script-can-run-but-then-jump-in;
                   -moz-animation-name: delay-showing-before-hide-script-can-run-but-then-jump-in;
                -webkit-animation-name: delay-showing-before-hide-script-can-run-but-then-jump-in;
                     -o-animation-name: delay-showing-before-hide-script-can-run-but-then-jump-in;
                      background-color: white;
                                border: 1px solid red;
                               padding: 10px;">
            <style scoped>
                @keyframes delay-showing-before-hide-script-can-run-but-then-jump-in {
                    from { opacity: 0; }
                    95% { opacity: 0; }
                    to { opacity: 1; }
                }
                @-webkit-keyframes delay-showing-before-hide-script-can-run-but-then-jump-in {
                    from { opacity: 0; }
                    95% { opacity: 0; }
                    to { opacity: 1; }
                }
                @-moz-keyframes delay-showing-before-hide-script-can-run-but-then-jump-in {
                    from { opacity: 0; }
                    95% { opacity: 0; }
                    to { opacity: 1; }
                }
                @-o-keyframes delay-showing-before-hide-script-can-run-but-then-jump-in {
                    from { opacity: 0; }
                    95% { opacity: 0; }
                    to { opacity: 1; }
                }

                .noscript-warning {
                    color: red;
                    font-size: 24px;
                    position: absolute;
                    top: 25%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                }
            </style>
            You appear to have JavaScript blocked. And Quirk is made out of JavaScript... :(
        </div>
        <script>
          document.getElementById('noscript-div').style.display = 'none';
        </script>

        <script>
          document.getElementById('noscript-div').style.display = 'block';
          //noinspection InnerHTMLJS
          document.QUIRK_QUINE_ALL_HTML_ORIGINAL = '<!'+'DOCTYPE html>\n<'+'html>\n    ' +
                  document.documentElement.innerHTML + '\n<' + '/html>';
          document.getElementById('noscript-div').style.display = 'none';
//DEFAULT_CIRCUIT_START
document.DEFAULT_CIRCUIT = undefined;
//DEFAULT_CIRCUIT_END

// UN-MINIFIED SOURCE IS AVAILABLE FROM github.com/Strilanc/Quirk

!function(e){"use strict";function t(e){e.Reflect=e.Reflect||{},e.Reflect.global=e.Reflect.global||e}e.$traceurRuntime||(t(e),e.$traceurRuntime={options:{},setupGlobals:t,typeof:function(e){return typeof e}})}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this),function(){var t=new RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([\\w\\d\\-\\u0100-\\uffff.%]*)(?::([0-9]+))?)?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$"),s={SCHEME:1,USER_INFO:2,DOMAIN:3,PORT:4,PATH:5,QUERY_DATA:6,FRAGMENT:7};function a(e){return e.match(t)}function l(e){if("/"===e)return"/";for(var t="/"===e[0]?"/":"",r="/"===e.slice(-1)?"/":"",n=e.split("/"),i=[],a=0,o=0;o<n.length;o++){var u=n[o];switch(u){case"":case".":break;case"..":i.length?i.pop():a++;break;default:i.push(u)}}if(!t){for(;0<a--;)i.unshift("..");0===i.length&&i.push(".")}return t+i.join("/")+r}function o(e){var t,r,n,i,a,o,u=l(e[s.PATH]||"");return e[s.PATH]=u,u=e[s.SCHEME],t=e[s.USER_INFO],r=e[s.DOMAIN],n=e[s.PORT],i=e[s.PATH],a=e[s.QUERY_DATA],e=e[s.FRAGMENT],o=[],u&&o.push(u,":"),r&&(o.push("//"),t&&o.push(t,"@"),o.push(r),n)&&o.push(":",n),i&&o.push(i),a&&o.push("?",a),e&&o.push("#",e),o.join("")}$traceurRuntime.canonicalizeUrl=function(e){return o(a(e))},$traceurRuntime.isAbsolute=function(e){return!(!e||"/"!==e[0]&&!a(e)[s.SCHEME])},$traceurRuntime.removeDotSegments=l,$traceurRuntime.resolveUrl=function(e,t){var r=a(t),n=a(e);if(!r[s.SCHEME]){r[s.SCHEME]=n[s.SCHEME];for(var i=s.SCHEME;i<=s.PORT;i++)r[i]||(r[i]=n[i]);"/"!=r[s.PATH][0]&&(e=(t=n[s.PATH]).lastIndexOf("/"),t=t.slice(0,e+1)+r[s.PATH],r[s.PATH]=t)}return o(r)}}(),function(t){"use strict";var r,e=$traceurRuntime,n=e.canonicalizeUrl,i=e.resolveUrl,a=e.isAbsolute,o=Object.create(null);function u(e,t){this.url=e,this.value_=t}function s(e,t){this.message=this.constructor.name+": "+this.stripCause(t)+" in "+e,t instanceof s||!t.stack?this.stack="":this.stack=this.stripStack(t.stack)}function l(e){for(var t="",r=0;r<e-1;r++)t+="-";return t}function c(e,t){u.call(this,e,null),this.func=t}r=t.location&&t.location.href?i(t.location.href,"./"):"",((s.prototype=Object.create(Error.prototype)).constructor=s).prototype.stripError=function(e){return e.replace(/.*Error:/,this.constructor.name+":")},s.prototype.stripCause=function(e){return e?e.message?this.stripError(e.message):e+"":""},s.prototype.loadedBy=function(e){this.stack+="\n loaded by "+e},s.prototype.stripStack=function(e){var t=[];return e.split("\n").some(function(e){if(/UncoatedModuleInstantiator/.test(e))return!0;t.push(e)}),t[0]=this.stripError(t[0]),t.join("\n")},(c.prototype=Object.create(u.prototype)).getUncoatedModule=function(){var e,i,a,o=this;if(this.value_)return this.value_;try{return $traceurRuntime.require&&(e=$traceurRuntime.require.bind(null,this.url)),this.value_=this.func.call(t,e)}catch(e){if(e instanceof s)throw e.loadedBy(this.url),e;throw e.stack&&(i=this.func.toString().split("\n"),a=[],e.stack.split("\n").some(function(e,t){if(0<e.indexOf("UncoatedModuleInstantiator.getUncoatedModule"))return!0;var r,n=/(at\s[^\s]*\s).*>:(\d*):(\d*)\)/.exec(e);n?(r=parseInt(n[2],10),a=a.concat(function(e,t){for(var r=[],n=t-3,i=n=n<0?0:n;i<t;i++)r.push(e[i]);return r}(i,r)),1===t?a.push(l(n[3])+"^ "+o.url):a.push(l(n[3])+"^"),(a=a.concat(function(e,t){for(var r=t+1,n=(r>e.length-1&&(r=e.length-1),[]),i=t;i<=r;i++)n.push(e[i]);return n}(i,r))).push("= = = = = = = = =")):a.push(e)}),e.stack=a.join("\n")),new s(this.url,e)}};var d=Object.create(null),m={};function f(i){var a=arguments[1],o=Object.create(null);return Object.getOwnPropertyNames(i).forEach(function(e){var t,r,n;(t=a===m&&(n=Object.getOwnPropertyDescriptor(i,e)).get?n.get:t)||(r=i[e],t=function(){return r}),Object.defineProperty(o,e,{get:t,enumerable:!0})}),Object.preventExtensions(o),o}var h={normalize:function(e,t,r){if("string"!=typeof e)throw new TypeError("module name must be a string, not "+typeof e);if(a(e))return n(e);if(/[^\.]\/\.\.\//.test(e))throw new Error("module name embeds /../: "+e);return"."===e[0]&&t?i(t,e):n(e)},get:function(e){var t,e=function(e){if(e)return e=h.normalize(e),o[e]}(e);if(e)return(t=d[e.url])||(t=f(e.getUncoatedModule(),m),d[e.url]=t)},set:function(e,t){e=String(e),o[e]=new c(e,function(){return t}),d[e]=t},get baseURL(){return r},set baseURL(e){r=String(e)},registerModule:function(e,t,r){e=h.normalize(e);if(o[e])throw new Error("duplicate module named "+e);o[e]=new c(e,r)},bundleStore:Object.create(null),register:function(e,t,i){t&&(t.length||i.length)?this.bundleStore[e]={deps:t,execute:function(){var r=arguments,n={},e=(t.forEach(function(e,t){return n[e]=r[t]}),i.call(this,n));return e.execute.call(this),e.exports}}:this.registerModule(e,t,i)},getAnonymousModule:function(e){return new f(e(),m)}},e=new f({ModuleStore:h}),g=(h.set("@traceur/src/runtime/ModuleStore.js",e),$traceurRuntime.setupGlobals);$traceurRuntime.setupGlobals=function(e){g(e)},$traceurRuntime.ModuleStore=h,$traceurRuntime.registerModule=h.registerModule.bind(h),$traceurRuntime.getModule=h.get,$traceurRuntime.setModule=h.set,$traceurRuntime.normalizeModuleName=h.normalize}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/new-unique-string.js",[],function(){"use strict";var e=Math.random,t=Date.now()%1e9;function r(){return"__$"+(1e9*e()>>>1)+"$"+ ++t+"$__"}return{get default(){return r}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/has-native-symbols.js",[],function(){"use strict";var e=!!Object.getOwnPropertySymbols&&"function"==typeof Symbol;function t(){return e}return{get default(){return t}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/symbols.js",[],function(){"use strict";var r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../new-unique-string.js","traceur-runtime@0.0.111/src/runtime/modules/symbols.js")).default,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../has-native-symbols.js","traceur-runtime@0.0.111/src/runtime/modules/symbols.js")).default,t=Object.create,n=Object.defineProperty,i=Object.freeze,a=Object.getOwnPropertyNames,o=Object.keys,u=TypeError;function s(e){return{configurable:!0,enumerable:!1,value:e,writable:!0}}function l(e){if(e=new h(e),this instanceof l)throw new u("Symbol cannot be new'ed");return e}var c=r(),d=r(),m=r(),f=t(null);function h(e){var t=r();n(this,m,{value:this}),n(this,c,{value:t}),n(this,d,{value:e}),i(this),f[t]=this}function g(e){for(var t,r=[],n=0;n<e.length;n++)t=e[n],f[t]||r.push(e[n]);return r}function p(e){return g(a(e))}function v(e){return g(o(e))}function y(e){for(var t=[],r=a(e),n=0;n<r.length;n++){var i=f[r[n]];i&&t.push(i)}return t}n(l.prototype,"constructor",s(l)),n(l.prototype,"toString",s(function(){return this[m][c]})),n(l.prototype,"valueOf",s(function(){var e=this[m];if(e)return e[c];throw u("Conversion from symbol to string")})),n(h.prototype,"constructor",s(l)),n(h.prototype,"toString",{value:l.prototype.toString,enumerable:!1}),n(h.prototype,"valueOf",{value:l.prototype.valueOf,enumerable:!1}),i(h.prototype);var b,t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:void 0,R=(b=(t=t).Object,e()||(t.Symbol=l,b.getOwnPropertyNames=p,b.keys=v,n(b,"getOwnPropertySymbols",s(y))),t.Symbol.iterator||(t.Symbol.iterator=t.Symbol("Symbol.iterator")),t.Symbol.observer||(t.Symbol.observer=t.Symbol("Symbol.observer")),e()?function(e){return typeof e}:function(e){return e instanceof h?"symbol":typeof e});return{get typeof(){return R}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/typeof.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./symbols.js","traceur-runtime@0.0.111/src/runtime/modules/typeof.js"));return{get default(){return e.typeof}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/symbols.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/typeof.js","traceur-runtime@0.0.111/src/runtime/symbols.js")).default;return $traceurRuntime.typeof=e,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/createClass.js",[],function(){"use strict";var a=Object,o=TypeError,e=Object,u=e.create,s=e.defineProperties,l=e.defineProperty,n=e.getOwnPropertyDescriptor,r=e.getOwnPropertyNames,i=e.getOwnPropertySymbols;function c(e,t){r(e).forEach(t),i&&i(e).forEach(t)}function d(t){var r={};return c(t,function(e){r[e]=n(t,e),r[e].enumerable=!1}),r}var m={enumerable:!1};function t(e,t,r,n){var i;return l(t,"constructor",{value:e,configurable:!0,enumerable:!1,writable:!0}),3<arguments.length?("function"==typeof n&&(e.__proto__=n),e.prototype=u(function(e){if("function"==typeof e){var t=e.prototype;if(a(t)===t||null===t)return e.prototype;throw new o("super prototype must be an Object or null")}if(null===e)return null;throw new o("Super expression must either be null or a function, not "+typeof e+".")}(n),d(t))):(c(i=t,function(e){l(i,e,m)}),e.prototype=t),l(e,"prototype",{configurable:!1,writable:!1}),s(e,d(r))}return{get default(){return t}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/superConstructor.js",[],function(){"use strict";function e(e){return e.__proto__}return{get default(){return e}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/superDescriptor.js",[],function(){"use strict";var e=Object,i=e.getOwnPropertyDescriptor,a=e.getPrototypeOf;function t(e,t){var r=a(e);do{var n=i(r,t);if(n)return n}while(r=a(r))}return{get default(){return t}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/superGet.js",[],function(){"use strict";var n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./superDescriptor.js","traceur-runtime@0.0.111/src/runtime/modules/superGet.js")).default;function e(e,t,r){t=n(t,r);if(t)return(r=t.value)||(t.get?t.get.call(e):r)}return{get default(){return e}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/superSet.js",[],function(){"use strict";var i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./superDescriptor.js","traceur-runtime@0.0.111/src/runtime/modules/superSet.js")).default,a=TypeError;function e(e,t,r,n){t=i(t,r);if(t&&t.set)return t.set.call(e,n),n;throw a("super has no setter '"+r+"'.")}return{get default(){return e}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/classes.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/createClass.js","traceur-runtime@0.0.111/src/runtime/classes.js")).default,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/superConstructor.js","traceur-runtime@0.0.111/src/runtime/classes.js")).default,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/superGet.js","traceur-runtime@0.0.111/src/runtime/classes.js")).default,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/superSet.js","traceur-runtime@0.0.111/src/runtime/classes.js")).default;return $traceurRuntime.createClass=e,$traceurRuntime.superConstructor=t,$traceurRuntime.superGet=r,$traceurRuntime.superSet=n,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/exportStar.js",[],function(){"use strict";var e=Object,o=e.defineProperty,u=e.getOwnPropertyNames;function t(i){for(var a=arguments,e=function(e){for(var r=a[e],n=u(r),t=0;t<n.length;t++)(function(e){var t=n[e];if("__esModule"===t||"default"===t)return;o(i,t,{get:function(){return r[t]},enumerable:!0})})(t)},t=1;t<arguments.length;t++)e(t);return i}return{get default(){return t}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/exportStar.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/exportStar.js","traceur-runtime@0.0.111/src/runtime/exportStar.js")).default;return $traceurRuntime.exportStar=e,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/private-symbol.js",[],function(){"use strict";var t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./new-unique-string.js","traceur-runtime@0.0.111/src/runtime/private-symbol.js")).default,r="function"==typeof Symbol?Symbol:void 0,a=Object.getOwnPropertySymbols,n=(0,Object.create)(null);function o(e){return n[e]}function e(){var e=(r||t)();return n[e]=!0,e}function i(e,t){return hasOwnProperty.call(e,t)}function u(e,t){return!!i(e,t)&&(delete e[t],!0)}function s(e,t,r){e[t]=r}function l(e,t){var r=e[t];return void 0!==r&&hasOwnProperty.call(e,t)?r:void 0}function c(){a&&(Object.getOwnPropertySymbols=function(e){for(var t=[],r=a(e),n=0;n<r.length;n++){var i=r[n];o(i)||t.push(i)}return t})}return{get isPrivateSymbol(){return o},get createPrivateSymbol(){return e},get hasPrivate(){return i},get deletePrivate(){return u},get setPrivate(){return s},get getPrivate(){return l},get init(){return c}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/private-weak-map.js",[],function(){"use strict";var e="function"==typeof WeakMap?WeakMap:void 0;function t(e){return!1}function r(){return new e}function n(e,t){return t.has(e)}function i(e,t){return t.delete(e)}function a(e,t,r){t.set(e,r)}function o(e,t){return t.get(e)}function u(){}return{get isPrivateSymbol(){return t},get createPrivateSymbol(){return r},get hasPrivate(){return n},get deletePrivate(){return i},get setPrivate(){return a},get getPrivate(){return o},get init(){return u}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/private.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./private-symbol.js","traceur-runtime@0.0.111/src/runtime/private.js")),t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./private-weak-map.js","traceur-runtime@0.0.111/src/runtime/private.js")),t="function"==typeof WeakMap?t:e,r=t.isPrivateSymbol,n=t.createPrivateSymbol,i=t.hasPrivate,a=t.deletePrivate,o=t.setPrivate,u=t.getPrivate;return t.init(),{get isPrivateSymbol(){return r},get createPrivateSymbol(){return n},get hasPrivate(){return i},get deletePrivate(){return a},get setPrivate(){return o},get getPrivate(){return u}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/properTailCalls.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../private.js","traceur-runtime@0.0.111/src/runtime/modules/properTailCalls.js")),t=e.getPrivate,r=e.setPrivate,n=e.createPrivateSymbol,a=Function.prototype.call.bind(Function.prototype.apply),i=Object.create(null),o=null;function u(e,t,r){return[i,e,t,r]}function s(e){return e&&e[0]===i}function l(e,t){return new(function(e,t,r){for(var n=[t],i=0;i<r.length;i++)n[i+1]=r[i];return a(Function.prototype.bind,e,n)}(e,null,t))}function c(e){return t(e,o)}function d(e,t,r){var n=r[0];if(s(n))return n=a(e,t,n[3]);for(n=u(e,t,r);;){if(!s(n=c(e)?a(e,n[2],[n]):a(e,n[2],n[3])))return n;e=n[1]}}function m(){var e=c(this)?l(this,[u(null,null,arguments)]):l(this,arguments);return e}function f(e){return null===o&&(o=n(),Function.prototype.call=f(function(e){return d(function(e){for(var t=[],r=1;r<arguments.length;++r)t[r-1]=arguments[r];return u(this,e,t)},this,arguments)}),Function.prototype.apply=f(function(e,t){return d(function(e,t){return u(this,e,t)},this,arguments)})),r(e,o,!0),e}return{get createContinuation(){return u},get tailCall(){return d},get construct(){return m},get initTailRecursiveFunction(){return f}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/initTailRecursiveFunction.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./properTailCalls.js","traceur-runtime@0.0.111/src/runtime/modules/initTailRecursiveFunction.js"));return{get default(){return e.initTailRecursiveFunction}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/call.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./properTailCalls.js","traceur-runtime@0.0.111/src/runtime/modules/call.js"));return{get default(){return e.tailCall}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/continuation.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./properTailCalls.js","traceur-runtime@0.0.111/src/runtime/modules/continuation.js"));return{get default(){return e.createContinuation}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/construct.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./properTailCalls.js","traceur-runtime@0.0.111/src/runtime/modules/construct.js"));return{get default(){return e.construct}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/properTailCalls.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/initTailRecursiveFunction.js","traceur-runtime@0.0.111/src/runtime/properTailCalls.js")).default,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/call.js","traceur-runtime@0.0.111/src/runtime/properTailCalls.js")).default,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/continuation.js","traceur-runtime@0.0.111/src/runtime/properTailCalls.js")).default,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/construct.js","traceur-runtime@0.0.111/src/runtime/properTailCalls.js")).default;return $traceurRuntime.initTailRecursiveFunction=e,$traceurRuntime.call=t,$traceurRuntime.continuation=r,$traceurRuntime.construct=n,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/relativeRequire.js",[],function(){"use strict";var r;return $traceurRuntime.require=function(e,t){if(r=r||"undefined"!=typeof require&&require("path"),"/"!==t.slice(-1)&&"/"!==t[0])return"."===t[0]?require(r.resolve(r.dirname(e),t)):require(t)},{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/checkObjectCoercible.js",[],function(){"use strict";var t=TypeError;function e(e){if(null==e)throw new t("Value cannot be converted to an Object");return e}return{get default(){return e}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/spread.js",[],function(){"use strict";var o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../checkObjectCoercible.js","traceur-runtime@0.0.111/src/runtime/modules/spread.js")).default;function e(){for(var e,t=[],r=0,n=0;n<arguments.length;n++){var i=o(arguments[n]);if("function"!=typeof i[Symbol.iterator])throw new TypeError("Cannot spread non-iterable object.");for(var a=i[Symbol.iterator]();!(e=a.next()).done;)t[r++]=e.value}return t}return{get default(){return e}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/spread.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/spread.js","traceur-runtime@0.0.111/src/runtime/spread.js")).default;return $traceurRuntime.spread=e,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/iteratorToArray.js",[],function(){"use strict";function e(e){for(var t,r=[],n=0;!(t=e.next()).done;)r[n++]=t.value;return r}return{get default(){return e}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/destructuring.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/iteratorToArray.js","traceur-runtime@0.0.111/src/runtime/destructuring.js")).default;return $traceurRuntime.iteratorToArray=e,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/async.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../private.js","traceur-runtime@0.0.111/src/runtime/modules/async.js")),t=e.createPrivateSymbol,n=e.getPrivate,i=e.setPrivate,e=Object,a=e.create,e=e.defineProperty,o=t();function r(){}function u(){}(r.prototype=u).constructor=r,e(u,"constructor",{enumerable:!1});var s=$traceurRuntime.createClass(function(e){var t=this;this.decoratedObserver=p(e,function(){t.done=!0}),this.done=!1,this.inReturn=!1},{throw:function(e){if(!this.inReturn)throw e},yield:function(e){if(this.done)throw void(this.inReturn=!0);var t;try{t=this.decoratedObserver.next(e)}catch(e){throw this.done=!0,e}if(void 0!==t){if(t.done)throw this.done=!0,void(this.inReturn=!0);return t.value}},yieldFor:function(e){var r=this;return d(e[Symbol.observer].bind(e),function(e){if(r.done)this.return();else{var t;try{t=r.decoratedObserver.next(e)}catch(e){throw r.done=!0,e}if(void 0!==t)return t.done&&(r.done=!0),t}})}},{});function l(e){return e.prototype=a(u.prototype),e.__proto__=u,e}function c(e,t){for(var r=2;r<arguments.length;r++)r-2,0;t=a(t.prototype);return i(t,o,e),t}function d(e,i){return new Promise(function(t,r){var n=e({next:function(e){return i.call(n,e)},throw:function(e){r(e)},return:function(e){t(e)}})})}function m(e){return Promise.resolve().then(e)}u.prototype[Symbol.observer]=function(e){var t=n(this,o),r=new s(e);return m(function(){return t(r)}).then(function(e){r.done||r.decoratedObserver.return(e)}).catch(function(e){r.done||r.decoratedObserver.throw(e)}),r.decoratedObserver},e(u.prototype,Symbol.observer,{enumerable:!1});var f=Symbol(),h=Symbol(),g=$traceurRuntime.createClass(function(e,t){this[f]=e,this[h]=t},{next:function(e){e=this[f].next(e);return void 0!==e&&e.done&&this[h].call(this),e},throw:function(e){return this[h].call(this),this[f].throw(e)},return:function(e){return this[h].call(this),this[f].return(e)}},{});function p(e,t){return new g(e,t)}return Array.prototype[Symbol.observer]=function(t){var e=!1,r=p(t,function(){return e=!0}),n=!0,t=!1,i=void 0;try{for(var a,o=this[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var u=a.value;if(r.next(u),e)return}}catch(e){t=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(t)throw i}}return r.return(),r},e(Array.prototype,Symbol.observer,{enumerable:!1}),{get initAsyncGeneratorFunction(){return l},get createAsyncGeneratorInstance(){return c},get observeForEach(){return d},get schedule(){return m},get createDecoratedGenerator(){return p}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/initAsyncGeneratorFunction.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./async.js","traceur-runtime@0.0.111/src/runtime/modules/initAsyncGeneratorFunction.js"));return{get default(){return e.initAsyncGeneratorFunction}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/createAsyncGeneratorInstance.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./async.js","traceur-runtime@0.0.111/src/runtime/modules/createAsyncGeneratorInstance.js"));return{get default(){return e.createAsyncGeneratorInstance}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/observeForEach.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./async.js","traceur-runtime@0.0.111/src/runtime/modules/observeForEach.js"));return{get default(){return e.observeForEach}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/schedule.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./async.js","traceur-runtime@0.0.111/src/runtime/modules/schedule.js"));return{get default(){return e.schedule}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/createDecoratedGenerator.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./async.js","traceur-runtime@0.0.111/src/runtime/modules/createDecoratedGenerator.js"));return{get default(){return e.createDecoratedGenerator}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/async.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/initAsyncGeneratorFunction.js","traceur-runtime@0.0.111/src/runtime/async.js")).default,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/createAsyncGeneratorInstance.js","traceur-runtime@0.0.111/src/runtime/async.js")).default,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/observeForEach.js","traceur-runtime@0.0.111/src/runtime/async.js")).default,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/schedule.js","traceur-runtime@0.0.111/src/runtime/async.js")).default,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/createDecoratedGenerator.js","traceur-runtime@0.0.111/src/runtime/async.js")).default;return $traceurRuntime.initAsyncGeneratorFunction=e,$traceurRuntime.createAsyncGeneratorInstance=t,$traceurRuntime.observeForEach=r,$traceurRuntime.schedule=n,$traceurRuntime.createDecoratedGenerator=i,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/generators.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../private.js","traceur-runtime@0.0.111/src/runtime/modules/generators.js")),t=e.createPrivateSymbol,r=e.getPrivate,n=e.setPrivate,o=TypeError,e=Object,i=e.create,a=e.defineProperties,e=e.defineProperty;function u(e){return{configurable:!0,enumerable:!1,value:e,writable:!0}}function s(e){return new Error("Traceur compiler bug: invalid state in state machine: "+e)}var l={};function c(){this.state=0,this.GState=0,this.storedException=void 0,this.finallyFallThrough=void 0,this.sent_=void 0,this.returnValue=void 0,this.oldReturnValue=void 0,this.tryStack_=[]}function d(t,e,r,n){switch(t.GState){case 1:throw new Error('"'+r+'" on executing generator');case 3:if("next"==r)return{value:void 0,done:!0};if(n===l)return{value:t.returnValue,done:!0};throw n;case 0:if("throw"===r){if(t.GState=3,n===l)return{value:t.returnValue,done:!0};throw n}if(void 0!==n)throw o("Sent value to newborn generator");case 2:var i;t.GState=1,t.action=r,t.sent=n;try{i=e(t)}catch(e){if(e!==l)throw e;i=t}var a=i===t;return a&&(i=t.returnValue),t.GState=a?3:2,{value:i,done:a}}}c.prototype={pushTry:function(e,t){if(null!==t){for(var r=null,n=this.tryStack_.length-1;0<=n;n--)if(void 0!==this.tryStack_[n].catch){r=this.tryStack_[n].catch;break}this.tryStack_.push({finally:t,finallyFallThrough:r=null===r?-3:r})}null!==e&&this.tryStack_.push({catch:e})},popTry:function(){this.tryStack_.pop()},maybeUncatchable:function(){if(this.storedException===l)throw l},get sent(){return this.maybeThrow(),this.sent_},set sent(e){this.sent_=e},get sentIgnoreThrow(){return this.sent_},maybeThrow:function(){if("throw"===this.action)throw this.action="next",this.sent_},end:function(){switch(this.state){case-2:return this;case-3:throw this.storedException;default:throw s(this.state)}},handleException:function(e){throw this.GState=3,this.state=-2,e},wrapYieldStar:function(r){var n=this;return{next:function(e){return r.next(e)},throw:function(e){var t;if(e===l){if(r.return){if(!(t=r.return(n.returnValue)).done)return n.returnValue=n.oldReturnValue,t;n.returnValue=t.value}throw e}if(r.throw)return r.throw(e);throw r.return&&r.return(),o("Inner iterator does not have a throw method")}}}};var m=t(),f=t();function h(){}function g(){}function p(e,t,r){e=R(e,r),r=new c,t=i(t.prototype);return n(t,m,r),n(t,f,e),t}function v(e){return e.prototype=i(g.prototype),e.__proto__=g,e}function y(){c.call(this),this.err=void 0;var r=this;r.result=new Promise(function(e,t){r.resolve=e,r.reject=t})}function b(e,t){var r=R(e,t),n=new y;return n.createCallback=function(t){return function(e){n.state=t,n.value=e,r(n)}},n.errback=function(e){w(n,e),r(n)},r(n),n.result}function R(e,r){return function(t){for(;;)try{return e.call(r,t)}catch(e){w(t,e)}}}function w(e,t){e.storedException=t;var r=e.tryStack_[e.tryStack_.length-1];r?(e.state=void 0!==r.catch?r.catch:r.finally,void 0!==r.finallyFallThrough&&(e.finallyFallThrough=r.finallyFallThrough)):e.handleException(t)}return e(h.prototype=g,"constructor",u(h)),a(g.prototype={constructor:g,next:function(e){return d(r(this,m),r(this,f),"next",e)},throw:function(e){return d(r(this,m),r(this,f),"throw",e)},return:function(e){var t=r(this,m);return t.oldReturnValue=t.returnValue,t.returnValue=e,d(t,r(this,f),"throw",l)}},{constructor:{enumerable:!1},next:{enumerable:!1},throw:{enumerable:!1},return:{enumerable:!1}}),Object.defineProperty(g.prototype,Symbol.iterator,u(function(){return this})),(y.prototype=i(c.prototype)).end=function(){switch(this.state){case-2:this.resolve(this.returnValue);break;case-3:this.reject(this.storedException);break;default:this.reject(s(this.state))}},y.prototype.handleException=function(){this.state=-3},{get createGeneratorInstance(){return p},get initGeneratorFunction(){return v},get asyncWrap(){return b}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/asyncWrap.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./generators.js","traceur-runtime@0.0.111/src/runtime/modules/asyncWrap.js"));return{get default(){return e.asyncWrap}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/initGeneratorFunction.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./generators.js","traceur-runtime@0.0.111/src/runtime/modules/initGeneratorFunction.js"));return{get default(){return e.initGeneratorFunction}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/createGeneratorInstance.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./generators.js","traceur-runtime@0.0.111/src/runtime/modules/createGeneratorInstance.js"));return{get default(){return e.createGeneratorInstance}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/generators.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/asyncWrap.js","traceur-runtime@0.0.111/src/runtime/generators.js")).default,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/initGeneratorFunction.js","traceur-runtime@0.0.111/src/runtime/generators.js")).default,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/createGeneratorInstance.js","traceur-runtime@0.0.111/src/runtime/generators.js")).default;return $traceurRuntime.asyncWrap=e,$traceurRuntime.initGeneratorFunction=t,$traceurRuntime.createGeneratorInstance=r,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/spawn.js",[],function(){"use strict";function e(e,o,u){return new Promise(function(t,r){function n(e){try{a(u.next(e))}catch(e){r(e)}}function i(e){try{a(u.throw(e))}catch(e){r(e)}}function a(e){e.done?t(e.value):Promise.resolve(e.value).then(n,i)}a((u=u.apply(e,o)).next())})}return{get default(){return e}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/spawn.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/spawn.js","traceur-runtime@0.0.111/src/runtime/spawn.js")).default;return $traceurRuntime.spawn=e,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/getTemplateObject.js",[],function(){"use strict";var e=Object,i=e.defineProperty,a=e.freeze,o=Array.prototype.slice,u=Object.create(null);function t(e){var t=arguments[1],r=e.join("${}"),n=u[r];return n||(t=t||o.call(e),u[r]=a(i(t,"raw",{value:a(e)})))}return{get default(){return t}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/template.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/getTemplateObject.js","traceur-runtime@0.0.111/src/runtime/template.js")).default;return $traceurRuntime.getTemplateObject=e,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/spreadProperties.js",[],function(){"use strict";var e=Object,o=e.defineProperty,t=e.getOwnPropertyNames,r=e.getOwnPropertySymbols,u=e.propertyIsEnumerable;function n(i,a){var e;null!=a&&((e=function(e){for(var t=0;t<e.length;t++){var r,n=e[t];u.call(a,n)&&(r=a[n],o(i,n,{configurable:!0,enumerable:!0,value:r,writable:!0}))}})(t(a)),e(r(a)))}function i(){for(var e=arguments[0],t=1;t<arguments.length;t++)n(e,arguments[t]);return e}return{get default(){return i}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/jsx.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/spreadProperties.js","traceur-runtime@0.0.111/src/runtime/jsx.js")).default;return $traceurRuntime.spreadProperties=e,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/runtime-modules.js",[],function(){"use strict";return $traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./symbols.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./classes.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./exportStar.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./properTailCalls.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./relativeRequire.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./spread.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./destructuring.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./async.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./generators.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./spawn.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./template.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./jsx.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),{}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/runtime-modules.js"),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/frozen-data.js",[],function(){"use strict";function n(e,t){for(var r=0;r<e.length;r+=2)if(e[r]===t)return r;return-1}function e(e,t,r){-1===n(e,t)&&e.push(t,r)}function t(e,t){t=n(e,t);if(-1!==t)return e[t+1]}function r(e,t){return-1!==n(e,t)}function i(e,t){t=n(e,t);return-1!==t&&(e.splice(t,2),!0)}return{get setFrozen(){return e},get getFrozen(){return t},get hasFrozen(){return r},get deleteFrozen(){return i}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/utils.js",[],function(){"use strict";var t=Math.ceil,r=Math.floor,n=isFinite,i=isNaN,e=Math.pow,a=Math.min,o=TypeError,u=Object;function s(e){if(null==e)throw o();return u(e)}function l(e){return e>>>0}function c(e){return e&&("object"==typeof e||"function"==typeof e)}function d(e){return"function"==typeof e}function m(e){return"number"==typeof e}function f(e){return i(e=+e)?0:0!==e&&n(e)?(0<e?r:t)(e):e}var h=e(2,53)-1;function g(e){e=f(e);return e<0?0:a(e,h)}function p(e){return c(e)?e[Symbol.iterator]:void 0}function v(e){return d(e)}function y(e,t){return{value:e,done:t}}function b(e,t,r){t in e||Object.defineProperty(e,t,r)}function R(e,t,r){b(e,t,{value:r,configurable:!0,enumerable:!1,writable:!0})}function w(e,t,r){b(e,t,{value:r,configurable:!1,enumerable:!1,writable:!1})}function M(e,t){for(var r=0;r<t.length;r+=2)R(e,t[r],t[r+1])}function _(e,t){for(var r=0;r<t.length;r+=2)w(e,t[r],t[r+1])}function x(e,t,r){r&&r.iterator&&!e[r.iterator]&&(e["@@iterator"]&&(t=e["@@iterator"]),Object.defineProperty(e,r.iterator,{value:t,configurable:!0,enumerable:!1,writable:!0}))}var S=[];function T(e){S.push(e)}function A(t){S.forEach(function(e){return e(t)})}return{get toObject(){return s},get toUint32(){return l},get isObject(){return c},get isCallable(){return d},get isNumber(){return m},get toInteger(){return f},get toLength(){return g},get checkIterable(){return p},get isConstructor(){return v},get createIteratorResultObject(){return y},get maybeDefine(){return b},get maybeDefineMethod(){return R},get maybeDefineConst(){return w},get maybeAddFunctions(){return M},get maybeAddConsts(){return _},get maybeAddIterator(){return x},get registerPolyfill(){return T},get polyfillAll(){return A}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/Map.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../private.js","traceur-runtime@0.0.111/src/runtime/polyfills/Map.js")),t=e.createPrivateSymbol,r=e.getPrivate,i=e.setPrivate,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../frozen-data.js","traceur-runtime@0.0.111/src/runtime/polyfills/Map.js")),n=e.deleteFrozen,a=e.getFrozen,o=e.setFrozen,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/Map.js")),c=e.isObject,e=e.registerPolyfill,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../has-native-symbols.js","traceur-runtime@0.0.111/src/runtime/polyfills/Map.js")).default,s=Object,l=s.defineProperty,d=(s.getOwnPropertyDescriptor,s.hasOwnProperty),m=s.isExtensible,f={},h=1,g=t();function p(e){return r(e,g)}function v(e,t){var r;return"string"==typeof t?e.stringIndex_[t]:c(t)?m(t)?void 0===(r=p(t))?void 0:e.objectIndex_[r]:a(e.frozenData_,t):e.primitiveIndex_[t]}function y(e){e.entries_=[],e.objectIndex_=Object.create(null),e.stringIndex_=Object.create(null),e.primitiveIndex_=Object.create(null),e.frozenData_=[],e.deletedCount_=0}var b=$traceurRuntime.createClass(function(){var e,t,r=arguments[0];if(!c(this))throw new TypeError("Map called on incompatible type");if(d.call(this,"entries_"))throw new TypeError("Map can not be reentrantly initialised");if(y(this),null!=r){var n=!0,i=!1,a=void 0;try{for(var o,u=r[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=(t=(e=o.value[Symbol.iterator]()).next()).done?void 0:t.value,l=(t=e.next()).done?void 0:t.value;this.set(s,l)}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}}},{get size(){return this.entries_.length/2-this.deletedCount_},get:function(e){e=v(this,e);if(void 0!==e)return this.entries_[e+1]},set:function(e,t){var r,n=v(this,e);return void 0!==n?this.entries_[n+1]=t:(n=this.entries_.length,this.entries_[n]=e,this.entries_[n+1]=t,c(e)?m(e)?((r=p(t=e))||(r=h++,i(t,g,r)),t=r,this.objectIndex_[t]=n):o(this.frozenData_,e,n):"string"==typeof e?this.stringIndex_[e]=n:this.primitiveIndex_[e]=n),this},has:function(e){return void 0!==v(this,e)},delete:function(e){var t=v(this,e);return void 0!==t&&(this.entries_[t]=f,this.entries_[t+1]=void 0,this.deletedCount_++,c(e)?m(e)?(t=p(e),delete this.objectIndex_[t]):n(this.frozenData_,e):"string"==typeof e?delete this.stringIndex_[e]:delete this.primitiveIndex_[e],!0)},clear:function(){y(this)},forEach:function(e){for(var t=arguments[1],r=0;r<this.entries_.length;r+=2){var n=this.entries_[r],i=this.entries_[r+1];n!==f&&e.call(t,i,n,this)}},entries:$traceurRuntime.initGeneratorFunction(function e(){var t,r,n;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=0,e.state=12;break;case 12:e.state=t<this.entries_.length?8:-2;break;case 4:t+=2,e.state=12;break;case 8:r=this.entries_[t],n=this.entries_[t+1],e.state=9;break;case 9:e.state=r===f?4:6;break;case 6:return e.state=2,[r,n];case 2:e.maybeThrow(),e.state=4;break;default:return e.end()}},e,this)}),keys:$traceurRuntime.initGeneratorFunction(function e(){var t,r;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=0,e.state=12;break;case 12:e.state=t<this.entries_.length?8:-2;break;case 4:t+=2,e.state=12;break;case 8:r=this.entries_[t],this.entries_[t+1],e.state=9;break;case 9:e.state=r===f?4:6;break;case 6:return e.state=2,r;case 2:e.maybeThrow(),e.state=4;break;default:return e.end()}},e,this)}),values:$traceurRuntime.initGeneratorFunction(function e(){var t,r,n;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=0,e.state=12;break;case 12:e.state=t<this.entries_.length?8:-2;break;case 4:t+=2,e.state=12;break;case 8:r=this.entries_[t],n=this.entries_[t+1],e.state=9;break;case 9:e.state=r===f?4:6;break;case 6:return e.state=2,n;case 2:e.maybeThrow(),e.state=4;break;default:return e.end()}},e,this)})},{});function R(e){!function(e){var t=e.Map,e=e.Symbol;if(!(t&&u()&&t.prototype[e.iterator]&&t.prototype.entries))return 1;try{return 1!==new t([[]]).size}catch(e){}}(e)||(e.Map=b)}return l(b.prototype,Symbol.iterator,{configurable:!0,writable:!0,value:b.prototype.entries}),e(R),{get Map(){return b},get polyfillMap(){return R}}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/Map.js"),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/Set.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/Set.js")),u=e.isObject,e=e.registerPolyfill,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./Map.js","traceur-runtime@0.0.111/src/runtime/polyfills/Set.js")).Map,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../has-native-symbols.js","traceur-runtime@0.0.111/src/runtime/polyfills/Set.js")).default,l=Object.prototype.hasOwnProperty,t=$traceurRuntime.createClass(function(){var e=arguments[0];if(!u(this))throw new TypeError("Set called on incompatible type");if(l.call(this,"map_"))throw new TypeError("Set can not be reentrantly initialised");if(this.map_=new s,null!=e){var t=!0,r=!1,n=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;this.add(o)}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}},{get size(){return this.map_.size},has:function(e){return this.map_.has(e)},add:function(e){return this.map_.set(e,e),this},delete:function(e){return this.map_.delete(e)},clear:function(){return this.map_.clear()},forEach:function(r){var n=arguments[1],i=this;return this.map_.forEach(function(e,t){r.call(n,t,t,i)})},values:$traceurRuntime.initGeneratorFunction(function e(){var t,r;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=e.wrapYieldStar(this.map_.keys()[Symbol.iterator]()),e.sent=void 0,e.action="next",e.state=12;break;case 12:r=t[e.action](e.sentIgnoreThrow),e.state=9;break;case 9:e.state=r.done?3:2;break;case 3:e.sent=r.value,e.state=-2;break;case 2:return e.state=12,r.value;default:return e.end()}},e,this)}),entries:$traceurRuntime.initGeneratorFunction(function e(){var t,r;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=e.wrapYieldStar(this.map_.entries()[Symbol.iterator]()),e.sent=void 0,e.action="next",e.state=12;break;case 12:r=t[e.action](e.sentIgnoreThrow),e.state=9;break;case 9:e.state=r.done?3:2;break;case 3:e.sent=r.value,e.state=-2;break;case 2:return e.state=12,r.value;default:return e.end()}},e,this)})},{});function n(e){!function(e){var t=e.Set,e=e.Symbol;if(!(t&&r()&&t.prototype[e.iterator]&&t.prototype.values))return 1;try{return 1!==new t([1]).size}catch(e){}}(e)||(e.Set=t)}return Object.defineProperty(t.prototype,Symbol.iterator,{configurable:!0,writable:!0,value:t.prototype.values}),Object.defineProperty(t.prototype,"keys",{configurable:!0,writable:!0,value:t.prototype.values}),e(n),{get Set(){return t},get polyfillSet(){return n}}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/Set.js"),$traceurRuntime.registerModule("traceur-runtime@0.0.111/node_modules/rsvp/lib/rsvp/asap.js",[],function(){"use strict";var t,r=0;function e(e,t){f[r]=e,f[r+1]=t,2===(r+=2)&&s()}var n="undefined"!=typeof window?window:void 0,i=n||{},i=i.MutationObserver||i.WebKitMutationObserver,a="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),o="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function u(){return function(){setTimeout(h,1)}}var s,l,c,d,m,f=new Array(1e3);function h(){for(var e=0;e<r;e+=2)(0,f[e])(f[e+1]),f[e]=void 0,f[e+1]=void 0;r=0}function g(){try{var e=require("vertx");return t=e.runOnLoop||e.runOnContext,function(){t(h)}}catch(e){return u()}}return s=a?(m=process.nextTick,a=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/),Array.isArray(a)&&"0"===a[1]&&"10"===a[2]&&(m=setImmediate),function(){m(h)}):i?(c=0,a=new i(h),d=document.createTextNode(""),a.observe(d,{characterData:!0}),function(){d.data=c=++c%2}):o?((l=new MessageChannel).port1.onmessage=h,function(){l.port2.postMessage(0)}):(void 0===n&&"function"==typeof require?g:u)(),{get default(){return e}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/Promise.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../../../node_modules/rsvp/lib/rsvp/asap.js","traceur-runtime@0.0.111/src/runtime/polyfills/Promise.js")).default,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/Promise.js")),a=t.isObject,t=t.registerPolyfill,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../private.js","traceur-runtime@0.0.111/src/runtime/polyfills/Promise.js")),n=r.createPrivateSymbol,o=r.getPrivate,u=r.setPrivate,i={};function s(e){return e&&"object"==typeof e&&void 0!==e.status_}function l(e){return e}function c(e){throw e}function d(e,t,r){var n=void 0!==t?t:l,i=void 0!==r?r:c,a=m(e.constructor);switch(e.status_){case void 0:throw TypeError;case 0:e.onResolve_.push(n,a),e.onReject_.push(i,a);break;case 1:w(e.value_,[n,a]);break;case-1:w(e.value_,[i,a])}return a.promise}function m(e){var t,r;return this===p?{promise:t=h(new p(i)),resolve:function(e){y(t,e)},reject:function(e){b(t,e)}}:((r={}).promise=new e(function(e,t){r.resolve=e,r.reject=t}),r)}function f(e,t,r,n,i){return e.status_=t,e.value_=r,e.onResolve_=n,e.onReject_=i,e}function h(e){return f(e,0,void 0,[],[])}var g=$traceurRuntime.createClass(function(e){if(e!==i){if("function"!=typeof e)throw new TypeError;var t=h(this);try{e(function(e){y(t,e)},function(e){b(t,e)})}catch(e){b(t,e)}}},{catch:function(e){return this.then(void 0,e)},then:function(t,r){"function"!=typeof t&&(t=l),"function"!=typeof r&&(r=c);var n=this,i=this.constructor;return d(this,function(e){return(e=function(t,r){if(!s(r)&&a(r)){var e;try{e=r.then}catch(e){var n=v.call(t,e);return u(r,M,n),n}if("function"==typeof e){n=o(r,M);if(n)return n;n=m(t);u(r,M,n.promise);try{e.call(r,n.resolve,n.reject)}catch(e){n.reject(e)}return n.promise}}return r}(i,e))===n?r(new TypeError):s(e)?e.then(t,r):t(e)},r)}},{resolve:function(r){return this===p?s(r)?r:f(new p(i),1,r):new this(function(e,t){e(r)})},reject:function(r){return this===p?f(new p(i),-1,r):new this(function(e,t){t(r)})},all:function(e){var r=m(this),n=[];try{var i=0,t=0,a=!0,o=!1,u=void 0;try{for(var s,l=e[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value,d=function(t){return function(e){n[t]=e,0==--i&&r.resolve(n)}}(t);this.resolve(c).then(d,function(e){r.reject(e)}),++t,++i}}catch(e){o=!0,u=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw u}}0===i&&r.resolve(n)}catch(e){r.reject(e)}return r.promise},race:function(e){var t=m(this);try{for(var r=0;r<e.length;r++)this.resolve(e[r]).then(function(e){t.resolve(e)},function(e){t.reject(e)})}catch(e){t.reject(e)}return t.promise}}),p=g,v=p.reject;function y(e,t){R(e,1,t,e.onResolve_)}function b(e,t){R(e,-1,t,e.onReject_)}function R(e,t,r,n){0===e.status_&&(w(r,n),f(e,t,r))}function w(a,o){e(function(){for(var e=0;e<o.length;e+=2){i=n=r=t=void 0;var t=a,r=o[e],n=o[e+1];try{var i=r(t);if(i===n.promise)throw new TypeError;s(i)?d(i,n.resolve,n.reject):n.resolve(i)}catch(e){try{n.reject(e)}catch(e){}}}})}var M=n();function _(e){e.Promise||(e.Promise=g)}return t(_),{get Promise(){return g},get polyfillPromise(){return _}}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/Promise.js"),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/StringIterator.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/StringIterator.js")),a=e.createIteratorResultObject,o=e.isObject,u=Object.prototype.hasOwnProperty,s=Symbol("iteratedString"),l=Symbol("stringIteratorNextIndex"),r=$traceurRuntime.createClass(function(){},(e={},Object.defineProperty(e,"next",{value:function(){var e,t,r,n,i=this;if(o(i)&&u.call(i,s))return void 0===(n=i[s])?a(void 0,!0):(e=i[l],(r=n.length)<=e?(i[s]=void 0,a(void 0,!0)):(n=(t=n.charCodeAt(e))<55296||56319<t||e+1===r||(r=n.charCodeAt(e+1))<56320||57343<r?String.fromCharCode(t):String.fromCharCode(t)+String.fromCharCode(r),i[l]=e+n.length,a(n,!1)));throw new TypeError("this must be a StringIterator object")},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(e,Symbol.iterator,{value:function(){return this},configurable:!0,enumerable:!0,writable:!0}),e),{});function t(e){var e=String(e),t=Object.create(r.prototype);return t[s]=e,t[l]=0,t}return{get createStringIterator(){return t}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/String.js",[],function(){"use strict";var t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../checkObjectCoercible.js","traceur-runtime@0.0.111/src/runtime/polyfills/String.js")).default,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./StringIterator.js","traceur-runtime@0.0.111/src/runtime/polyfills/String.js")).createStringIterator,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/String.js")),n=e.maybeAddFunctions,i=e.maybeAddIterator,e=e.registerPolyfill,o=Object.prototype.toString,a=String.prototype.indexOf,u=String.prototype.lastIndexOf;function s(e){var t=String(this);if(null==this||"[object RegExp]"==o.call(e))throw TypeError();var r=t.length,e=String(e),n=(e.length,1<arguments.length?arguments[1]:void 0),n=n?Number(n):0,r=(isNaN(n)&&(n=0),Math.min(Math.max(n,0),r));return a.call(t,e,n)==r}function l(e){var t=String(this);if(null==this||"[object RegExp]"==o.call(e))throw TypeError();var r=t.length,e=String(e),n=e.length,i=r;1<arguments.length&&void 0!==(a=arguments[1])&&(i=a?Number(a):0,isNaN(i))&&(i=0);var a=Math.min(Math.max(i,0),r)-n;return!(a<0)&&u.call(t,e,a)==a}function c(e){if(null==this)throw TypeError();var t=String(this);if(e&&"[object RegExp]"==o.call(e))throw TypeError();var r=t.length,e=String(e),n=e.length,i=1<arguments.length?arguments[1]:void 0,i=i?Number(i):0;return i!=i&&(i=0),!(r<n+Math.min(Math.max(i,0),r))&&-1!=a.call(t,e,i)}function d(e){if(null==this)throw TypeError();var t=String(this),r=e?Number(e):0;if((r=isNaN(r)?0:r)<0||r==1/0)throw RangeError();if(0==r)return"";for(var n="";r--;)n+=t;return n}function m(e){if(null==this)throw TypeError();var t,r=String(this),n=r.length,e=e?Number(e):0;if(!((e=isNaN(e)?0:e)<0||n<=e))return 55296<=(t=r.charCodeAt(e))&&t<=56319&&e+1<n&&56320<=(n=r.charCodeAt(e+1))&&n<=57343?1024*(t-55296)+n-56320+65536:t}function f(e){var t=e.raw,r=t.length>>>0;if(0==r)return"";for(var n="",i=0;;){if(n+=t[i],i+1===r)return n;n+=arguments[++i]}}function h(e){var t=[],r=Math.floor,n=-1,i=arguments.length;if(!i)return"";for(;++n<i;){var a=Number(arguments[n]);if(!isFinite(a)||a<0||1114111<a||r(a)!=a)throw RangeError("Invalid code point: "+a);a<=65535?t.push(a):t.push(55296+((a-=65536)>>10),a%1024+56320)}return String.fromCharCode.apply(null,t)}function g(){var e=t(this),e=String(e);return r(e)}function p(e){e=e.String;n(e.prototype,["codePointAt",m,"endsWith",l,"includes",c,"repeat",d,"startsWith",s]),n(e,["fromCodePoint",h,"raw",f]),i(e.prototype,g,Symbol)}return e(p),{get startsWith(){return s},get endsWith(){return l},get includes(){return c},get repeat(){return d},get codePointAt(){return m},get raw(){return f},get fromCodePoint(){return h},get stringPrototypeIterator(){return g},get polyfillString(){return p}}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/String.js"),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/ArrayIterator.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/ArrayIterator.js")),i=e.toObject,a=e.toUint32,o=e.createIteratorResultObject,n=$traceurRuntime.createClass(function(){},(e={},Object.defineProperty(e,"next",{value:function(){var e,t,r=i(this),n=r.iteratorObject_;if(n)return e=r.arrayIteratorNextIndex_,t=r.arrayIterationKind_,a(n.length)<=e?(r.arrayIteratorNextIndex_=1/0,o(void 0,!0)):(r.arrayIteratorNextIndex_=e+1,o(2==t?n[e]:3==t?[e,n[e]]:e,!1));throw new TypeError("Object is not an ArrayIterator")},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(e,Symbol.iterator,{value:function(){return this},configurable:!0,enumerable:!0,writable:!0}),e),{});function t(e,t){var e=i(e),r=new n;return r.iteratorObject_=e,r.arrayIteratorNextIndex_=0,r.arrayIterationKind_=t,r}function r(){return t(this,3)}function u(){return t(this,1)}function s(){return t(this,2)}return{get entries(){return r},get keys(){return u},get values(){return s}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/Array.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ArrayIterator.js","traceur-runtime@0.0.111/src/runtime/polyfills/Array.js")),i=e.entries,a=e.keys,o=e.values,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/Array.js")),f=e.checkIterable,h=e.isCallable,g=e.isConstructor,u=e.maybeAddFunctions,s=e.maybeAddIterator,t=e.registerPolyfill,l=e.toInteger,p=e.toLength,v=e.toObject;function c(t){var e,r=arguments[1],n=arguments[2],i=v(t),a=void 0!==r,o=0;if(a&&!h(r))throw TypeError();if(f(i)){var u=g(this)?new this:[],s=!0,t=!1,l=void 0;try{for(var c,d=i[Symbol.iterator]();!(s=(c=d.next()).done);s=!0){var m=c.value;u[o]=a?r.call(n,m,o):m,o++}}catch(e){t=!0,l=e}finally{try{s||null==d.return||d.return()}finally{if(t)throw l}}u.length=o}else{for(e=p(i.length),u=new(g(this)?this:Array)(e);o<e;o++)u[o]=a?void 0===n?r(i[o],o):r.call(n,i[o],o):i[o];u.length=e}return u}function d(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=e.length,n=new(g(this)?this:Array)(r),i=0;i<r;i++)n[i]=e[i];return n.length=r,n}function m(e){for(var t=void 0!==arguments[1]?arguments[1]:0,r=arguments[2],n=v(this),i=p(n.length),a=l(t),o=void 0!==r?l(r):i,a=a<0?Math.max(i+a,0):Math.min(a,i),o=o<0?Math.max(i+o,0):Math.min(o,i);a<o;)n[a]=e,a++;return n}function y(e){return r(this,e,arguments[1])}function b(e){return r(this,e,arguments[1],!0)}function r(e,t,r,n){var i=r,a=void 0!==n&&n,o=v(e),u=p(o.length);if(!h(t))throw TypeError();for(var s=0;s<u;s++){var l=o[s];if(t.call(i,l,s,o))return a?s:l}return a?-1:void 0}function n(e){var t=e.Array,r=e.Object,e=e.Symbol,n=o;e&&e.iterator&&t.prototype[e.iterator]&&(n=t.prototype[e.iterator]),u(t.prototype,["entries",i,"keys",a,"values",n,"fill",m,"find",y,"findIndex",b]),u(t,["from",c,"of",d]),s(t.prototype,n,e),s(r.getPrototypeOf([].values()),function(){return this},e)}return t(n),{get from(){return c},get of(){return d},get fill(){return m},get find(){return y},get findIndex(){return b},get polyfillArray(){return n}}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/Array.js"),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/assign.js",[],function(){"use strict";var u=Object.keys;function e(e){for(var t=1;t<arguments.length;t++)for(var r=arguments[t],n=null==r?[]:u(r),i=void 0,a=n.length,i=0;i<a;i++){var o=n[i];e[o]=r[o]}return e}return{get default(){return e}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/Object.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/Object.js")),t=e.maybeAddFunctions,e=e.registerPolyfill,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./assign.js","traceur-runtime@0.0.111/src/runtime/polyfills/Object.js")).default,n=Object,o=n.defineProperty,u=n.getOwnPropertyDescriptor,s=n.getOwnPropertyNames;function i(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function a(e,t){for(var r=s(t),n=r.length,i=0;i<n;i++){r[i];var a=u(t,r[i]);o(e,r[i],a)}return e}function l(e){e=e.Object;t(e,["assign",r,"is",i,"mixin",a])}return e(l),{get assign(){return r},get is(){return i},get mixin(){return a},get polyfillObject(){return l}}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/Object.js"),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/Number.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/Number.js")),t=e.isNumber,r=e.maybeAddConsts,n=e.maybeAddFunctions,i=e.registerPolyfill,a=e.toInteger,o=Math.abs,u=isFinite,s=isNaN,l=Math.pow(2,53)-1,c=1-Math.pow(2,53),d=Math.pow(2,-52);function m(e){return t(e)&&u(e)}function f(e){return m(e)&&a(e)===e}function h(e){return t(e)&&s(e)}function g(e){if(m(e)){var t=a(e);if(t===e)return o(t)<=l}return!1}function p(e){e=e.Number;r(e,["MAX_SAFE_INTEGER",l,"MIN_SAFE_INTEGER",c,"EPSILON",d]),n(e,["isFinite",m,"isInteger",f,"isNaN",h,"isSafeInteger",g])}return i(p),{get MAX_SAFE_INTEGER(){return l},get MIN_SAFE_INTEGER(){return c},get EPSILON(){return d},get isFinite(){return m},get isInteger(){return f},get isNaN(){return h},get isSafeInteger(){return g},get polyfillNumber(){return p}}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/Number.js"),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/fround.js",[],function(){"use strict";var t=isFinite,r=isNaN,e=Math,m=e.LN2,f=e.abs,h=e.floor,g=e.log,p=e.min,v=e.pow;function n(e){for(var t,r,n,i,a,o,u=e,e=8,s=23,l=[],c=u.length;c;--c)for(r=u[c-1],t=8;t;--t)l.push(r%2?1:0),r>>=1;return l.reverse(),o=l.join(""),n=(1<<e-1)-1,i=parseInt(o.substring(0,1),2)?-1:1,a=parseInt(o.substring(1,1+e),2),o=parseInt(o.substring(1+e),2),a===(1<<e)-1?0!==o?NaN:1/0*i:0<a?i*v(2,a-n)*(1+o/v(2,s)):0!==o?i*v(2,-(n-1))*(o/v(2,s)):i<0?-0:0}function i(e){var t,r,n,i,a,o,u,s=8,l=23,c=(1<<s-1)-1;function d(e){var t=h(e),e=e-t;return!(e<.5)&&(.5<e||t%2)?t+1:t}for(e!=e?(r=(1<<s)-1,n=v(2,l-1),t=0):e===1/0||e===-1/0?(r=(1<<s)-1,t=e<(n=0)?1:0):0===e?t=1/e==-1/(n=r=0)?1:0:(t=e<0,(e=f(e))>=v(2,1-c)?(r=p(h(g(e)/m),1023),2<=(n=d(e/v(2,r)*v(2,l)))/v(2,l)&&(r+=1,n=1),c<r?(r=(1<<s)-1,n=0):(r+=c,n-=v(2,l))):(r=0,n=d(e/v(2,1-c-l)))),a=[],i=l;i;--i)a.push(n%2?1:0),n=h(n/2);for(i=s;i;--i)a.push(r%2?1:0),r=h(r/2);for(a.push(t?1:0),a.reverse(),o=a.join(""),u=[];o.length;)u.push(parseInt(o.substring(0,8),2)),o=o.substring(8);return u}function a(e){return 0===e||!t(e)||r(e)?e:n(i(Number(e)))}return{get fround(){return a}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/Math.js",[],function(){"use strict";var t,r,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./fround.js","traceur-runtime@0.0.111/src/runtime/polyfills/Math.js")).fround,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/Math.js")),i=n.maybeAddFunctions,a=n.registerPolyfill,o=n.toUint32,u=isFinite,s=isNaN,n=Math,d=n.abs,l=n.ceil,c=n.exp,m=n.floor,f=n.log,h=n.pow,g=n.sqrt;function p(e){var t;return 0==(e=o(+e))?32:((t=0)==(4294901760&e)&&(e<<=16,t+=16),0==(4278190080&e)&&(e<<=8,t+=8),0==(4026531840&e)&&(e<<=4,t+=4),0==(3221225472&e)&&(e<<=2,t+=2),0==(2147483648&e)&&(e<<=1,t+=1),t)}function v(e,t){var r=65535&(e=o(+e)),n=65535&(t=o(+t));return r*n+((e>>>16&65535)*n+r*(t>>>16&65535)<<16>>>0)|0}function y(e){return 0<(e=+e)?1:e<0?-1:e}function b(e){return.4342944819032518*f(e)}function R(e){return 1.4426950408889634*f(e)}function w(e){if((e=+e)<-1||s(e))return NaN;if(0===e||e===1/0)return e;if(-1===e)return-1/0;var t=0;if(e<0||1<e)return f(1+e);for(var r=1;r<50;r++)r%2==0?t-=h(e,r)/r:t+=h(e,r)/r;return t}function M(e){return(e=+e)===-1/0?-1:u(e)&&0!==e?c(e)-1:e}function _(e){return 0===(e=+e)?1:s(e)?NaN:u(e)?21<(e=e<0?-e:e)?c(e)/2:(c(e)+c(-e))/2:1/0}function x(e){return u(e=+e)&&0!==e?(c(e)-c(-e))/2:e}function S(e){var t,r;return 0===(e=+e)?e:u(e)?((t=c(e))-(r=c(-e)))/(t+r):y(e)}function T(e){return(e=+e)<1?NaN:u(e)?f(e+g(e+1)*g(e-1)):e}function A(e){return 0!==(e=+e)&&u(e)?0<e?f(e+g(e*e+1)):-f(-e+g(e*e+1)):e}function C(e){return-1===(e=+e)?-1/0:1===e?1/0:0===e?e:s(e)||e<-1||1<e?NaN:.5*f((1+e)/(1-e))}function E(e,t){for(var r=arguments.length,n=new Array(r),i=0,a=0;a<r;a++){if((s=+(s=arguments[a]))===1/0||s===-1/0)return 1/0;i<(s=d(s))&&(i=s),n[a]=s}0===i&&(i=1);for(var o=0,u=0,a=0;a<r;a++)var s,l=(s=n[a]/i)*s-u,c=o+l,u=c-o-l,o=c;return g(o)*i}function I(e){return 0<(e=+e)?m(e):e<0?l(e):e}function j(e){var t;return 0!=(e=+e)&&(e=h(e=(t=e<0)?-e:e,1/3),t)?-e:e}function $(e){e=e.Math;i(e,["acosh",T,"asinh",A,"atanh",C,"cbrt",j,"clz32",p,"cosh",_,"expm1",M,"fround",t,"hypot",E,"imul",v,"log10",b,"log1p",w,"log2",R,"sign",y,"sinh",x,"tanh",S,"trunc",I])}return t="function"==typeof Float32Array?(r=new Float32Array(1),function(e){return r[0]=Number(e),r[0]}):e,a($),{get clz32(){return p},get imul(){return v},get sign(){return y},get log10(){return b},get log2(){return R},get log1p(){return w},get expm1(){return M},get cosh(){return _},get sinh(){return x},get tanh(){return S},get acosh(){return T},get asinh(){return A},get atanh(){return C},get hypot(){return E},get trunc(){return I},get fround(){return t},get cbrt(){return j},get polyfillMath(){return $}}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/Math.js"),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/WeakMap.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../private.js","traceur-runtime@0.0.111/src/runtime/polyfills/WeakMap.js")),t=e.createPrivateSymbol,r=e.deletePrivate,n=e.getPrivate,i=e.hasPrivate,a=e.setPrivate,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../frozen-data.js","traceur-runtime@0.0.111/src/runtime/polyfills/WeakMap.js")),o=e.deleteFrozen,u=e.getFrozen,s=e.hasFrozen,l=e.setFrozen,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/WeakMap.js")),c=e.isObject,e=e.registerPolyfill,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../has-native-symbols.js","traceur-runtime@0.0.111/src/runtime/polyfills/WeakMap.js")).default,m=Object,f=(m.defineProperty,m.getOwnPropertyDescriptor,m.isExtensible),h=TypeError,g=(Object.prototype.hasOwnProperty,$traceurRuntime.createClass(function(){this.name_=t(),this.frozenData_=[]},{set:function(e,t){if(c(e))return f(e)?a(e,this.name_,t):l(this.frozenData_,e,t),this;throw new h("key must be an object")},get:function(e){if(c(e))return f(e)?n(e,this.name_):u(this.frozenData_,e)},delete:function(e){return!!c(e)&&(f(e)?r(e,this.name_):o(this.frozenData_,e))},has:function(e){return!!c(e)&&(f(e)?i(e,this.name_):s(this.frozenData_,e))}},{}));function p(e){!function(e){var t=e.WeakMap;if(e.Symbol,!t||!d())return 1;try{var r={};return new t([[r,!1]]).get(r)}catch(e){}}(e)||(e.WeakMap=g)}return e(p),{get WeakMap(){return g},get polyfillWeakMap(){return p}}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/WeakMap.js"),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/WeakSet.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../private.js","traceur-runtime@0.0.111/src/runtime/polyfills/WeakSet.js")),t=e.createPrivateSymbol,r=e.deletePrivate,n=(e.getPrivate,e.hasPrivate),i=e.setPrivate,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../frozen-data.js","traceur-runtime@0.0.111/src/runtime/polyfills/WeakSet.js")),a=e.deleteFrozen,o=e.getFrozen,u=e.setFrozen,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/WeakSet.js")),s=e.isObject,e=e.registerPolyfill,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../has-native-symbols.js","traceur-runtime@0.0.111/src/runtime/polyfills/WeakSet.js")).default,c=Object,d=(c.defineProperty,c.isExtensible),m=TypeError,f=(Object.prototype.hasOwnProperty,$traceurRuntime.createClass(function(){this.name_=t(),this.frozenData_=[]},{add:function(e){if(s(e))return d(e)?i(e,this.name_,!0):u(this.frozenData_,e,e),this;throw new m("value must be an object")},delete:function(e){return!!s(e)&&(d(e)?r(e,this.name_):a(this.frozenData_,e))},has:function(e){return!!s(e)&&(d(e)?n(e,this.name_):o(this.frozenData_,e)===e)}},{}));function h(e){!function(e){var t=e.WeakSet;if(e.Symbol,!t||!l())return 1;try{var r={};return!new t([[r]]).has(r)}catch(e){}}(e)||(e.WeakSet=f)}return e(h),{get WeakSet(){return f},get polyfillWeakSet(){return h}}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/WeakSet.js"),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/polyfills.js",[],function(){"use strict";var t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/polyfills.js")).polyfillAll,r=(t(Reflect.global),$traceurRuntime.setupGlobals);return $traceurRuntime.setupGlobals=function(e){r(e),t(e)},{}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/polyfills.js"),$traceurRuntime.registerModule("src/base/CooldownThrottle.js",[],function(){"use strict";var e=$traceurRuntime.createClass(function(e,t){var r=void 0!==arguments[2]?arguments[2]:0,n=void 0!==arguments[3]&&arguments[3];this.action=e,this.cooldownDuration=t,this.slowActionCooldownPumpupFactor=r,this._waitWithRequestAnimationFrame=n,this._state="idle",this._cooldownStartTime=-1/0},{_triggerIdle:function(){var e=this.cooldownDuration-(performance.now()-this._cooldownStartTime);if(0<e)this._forceIdleTriggerAfter(e);else{this._state="running";e=performance.now();try{this.action()}finally{e=performance.now()-e;this._cooldownStartTime=performance.now()+e*this.slowActionCooldownPumpupFactor,"running-and-triggered"===this._state?this._forceIdleTriggerAfter(this.cooldownDuration):this._state="idle"}}},trigger:function(){switch(this._state){case"idle":this._triggerIdle();break;case"waiting":break;case"running":this._state="running-and-triggered";break;case"running-and-triggered":break;default:throw new Error("Unrecognized throttle state: "+this._state)}},_forceIdleTriggerAfter:function(e){var t,r,n=this;this._state="waiting",this._waitWithRequestAnimationFrame?(t=performance.now(),(r=function(){performance.now()<t+e?requestAnimationFrame(r):(n._state="idle",n._cooldownStartTime=-1/0,n.trigger())})()):setTimeout(function(){n._state="idle",n._cooldownStartTime=-1/0,n.trigger()},e)}},{});return{get CooldownThrottle(){return e}}}),$traceurRuntime.registerModule("src/base/Describe.js",[],function(){"use strict";var I=1e3,l=(new function(){}).toString(),j="!recursion-limit!";function n(e,t){if(0===t)return j;if(e instanceof Map){var r,n,i=e,a=t,o=[],u=!0,s=!1,l=void 0;try{for(var c=void 0,d=i.entries()[Symbol.iterator]();!(u=(c=d.next()).done);u=!0){var m=c.value,f=(r=m[Symbol.iterator](),(n=r.next()).done?void 0:n.value),h=(n=r.next()).done?void 0:n.value;if(I<o.length){o.push("[...]");break}var g=$(f,a-1),p=$(h,a-1);o.push(g+": "+p)}}catch(e){s=!0,l=e}finally{try{u||null==d.return||d.return()}finally{if(s)throw l}}return"Map{"+o.join(", ")+"}"}if(e instanceof Set){var i=e,v=t,y=[],b=!0,s=!1,l=void 0;try{for(var R=void 0,w=i[Symbol.iterator]();!(b=(R=w.next()).done);b=!0){var M=R.value;if(I<y.length){y.push("[...]");break}y.push($(M,v-1))}}catch(e){s=!0,l=e}finally{try{b||null==w.return||w.return()}finally{if(s)throw l}}return"Set{"+y.join(", ")+"}"}if(void 0!==e[Symbol.iterator]){var _=t,x=[],S=!0,t=!1,T=void 0;try{for(var A=void 0,C=e[Symbol.iterator]();!(S=(A=C.next()).done);S=!0){var E=A.value;if(I<x.length){x.push("[...]");break}x.push($(E,_-1))}}catch(e){t=!0,T=e}finally{try{S||null==C.return||C.return()}finally{if(t)throw T}}return(Array.isArray(e)?"":e.constructor.name)+"["+x.join(", ")+"]"}}function i(e,t){var r=String(e);if(r!==l)return r;var n,i=e,a=t,o=[];for(n in i)if(i.hasOwnProperty(n)){if(I<o.length){o.push("[...]");break}var u=i[n],s=$(n,a-1),u=$(u,a-1);o.push(s+": "+u)}r=i.constructor.name;return(r==={}.constructor.name?"":"(Type: "+r+")")+"{"+o.join(", ")+"}"}function $(e){var t,r=void 0!==arguments[1]?arguments[1]:10;return(null===(t=e)?"null":void 0===t?"undefined":"string"==typeof t?'"'+t+'"':"number"==typeof t?""+t:void 0)||n(e,r)||i(e,r)}return{get describe(){return $}}}),$traceurRuntime.registerModule("src/base/DetailedError.js",[],function(){"use strict";var e,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./Describe.js","src/base/DetailedError.js")).describe,n=0,t=(e=Error,$traceurRuntime.createClass(i,{toString:function(){return $traceurRuntime.superGet(this,i.prototype,"toString").call(this)+"\nDetails: "+this.details}},{},e));function i(e,t){$traceurRuntime.superConstructor(i).call(this,e),this.detailsObj=t,this.name="Error",this.message=e,this.stack=(new Error).stack,void 0!==this.stack&&(this.stack=this.stack.replace(/^Error\n\s+at new DetailedError (\S+)\s?\n\s+at /,"\n    ")),n++;try{this.details=1===n?r(this.detailsObj):"(failed to describe detailsObj due to possibly re-entrancy)"}catch(e){console.error(e),this.details="(failed to describe detailsObj, see the console for details)"}finally{n--}}return{get DetailedError(){return t}}}),$traceurRuntime.registerModule("src/base/Equate.js",[],function(){"use strict";function f(t,r){if(t===r||g(t)&&g(r))return!0;var n,e=function(e,t){if(!p(e)&&e.constructor.prototype.hasOwnProperty("isEqualTo"))return e.isEqualTo(t);if(!p(t)&&t.constructor.prototype.hasOwnProperty("isEqualTo"))return t.isEqualTo(e)}(t,r);if(void 0!==e)return e;if(p(t)||p(r)||t.constructor.name!==r.constructor.name)return!1;if(t instanceof Map)return v(t,r);if(t instanceof Set)return y(t,r);if(n=t,Array.isArray(n)||!h.every(function(e){return!(n instanceof e)})){var i=t,a=r;if(i.length!==a.length)return!1;for(var o=0;o<i.length;o++)if(!f(i[o],a[o]))return!1;return!0}var u=t,s=r,e=b(u);if(!y(e,b(s)))return!1;var l=!0,t=!1,r=void 0;try{for(var c=void 0,d=e[Symbol.iterator]();!(l=(c=d.next()).done);l=!0){var m=c.value;if(m!==Symbol.iterator&&!f(u[m],s[m]))return!1}}catch(e){t=!0,r=e}finally{try{l||null==d.return||d.return()}finally{if(t)throw r}}return e=void 0!==u[Symbol.iterator],t=void 0!==s[Symbol.iterator],e==t&&!(e&&t&&!function(e,t){var r=t[Symbol.iterator](),n=!0,t=!1,i=void 0;try{for(var a=void 0,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var u=a.value,s=r.next();if(s.done||!f(u,s.value))return}}catch(e){t=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(t)throw i}}return r.next().done}(u,s))}var h=[Float32Array,Float64Array,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array,Uint8ClampedArray];function g(e){return"number"==typeof e&&isNaN(e)}function p(e){return null==e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e}function v(e,t){var r,n;if(e.size!==t.size)return!1;var i=!0,a=!1,o=void 0;try{for(var u,s=e[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var l=(n=(r=u.value[Symbol.iterator]()).next()).done?void 0:n.value,c=(n=r.next()).done?void 0:n.value;if(!t.has(l))return!1;if(!f(c,t.get(l)))return!1}}catch(e){a=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(a)throw o}}return!0}function y(e,t){if(e.size!==t.size)return!1;var r=!0,n=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var u=a.value;if(!t.has(u))return!1}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return!0}function b(e){var t,r=new Set;for(t in e)e.hasOwnProperty(t)&&r.add(t);return r}return{get equate(){return f},get equate_Maps(){return v}}}),$traceurRuntime.registerModule("src/base/Format.js",[],function(){"use strict";var e=$traceurRuntime.createClass(n,{formatFloat:function(e){return this.allowAbbreviation?function e(t){var r=void 0!==arguments[1]?arguments[1]:0;var n=arguments[2];if(Math.abs(t)<r)return"0";if(t<0)return"-"+e(-t,r,n);var i=o(a,function(e){return Math.abs(e.value-t)<=r});if(void 0!==i)return i.character;i=o(a,function(e){return Math.abs(Math.sqrt(e.value)-t)<=r});if(void 0!==i)return"√"+i.character;if(t%1!=0&&void 0!==n)return t.toFixed(n);return t.toString()}(e,this.maxAbbreviationError,this.fixedDigits):void 0!==this.fixedDigits?e.toFixed(this.fixedDigits):e+""}},{parseFloat:function(t){if(0===t.length)throw new Error("Not a number: '"+t+"'");if("-"===t[0])return-n.parseFloat(t.substr(1));if("√"===t[0])return Math.sqrt(n.parseFloat(t.substr(1)));var e=o(a,function(e){return e.character===t});if(void 0!==e)return e.value;e=parseFloat(t);if(isNaN(e))throw new Error("Not a number: '"+t+"'");return e},simplifyByRounding:function(t,r){var e;return t<0?-n.simplifyByRounding(-t,r):(e=t%1)<=r||1-e<=r?Math.round(t):void 0!==(e=o(a,function(e){return Math.abs(e.value-t)<=r}))?e.value:void 0!==(e=o(a,function(e){return Math.abs(Math.sqrt(e.value)-t)<=r}))?Math.sqrt(e.value):t}});function n(e,t,r,n){this.allowAbbreviation=e,this.maxAbbreviationError=t,this.fixedDigits=r,this.itemSeparator=n}var a=[{character:"½",ref:"½",expanded:"1/2",value:.5},{character:"¼",ref:"¼",expanded:"1/4",value:.25},{character:"¾",ref:"¾",expanded:"3/4",value:.75},{character:"⅓",ref:"⅓",expanded:"1/3",value:1/3},{character:"⅔",ref:"⅔",expanded:"2/3",value:2/3},{character:"⅕",ref:"⅕",expanded:"1/5",value:.2},{character:"⅖",ref:"⅖",expanded:"2/5",value:.4},{character:"⅗",ref:"⅗",expanded:"3/5",value:.6},{character:"⅘",ref:"⅘",expanded:"4/5",value:.8},{character:"⅙",ref:"⅙",expanded:"1/6",value:1/6},{character:"⅚",ref:"⅚",expanded:"5/6",value:5/6},{character:"⅐",ref:"⅐",expanded:"1/7",value:1/7},{character:"⅛",ref:"⅛",expanded:"1/8",value:1/8},{character:"⅜",ref:"⅜",expanded:"3/8",value:3/8},{character:"⅝",ref:"⅝",expanded:"5/8",value:5/8},{character:"⅞",ref:"⅞",expanded:"7/8",value:7/8},{character:"⅑",ref:"⅑",expanded:"1/9",value:1/9},{character:"⅒",ref:"⅒",expanded:"1/10",value:.1}],o=function(e,t){var r=!0,n=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var u=a.value;if(t(u))return u}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}};return e.EXACT=new e(!0,0,void 0,", "),e.MINIFIED=new e(!0,0,void 0,","),e.SIMPLIFIED=new e(!0,5e-4,3,", "),e.CONSISTENT=new e(!1,0,2,", "),{get Format(){return e},get UNICODE_FRACTIONS(){return a}}}),$traceurRuntime.registerModule("src/base/Obs.js",[],function(){"use strict";var u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./CooldownThrottle.js","src/base/Obs.js")).CooldownThrottle,e=$traceurRuntime.createClass(c,{subscribe:function(e){return this._subscribe(e)},snapshot:function(){var t=[];return this.subscribe(function(e){return t.push(e)})(),t},map:function(r){var e=this;return new c(function(t){return e.subscribe(function(e){return t(r(e))})})},filter:function(r){var e=this;return new c(function(t){return e.subscribe(function(e){r(e)&&t(e)})})},zipLatest:function(u,s){var l=this;return new c(function(t){var r,n,i=!1,a=!1,e=l.subscribe(function(e){r=e,i=!0,a&&t(s(r,n))}),o=u.subscribe(function(e){n=e,a=!0,i&&t(s(r,n))});return function(){e(),o()}})},flattenLatest:function(){var t=this;return new c(function(r){var n=function(){},i=!1,e=t.subscribe(function(e){var t;i||(t=n,n=e.subscribe(r),t())});return function(){i=!0,n(),e()}})},peek:function(t){return this.map(function(e){return t(e),e})},flatten:function(){var e=this;return new c(function(t){var a=[];return a.push(e.subscribe(function(e){return a.push(e.subscribe(t))})),function(){var e=!0,t=!1,r=void 0;try{for(var n,i=a[Symbol.iterator]();!(e=(n=i.next()).done);e=!0)(0,n.value)()}catch(e){t=!0,r=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}}})},throttleLatest:function(a){var o=this;return new c(function(e){var t=void 0,r=!1,n=new u(function(){r||e(t)},a),i=o.subscribe(function(e){t=e,n.trigger()});return function(){r=!0,i()}})},skip:function(e){var n=this;return new c(function(t){var r=e;return n.subscribe(function(e){0<r?--r:t(e)})})},whenDifferent:function(){var e=this,i=arguments[0]||function(e,t){return e===t};return new c(function(t){var r=!1,n=void 0;return e.subscribe(function(e){r&&i(n,e)||(r=!0,t(n=e))})})}},{of:function(){for(var o=[],e=0;e<arguments.length;e++)o[e]=arguments[e];return new c(function(e){var t=!0,r=!1,n=void 0;try{for(var i,a=o[Symbol.iterator]();!(t=(i=a.next()).done);t=!0)e(i.value)}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}return function(){}})},requestAnimationTicker:function(){return new c(function(e){var t=!1,r=function(){t||(e(void 0),window.requestAnimationFrame(r))};return r(),function(){t=!0}})},elementEvent:function(t,r){return new c(function(e){return t.addEventListener(r,e),function(){return t.removeEventListener(r,e)}})}});function c(e){this._subscribe=e}var r=$traceurRuntime.createClass(function(){var r=this;this._observers=[],this._observable=new e(function(e){r._observers.push(e);var t=!1;return function(){t||(t=!0,r._observers.splice(r._observers.indexOf(e),1))}})},{observable:function(){return this._observable},send:function(e){var t=!0,r=!1,n=void 0;try{for(var i,a=this._observers[Symbol.iterator]();!(t=(i=a.next()).done);t=!0)(0,i.value)(e)}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}},{}),t=$traceurRuntime.createClass(function(){var t=this;this._value=arguments[0],this._source=new r,this._observable=new e(function(e){return e(t._value),t._source.observable().subscribe(e)})},{observable:function(){return this._observable},set:function(e){this._value=e,this._source.send(e)},get:function(){return this._value}},{});return{get Observable(){return e},get ObservableSource(){return r},get ObservableValue(){return t}}}),$traceurRuntime.registerModule("src/base/RestartableRng.js",[],function(){"use strict";var e=$traceurRuntime.createClass(t,{restarted:function(){var e=new t;return e._cache=this._cache,e},random:function(){var e=this._next++;return e>=this._cache.length&&this._cache.push(Math.random()),this._cache[e]}},{});function t(){this._cache=[],this._next=0}return{get RestartableRng(){return e}}}),$traceurRuntime.registerModule("src/base/Revision.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./Describe.js","src/base/Revision.js")).describe,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./Equate.js","src/base/Revision.js")).equate,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./DetailedError.js","src/base/Revision.js")).DetailedError,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./Obs.js","src/base/Revision.js")),i=r.ObservableSource,a=r.ObservableValue,o=$traceurRuntime.createClass(u,{changes:function(){return this._changes.observable()},latestActiveCommit:function(){return this._latestActiveCommit.observable()},peekActiveCommit:function(){return this._latestActiveCommit.get()},isAtBeginningOfHistory:function(){return 0===this.index&&!this.isWorkingOnCommit},isAtEndOfHistory:function(){return this.index===this.history.length-1},clear:function(e){this.history=[e],this.index=0,this.isWorkingOnCommit=!1,this._changes.send(e),this._latestActiveCommit.set(e)},startedWorkingOnCommit:function(){this.isWorkingOnCommit=!0,this._changes.send(void 0)},cancelCommitBeingWorkedOn:function(){this.isWorkingOnCommit=!1;var e=this.history[this.index];return this._changes.send(e),this._latestActiveCommit.set(e),e},commit:function(e){e===this.history[this.index]?this.cancelCommitBeingWorkedOn():(this.isWorkingOnCommit=!1,this.index+=1,this.history.splice(this.index,this.history.length-this.index),this.history.push(e),this._changes.send(e),this._latestActiveCommit.set(e))},undo:function(){if(!this.isWorkingOnCommit){if(0===this.index)return;--this.index}this.isWorkingOnCommit=!1;var e=this.history[this.index];return this._changes.send(e),this._latestActiveCommit.set(e),e},redo:function(){var e;if(this.index+1!==this.history.length)return this.index+=1,this.isWorkingOnCommit=!1,e=this.history[this.index],this._changes.send(e),this._latestActiveCommit.set(e),e},toString:function(){return"Revision("+e({index:this.index,count:this.history.length,workingOnCommit:this.isWorkingOnCommit,head:this.history[this.index]})+")"},isEqualTo:function(e){return e instanceof u&&this.index===e.index&&this.isWorkingOnCommit===e.isWorkingOnCommit&&t(this.history,e.history)}},{startingAt:function(e){return new u([e],0,!1)}});function u(e,t,r){if(t<0||t>=e.length)throw new n("Bad index",{history:e,index:t,isWorkingOnCommit:r});if(!Array.isArray(e))throw new n("Bad history",{history:e,index:t,isWorkingOnCommit:r});this.history=e,this.index=t,this.isWorkingOnCommit=r,this._changes=new i,this._latestActiveCommit=new a(this.history[this.index])}return{get Revision(){return o}}}),$traceurRuntime.registerModule("src/base/Seq.js",[],function(){"use strict";function l(e){return"function"==typeof Object(e)[Symbol.iterator]}function m(e,t,r){if(e!==h)return e;if(t===f)throw new Error(r);return t}var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./DetailedError.js","src/base/Seq.js")).DetailedError,f={if_same_instance_as_this_then_throw:!0},h={not_a_normal_value:!0},r=[Float32Array,Float64Array,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array,Uint8ClampedArray],t=$traceurRuntime.createClass(u,{isEqualTo:function(t){var e=void 0!==arguments[1]?arguments[1]:function(e,t){return e===t};if(!l(t))return!1;if(t===this)return!0;var r=t[Symbol.iterator](),n=!0,t=!1,i=void 0;try{for(var a,o=this._iterable[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var u=a.value,s=r.next();if(s.done||!e(u,s.value))return!1}}catch(e){t=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(t)throw i}}return r.next().done},toArray:function(){return Array.from(this._iterable)},toFloat32Array:function(){var t=this.tryPeekCount();if(void 0===t)return new Float32Array(this.toArray());var e=new Float32Array(t),r=0,n=!0,t=!1,i=void 0;try{for(var a,o=this._iterable[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var u=a.value;e[r++]=u}}catch(e){t=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(t)throw i}}return e},toSet:function(){return new Set(this._iterable)},join:function(e){return this.toArray().join(e)},toString:function(){return"Seq["+this.join(", ")+"]"},solidify:function(){var e=[Float32Array,Float64Array,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array];if(Array.isArray(this._iterable))return this;var t=!0,r=!1,n=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;if(this._iterable instanceof o)return this}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}return new u(this.toArray())},map:function(s){var l=this._iterable;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:r=!(t=!0),n=void 0,e.state=24;break;case 24:e.pushTry(10,11),e.state=13;break;case 13:i=void 0,a=l[Symbol.iterator](),e.state=9;break;case 9:e.state=(t=(i=a.next()).done)?7:5;break;case 4:t=!0,e.state=9;break;case 5:o=i.value,e.state=6;break;case 6:return e.state=2,s(o);case 2:e.maybeThrow(),e.state=4;break;case 7:e.popTry(),e.state=11,e.finallyFallThrough=-2;break;case 10:e.popTry(),e.maybeUncatchable(),u=e.storedException,e.state=16;break;case 16:r=!0,n=u,e.state=11,e.finallyFallThrough=-2;break;case 11:e.popTry(),e.state=22;break;case 22:try{t||null==a.return||a.return()}finally{if(r)throw n}e.state=20;break;case 20:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},mapWithIndex:function(l){var c=this._iterable;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:n=!(r=!(t=0)),i=void 0,e.state=26;break;case 26:e.pushTry(12,13),e.state=15;break;case 15:a=void 0,o=c[Symbol.iterator](),e.state=11;break;case 11:e.state=(r=(a=o.next()).done)?9:7;break;case 6:r=!0,e.state=11;break;case 7:u=a.value,e.state=8;break;case 8:return e.state=2,l(u,t);case 2:e.maybeThrow(),e.state=4;break;case 4:t+=1,e.state=6;break;case 9:e.popTry(),e.state=13,e.finallyFallThrough=-2;break;case 12:e.popTry(),e.maybeUncatchable(),s=e.storedException,e.state=18;break;case 18:n=!0,i=s,e.state=13,e.finallyFallThrough=-2;break;case 13:e.popTry(),e.state=24;break;case 24:try{r||null==o.return||o.return()}finally{if(n)throw i}e.state=22;break;case 22:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},flatMap:function(c){var d=this._iterable;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s,l;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:r=!(t=!0),n=void 0,e.state=32;break;case 32:e.pushTry(18,19),e.state=21;break;case 21:i=void 0,a=d[Symbol.iterator](),e.state=17;break;case 17:e.state=(t=(i=a.next()).done)?15:13;break;case 10:t=!0,e.state=17;break;case 13:o=i.value,e.state=14;break;case 14:u=e.wrapYieldStar(c(o)[Symbol.iterator]()),e.sent=void 0,e.action="next",e.state=12;break;case 12:s=u[e.action](e.sentIgnoreThrow),e.state=9;break;case 9:e.state=s.done?3:2;break;case 3:e.sent=s.value,e.state=10;break;case 2:return e.state=12,s.value;case 15:e.popTry(),e.state=19,e.finallyFallThrough=-2;break;case 18:e.popTry(),e.maybeUncatchable(),l=e.storedException,e.state=24;break;case 24:r=!0,n=l,e.state=19,e.finallyFallThrough=-2;break;case 19:e.popTry(),e.state=30;break;case 30:try{t||null==a.return||a.return()}finally{if(r)throw n}e.state=28;break;case 28:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},filter:function(s){var l=this._iterable;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:r=!(t=!0),n=void 0,e.state=25;break;case 25:e.pushTry(11,12),e.state=14;break;case 14:i=void 0,a=l[Symbol.iterator](),e.state=10;break;case 10:e.state=(t=(i=a.next()).done)?8:6;break;case 4:t=!0,e.state=10;break;case 6:o=i.value,e.state=7;break;case 7:e.state=s(o)?1:4;break;case 1:return e.state=2,o;case 2:e.maybeThrow(),e.state=4;break;case 8:e.popTry(),e.state=12,e.finallyFallThrough=-2;break;case 11:e.popTry(),e.maybeUncatchable(),u=e.storedException,e.state=17;break;case 17:r=!0,n=u,e.state=12,e.finallyFallThrough=-2;break;case 12:e.popTry(),e.state=23;break;case 23:try{t||null==a.return||a.return()}finally{if(r)throw n}e.state=21;break;case 21:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},filterWithIndex:function(l){var c=this._iterable;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:n=!(r=!(t=0)),i=void 0,e.state=27;break;case 27:e.pushTry(13,14),e.state=16;break;case 16:a=void 0,o=c[Symbol.iterator](),e.state=12;break;case 12:e.state=(r=(a=o.next()).done)?10:8;break;case 7:r=!0,e.state=12;break;case 8:u=a.value,e.state=9;break;case 9:e.state=l(u,t)?1:4;break;case 1:return e.state=2,u;case 2:e.maybeThrow(),e.state=4;break;case 4:t++,e.state=7;break;case 10:e.popTry(),e.state=14,e.finallyFallThrough=-2;break;case 13:e.popTry(),e.maybeUncatchable(),s=e.storedException,e.state=19;break;case 19:n=!0,i=s,e.state=14,e.finallyFallThrough=-2;break;case 14:e.popTry(),e.state=25;break;case 25:try{r||null==o.return||o.return()}finally{if(n)throw i}e.state=23;break;case 23:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},fold:function(e){var t=void 0!==arguments[1]?arguments[1]:f,r=h,n=!0,i=!1,a=void 0;try{for(var o,u=this._iterable[Symbol.iterator]();!(n=(o=u.next()).done);n=!0)var s=o.value,r=r===h?s:e(r,s)}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}return m(r,t,"Folded empty sequence without providing an alternative result.")},aggregate:function(t,e){var r=t,n=!0,t=!1,i=void 0;try{for(var a,o=this._iterable[Symbol.iterator]();!(n=(a=o.next()).done);n=!0)r=e(r,a.value)}catch(e){t=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(t)throw i}}return r},zip:function(c,d){var m=this._iterable;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s,l;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=c[Symbol.iterator](),n=!(r=!0),i=void 0,e.state=29;break;case 29:e.pushTry(15,16),e.state=18;break;case 18:a=void 0,o=m[Symbol.iterator](),e.state=14;break;case 14:e.state=(r=(a=o.next()).done)?12:10;break;case 7:r=!0,e.state=14;break;case 10:u=a.value,e.state=11;break;case 11:s=t.next(),e.state=9;break;case 9:e.state=s.done?12:2;break;case 2:return e.state=5,d(u,s.value);case 5:e.maybeThrow(),e.state=7;break;case 12:e.popTry(),e.state=16,e.finallyFallThrough=-2;break;case 15:e.popTry(),e.maybeUncatchable(),l=e.storedException,e.state=21;break;case 21:n=!0,i=l,e.state=16,e.finallyFallThrough=-2;break;case 16:e.popTry(),e.state=27;break;case 27:try{r||null==o.return||o.return()}finally{if(n)throw i}e.state=25;break;case 25:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},max:function(){return this.fold(function(e,t){return e<t?t:e},void 0!==arguments[0]?arguments[0]:f)},min:function(){return this.fold(function(e,t){return e<t?e:t},void 0!==arguments[0]?arguments[0]:f)},maxBy:function(e){var t=void 0!==arguments[1]?arguments[1]:f,r=void 0!==arguments[2]?arguments[2]:function(e,t){return e<t},n=h,i=h,a=!0,o=!1,u=void 0;try{for(var s,l=this._iterable[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c,d=s.value;n===h?n=d:r(i=i===h?e(n):i,c=e(d))&&(n=d,i=c)}}catch(e){o=!0,u=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw u}}return m(n,t,"Can't maxBy an empty sequence.")},minBy:function(e){var t=void 0!==arguments[1]?arguments[1]:f,r=void 0!==arguments[2]?arguments[2]:function(e,t){return e<t};return this.maxBy(e,t,function(e,t){return r(t,e)})},any:function(e){var t=!0,r=!1,n=void 0;try{for(var i,a=this._iterable[Symbol.iterator]();!(t=(i=a.next()).done);t=!0)if(e(i.value))return!0}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}return!1},every:function(t){return!this.any(function(e){return!t(e)})},contains:function(t){return this.any(function(e){return e===t})},sum:function(){var e=0,t=!0,r=!0,n=!1,i=void 0;try{for(var a,o=this._iterable[Symbol.iterator]();!(r=(a=o.next()).done);r=!0)var u=a.value,e=t?u:e+u,t=!1}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return e},product:function(){return this.fold(function(e,t){return e*t},1)},scan:function(l,c){var d=this._iterable;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=l,e.state=30;break;case 30:return e.state=2,t;case 2:e.maybeThrow(),e.state=4;break;case 4:n=!(r=!0),i=void 0,e.state=32;break;case 32:e.pushTry(16,17),e.state=19;break;case 19:a=void 0,o=d[Symbol.iterator](),e.state=15;break;case 15:e.state=(r=(a=o.next()).done)?13:11;break;case 8:r=!0,e.state=15;break;case 11:u=a.value,e.state=12;break;case 12:t=c(t,u),e.state=10;break;case 10:return e.state=6,t;case 6:e.maybeThrow(),e.state=8;break;case 13:e.popTry(),e.state=17,e.finallyFallThrough=-2;break;case 16:e.popTry(),e.maybeUncatchable(),s=e.storedException,e.state=22;break;case 22:n=!0,i=s,e.state=17,e.finallyFallThrough=-2;break;case 17:e.popTry(),e.state=28;break;case 28:try{r||null==o.return||o.return()}finally{if(n)throw i}e.state=26;break;case 26:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},reverse:function(){return new u(this.toArray().reverse())},flatten:function(){var c=this._iterable;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s,l;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:r=!(t=!0),n=void 0,e.state=32;break;case 32:e.pushTry(18,19),e.state=21;break;case 21:i=void 0,a=c[Symbol.iterator](),e.state=17;break;case 17:e.state=(t=(i=a.next()).done)?15:13;break;case 10:t=!0,e.state=17;break;case 13:o=i.value,e.state=14;break;case 14:u=e.wrapYieldStar(o[Symbol.iterator]()),e.sent=void 0,e.action="next",e.state=12;break;case 12:s=u[e.action](e.sentIgnoreThrow),e.state=9;break;case 9:e.state=s.done?3:2;break;case 3:e.sent=s.value,e.state=10;break;case 2:return e.state=12,s.value;case 15:e.popTry(),e.state=19,e.finallyFallThrough=-2;break;case 18:e.popTry(),e.maybeUncatchable(),l=e.storedException,e.state=24;break;case 24:r=!0,n=l,e.state=19,e.finallyFallThrough=-2;break;case 19:e.popTry(),e.state=30;break;case 30:try{t||null==a.return||a.return()}finally{if(r)throw n}e.state=28;break;case 28:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},concat:function(a){var o=this._iterable;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=e.wrapYieldStar(o[Symbol.iterator]()),e.sent=void 0,e.action="next",e.state=12;break;case 12:r=t[e.action](e.sentIgnoreThrow),e.state=9;break;case 9:e.state=r.done?3:2;break;case 3:e.sent=r.value,e.state=10;break;case 2:return e.state=12,r.value;case 10:n=e.wrapYieldStar(a[Symbol.iterator]()),e.sent=void 0,e.action="next",e.state=24;break;case 24:i=n[e.action](e.sentIgnoreThrow),e.state=21;break;case 21:e.state=i.done?15:14;break;case 15:e.sent=i.value,e.state=-2;break;case 14:return e.state=24,i.value;default:return e.end()}},e,this)}))},withOverlayedItem:function(l,c){if(l<0)throw new Error("needed index >= 0");var d=this;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:if(void 0!==d.tryPeekCount()&&l>=d.tryPeekCount())throw new Error("needed index <= count");n=!(r=!(t=0)),i=void 0,e.state=26;break;case 26:e.pushTry(12,13),e.state=15;break;case 15:a=void 0,o=d._iterable[Symbol.iterator](),e.state=11;break;case 11:e.state=(r=(a=o.next()).done)?9:7;break;case 6:r=!0,e.state=11;break;case 7:u=a.value,e.state=8;break;case 8:return e.state=2,t===l?c:u;case 2:e.maybeThrow(),e.state=4;break;case 4:t++,e.state=6;break;case 9:e.popTry(),e.state=13,e.finallyFallThrough=17;break;case 12:e.popTry(),e.maybeUncatchable(),s=e.storedException,e.state=18;break;case 18:n=!0,i=s,e.state=13,e.finallyFallThrough=17;break;case 13:e.popTry(),e.state=24;break;case 24:try{r||null==o.return||o.return()}finally{if(n)throw i}e.state=22;break;case 17:if(t<=l)throw new Error("sequence ended before overlay [withOverlayedItem(${index}, ${overlayedItem})]");e.state=-2;break;case 22:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},withTransformedItem:function(l,c){if(l<0)throw new Error("needed index >= 0");var d=this;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:if(void 0!==d.tryPeekCount()&&l>=d.tryPeekCount())throw new Error("needed index <= count");n=!(r=!(t=0)),i=void 0,e.state=26;break;case 26:e.pushTry(12,13),e.state=15;break;case 15:a=void 0,o=d._iterable[Symbol.iterator](),e.state=11;break;case 11:e.state=(r=(a=o.next()).done)?9:7;break;case 6:r=!0,e.state=11;break;case 7:u=a.value,e.state=8;break;case 8:return e.state=2,t===l?c(u):u;case 2:e.maybeThrow(),e.state=4;break;case 4:t++,e.state=6;break;case 9:e.popTry(),e.state=13,e.finallyFallThrough=17;break;case 12:e.popTry(),e.maybeUncatchable(),s=e.storedException,e.state=18;break;case 18:n=!0,i=s,e.state=13,e.finallyFallThrough=17;break;case 13:e.popTry(),e.state=24;break;case 24:try{r||null==o.return||o.return()}finally{if(n)throw i}e.state=22;break;case 17:if(t<=l)throw new Error("sequence ended before transformation [withTransformedItem(${index}, ${itemTransformation})]");e.state=-2;break;case 22:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},withInsertedItem:function(l,c){if(l<0)throw new Error("needed index >= 0");var d=this;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:if(void 0!==d.tryPeekCount()&&l>d.tryPeekCount())throw new Error("needed index <= count");n=!(r=!(t=0)),i=void 0,e.state=36;break;case 36:e.pushTry(17,18),e.state=20;break;case 20:a=void 0,o=d._iterable[Symbol.iterator](),e.state=16;break;case 16:e.state=(r=(a=o.next()).done)?14:12;break;case 9:r=!0,e.state=16;break;case 12:u=a.value,e.state=13;break;case 13:e.state=t===l?1:4;break;case 1:return e.state=2,c;case 2:e.maybeThrow(),e.state=4;break;case 4:t++,e.state=11;break;case 11:return e.state=7,u;case 7:e.maybeThrow(),e.state=9;break;case 14:e.popTry(),e.state=18,e.finallyFallThrough=22;break;case 17:e.popTry(),e.maybeUncatchable(),s=e.storedException,e.state=23;break;case 23:n=!0,i=s,e.state=18,e.finallyFallThrough=22;break;case 18:e.popTry(),e.state=29;break;case 29:try{r||null==o.return||o.return()}finally{if(n)throw i}e.state=27;break;case 22:e.state=t===l?30:33;break;case 30:return e.state=31,c;case 31:e.maybeThrow(),e.state=33;break;case 33:if(t<l)throw new Error("sequence ended before insertion [withInsertedItem(${index}, ${item})]");e.state=-2;break;case 27:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},takeWhile:function(s){var l=this._iterable;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:r=!(t=!0),n=void 0,e.state=27;break;case 27:e.pushTry(13,14),e.state=16;break;case 16:i=void 0,a=l[Symbol.iterator](),e.state=12;break;case 12:e.state=(t=(i=a.next()).done)?10:8;break;case 7:t=!0,e.state=12;break;case 8:o=i.value,e.state=9;break;case 9:e.state=s(o)?2:10;break;case 2:return e.state=5,o;case 5:e.maybeThrow(),e.state=7;break;case 10:e.popTry(),e.state=14,e.finallyFallThrough=-2;break;case 13:e.popTry(),e.maybeUncatchable(),u=e.storedException,e.state=19;break;case 19:r=!0,n=u,e.state=14,e.finallyFallThrough=-2;break;case 14:e.popTry(),e.state=25;break;case 25:try{t||null==a.return||a.return()}finally{if(r)throw n}e.state=23;break;case 23:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},skipTailWhile:function(d){var m=this._iterable;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s,l,c;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=[],n=!(r=!0),i=void 0,e.state=41;break;case 41:e.pushTry(27,28),e.state=30;break;case 30:a=void 0,o=m[Symbol.iterator](),e.state=26;break;case 26:e.state=(r=(a=o.next()).done)?24:22;break;case 20:r=!0,e.state=26;break;case 22:u=a.value,e.state=23;break;case 23:e.state=d(u)?19:11;break;case 19:t.push(u),e.state=20;break;case 11:s=e.wrapYieldStar(t[Symbol.iterator]()),e.sent=void 0,e.action="next",e.state=12;break;case 12:l=s[e.action](e.sentIgnoreThrow),e.state=9;break;case 9:e.state=l.done?3:2;break;case 3:e.sent=l.value,e.state=10;break;case 2:return e.state=12,l.value;case 10:t=[],e.state=18;break;case 18:return e.state=14,u;case 14:e.maybeThrow(),e.state=20;break;case 24:e.popTry(),e.state=28,e.finallyFallThrough=-2;break;case 27:e.popTry(),e.maybeUncatchable(),c=e.storedException,e.state=33;break;case 33:n=!0,i=c,e.state=28,e.finallyFallThrough=-2;break;case 28:e.popTry(),e.state=39;break;case 39:try{r||null==o.return||o.return()}finally{if(n)throw i}e.state=37;break;case 37:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},skipWhile:function(l){var c=this._iterable;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:n=!(r=t=!0),i=void 0,e.state=27;break;case 27:e.pushTry(13,14),e.state=16;break;case 16:a=void 0,o=c[Symbol.iterator](),e.state=12;break;case 12:e.state=(r=(a=o.next()).done)?10:8;break;case 4:r=!0,e.state=12;break;case 8:u=a.value,e.state=9;break;case 9:t=t&&l(u),e.state=7;break;case 7:e.state=t?4:1;break;case 1:return e.state=2,u;case 2:e.maybeThrow(),e.state=4;break;case 10:e.popTry(),e.state=14,e.finallyFallThrough=-2;break;case 13:e.popTry(),e.maybeUncatchable(),s=e.storedException,e.state=19;break;case 19:n=!0,i=s,e.state=14,e.finallyFallThrough=-2;break;case 14:e.popTry(),e.state=25;break;case 25:try{r||null==o.return||o.return()}finally{if(n)throw i}e.state=23;break;case 23:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},take:function(l){if(l<0)throw new Error("needed maxTakeCount >= 0");var c;return 0===l?new u([]):(c=this._iterable,u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:n=!(r=!(t=0)),i=void 0,e.state=29;break;case 29:e.pushTry(15,16),e.state=18;break;case 18:a=void 0,o=c[Symbol.iterator](),e.state=14;break;case 14:e.state=(r=(a=o.next()).done)?12:10;break;case 6:r=!0,e.state=14;break;case 10:u=a.value,e.state=11;break;case 11:return e.state=2,u;case 2:e.maybeThrow(),e.state=4;break;case 4:t++,e.state=9;break;case 9:e.state=l<=t?12:6;break;case 12:e.popTry(),e.state=16,e.finallyFallThrough=-2;break;case 15:e.popTry(),e.maybeUncatchable(),s=e.storedException,e.state=21;break;case 21:n=!0,i=s,e.state=16,e.finallyFallThrough=-2;break;case 16:e.popTry(),e.state=27;break;case 27:try{r||null==o.return||o.return()}finally{if(n)throw i}e.state=25;break;case 25:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)})))},skip:function(l){if(l<0)throw new Error("needed maxSkipCount >= 0");var c;return 0===l?this:(c=this._iterable,u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:n=!(r=!(t=0)),i=void 0,e.state=27;break;case 27:e.pushTry(13,14),e.state=16;break;case 16:a=void 0,o=c[Symbol.iterator](),e.state=12;break;case 12:e.state=(r=(a=o.next()).done)?10:8;break;case 7:r=!0,e.state=12;break;case 8:u=a.value,e.state=9;break;case 9:e.state=l<=t?1:4;break;case 1:return e.state=2,u;case 2:e.maybeThrow(),e.state=4;break;case 4:t++,e.state=7;break;case 10:e.popTry(),e.state=14,e.finallyFallThrough=-2;break;case 13:e.popTry(),e.maybeUncatchable(),s=e.storedException,e.state=19;break;case 19:n=!0,i=s,e.state=14,e.finallyFallThrough=-2;break;case 14:e.popTry(),e.state=25;break;case 25:try{r||null==o.return||o.return()}finally{if(n)throw i}e.state=23;break;case 23:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)})))},distinctBy:function(r){var e=this;return u.fromGenerator(function(){var t=new Set;return e.filter(function(e){e=r(e);return!t.has(e)&&(t.add(e),!0)})[Symbol.iterator]()})},distinct:function(){return this.distinctBy(function(e){return e})},segmentBy:function(d){var m=this;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s,l,c;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=[],i=!(n=!(r=void 0)),a=void 0,e.state=36;break;case 36:e.pushTry(17,18),e.state=20;break;case 20:o=void 0,u=m[Symbol.iterator](),e.state=16;break;case 16:e.state=(n=(o=u.next()).done)?14:12;break;case 11:n=!0,e.state=16;break;case 12:s=o.value,e.state=13;break;case 13:l=d(s),e.state=9;break;case 9:e.state=0<t.length&&l!==r?1:6;break;case 1:return e.state=2,t;case 2:e.maybeThrow(),e.state=4;break;case 4:t=[],e.state=6;break;case 6:t.push(s),r=l,e.state=11;break;case 14:e.popTry(),e.state=18,e.finallyFallThrough=22;break;case 17:e.popTry(),e.maybeUncatchable(),c=e.storedException,e.state=23;break;case 23:i=!0,a=c,e.state=18,e.finallyFallThrough=22;break;case 18:e.popTry(),e.state=29;break;case 29:try{n||null==u.return||u.return()}finally{if(i)throw a}e.state=27;break;case 22:e.state=0<t.length?30:-2;break;case 30:return e.state=31,t;case 31:e.maybeThrow(),e.state=-2;break;case 27:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},single:function(){var e=void 0!==arguments[0]?arguments[0]:f,t=this[Symbol.iterator](),r=t.next();if(!r.done&&t.next().done)return r.value;if(e===f)throw r.done?new Error("Empty sequence doesn't contain a single item."):new Error("Sequence contains more than a single item.");return e},first:function(){var e=void 0!==arguments[0]?arguments[0]:f,t=this[Symbol.iterator]().next();if(!t.done)return t.value;if(e===f)throw new Error("Empty sequence has no first item.");return e},last:function(){var e=void 0!==arguments[0]?arguments[0]:f,t=h,r=!0,n=!1,i=void 0;try{for(var a,o=this._iterable[Symbol.iterator]();!(r=(a=o.next()).done);r=!0)t=a.value}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return m(t,e,"Empty sequence has no last item.")},tryPeekCount:function(){var t=this;return Array.isArray(this._iterable)||!r.every(function(e){return!(t._iterable instanceof e)})?this._iterable.length:this._iterable instanceof Map||this._iterable instanceof Set?this._iterable.size:void 0},count:function(){var t=this.tryPeekCount();if(void 0!==t)return t;var e=0,r=!0,t=!1,n=void 0;try{for(var i,a=this._iterable[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){i.value;e++}}catch(e){t=!0,n=e}finally{try{r||null==a.return||a.return()}finally{if(t)throw n}}return e},padded:function(l){var c=arguments[1];if(l<0)throw new Error("needed minCount >= 0");var d=this._iterable;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=l,n=!(r=!0),i=void 0,e.state=33;break;case 33:e.pushTry(12,13),e.state=15;break;case 15:a=void 0,o=d[Symbol.iterator](),e.state=11;break;case 11:e.state=(r=(a=o.next()).done)?9:7;break;case 6:r=!0,e.state=11;break;case 7:u=a.value,e.state=8;break;case 8:return e.state=2,u;case 2:e.maybeThrow(),e.state=4;break;case 4:--t,e.state=6;break;case 9:e.popTry(),e.state=13,e.finallyFallThrough=17;break;case 12:e.popTry(),e.maybeUncatchable(),s=e.storedException,e.state=18;break;case 18:n=!0,i=s,e.state=13,e.finallyFallThrough=17;break;case 13:e.popTry(),e.state=24;break;case 24:try{r||null==o.return||o.return()}finally{if(n)throw i}e.state=22;break;case 17:e.state=0<t?25:-2;break;case 25:return e.state=26,c;case 26:e.maybeThrow(),e.state=28;break;case 28:--t,e.state=17;break;case 22:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},sorted:function(){return n(this.toArray().sort())},sortedBy:function(r){return n(this.toArray().sort(function(e,t){e=r(e),t=r(t);return e<t?-1:t<e?1:0}))},ifThen:function(e,t){return e?new u(t(this)):this},toMap:function(e,t){var r=new Map,n=!0,i=!1,a=void 0;try{for(var o,u=this._iterable[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value,l=e(s),c=t(s);if(r.has(l))throw new Error("Duplicate key <"+l+">. Came from item <"+s+">.");r.set(l,c)}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}return r},keyedBy:function(e){return this.toMap(e,function(e){return e})},groupBy:function(e){var t=new Map,r=!0,n=!1,i=void 0;try{for(var a,o=this._iterable[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var u=a.value,s=e(u);t.has(s)||t.set(s,[]),t.get(s).push(u)}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return t},partitioned:function(l){if(l<=0)throw new Error("need partitionSize > 0");var c=this;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=[],n=!(r=!0),i=void 0,e.state=34;break;case 34:e.pushTry(15,16),e.state=18;break;case 18:a=void 0,o=c[Symbol.iterator](),e.state=14;break;case 14:e.state=(r=(a=o.next()).done)?12:10;break;case 6:r=!0,e.state=14;break;case 10:u=a.value,e.state=11;break;case 11:t.push(u),e.state=9;break;case 9:e.state=t.length>=l?1:6;break;case 1:return e.state=2,t;case 2:e.maybeThrow(),e.state=4;break;case 4:t=[],e.state=6;break;case 12:e.popTry(),e.state=16,e.finallyFallThrough=20;break;case 15:e.popTry(),e.maybeUncatchable(),s=e.storedException,e.state=21;break;case 21:n=!0,i=s,e.state=16,e.finallyFallThrough=20;break;case 16:e.popTry(),e.state=27;break;case 27:try{r||null==o.return||o.return()}finally{if(n)throw i}e.state=25;break;case 20:e.state=0<t.length?28:-2;break;case 28:return e.state=29,t;case 29:e.maybeThrow(),e.state=-2;break;case 25:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},stride:function(r){return this.filterWithIndex(function(e,t){return t%r==0})},breadthFirstSearch:function(m){var f=void 0!==arguments[1]?arguments[1]:function(e){return e},h=this;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s,l,c,d;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=new Set,r=h.toArray(),e.state=16;break;case 16:n=0,e.state=14;break;case 14:e.state=n<r.length?8:-2;break;case 7:n++,e.state=14;break;case 8:i=r[n],a=f(i),e.state=9;break;case 9:e.state=t.has(a)?7:2;break;case 2:t.add(a),u=!(o=!0),s=void 0;try{for(l=void 0,c=m(i)[Symbol.iterator]();!(o=(l=c.next()).done);o=!0)d=l.value,r.push(d)}catch(e){u=!0,s=e}finally{try{o||null==c.return||c.return()}finally{if(u)throw s}}e.state=11;break;case 11:return e.state=5,i;case 5:e.maybeThrow(),e.state=7;break;default:return e.end()}},e,this)}))}},{fromGenerator:function(e){return new u(e,!0)},range:function(r){if(!Number.isInteger(r)||r<0)throw new e("bad count",{count:r});return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=0,e.state=7;break;case 7:e.state=t<r?1:-2;break;case 4:t++,e.state=7;break;case 1:return e.state=2,t;case 2:e.maybeThrow(),e.state=4;break;default:return e.end()}},e,this)}))},naturals:function(){return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=0,e.state=9;break;case 9:e.state=1;break;case 1:return e.state=2,t;case 2:e.maybeThrow(),e.state=4;break;case 4:t++,e.state=9;break;default:return e.end()}},e,this)}))},repeat:function(r,n){if(n<0)throw new Error("needed repeatCount >= 0");return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=0,e.state=7;break;case 7:e.state=t<n?1:-2;break;case 4:t++,e.state=7;break;case 1:return e.state=2,r;case 2:e.maybeThrow(),e.state=4;break;default:return e.end()}},e,this)}))}});function u(e){var t,r,n;if(e instanceof u)r=e._iterable,n=e[Symbol.iterator];else if(void 0!==arguments[1]&&arguments[1])t={},Object.defineProperty(t,Symbol.iterator,{value:e,configurable:!0,enumerable:!0,writable:!0}),r=t,n=e;else{if(!l(e))throw new Error("Not iterable: "+e);n=(r=e)[Symbol.iterator].bind(e)}this._iterable=r,this[Symbol.iterator]=n}var n=function(e){return new t(e)};return{get THROW_IF_EMPTY(){return f},get seq(){return n},get Seq(){return t}}}),$traceurRuntime.registerModule("src/base/Util.js",[],function(){"use strict";var r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./DetailedError.js","src/base/Util.js")).DetailedError,e=$traceurRuntime.createClass(d,{},{need:function(e,t,r){if(!0!==e)throw e=void 0===r?"(not provided)":"["+Array.prototype.slice.call(r).join(", ")+"]",new Error("Precondition failed\n\nMessage: "+(void 0===t?"(not provided)":t)+"\n\nArgs: "+e)},numberOfSetBits:function(e){if(e<0)throw new Error("i < 0");if(!Number.isInteger(e))throw new Error("!Number.isInteger(i)");if(4294967295<e)throw new Error("i > 0xFFFFFFFF");return e=(e=(858993459&(e=(1431655765&e)+(e>>1&1431655765)))+(e>>2&858993459))+(e>>4)&252645135,255&(e=(e+=e>>8)+(e>>16))},bin:function(e,t){return("0".repeat(t)+e.toString(2)).slice(-t).split("").join("")},notNull:function(e){return d.need(null!==e,"notNull"),e},isPowerOf2:function(e){return 0<e&&0==(e-1&e)},bitSize:function(e){return d.need(0<=e,"bitSize: n >= 0"),0===e?0:d.floorLg2(e)+1},ceilingPowerOf2:function(e){return e<=1?1:1<<d.ceilLg2(e)},ceilLg2:function(e){var t;return e<=1?0:1<<(t=Math.ceil(Math.log2(e)))<e?t+1:e<=1<<t-1?t-1:t},floorLg2:function(e){var t;return e<=1?0:1<<(t=Math.floor(Math.log2(e)))+1<=e?t+1:e<1<<t?t-1:t},popcnt:function(e){if(e<0)return Math.POSITIVE_INFINITY;for(var t=0;0<e;)e&=e-1,t++;return t},powerOfTwoness:function(e){var t=void 0!==arguments[1]?arguments[1]:Math.POSITIVE_INFINITY;return 0===e?t:e<0?d.powerOfTwoness(-e,t):Math.round(Math.log2(e&~(e-1)))},reverseGroupMap:function(e){var t,r,n=void 0!==arguments[1]&&arguments[1],i=new Map;if(n){var a=!0,n=!1,o=void 0;try{for(var u,s=e.keys()[Symbol.iterator]();!(a=(u=s.next()).done);a=!0){var l=u.value;i.set(l,[])}}catch(e){n=!0,o=e}finally{try{a||null==s.return||s.return()}finally{if(n)throw o}}}var c=!0,n=!1,o=void 0;try{for(var d,m=e[Symbol.iterator]();!(c=(d=m.next()).done);c=!0){var f=(r=(t=d.value[Symbol.iterator]()).next()).done?void 0:r.value,h=(r=t.next()).done?void 0:r.value,g=!0,p=!1,v=void 0;try{for(var y,b=h[Symbol.iterator]();!(g=(y=b.next()).done);g=!0){var R=y.value;i.has(R)||i.set(R,[]),i.get(R).push(f)}}catch(e){p=!0,v=e}finally{try{g||null==b.return||b.return()}finally{if(p)throw v}}}}catch(e){n=!0,o=e}finally{try{c||null==m.return||m.return()}finally{if(n)throw o}}return i},binarySearchForTransitionFromTrueToFalse:function(e,t){for(var r=0;r<e;){var n=r+Math.floor((e-r)/2);t(n)?r=n+1:e=n}return r},breakLine:function(t,r,n){if(""===t)return[""];for(var e=[],i=0;i<t.length;){var a=d.binarySearchForTransitionFromTrueToFalse(t.length-i+1,function(e){return n(t.substr(i,e))<=r})-1,a=Math.max(1,a),o=t.substr(i,a);if(!(i+a===t.length||null!==t.substr(i+a,1).match(/\s/))){a=/^(.*\S)(\s+)\S*$/.exec(o);if(null!==a){var u=a[1],a=a[2];e.push(u.trim()),i+=u.length+a.length;continue}}e.push(o.trim()),i=(i+=o.length)+t.substr(i).match(/^\s*/)[0].length}return e},decomposeObjectValues:function(e){var u=[],s=function(e){if(Array.isArray(e)){var t=!0,r=!1,n=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;s(o)}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}else u.push(e)},t=!0,r=!1,n=void 0;try{for(var i,a=Object.keys(e).sort()[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;s(e[o])}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}return u},recomposedObjectValues:function(e,s){var t={},l=0,c=function(e){if(Array.isArray(e)){var t=[],r=!0,n=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var u=a.value;t.push(c(u))}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return t}return s[l++]},r=!0,n=!1,i=void 0;try{for(var a,o=Object.keys(e).sort()[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var u=a.value;t[u]=c(e[u])}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return d.need(l===s.length,"Mismatched field value count."),t},objectifyArrayFunc:function(t){return function(e){return d.recomposedObjectValues(e,t(d.decomposeObjectValues(e)))}},snappedCosSin:function(e){var t=Math.PI/4,r=Math.round(e/t);return r*t===e?[[1,0],[t=Math.sqrt(.5),t],[0,1],[-t,t],[-1,0],[-t,-t],[0,-1],[t,-t]][7&r]:[Math.cos(e),Math.sin(e)]},properMod:function(e,t){if(t<=0)throw new r("denominator <= 0",{numerator:e,denominator:t});e%=t;return e+(e<0?t:0)},mergeMaps:function(){for(var e,t,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=new Map,a=!0,o=!1,u=void 0;try{for(var s,l=r[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value,d=!0,m=!1,f=void 0;try{for(var h,g=c.entries()[Symbol.iterator]();!(d=(h=g.next()).done);d=!0){var p=(t=(e=h.value[Symbol.iterator]()).next()).done?void 0:t.value,v=(t=e.next()).done?void 0:t.value;i.set(p,v)}}catch(e){m=!0,f=e}finally{try{d||null==g.return||g.return()}finally{if(m)throw f}}}}catch(e){o=!0,u=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw u}}return i},modular_multiplicative_inverse:function(e,t){var e=d.extended_gcd(e,t),r=e.x,e=e.gcd;if(1===e)return(r%=t)<0&&(r+=t),r},extended_gcd:function(e,t){for(var r,n=0,i=1,a=t,o=1,u=0,s=e;0!==a;)var l,c=Math.floor(s/a),s=(r=(l=[a,s-c*a][Symbol.iterator]()).next()).done?void 0:r.value,a=(r=l.next()).done?void 0:r.value,o=(r=(l=[n,o-c*n][Symbol.iterator]()).next()).done?void 0:r.value,n=(r=l.next()).done?void 0:r.value,u=(r=(l=[i,u-c*i][Symbol.iterator]()).next()).done?void 0:r.value,i=(r=l.next()).done?void 0:r.value;return{x:o,y:u,gcd:s}},digits_to_superscript_digits:function(e){for(var t=0;t<10;t++)e=e.split("0123456789"[t]).join("⁰¹²³⁴⁵⁶⁷⁸⁹"[t]);return e}});function d(){}return e.STRICT_EQUALITY=function(e,t){return e===t},e.CUSTOM_IS_EQUAL_TO_EQUALITY=function(e,t){return null===e?null===t:void 0===e?void 0===t:e.isEqualTo(t)},{get Util(){return e}}}),$traceurRuntime.registerModule("src/browser/Clipboard.js",[],function(){"use strict";function e(e){var t;if(document.selection?((t=document.body.createTextRange()).moveToElementText(e),t.select()):window.getSelection&&((t=document.createRange()).selectNodeContents(e),window.getSelection().removeAllRanges(),window.getSelection().addRange(t)),!document.execCommand("copy"))throw new Error("execCommand failed")}return{get selectAndCopyToClipboard(){return e}}}),$traceurRuntime.registerModule("src/browser/EventUtil.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Obs.js","src/browser/EventUtil.js")).Observable;function t(t){return e.of(e.elementEvent(t,"change"),e.elementEvent(t,"keyup"),e.elementEvent(t,"click"),e.elementEvent(t,"paste"),e.elementEvent(t,"input")).flatten().map(function(e){return t.value}).whenDifferent()}return{get textEditObservable(){return t}}}),$traceurRuntime.registerModule("src/browser/HistoryPusher.js",[],function(){"use strict";var r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/DetailedError.js","src/browser/HistoryPusher.js")).DetailedError,e=$traceurRuntime.createClass(function(){this._historyActionsNotWorking=!1,this._currentMemorableStateObj=void 0},{currentStateIsMemorableButUnknown:function(){this._currentMemorableStateObj={wont_equal_this:!0}},currentStateIsMemorableAndEqualTo:function(e){this._currentMemorableStateObj=e},currentStateIsNotMemorable:function(){this._currentMemorableStateObj=void 0},stateChange:function(e,t){if(!t.startsWith("#"))throw new r("Expected a hash URL.",{stateObj:e,stateUrlHash:t});if(this._currentMemorableStateObj!==e)if(this._historyActionsNotWorking)document.location.hash=t;else try{void 0===this._currentMemorableStateObj?history.replaceState(e,"",t):(history.pushState(e,"",t),this._currentMemorableStateObj=void 0)}catch(e){console.warn("Calling 'history.replaceState/pushState' failed. Falling back to setting location.hash.",e),this._historyActionsNotWorking=!0,document.location.hash=t}}},{});return{get HistoryPusher(){return e}}}),$traceurRuntime.registerModule("src/browser/MouseWatcher.js",[],function(){"use strict";function n(e){return void 0!==window.TouchEvent&&e instanceof TouchEvent||1===e.which}function e(e){return 2===e.which}var r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Point.js","src/browser/MouseWatcher.js")).Point;function t(e,t){t=t.getBoundingClientRect();return new r(e.clientX-t.left,e.clientY-t.top)}function i(e,t,r,n,i){return new a(e,t,r,n,i).addListenersUntilResultInvoked()}function o(e,t,r){return e.addEventListener(t,r),function(){return e.removeEventListener(t,r)}}var a=$traceurRuntime.createClass(function(e,t,r,n,i){this._element=e,this._grabHandler=t,this._cancelHandler=r,this._dragHandler=n,this._dropHandler=i,this._grabPointerId=void 0,this._grabActivityTime=window.performance.now(),this._lastPos=void 0,this._lastEv=void 0},{addListenersUntilResultInvoked:function(){var t=this,e=this._element,a=[o(e,"mousedown",function(e){return t.handleMouseEventWith(e,t.onDown)}),o(document,"mousemove",function(e){return t.handleMouseEventWith(e,t.onMove)}),o(document,"mouseup",function(e){return t.handleMouseEventWith(e,t.onUp)}),o(document,"mouseleave",function(e){return t.handleMouseEventWith(e,t.onLeave)}),o(document,"mouseenter",function(e){return t.handleMouseEventWith(e,t.onEnter)}),o(e,"touchstart",function(e){return t.handleTouchEventWith(e,t.onDown)}),o(e,"touchmove",function(e){return t.handleTouchEventWith(e,t.onMove)}),o(e,"touchend",function(e){return t.handleTouchEventWith(e,t.onUp)}),o(e,"touchcancel",function(e){return t.handleTouchEventWith(e,t.onCancel)})];return function(){var e=!0,t=!1,r=void 0;try{for(var n,i=a[Symbol.iterator]();!(e=(n=i.next()).done);e=!0)(0,n.value)()}catch(e){t=!0,r=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}}},canRegrab:function(){return window.performance.now()>=this._grabActivityTime+5e3},onDown:function(e,t,r){if(n(r)){if(void 0!==this._grabPointerId){if(!this.canRegrab())return;this._dropHandler(this._lastPos,this._lastEv)}this._grabPointerId=t,this._grabActivityTime=window.performance.now(),this._lastPos=e,this._lastEv=r,this._grabHandler(e,r)}},onMove:function(e,t,r){this._grabPointerId===t&&(n(r)?(this._grabActivityTime=window.performance.now(),this._lastPos=e,this._lastEv=r,this._dragHandler(e,r)):(this._lastPos=void 0,this._lastEv=void 0,this._grabPointerId=void 0,this._dropHandler(void 0,r)))},onCancel:function(e,t,r){this._grabPointerId===t&&(this._lastPos=void 0,this._lastEv=void 0,this._grabPointerId=void 0,this._cancelHandler(r))},onUp:function(e,t,r){n(r)&&this._grabPointerId===t&&(this._lastPos=void 0,this._lastEv=void 0,this._grabPointerId=void 0,this._dropHandler(e,r))},onLeave:function(e,t,r){n(r)&&this._grabPointerId===t&&(this._grabActivityTime=window.performance.now(),this._lastPos=void 0,this._lastEv=r,this._dragHandler(void 0,r))},onEnter:function(e,t,r){n(r)||this._grabPointerId!==t||(this._lastPos=void 0,this._lastEv=void 0,this._grabPointerId=void 0,this._dropHandler(void 0,r))},relativeEventPos:function(e){return t(e,this._element)},handleTouchEventWith:function(e,t){for(var r=0;r<e.changedTouches.length;r++){var n=e.changedTouches[r];t.call(this,this.relativeEventPos(n),n.identifier,e)}},handleMouseEventWith:function(e,t){t.call(this,this.relativeEventPos(e),"mouse!",e)}},{});return{get watchDrags(){return i},get isLeftClicking(){return n},get isMiddleClicking(){return e},get eventPosRelativeTo(){return t}}}),$traceurRuntime.registerModule("src/browser/Polyfills.js",[],function(){"use strict";function e(){var r=this;return $traceurRuntime.initGeneratorFunction(function e(){var t;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=0,e.state=7;break;case 7:e.state=t<r.length?1:-2;break;case 4:t++,e.state=7;break;case 1:return e.state=2,r[t];case 2:e.maybeThrow(),e.state=4;break;default:return e.end()}},e,this)})()}Float32Array.prototype.slice=Float32Array.prototype.slice||function(e,t){return new Float32Array(Array.from(this).slice(e,t))},Float64Array.prototype.slice=Float64Array.prototype.slice||function(e,t){return new Float64Array(Array.from(this).slice(e,t))},Uint32Array.prototype.slice=Uint32Array.prototype.slice||function(e,t){return new Uint32Array(Array.from(this).slice(e,t))},Int32Array.prototype.slice=Int32Array.prototype.slice||function(e,t){return new Int32Array(Array.from(this).slice(e,t))},Uint16Array.prototype.slice=Uint16Array.prototype.slice||function(e,t){return new Uint16Array(Array.from(this).slice(e,t))},Int16Array.prototype.slice=Int16Array.prototype.slice||function(e,t){return new Int16Array(Array.from(this).slice(e,t))},Uint8Array.prototype.slice=Uint8Array.prototype.slice||function(e,t){return new Uint8Array(Array.from(this).slice(e,t))},Int8Array.prototype.slice=Int8Array.prototype.slice||function(e,t){return new Int8Array(Array.from(this).slice(e,t))};Float32Array.prototype[Symbol.iterator]=Float32Array.prototype[Symbol.iterator]||e,Float64Array.prototype[Symbol.iterator]=Float64Array.prototype[Symbol.iterator]||e,Uint32Array.prototype[Symbol.iterator]=Uint32Array.prototype[Symbol.iterator]||e,Uint16Array.prototype[Symbol.iterator]=Uint16Array.prototype[Symbol.iterator]||e,Uint8Array.prototype[Symbol.iterator]=Uint8Array.prototype[Symbol.iterator]||e,Int32Array.prototype[Symbol.iterator]=Int32Array.prototype[Symbol.iterator]||e,Int16Array.prototype[Symbol.iterator]=Int16Array.prototype[Symbol.iterator]||e,Int8Array.prototype[Symbol.iterator]=Int8Array.prototype[Symbol.iterator]||e,window.performance=window.performance||{},window.performance.now=window.performance.now||function(){return Date.now()};var t=WebGLRenderingContext;if(void 0!==t&&void 0===t.INVALID_ENUM){var r=document.createElement("canvas").getContext("webgl");if(null!=r){var n=!0,i=!1,a=void 0;try{for(var o,u=["ARRAY_BUFFER","CLAMP_TO_EDGE","COLOR_ATTACHMENT0","COMPILE_STATUS","ELEMENT_ARRAY_BUFFER","FLOAT","FRAGMENT_SHADER","FRAMEBUFFER","FRAMEBUFFER_COMPLETE","HIGH_FLOAT","LINK_STATUS","MAX_TEXTURE_IMAGE_UNITS","MAX_TEXTURE_SIZE","MEDIUM_FLOAT","NEAREST","NO_ERROR","RGBA","STATIC_DRAW","TEXTURE_2D","TEXTURE_MAG_FILTER","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","TEXTURE_WRAP_T","TEXTURE0","TRIANGLES","UNSIGNED_SHORT","UNSIGNED_BYTE","VALIDATE_STATUS","VERTEX_SHADER"][Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value;t[s]=t[s]||r[s]}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}}}return{}}),$traceurRuntime.registerModule("src/browser/SaveFile.js",[],function(){"use strict";function e(e,t){if(navigator.msSaveBlob)navigator.msSaveBlob(new Blob([t],{type:"text/html;charset=UTF-8"}),e);else{var r=document.createElement("a");r.href=void 0!==window.URL?window.URL.createObjectURL(new Blob([t],{type:"text/html;charset=UTF-8"})):"data:application/octet-stream,"+encodeURI(moddedHtml),r.download=e;try{document.body.appendChild(r),r.click()}finally{document.body.removeChild(r)}}}return{get saveFile(){return e}}}),$traceurRuntime.registerModule("src/browser/TouchScrollBlocker.js",[],function(){"use strict";$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Rect.js","src/browser/TouchScrollBlocker.js")).Rect;var e=$traceurRuntime.createClass(function(e){this._parentElement=e,this._curBlockers=[],this._curShowing=0},{setBlockers:function(e,t){for(;this._curBlockers.length<e.length;){var r=document.createElement("div");r.style.touchAction="none",r.style.position="absolute",r.style.opacity=1e-4,this._parentElement.appendChild(r),this._curBlockers.push({div:r,area:void 0})}for(var n=0;n<e.length;n++){var i=e[n].rect,a=t||e[n].cursor||"auto",o=this._curBlockers[n],u=o.div.style;i.isEqualTo(o.area)||(o.area=i,u.left=i.x+"px",u.top=i.y+"px",u.width=i.w+"px",u.height=i.h+"px"),u.cursor!==a&&(u.cursor=a)}for(;this._curShowing<e.length;)this._curBlockers[this._curShowing].div.style.display="inline",this._curShowing++;for(;this._curShowing>e.length;)this._curShowing--,this._curBlockers[this._curShowing].div.style.display="none"}},{});return{get TouchScrollBlocker(){return e}}}),$traceurRuntime.registerModule("src/circuit/CircuitComputeUtil.js",[],function(){"use strict";var b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./CircuitEvalContext.js","src/circuit/CircuitComputeUtil.js")).CircuitEvalContext,R=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./CircuitShaders.js","src/circuit/CircuitComputeUtil.js")).CircuitShaders,w=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/DetailedError.js","src/circuit/CircuitComputeUtil.js")).DetailedError,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./KetTextureUtil.js","src/circuit/CircuitComputeUtil.js")).KetTextureUtil),M=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./Controls.js","src/circuit/CircuitComputeUtil.js")).Controls,o=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./Gate.js","src/circuit/CircuitComputeUtil.js")).GateBuilder,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../gates/AllGates.js","src/circuit/CircuitComputeUtil.js")).Gates),_=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/circuit/CircuitComputeUtil.js")).Util;function e(e,a){return e.setActualEffectToUpdateFunc(function(e){return t(e,a.withDisabledReasonsForEmbeddedContext(e.row,e.customContextFromGates),!1)}).setKnownEffectToCircuit(a).setExtraDisableReasonFinder(function(e){for(var t=a.withDisabledReasonsForEmbeddedContext(e.outerRow,e.context),r=0;r<t.numWires;r++)for(var n=0;n<t.columns.length;n++){var i=t.gateAtLocIsDisabledReason(n,r);if(void 0!==i)return i;if(t.gateInSlot(n,r)===o.Special.Measurement)return"hidden\nmeasure\nbroken"}})}function t(e,c,d){function t(l){return function(e){if(d){var e=function(e,t,r){var n=[],i=!0,a=!1,o=void 0;try{for(var u=void 0,s=t.customStatRowsInCol(r)[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var l=u.value,c=new b(e.time,l,t.numWires,e.controls,e.controlsTexture,e.controls,e.stateTrader,_.mergeMaps(e.customContextFromGates,t.colCustomContextFromGates(r,l))),d=t.columns[r].gates[l].customStatTexturesMaker(c);n.push({row:l,stat:d})}}catch(e){a=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(a)throw o}}a=w.superpositionToQubitDensities(e.stateTrader.currentTexture,e.controls,t.colDesiredSingleQubitStatsMask(r)),o=void 0!==t.columns[r].indexOfNonUnitaryGate(),o=w.superpositionToNorm(e.stateTrader.currentTexture,o);return{qubitDensities:a,norm:o,customGateStats:n}}(e,c,l),t=e.qubitDensities,r=e.norm,e=e.customGateStats,n=(m.push(t),h.push(r),!0),t=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var o=i.value,u=o.row,s=o.stat;g.push({col:l,row:u,out:f.length}),f.push(s)}}catch(e){t=!0,r=e}finally{try{n||null==a.return||a.return()}finally{if(t)throw r}}}}}var m=[],f=[],h=[],g=[];c.applyInitialStateOperations(e);for(var r,n,i,a,o,u,s,l,p,v,y=0;y<c.columns.length;y++)n=c,a=t(i=y),p=l=s=u=o=void 0,o=(r=e).controls.and(n.colControls(i).shift(r.row)),u=R.controlMask(o).toBoolTexture(r.wireCount),s=_.mergeMaps(r.customContextFromGates,n.colCustomContextFromGates(i,r.row)),l=r.stateTrader,p=new b(r.time,r.row,r.wireCount,r.controls,r.controlsTexture,o,l,s),r=new b(r.time,r.row,r.wireCount,o,u,o,l,s),n.applyBeforeOperationsInCol(i,p),n.applyMainOperationsInCol(i,r),a(r),n.applyAfterOperationsInCol(i,p),u.deallocByDepositingInPool("controlTex in _advanceStateWithCircuitDefinitionColumn");return d&&(v=(1<<c.numWires)-1,m.push(w.superpositionToQubitDensities(e.stateTrader.currentTexture,M.NONE,v))),{colQubitDensities:m,colNorms:h,customStats:f,customStatsMap:g}}return{get setGateBuilderEffectToCircuit(){return e},get advanceStateWithCircuit(){return t}}}),$traceurRuntime.registerModule("src/circuit/CircuitDefinition.js",[],function(){"use strict";var i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./CircuitShaders.js","src/circuit/CircuitDefinition.js")).CircuitShaders,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/circuit/CircuitDefinition.js")).Config,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./Controls.js","src/circuit/CircuitDefinition.js")).Controls,x=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./CustomGateSet.js","src/circuit/CircuitDefinition.js")).CustomGateSet,S=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/DetailedError.js","src/circuit/CircuitDefinition.js")).DetailedError,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Equate.js","src/circuit/CircuitDefinition.js")).equate_Maps,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./Gate.js","src/circuit/CircuitDefinition.js")).Gate,T=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./GateColumn.js","src/circuit/CircuitDefinition.js")).GateColumn,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./GateShaders.js","src/circuit/CircuitDefinition.js")).GateShaders,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../gates/AllGates.js","src/circuit/CircuitDefinition.js")),p=e.Gates,c=e.INITIAL_STATES_TO_GATES,v=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Point.js","src/circuit/CircuitDefinition.js")).Point,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Seq.js","src/circuit/CircuitDefinition.js")),o=e.seq,u=e.Seq,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/circuit/CircuitDefinition.js")).Util,d=$traceurRuntime.createClass(m,{gateWeight:function(){return o(this.columns).flatMap(function(e){return e.gates}).filter(function(e){return void 0!==e}).map(function(e){return void 0===e.knownCircuit?1:e.knownCircuit.gateWeight()}).sum()},hasControls:function(){return!this.columns.every(function(e){return!e.hasControl(-1)})},withSwitchedInitialStateOn:function(e){var t=arguments[1],r=new Map($traceurRuntime.spread(this.customInitialValues.entries())),n=r.get(e),i=$traceurRuntime.spread(c.keys()),n=i[(i.indexOf(n)+1)%i.length];return void 0===(n=void 0!==t?t:n)||0===n?r.delete(e):r.set(e,n),this.withInitialStates(r)},withInitialStates:function(e){return new m(this.numWires,this.columns,this.outerRowOffset,this.outerContext,this.customGateSet,this.isNested,e)},hasOnlyUnitaryGates:function(){return this.columns.every(function(e){return void 0===e.indexOfNonUnitaryGate()})},hasNonControlGates:function(){return!this.columns.every(function(e){return!!e.gates.every(function(e){return void 0===e||e.isControl()})})},countGatesUpTo:function(e){var t=0,r=!0,n=!1,i=void 0;try{for(var a,o=this.columns[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var u=a.value,s=!0,l=!1,c=void 0;try{for(var d,m=u.gates[Symbol.iterator]();!(s=(d=m.next()).done);s=!0){var f=d.value;if(void 0!==f&&e<=++t)return t}}catch(e){l=!0,c=e}finally{try{s||null==m.return||m.return()}finally{if(l)throw c}}}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return t},getUnmetContextKeys:function(){for(var e=new Set,t=0;t<this.columns.length;t++){var r=this.columns[t],n=this.colCustomContextFromGates(t,0),i=!0,a=!1,o=void 0;try{for(var u,s=r.gates[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var l=u.value,c=!0,d=!1,m=void 0;try{for(var f,h=(void 0===l?[]:l.getUnmetContextKeys())[Symbol.iterator]();!(c=(f=h.next()).done);c=!0){var g=f.value,p=g.replace("Input Range ","Input Default ").replace("Input NO_DEFAULT Range ","Input Range ");n.has(g)||n.has(p)||e.add(g)}}catch(e){d=!0,m=e}finally{try{c||null==h.return||h.return()}finally{if(d)throw m}}}}catch(e){a=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(a)throw o}}}return e},withDisabledReasonsForEmbeddedContext:function(e,t){return new m(this.numWires,this.columns,e,t,this.customGateSet,!0,this.customInitialValues)},_computeGateSlotCoverMap:function(){for(var e=new Map,t=0;t<this.columns.length;t++)for(var r=0;r<this.numWires;r++){var n=this.columns[t].gates[r];if(void 0!==n)for(var i=0;i<n.width;i++)for(var a=0;a<n.height;a++)e.set(t+i+":"+(r+a),{col:t,row:r,gate:n})}return e},isEmpty:function(){return 0===this.columns.length},isEqualTo:function(e){return this===e||e instanceof m&&this.numWires===e.numWires&&o(this.columns).isEqualTo(o(e.columns),n.CUSTOM_IS_EQUAL_TO_EQUALITY)&&r(this.customInitialValues,e.customInitialValues)},toString:function(){var n=this,i=function(e){return"─".repeat(e)},a=u.range(this.columns.length).map(function(e){return o(n.columns[e].gates).map(function(e){return void 0===e?0:e.serializedId.length}).max()}).toArray();return"CircuitDefinition ("+this.numWires+" wires, "+this.columns.length+" cols):\n\t"+u.range(this.numWires).map(function(r){return i(1)+u.range(n.columns.length).map(function(e){var t=n.columns[e].gates[r],t=void 0===t?"":t.serializedId;return e=a[e],t=t,i(Math.floor(e-t.length)/2)+t+i(Math.ceil(e-t.length)/2)}).join(i(1))+i(1)}).join("\n\t")},stableDuration:function(){return o(this.columns).flatMap(function(e){return e.gates}).filter(function(e){return void 0!==e}).map(function(e){return e.stableDuration()}).min(1/0)},readableHash:function(){var e=o(this.columns).flatMap(function(e){return e.gates}).filter(function(e){return void 0!==e}).map(function(e){return e.symbol}).toArray();return 0===e.length?t.EMPTY_CIRCUIT_TITLE:(e=this.numWires+" wires, "+e.length+" ops, "+e.join("").split("^").join("")).length<=40?e:e.substring(0,40)+"…"},withColumns:function(e){return new m(this.numWires,e,this.outerRowOffset,this.outerContext,this.customGateSet,!1,this.customInitialValues)},_usedColumns:function(){for(var e=new Set,t=0;t<this.columns.length;t++)for(var r=0;r<this.columns[t].maximumGateWidth();r++)e.add(t+r);return e},_findWidthWiseOverlapInRect:function(e,t,r,n){for(var i=1;i<r&&e+i<this.columns.length;i++)for(var a=0;a<n;a++){var o=this.findGateCoveringSlot(e+i,t+a);if(void 0!==o&&o.col!==e)return{col:o.col,row:o.row}}},withWidthOverlapsFixed:function(){for(var n=this,i=[],a=this,e=0;e<this.columns.length;e++)!function(r){var e=u.range(a.numWires).map(function(e){var t=n.columns[r].gates[e];return void 0===t||void 0===(e=n._findWidthWiseOverlapInRect(r,e,t.width,t.height))?0:t.width-(e.col-r)}).max(0);i.push(a.columns[r]);for(var t=0;t<e;t++)i.push(T.empty(a.numWires))}(e);return this.withColumns(i)},_findHeightWiseOverlapsInCol:function(e){for(var t=new Set,r=0,n=0;n<this.numWires;n++){--r;var i=this.gateInSlot(e,n);void 0!==i&&(0<r&&t.add(n),r=Math.max(r,i.height))}return t},withHeightOverlapsFixed:function(){for(var e=void 0!==arguments[0]?arguments[0]:5,n=[],i=this,t=0;t<this.columns.length;t++)(function(e){var r=i._findHeightWiseOverlapsInCol(e);if(0===r.size)return n.push(i.columns[e]);var t=o(i.columns[e].gates).mapWithIndex(function(e,t){return r.has(t)?void 0:e}).toArray(),e=o(i.columns[e].gates).mapWithIndex(function(e,t){return void 0!==e&&(e.isControl()||r.has(t))?e:void 0}).toArray();n.push(new T(t)),n.push(new T(e))})(t);var r=this.withColumns(n);return r=n.length>this.columns.length&&0<e?r.withHeightOverlapsFixed(e-1):r},withTrailingSpacersIncluded:function(){var e=void 0!==arguments[0]?arguments[0]:0;return this.withColumns($traceurRuntime.spread(this.columns,new Array(Math.max(0,this.minimumRequiredColCount()+e-this.columns.length)).fill(T.empty(this.numWires))))},trimEmptyColumnsAtEndIgnoringGateWidths:function(){for(var e=this.columns.length;;e--)if(0===e||!this.columns[e-1].isEmpty())return this.withColumns(this.columns.slice(0,e))},withUncoveredColumnsRemoved:function(){var r=this._usedColumns();return new m(this.numWires,o(this.columns).filterWithIndex(function(e,t){return r.has(t)}).toArray(),this.outerRowOffset,this.outerContext,this.customGateSet,!1,this.customInitialValues)},withWireCount:function(t){return t===this.numWires?this:new m(t,this.columns.map(function(e){return new T($traceurRuntime.spread(e.gates.slice(0,t),new Array(Math.max(0,t-e.gates.length)).fill(void 0)))}),this.outerRowOffset,this.outerContext,this.customGateSet,!1,this.customInitialValues)},minimumRequiredWireCount:function(){var e=1,t=!0,r=!1,n=void 0;try{for(var i,a=this.columns[Symbol.iterator]();!(t=(i=a.next()).done);t=!0)var o=i.value,e=Math.max(e,o.minimumRequiredWireCount())}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}var u=!0,r=!1,n=void 0;try{for(var s,l=this.customInitialValues.keys()[Symbol.iterator]();!(u=(s=l.next()).done);u=!0){var c=s.value;e=Math.max(e,c+1)}}catch(e){r=!0,n=e}finally{try{u||null==l.return||l.return()}finally{if(r)throw n}}return e},withMinimumWireCount:function(){return this.withWireCount(this.minimumRequiredWireCount())},minimumRequiredColCount:function(){for(var e=0,t=0;t<this.columns.length;t++)e=Math.max(e,this.columns[t].maximumGateWidth()+t);return e},colIsMeasuredMask:function(e){return e<0?0:this._measureMasks[Math.min(e,this.columns.length)]},colDesiredSingleQubitStatsMask:function(e){if(e<0||e>=this.columns.length)return 0;for(var t=this.columns[e],r=0,n=0;n<t.gates.length;n++)void 0!==t.gates[n]&&t.gates[n].isSingleQubitDisplay&&void 0===this.gateAtLocIsDisabledReason(e,n)&&(r|=1<<n);return r},colCustomContextFromGates:function(e,t){var r,n;return e<0||e>=this.columns.length?new Map:(void 0===(n=this._cachedColumnContexts.get(r=""+t))&&(n=this._uncached_customContextFromGates(t),this._cachedColumnContexts.set(r,n)),n[e])},_uncached_customContextFromGates:function(e){for(var t=[],r=new Map,n=0;n<this.columns.length;n++){for(var i=new Map(r),a=this.columns[n],o=0;o<a.gates.length;o++){var u=a.gates[o];if(void 0!==u&&void 0===this.gateAtLocIsDisabledReason(n,o)){var s=!0,l=!1,c=void 0;try{for(var d,m=u.customColumnContextProvider(e+o,u)[Symbol.iterator]();!(s=(d=m.next()).done);s=!0){var f=d.value,h=f.key,g=f.val;i.set(h,g),u.isContextTemporary||r.set(h,g)}}catch(e){l=!0,c=e}finally{try{s||null==m.return||m.return()}finally{if(l)throw c}}}}t.push(i)}return t},locIsMeasured:function(e){var t=e.y;return!(t<0||t>=this.numWires)&&0!=(this.colIsMeasuredMask(e.x)&1<<t)},locClassifyMeasuredIncludingGateExtension:function(e){var t,r=e.y;return!(r<0||r>=this.numWires)&&(t=void 0===(t=this.columns[e.x].gates[r])?1:t.height,0!=(e=this.colIsMeasuredMask(e.x)>>r&(1<<t)-1))&&(e==(1<<t)-1||void 0)},gateInSlot:function(e,t){return e<0||e>=this.columns.length||t<0||t>=this.numWires||void 0===(e=this.columns[e].gates[t])?void 0:e},findGateCoveringSlot:function(e,t){e=e+":"+t;if(this._gateSlotCoverMap.has(e))return this._gateSlotCoverMap.get(e)},locIsControlWireStarter:function(e){e=this.gateInSlot(e.x,e.y);return void 0!==e&&e.isControlWireSource},locStartsSingleControlWire:function(e){return this.locIsControlWireStarter(e)&&!0!==this.locClassifyMeasuredIncludingGateExtension(e)&&void 0===this.gateAtLocIsDisabledReason(e.x,e.y)},locStartsDoubleControlWire:function(e){return this.locIsControlWireStarter(e)&&!1!==this.locClassifyMeasuredIncludingGateExtension(e)&&void 0===this.gateAtLocIsDisabledReason(e.x,e.y)},colGetEnabledSwapGate:function(e){if(!(e<0||e>=this.columns.length)){for(var t=[],r=0;r<this.numWires;r++)if(this.gateInSlot(e,r)===p.Special.SwapHalf){if(void 0!==this.gateAtLocIsDisabledReason(e,r))return;t.push(r)}if(2===t.length)return t}},locProvidesStat:function(e,t){e=this.gateInSlot(e.x,e.y);return void 0!==e&&!e.customColumnContextProvider(0,e).every(function(e){return e.key!==t})},locNeedsStat:function(e,t){e=this.gateInSlot(e.x,e.y);return void 0!==e&&e.getUnmetContextKeys().has(t)},locHasControllableGate:function(e){e=this.gateInSlot(e.x,e.y);return void 0!==e&&e.interestedInControls},colHasControls:function(e){return!(e<0||e>=this.columns.length)&&this.columns[e].hasControl()},colHasSingleWireControl:function(e){return!(e<0||e>=this.columns.length)&&this.columns[e].hasCoherentControl(this._measureMasks[e])},colHasDoubleWireControl:function(e){return!(e<0||e>=this.columns.length)&&this.columns[e].hasMeasuredControl(this._measureMasks[e])},colControls:function(e){if(e<0||e>=this.columns.length)return s.NONE;for(var t,r=this.columns[e],n=0,i=0,a=0,o=0;o<r.gates.length;o++){var u=r.gates[o];void 0!==u&&void 0===this.gateAtLocIsDisabledReason(e,o)&&("parity"===(u=u.controlBit())?a|=1<<o:void 0!==u&&(n|=1<<o,u)&&(i|=1<<o))}return 0!==a&&(i|=t=a&~(a-1),n|=t),new s(n,i,a)},gateAtLocIsDisabledReason:function(e,t){if(!(e<0||t<0||e>=this._colRowDisabledReason.length||t>=this.numWires))return this._colRowDisabledReason[e][t]},applyInitialStateOperations:function(e){for(var t=0;t<this.numWires;t++){var r=this.customInitialValues.get(t);if(!c.has(r))throw new S("Unrecognized initial state.",{state:r});var n=!0,i=!1,a=void 0;try{for(var o,u=c.get(r)[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value;l.applyMatrixOperation(e.withRow(e.row+t),s.knownMatrixAt(e.time))}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}}},applyMainOperationsInCol:function(e,t){var r,n;e<0||e>=this.columns.length||(this._applyOpsInCol(e,t,function(t){if(!t.definitelyHasNoEffect()&&t!==p.Special.SwapHalf)return void 0!==t.customOperation?t.customOperation:function(e){return l.applyMatrixOperation(e,t.knownMatrixAt(e.time))}}),void 0!==(e=this.colGetEnabledSwapGate(e))&&(n=(r=(e=e[Symbol.iterator]()).next()).done?void 0:r.value,e=(r=e.next()).done?void 0:r.value,t.applyOperation(i.swap(t.withRow(n+t.row),e+t.row))))},applyBeforeOperationsInCol:function(e,t){this._applyOpsInCol(e,t,function(e){return e.customBeforeOperation})},applyAfterOperationsInCol:function(e,t){this._applyOpsInCol(e,t,function(e){return e.customAfterOperation})},_applyOpsInCol:function(e,t,r){if(!(e<0||e>=this.columns.length))for(var n=this.columns[e],i=0;i<this.numWires;i++){var a=n.gates[i];void 0!==a&&void 0===this.gateAtLocIsDisabledReason(e,i)&&void 0!==(a=r(a))&&a(t.withRow(t.row+i))}},customStatRowsInCol:function(e){if(e<0||e>=this.columns.length)return[];for(var t=this.columns[e],r=[],n=0;n<t.gates.length;n++)void 0!==t.gates[n]&&void 0!==t.gates[n].customStatTexturesMaker&&void 0===this.gateAtLocIsDisabledReason(e,n)&&r.push(n);return r},isSlotRectCoveredByGateInSameColumn:function(e,t,r){for(var n=0;n<r;n++){var i=this.findGateCoveringSlot(e,t+n);if(void 0!==i&&i.col===e)return!0}return!1},withCustomGate:function(e){return new m(this.numWires,this.columns,this.outerRowOffset,this.outerContext,this.customGateSet.withGate(e),!1,this.customInitialValues)},controlLinesRanges:function(t){function e(e){return o.locHasControllableGate(s(e))}function r(e){return void 0!==n&&-1!==n.indexOf(e)}var o=this,u=this.columns[t].gates.length,n=this.colGetEnabledSwapGate(t),s=function(e){return new v(t,e)},l=function(e){return!0!==o.locClassifyMeasuredIncludingGateExtension(s(e))},c=function(e){return!1!==o.locClassifyMeasuredIncludingGateExtension(s(e))},d=[y(u,r,r,!1),y(u,e,function(e){return o.locStartsSingleControlWire(s(e))},!1),y(u,e,function(e){return o.locStartsDoubleControlWire(s(e))},!0)],i=!0,a=!1,m=void 0;try{for(var f=function(){function t(e){return o.locProvidesStat(s(e),n)||o.locProvidesStat(s(e),i)}function e(e){return o.locNeedsStat(s(e),n)||o.locNeedsStat(s(e),a)}var r=h.value,n="Input Range "+r,i="Input Default "+r,a="Input NO_DEFAULT Range "+r;d.push(y(u,function(e){return t(e)&&l(e)},e,!1),y(u,function(e){return t(e)&&c(e)},e,!0))},h=void 0,g=p.InputGates.Letters[Symbol.iterator]();!(i=(h=g.next()).done);i=!0)f()}catch(e){a=!0,m=e}finally{try{i||null==g.return||g.return()}finally{if(a)throw m}}return d.filter(function(e){return void 0!==e})}},{fromTextDiagram:function(n,e){var i=o(e.split("\n")).map(function(e){return e.trim()}).filter(function(e){return""!==e}).toArray();if(1<o(i.map(function(e){return e.length})).distinct().count())throw new S("Uneven diagram",{diagram:e});var e=i.length,t=0<i.length?i[0].length:0;return new m(e,u.range(t).map(function(r){return new T(o(i).mapWithIndex(function(e,t){e=e[r];if(!n.has(e))throw new S("Unspecified gate",{char:e});e=n.get(e);if(null!=e){if(e.hasOwnProperty("ofSize"))return e.ofSize(function(e,t){for(var r=1;t+r<i.length;r++)if(null!==n.get(i[t+r][e]))return r;return i.length-t}(r,t));if(e instanceof a)return e;throw new S("Not a gate",e)}}).toArray())}).toArray())}});function m(t,e){var r,n,i=void 0!==arguments[2]?arguments[2]:0,a=void 0!==arguments[3]?arguments[3]:new Map,o=void 0!==arguments[4]?arguments[4]:new x,u=void 0!==arguments[5]&&arguments[5],s=void 0!==arguments[6]?arguments[6]:new Map;if(t<0)throw new S("Bad numWires",{numWires:t});if(!Array.isArray(e))throw new S("Bad columns",{numWires:t,columns:e});if(!e.every(function(e){return e instanceof T}))throw new S("Not a GateColumn",{columns:e});if(!e.every(function(e){return e.gates.length===t}))throw new S("Wrong gate count in a column",{numWires:t,columns:e});this.numWires=t,this.columns=e,this.customGateSet=o,this.outerRowOffset=i,this.outerContext=a,this.isNested=u,this.customInitialValues=new Map;var l=!0,o=!1,c=void 0;try{for(var d,m=s.entries()[Symbol.iterator]();!(l=(d=m.next()).done);l=!0){var f=(n=(r=d.value[Symbol.iterator]()).next()).done?void 0:n.value,h=(n=r.next()).done?void 0:n.value;if(!Number.isInteger(f)||f<0)throw new S("Initial state key out of range.",{customInitialValues:s,numWires:t});f>=this.numWires||this.customInitialValues.set(f,h)}}catch(e){o=!0,c=e}finally{try{l||null==m.return||m.return()}finally{if(o)throw c}}this._colRowDisabledReason=[],this._measureMasks=[0];var g=0,p=new Map,v=!0,o=!1,c=void 0;try{for(var y,b=e[Symbol.iterator]();!(v=(y=b.next()).done);v=!0){var R=y.value,w=R.perRowDisabledReasons(g,i,a,p,u),M=w.allReasons,_=w.stickyCtx,g=R.nextMeasureMask(g,M);this._colRowDisabledReason.push(M),this._measureMasks.push(g),p=_}}catch(e){o=!0,c=e}finally{try{v||null==b.return||b.return()}finally{if(o)throw c}}this._gateSlotCoverMap=this._computeGateSlotCoverMap(),this._cachedColumnContexts=new Map}function y(e,t,r,n){var i=(a=(t=f(e,t)[Symbol.iterator]()).next()).done?void 0:a.value,t=(a=t.next()).done?void 0:a.value,r=(e=(a=f(e,r)[Symbol.iterator]()).next()).done?void 0:e.value,a=(e=a.next()).done?void 0:e.value;if(void 0!==r&&void 0!==i)return{first:Math.min(i,r),last:Math.max(t,a),measured:n}}function f(e,t){for(var r=void 0,n=void 0,i=0;i<e;i++)t(i)&&(void 0===r&&(r=i),n=i);return[r,n]}return d.EMPTY=new d(0,[]),{get CircuitDefinition(){return d}}}),$traceurRuntime.registerModule("src/circuit/CircuitEvalContext.js",[],function(){"use strict";var t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglConfiguredShader.js","src/circuit/CircuitEvalContext.js")).WglConfiguredShader,e=$traceurRuntime.createClass(r,{applyOperation:function(e){e=e instanceof t?e:e(this);this.stateTrader.shadeAndTrade(e)},_clone:function(){return new r(this.time,this.row,this.wireCount,this.controls,this.controlsTexture,this.rawControls,this.stateTrader,this.customContextFromGates)},withRow:function(e){var t=this._clone();return t.row=e,t},withInputSetToRange:function(e,t,r){var n=this._clone();return n.customContextFromGates=new Map(n.customContextFromGates),n.customContextFromGates.set("Input Range "+e,{offset:t,length:r}),n},withInputSetToConstant:function(e,t){var r=this._clone();return r.customContextFromGates=new Map(r.customContextFromGates),r.customContextFromGates.delete("Input Range "+e),r.customContextFromGates.set("Input Default "+e,t),r},withInputSetToOtherInput:function(e,t){var r=this._clone(),n=(r.customContextFromGates=new Map(r.customContextFromGates),!0),i=!1,a=void 0;try{for(var o,u=["Range","Default"][Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value,l=r.customContextFromGates.get("Input "+s+" "+t);void 0!==l?r.customContextFromGates.set("Input "+s+" "+e,l):r.customContextFromGates.delete("Input "+s+" "+e)}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}return r}},{});function r(e,t,r,n,i,a,o,u){this.time=e,this.row=t,this.wireCount=r,this.controls=n,this.rawControls=a,this.controlsTexture=i,this.stateTrader=o,this.customContextFromGates=u}return{get CircuitEvalContext(){return e}}}),$traceurRuntime.registerModule("src/circuit/CircuitShaders.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/circuit/CircuitShaders.js")).Config,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./Controls.js","src/circuit/CircuitShaders.js")).Controls,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./KetShaderUtil.js","src/circuit/CircuitShaders.js")),n=t.ketArgs,t=t.ketShaderPermute,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/Shaders.js","src/circuit/CircuitShaders.js")).Shaders,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/circuit/CircuitShaders.js")).Util,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglArg.js","src/circuit/CircuitShaders.js")).WglArg,u=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglConfiguredShader.js","src/circuit/CircuitShaders.js")).WglConfiguredShader,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/ShaderCoders.js","src/circuit/CircuitShaders.js"))),s=u.currentShaderCoder,l=u.makePseudoShaderWithInputsAndOutputAndCode,c=u.Inputs,u=u.Outputs,d=$traceurRuntime.createClass(function(){},{},{}),m=(d.classicalState=function(e){return m(o.float("state",e))},l([],u.vec2(),"\n    uniform float state;\n    vec2 outputFor(float k) {\n        return vec2(float(k == state), 0.0);\n    }")),f=(d.linearOverlay=function(e,t,r){return f(r,t,o.float("offset",e))},l([c.vec4("back"),c.vec4("fore")],u.vec4(),"\n    uniform float offset;\n    vec4 outputFor(float k) {\n        // Note: can't use multiplication to combine because it spreads NaNs from the background into the foreground.\n        return k >= offset && k < offset + len_fore() ? read_fore(k - offset) : read_back(k);\n    }")),h=(d.controlMask=function(e){return e.isEqualTo(r.NONE)?i.color(1,0,0,0):h(o.float("used",e.inclusionMask),o.float("desired",e.desiredValueMask))},l([],u.bool(),"\n    uniform float used;\n    uniform float desired;\n\n    bool outputFor(float k) {\n        float pass = 1.0;\n        float bit = 1.0;\n        for (int i = 0; i < "+e.MAX_WIRE_COUNT+"; i++) {\n            float v = mod(floor(k/bit), 2.0);\n            float u = mod(floor(used/bit), 2.0);\n            float d = mod(floor(desired/bit), 2.0);\n            pass *= 1.0 - abs(v-d)*u;\n            bit *= 2.0;\n        }\n        return pass == 1.0;\n    }")),g=(d.controlSelect=function(e,t){return e.isEqualTo(r.NONE)?i.passthrough(t):g(t,o.float("used",e.inclusionMask),o.float("desired",e.desiredValueMask))},l([c.vec2("input")],u.vec2(),"\n    uniform float used;\n    uniform float desired;\n\n    /**\n     * Inserts bits from the given value into the holes between used bits in the desired mask.\n     */\n    float scatter(float k) {\n        float maskPos = 1.0;\n        float coordPos = 1.0;\n        float result = 0.0;\n        for (int i = 0; i < "+e.MAX_WIRE_COUNT+"; i++) {\n            float v = mod(floor(k/coordPos), 2.0);\n            float u = mod(floor(used/maskPos), 2.0);\n            float d = mod(floor(desired/maskPos), 2.0);\n            result += (v + u*(d-v)) * maskPos;\n            coordPos *= 2.0-u;\n            maskPos *= 2.0;\n        }\n        return result;\n    }\n\n    vec2 outputFor(float k) {\n        return read_input(scatter(k));\n    }")),p=(d.swap=function(e,t){return p.withArgs.apply(p,$traceurRuntime.spread(n(e,t-e.row+1)))},t("","\n    float low_bit = mod(out_id, 2.0);\n    float mid_bits = floor(mod(out_id, span*0.5)*0.5);\n    float high_bit = floor(out_id*2.0/span);\n    return high_bit + mid_bits*2.0 + low_bit*span*0.5;")),v=(d.qubitDensities=function(e){var t=arguments[1],r=(void 0===t&&(t=(1<<s().vec2.arrayPowerSizeOfTexture(e))-1),a.ceilingPowerOf2(a.numberOfSetBits(t)));return v(e,o.float("keptCount",r),o.float("keptBitMask",t))},l([c.vec2("input")],u.vec4(),"\n    uniform float keptCount;\n    uniform float keptBitMask;\n\n    float scatter(float val, float used) {\n        float result = 0.0;\n        float posUsed = 1.0;\n        float posVal = 1.0;\n        for (int i = 0; i < "+e.MAX_WIRE_COUNT+"; i++) {\n            float u = mod(floor(used/posUsed), 2.0);\n            float v = mod(floor(val/posVal), 2.0);\n            result += u * v * posUsed;\n            posVal *= 1.0+u;\n            posUsed *= 2.0;\n        }\n        return result;\n    }\n\n    vec4 outputFor(float k) {\n        float bitIndex = mod(k, keptCount);\n        float otherBits = floor(k / keptCount);\n        float bit = scatter(exp2(bitIndex), keptBitMask);\n\n        // Indices of the two complex values making up the current conditional ket.\n        float srcIndex0 = mod(otherBits, bit) + floor(otherBits / bit) * bit * 2.0;\n        float srcIndex1 = srcIndex0 + bit;\n\n        // Grab the two complex values.\n        vec2 w1 = read_input(srcIndex0);\n        vec2 w2 = read_input(srcIndex1);\n\n        // Compute density matrix components.\n        float a = dot(w1, w1);\n        float br = dot(w1, w2);\n        float bi = dot(vec2(-w1.y, w1.x), w2);\n        float d = dot(w2, w2);\n\n        return vec4(a, br, bi, d);\n    }"));return{get CircuitShaders(){return d}}}),$traceurRuntime.registerModule("src/circuit/CircuitStats.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./CircuitDefinition.js","src/circuit/CircuitStats.js")).CircuitDefinition,y=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./CircuitEvalContext.js","src/circuit/CircuitStats.js")).CircuitEvalContext,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./CircuitShaders.js","src/circuit/CircuitStats.js")).CircuitShaders,R=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./KetTextureUtil.js","src/circuit/CircuitStats.js")).KetTextureUtil,w=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./Controls.js","src/circuit/CircuitStats.js")).Controls,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/DetailedError.js","src/circuit/CircuitStats.js")).DetailedError,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/circuit/CircuitStats.js")),l=t.Matrix,r=t.complexVectorToReadableJson,M=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/Shaders.js","src/circuit/CircuitStats.js")).Shaders,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./Serializer.js","src/circuit/CircuitStats.js")).Serializer,_=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/circuit/CircuitStats.js")).Util,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../fallback.js","src/circuit/CircuitStats.js")).notifyAboutRecoveryFromUnexpectedError,x=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./CircuitComputeUtil.js","src/circuit/CircuitStats.js")).advanceStateWithCircuit,S=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/ShaderCoders.js","src/circuit/CircuitStats.js")).currentShaderCoder,T=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglTextureTrader.js","src/circuit/CircuitStats.js")).WglTextureTrader,o=$traceurRuntime.createClass(A,{qubitDensityMatrix:function(e,t){if(t<0)throw new n("Bad wireIndex",{wireIndex:t,colIndex:e});var r;return e<0||t>=this.circuitDefinition.numWires?t>=this.circuitDefinition.numWires&&this.qubitDensityMatrix(e,0).hasNaN()?l.zero(2,2).times(NaN):((r=new Float32Array(8))[0]=1,new l(2,2,r)):(r=Math.min(e,this._qubitDensities.length-1))<0||t>=this._qubitDensities[r].length?l.zero(2,2).times(NaN):this._qubitDensities[r][t]},toReadableJson:function(){var e=void 0===arguments[0]||arguments[0],t={time_parameter:this.time,circuit:i.toJson(this.circuitDefinition),chance_of_surviving_to_each_column:this._survivalRates,computed_bloch_vectors_by_column_then_wire:this._qubitDensities.map(function(e){return e.map(u)}),displays:this._customStatsToReadableJson()};return e&&(t.output_amplitudes=r(this.finalState.getColumn(0))),t},_customStatsToReadableJson:function(){var e,t,r,n,i=[],a=!0,o=!1,u=void 0;try{for(var s,l=this._customStatsProcessed.entries()[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=(t=(e=s.value[Symbol.iterator]()).next()).done?void 0:t.value,d=(t=e.next()).done?void 0:t.value,m=(n=(r=c.split(":")[Symbol.iterator]()).next()).done?void 0:n.value,f=(n=r.next()).done?void 0:n.value,f=parseInt(f),m=parseInt(m),h=this.circuitDefinition.columns[m].gates[f];void 0!==h.processedStatsToJsonFunc&&(d=h.processedStatsToJsonFunc(d)),i.push({location:{wire:f,column:m},type:{serialized_id:h.serializedId,name:h.name},data:d})}}catch(e){o=!0,u=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw u}}return i},survivalRate:function(e){return(e=Math.min(e,this._survivalRates.length-1))<0?1:this._survivalRates[e]},customStatsForSlot:function(e,t){e=e+":"+t;return this._customStatsProcessed.has(e)?this._customStatsProcessed.get(e):void 0},controlledWireProbabilityJustAfter:function(e,t){return this.qubitDensityMatrix(t,e).rawBuffer()[6]},withTime:function(e){return new A(this.circuitDefinition,e,this._survivalRates,this._qubitDensities,this.finalState,this._customStatsProcessed)}},{withNanDataFromCircuitAtTime:function(e,t){return new A(e,t,[1],[],l.zero(1,1<<e.numWires).times(NaN),new Map)},fromCircuitAtTime:function(t,r){try{return A._fromCircuitAtTime_noFallback(t,r)}catch(e){return a("Defaulted to NaN results. Computing circuit values failed.",{circuitDefinition:i.toJson(t)},e),A.withNanDataFromCircuitAtTime(t,r)}},decohereMeasuredBitsInDensityMatrix:function(e,t){if(0===t)return e;for(var r=new Float32Array(e.rawBuffer()),n=e.width(),i=0;i<n;i++)for(var a,o=0;o<n;o++)0!=((i^o)&t)&&(r[a=2*(i*n+o)]=0,r[1+a]=0);return new l(n,n,r)},scatterAndDecohereDensities:function(e,t,r,n,i){for(var a=l.zero(1<<r,1<<r).times(NaN),o=0,u=[],s=0;s<t-r+1;s++)u.push(0==(i&1<<s)?a:A.decohereMeasuredBitsInDensityMatrix(e[o++],n>>s&(1<<r)-1));return u},_extractColumnQubitStatsFromPixelDatas:function(e,t){for(var r=[],n=0;n<t.length;n++){var i=n===e.columns.length?-1:e.colDesiredSingleQubitStatsMask(n);r.push(A.scatterAndDecohereDensities(R.pixelsToQubitDensityMatrices(t[n]),e.numWires,1,e.colIsMeasuredMask(n),i))}return r},_extractColumnSurvivalRateStatsFromPixelDatas:function(e){for(var t=1,r=[],n=0;n<e.length;n++)0<e[n].length&&(t=e[n][0]),r.push(t);return r},_fromCircuitAtTime_noFallback:function(e,t){var r=(e=e.withMinimumWireCount()).numWires,n=new T(b.classicalState(0).toVec2Texture(r)),i=b.controlMask(w.NONE).toBoolTexture(r),r=x(new y(t,0,r,w.NONE,i,w.NONE,n,new Map),e,!0),a=r.colQubitDensities,o=r.colNorms,u=r.customStats,r=r.customStatsMap,s=(i.deallocByDepositingInPool("controlTex in _fromCircuitAtTime_noFallback"),S().vec2.needRearrangingToBeInVec4Format&&n.shadeHalveAndTrade(M.packVec2IntoVec4),_.objectifyArrayFunc(R.mergedReadFloats)({output:n.currentTexture,colQubitDensities:a,colNorms:o,customStats:u})),i=A._extractColumnQubitStatsFromPixelDatas(e,s.colQubitDensities),n=A._extractColumnSurvivalRateStatsFromPixelDatas(s.colNorms),a=R.pixelsToAmplitudes(s.output,0===n.length?1:n[n.length-1]),l=new Map,c=!0,o=!1,u=void 0;try{for(var d,m=r[Symbol.iterator]();!(c=(d=m.next()).done);c=!0){var f=d.value,h=f.col,g=f.row,p=f.out,v=e.gateInSlot(h,g).customStatPostProcesser||function(e){return e};l.set(h+":"+g,v(s.customStats[p],e,h,g))}}catch(e){o=!0,u=e}finally{try{c||null==m.return||m.return()}finally{if(o)throw u}}return new A(e,t,n,i,a,l)}});function A(e,t,r,n,i,a){this.circuitDefinition=e,this.time=t,this._survivalRates=r,this._qubitDensities=n,this.finalState=i,this._customStatsProcessed=a}function u(e){var t,r,n;return e.hasNaN()?null:(r=(t=(e=e.qubitDensityMatrixToBlochVector()[Symbol.iterator]()).next()).done?void 0:t.value,n=(t=e.next()).done?void 0:t.value,e=(t=e.next()).done?void 0:t.value,{x:r*=-1,y:n,z:e*=-1})}return o.EMPTY=o.withNanDataFromCircuitAtTime(e.EMPTY,0),{get CircuitStats(){return o}}}),$traceurRuntime.registerModule("src/circuit/Controls.js",[],function(){"use strict";var n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/DetailedError.js","src/circuit/Controls.js")).DetailedError,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Seq.js","src/circuit/Controls.js")).Seq,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/circuit/Controls.js")).Util,e=$traceurRuntime.createClass(r,{isEqualTo:function(e){return e instanceof r&&this.inclusionMask===e.inclusionMask&&this.desiredValueMask===e.desiredValueMask&&this.parityMask===e.parityMask},toString:function(){var e,t,r=this;return 0===this.inclusionMask?"No Controls":(t="Controls: ...__"+(e=i.naturals().takeWhile(function(e){return 1<<e<=(r.inclusionMask|r.parityMask)})).map(function(e){return r.desiredValueFor(e)}).map(function(e){return void 0===e?"_":e?"1":"0"}).reverse().join(""),0!==this.parityMask&&(t+="\n  parity: ...__"+e.map(function(e){return r.parityMask&1<<e}).map(function(e){return e?"1":"_"}).reverse().join("")),t)},allowsState:function(e){return(this.inclusionMask&e)===this.desiredValueMask},desiredValueFor:function(e){if(0!=(this.inclusionMask&1<<e))return 0!=(this.desiredValueMask&1<<e)},includedBitCount:function(){return this.inclusionMask<0?1/0:a.numberOfSetBits(this.inclusionMask)},and:function(e){if((e.desiredValueMask&this.inclusionMask)!=(this.desiredValueMask&e.inclusionMask))throw new n("Contradictory controls.",{this:this,other:e});if(0!=(e.parityMask&this.inclusionMask)||0!=(this.parityMask&e.inclusionMask))throw new n("Can't intersect parity controls.",{this:this,other:e});return new r(this.inclusionMask|e.inclusionMask,this.desiredValueMask|e.desiredValueMask,this.parityMask|e.parityMask)},shift:function(e){return new r(this.inclusionMask<<e,this.desiredValueMask<<e,this.parityMask<<e)}},{bit:function(e,t){if(e<0)throw new n("Out of range",{bitIndex:e});return new r(1<<e,t?1<<e:0)}});function r(e,t){var r=void 0!==arguments[2]?arguments[2]:0;if(0!=(t&~e))throw new n("Desired un-included bits",{inclusionMask:e,desiredValueMask:t});if(0!==r&&1!==a.popcnt(e&r))throw new n("Exactly one parity bit must be in the inclusion mask",{inclusionMask:e,parityMask:r});this.inclusionMask=e,this.desiredValueMask=t,this.parityMask=r}return e.NONE=new e(0,0),{get Controls(){return e}}}),$traceurRuntime.registerModule("src/circuit/CustomGateSet.js",[],function(){"use strict";var t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/DetailedError.js","src/circuit/CustomGateSet.js")).DetailedError,e=$traceurRuntime.createClass(r,{withGate:function(e){if(!e.serializedId.startsWith("~"))throw new t("Custom gates' serialized id must start with '~'.",{id:e.serializedId,gate:e});if(this.findGateWithSerializedId(e.serializedId))throw new t("Duplicate serialized id.",{gate:e});return new(Function.prototype.bind.apply(r,$traceurRuntime.spread([null],this.gates,[e])))},findGateWithSerializedId:function(e){var t=!0,r=!1,n=void 0;try{for(var i,a=this.gates[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;if(o.serializedId===e)return o}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}},{});function r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.gates=e}return{get CustomGateSet(){return e}}}),$traceurRuntime.registerModule("src/circuit/Gate.js",[],function(){"use strict";var o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/DetailedError.js","src/circuit/Gate.js")).DetailedError,r=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GateDrawParams.js","src/circuit/Gate.js")).GateDrawParams,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Complex.js","src/circuit/Gate.js")).Complex),u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/circuit/Gate.js")).Matrix,e=$traceurRuntime.createClass(t,{_copy:function(){var e=new t;return e.symbol=this.symbol,e.name=this.name,e.blurb=this.blurb,e.alternate=this.alternate,e.serializedId=this.serializedId,e.onClickGateFunc=this.onClickGateFunc,e.tag=this.tag,e.param=this.param,e.customDrawer=this.customDrawer,e.interestedInControls=this.interestedInControls,e.customBeforeOperation=this.customBeforeOperation,e.knownBitPermutationFunc=this.knownBitPermutationFunc,e.customOperation=this.customOperation,e.customAfterOperation=this.customAfterOperation,e.customStatTexturesMaker=this.customStatTexturesMaker,e.customStatPostProcesser=this.customStatPostProcesser,e.processedStatsToJsonFunc=this.processedStatsToJsonFunc,e.width=this.width,e.height=this.height,e.isSingleQubitDisplay=this.isSingleQubitDisplay,e._knownMatrix=this._knownMatrix,e.knownCircuit=this.knownCircuit,e._showAsReachesOtherWires=this._showAsReachesOtherWires,e.isContextTemporary=this.isContextTemporary,e.knownCircuitNested=this.knownCircuitNested,e._requiredContextKeys=this._requiredContextKeys,e._knownMatrixFunc=this._knownMatrixFunc,e._stableDuration=this._stableDuration,e._withParamRecomputeFunc=this._withParamRecomputeFunc,e._hasNoEffect=this._hasNoEffect,e._effectPermutesStates=this._effectPermutesStates,e._effectCreatesSuperpositions=this._effectCreatesSuperpositions,e._affectsOtherWires=this._affectsOtherWires,e._controlBit=this._controlBit,e._isClassicalControl=this._isClassicalControl,e.isControlWireSource=this.isControlWireSource,e._isDefinitelyUnitary=this._isDefinitelyUnitary,e.knownPhaseTurnsFunc=this.knownPhaseTurnsFunc,e.knownPermutationFuncTakingInputs=this.knownPermutationFuncTakingInputs,e.customColumnContextProvider=this.customColumnContextProvider,e.customDisableReasonFinder=this.customDisableReasonFinder,e.knownBitPermutationGroupMasks=this.knownBitPermutationGroupMasks,e},withParam:function(e){var t=this._copy();return t.param=e,t._withParamRecomputeFunc(t),t},getUnmetContextKeys:function(){var e=new Set(this._requiredContextKeys);if(void 0!==this.knownCircuit){var t=!0,r=!1,n=void 0;try{for(var i,a=this.knownCircuit.getUnmetContextKeys()[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;e.add(o)}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}return e},shouldShowAsHavingGlobalEffect:function(){return this._showAsReachesOtherWires||!this._isDefinitelyUnitary},canChangeInSize:function(){return 1<this.gateFamily.length},canIncreaseInSize:function(){var t=this;return!this.gateFamily.every(function(e){return e.height!==t.height+1})},canDecreaseInSize:function(){var t=this;return!this.gateFamily.every(function(e){return e.height!==t.height-1})},knownMatrixAt:function(e){return void 0!==this._knownMatrix?this._knownMatrix:void 0!==this._knownMatrixFunc?this._knownMatrixFunc(e,this.param):void 0},isControl:function(){return void 0!==this._controlBit},isClassicalControl:function(){return this._isClassicalControl},controlBit:function(){return this._controlBit},effectMightPermutesStates:function(){return void 0!==this._effectPermutesStates?this._effectPermutesStates:void 0===this._knownMatrix||!this._knownMatrix.isDiagonal()},effectMightCreateSuperpositions:function(){return void 0!==this._effectCreatesSuperpositions?this._effectCreatesSuperpositions:void 0===this._knownMatrix||!this._knownMatrix.isPhasedPermutation()},definitelyHasNoEffect:function(){return this._hasNoEffect},isDefinitelyUnitary:function(){return this._isDefinitelyUnitary},stableDuration:function(){return void 0!==this._stableDuration?this._stableDuration:void 0!==this._knownMatrix||this._hasNoEffect?1/0:0},toString:function(){return"Gate("+this.symbol+")"}},{fromKnownMatrix:function(e,t){var r=void 0!==arguments[2]?arguments[2]:"",n=void 0!==arguments[3]?arguments[3]:"",i=arguments[4],a=arguments[5];if(t instanceof u)return i=(new s).setSymbol(e).setSerializedId(void 0===i?e:i).setTitle(r).setBlurb(n).setKnownEffectToMatrix(t),(i=void 0!==a?i.setAlternate(a):i).gate;throw new o("Bad matrix.",{symbol:e,matrix:t,name:r,blurb:n})},buildFamily:function(e,t,r){for(var u=[],n=e;n<=t;n++){var i=new s;i.setHeight(n),r(n,i),(i.gate.gateFamily=u).push(i.gate)}return{all:u,ofSize:function(e){var t=!0,r=!1,n=void 0;try{for(var i,a=u[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;if(o.height===e)return o}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}}}});function t(){this.symbol="",this.serializedId="",this.name="",this.blurb="",this.width=1,this.height=1,this.param=void 0,this._withParamRecomputeFunc=function(e){},this.customDrawer=void 0,this.onClickGateFunc=void 0,this.tag=void 0,this.customBeforeOperation=void 0,this.customOperation=void 0,this.customAfterOperation=void 0,this.customStatTexturesMaker=void 0,this.customStatPostProcesser=void 0,this.processedStatsToJsonFunc=void 0,this.gateFamily=[this],this.interestedInControls=!0,this._stableDuration=void 0,this._knownMatrix=void 0,this._knownMatrixFunc=void 0,this._hasNoEffect=!1,this._effectPermutesStates=void 0,this._effectCreatesSuperpositions=void 0,this.isControlWireSource=!1,this.knownCircuit=void 0,this.knownCircuitNested=void 0,this._requiredContextKeys=[],this.isSingleQubitDisplay=!1,this._controlBit=void 0,this._isClassicalControl=!1,this._isDefinitelyUnitary=!1,(this.alternate=this).customColumnContextProvider=function(e,t){return[]},this.isContextTemporary=!0,this.customDisableReasonFinder=function(e){},this.knownBitPermutationFunc=void 0,this.knownBitPermutationGroupMasks=void 0,this.knownPhaseTurnsFunc=void 0,this.knownPermutationFuncTakingInputs=void 0,this._showAsReachesOtherWires=!1}var s=$traceurRuntime.createClass(function(){this.gate=new e},{setSerializedIdAndSymbol:function(e){return this.gate.symbol=e,this.gate.serializedId=e,this},setSymbol:function(e){return this.gate.symbol=e,this},setAlternateFromFamily:function(e){return this.setAlternate(e.ofSize(this.gate.height))},setAlternate:function(e){if(void 0===e)throw new Error("alternate === undefined");if(e.height!==this.gate.height)throw new Error("alternate.height !== this.gate.height");if(e.alternate!==e)throw new Error("alternate.alternate !== alternate");return e.alternate=this.gate,this.gate.alternate=e,this},setSerializedId:function(e){return this.gate.serializedId=e,this},setTitle:function(e){return this.gate.name=e,this},setBlurb:function(e){return this.gate.blurb=e,this},setHeight:function(e){return this.gate.height=e,this},setWidth:function(e){return this.gate.width=e,this},setDrawer:function(e){return this.gate.customDrawer=e,this},setOnClickGateFunc:function(e){return this.gate.onClickGateFunc=e,this},setKnownEffectToMatrix:function(e){if(e instanceof u)return this.gate._isDefinitelyUnitary=e.isUnitary(.01),this.gate._hasNoEffect=e.isIdentity(),this.gate._stableDuration=1/0,this.gate._knownMatrix=e,this;throw new o("Bad matrix.",{matrix:e})},setKnownEffectToPermutation:function(t){var r=this;return this.gate.knownPermutationFuncTakingInputs=t,this.gate._knownMatrixFunc=function(e){return u.generateTransition(1<<r.gate.height,t)},this.gate._stableDuration=1/0,this.gate._hasNoEffect=!1,this.gate._effectPermutesStates=!0,this.gate._effectCreatesSuperpositions=!1,this.gate._isDefinitelyUnitary=!0,this},setKnownEffectToBitPermutation:function(e){return this.gate.knownBitPermutationFunc=e,this.gate.knownBitPermutationGroupMasks=function(e,t){for(var r=new Set,n=[],i=0;i<t;i++){for(var a=0,o=i;!r.has(o);)r.add(o),a|=1<<o,o=e(o);0!==a&&n.push(a)}return n}(e,this.gate.height),this.gate._isDefinitelyUnitary=!0,this.gate._stableDuration=1/0,this.gate._hasNoEffect=!1,this.gate._effectPermutesStates=!0,this.gate._effectCreatesSuperpositions=!1,this},setKnownEffectToTimeVaryingPermutation:function(r){var e=this.gate;return e._stableDuration=0,e._knownMatrixFunc=function(t){return u.generateTransition(1<<e.height,function(e){return r(t,e)})},e._hasNoEffect=!1,e._effectPermutesStates=!0,e._effectCreatesSuperpositions=!1,e._isDefinitelyUnitary=!0,this},setKnownEffectToParametrizedPermutation:function(e){var t=this.gate;return t.knownPermutationFuncTakingInputs=e,t._knownMatrixFunc=void 0,t._stableDuration=1/0,t._hasNoEffect=!1,t._effectPermutesStates=!0,t._effectCreatesSuperpositions=!1,t._isDefinitelyUnitary=!0,this},setKnownEffectToPhaser:function(t){var e=this;return this.gate._hasNoEffect=!1,this.gate._effectPermutesStates=!1,this.gate._effectCreatesSuperpositions=!1,this.gate._isDefinitelyUnitary=!0,this.gate._stableDuration=1/0,this.gate.knownPhaseTurnsFunc=t,this.gate._knownMatrixFunc=function(){return u.generateDiagonal(1<<e.gate.height,function(e){return r.polar(1,2*Math.PI*t(e))})},this},setTooltipMatrixFunc:function(t){return this.gate._knownMatrixFunc=function(e){return t()},this.gate._stableDuration=1/0,this},setKnownEffectToCircuit:function(e){return this.gate.knownCircuit=e,this.gate.knownCircuitNested=e.withDisabledReasonsForEmbeddedContext(0,new Map),this.gate._isDefinitelyUnitary=e.hasOnlyUnitaryGates(),this.gate._stableDuration=e.stableDuration(),this.gate.height=e.numWires,this},setEffectToTimeVaryingMatrix:function(e){return this.gate._stableDuration=0,this.gate._knownMatrixFunc=e,this.gate._hasNoEffect=!1,this},setWithParamPropertyRecomputeFunc:function(e){return this.gate._withParamRecomputeFunc=e,this},setActualEffectToUpdateFunc:function(e){if(void 0!==e&&"function"!=typeof e)throw new o("Bad customOperation",{circuitUpdateFunc:e});return this.gate.customOperation=e,this},setActualEffectToShaderProvider:function(t){return this.setActualEffectToUpdateFunc(function(e){return e.applyOperation(t)})},promiseEffectOnlyPermutesAndPhases:function(){return this.gate._hasNoEffect=!1,this.gate._effectPermutesStates=!0,this.gate._effectCreatesSuperpositions=!1,this.gate._isDefinitelyUnitary=!0,this},promiseEffectIsDiagonal:function(){return this.gate._hasNoEffect=!1,this.gate._effectPermutesStates=!1,this.gate._effectCreatesSuperpositions=!1,this},promiseEffectOnlyPhases:function(){return this.gate._hasNoEffect=!1,this.gate._effectPermutesStates=!1,this.gate._effectCreatesSuperpositions=!1,this.gate._isDefinitelyUnitary=!0,this},promiseEffectIsUnitary:function(){return this.gate._isDefinitelyUnitary=!0,this},promiseEffectIsStable:function(){return this.gate._stableDuration=1/0,this},promiseHasNoNetEffectOnStateVector:function(){return this.gate._stableDuration=1/0,this.gate._hasNoEffect=!0,this.gate._isDefinitelyUnitary=!0,this.gate._effectPermutesStates=!1,this.gate._effectCreatesSuperpositions=!1,this},promiseHasNoNetEffectOnStateVectorButStillRequiresDynamicRedraw:function(){return this.promiseHasNoNetEffectOnStateVector(),this.gate._stableDuration=0,this},markAsNotInterestedInControls:function(){return this.gate.interestedInControls=!1,this},markAsControlExpecting:function(e){var t=void 0!==arguments[1]&&arguments[1];return this.gate._controlBit=e,this.gate.isControlWireSource=!0,this.gate.interestedInControls=!1,this.gate._isClassicalControl=t,this},markAsReachingOtherWires:function(){return this.gate._showAsReachesOtherWires=!0,this},markAsDrawerNeedsSingleQubitDensityStats:function(){return this.gate.isSingleQubitDisplay=!0,this},setRequiredContextKeys:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.gate._requiredContextKeys=e,this},setContextProvider:function(e){return this.gate.customColumnContextProvider=e,this.gate.isContextTemporary=!0,this},setStickyContextProvider:function(e){return this.gate.customColumnContextProvider=e,this.gate.isContextTemporary=!1,this},setSetupCleanupEffectsToShaderProviders:function(t,r){return this.setSetupCleanupEffectToUpdateFunc(void 0===t?void 0:function(e){return e.applyOperation(t)},void 0===r?void 0:function(e){return e.applyOperation(r)})},setSetupCleanupEffectToUpdateFunc:function(e,t){if(void 0!==e&&"function"!=typeof e)throw new o("Bad beforeColumnUpdateFunc",{customOperation:customOperation});if(void 0!==t&&"function"!=typeof t)throw new o("Bad afterColumnUpdateFunc",{customOperation:customOperation});return this.gate.customBeforeOperation=e,this.gate.customAfterOperation=t,this},setExtraDisableReasonFinder:function(e){return this.gate.customDisableReasonFinder=e,this},setStatTexturesMaker:function(e){return this.gate.customStatTexturesMaker=e,this},setStatPixelDataPostProcessor:function(e){return this.gate.customStatPostProcesser=e,this},setProcessedStatsToJsonFunc:function(e){return this.gate.processedStatsToJsonFunc=e,this},setTag:function(e){return this.gate.tag=e,this}},{});return{get Gate(){return e},get GateBuilder(){return s}}}),$traceurRuntime.registerModule("src/circuit/GateCheckArgs.js",[],function(){"use strict";var e=$traceurRuntime.createClass(function(e,t,r,n,i,a){this.gate=e,this.innerColumn=t,this.outerRow=r,this.measuredMask=n,this.context=i,this.isNested=a},{},{});return{get GateCheckArgs(){return e}}}),$traceurRuntime.registerModule("src/circuit/GateColumn.js",[],function(){"use strict";var i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/DetailedError.js","src/circuit/GateColumn.js")).DetailedError,o=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./Gate.js","src/circuit/GateColumn.js")).Gate,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./GateCheckArgs.js","src/circuit/GateColumn.js")).GateCheckArgs),a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../gates/AllGates.js","src/circuit/GateColumn.js")).Gates,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Seq.js","src/circuit/GateColumn.js")),t=e.seq,b=(e.Seq,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/circuit/GateColumn.js")).Util),r=$traceurRuntime.createClass(s,{isEqualTo:function(e){return this===e||e instanceof s&&t(this.gates).isEqualTo(t(e.gates),b.STRICT_EQUALITY)},stableDuration:function(){var e;return(e=Math).min.apply(e,$traceurRuntime.spread([1/0],this.gates.filter(function(e){return void 0!==e}).map(function(e){return e.stableDuration()})))},isEmpty:function(){return this.gates.every(function(e){return void 0===e})},hasControl:function(){var e=void 0!==arguments[0]?arguments[0]:0,t=void 0!==arguments[1]?arguments[1]:0;return this.hasCoherentControl(e|t)||this.hasMeasuredControl(e&~t)},hasCoherentControl:function(){for(var e=void 0!==arguments[0]?arguments[0]:0,t=0;t<this.gates.length;t++)if(0==(e&1<<t)&&void 0!==this.gates[t]&&this.gates[t].isControl()&&!this.gates[t].isClassicalControl())return!0;return!1},hasMeasuredControl:function(){for(var e=void 0!==arguments[0]?arguments[0]:0,t=0;t<this.gates.length;t++)if(0!=(e&1<<t)&&void 0!==this.gates[t]&&this.gates[t].definitelyHasNoEffect()&&this.gates[t].isControl())return!0;return!1},controlMask:function(){for(var e=0,t=0;t<this.gates.length;t++)void 0!==this.gates[t]&&this.gates[t].definitelyHasNoEffect()&&this.gates[t].isControl()&&(e|=1<<t);return e},_disabledReason:function(e,t,r,n,i){var a=this.gates[t];if(void 0!==a)return n=new o(a,this,r+t,e,n,i),a.customDisableReasonFinder(n)||s._disabledReason_inputs(n)||this._disabledReason_controlInside(t)||this._disabledReason_remixing(t,e)||this._disabledReason_overlappingTags(r,t)},_disabledReason_overlappingTags:function(e,t){var r=new Set(this.gates[t].customColumnContextProvider(e+t,this.gates[t]).map(function(e){return e.key}));if(0!==r.length)for(var n=0;n<t;n++){var i=this.gates[n],a=!0,o=!1,u=void 0;try{for(var s,l=(void 0===i?[]:i.customColumnContextProvider(e+n,i))[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value.key;if(r.has(c))return"already\ndefined"}}catch(e){o=!0,u=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw u}}}},_disabledReason_remixing:function(e,t){var r=this.gates[e],n=(1<<r.height)-1<<e,i=n&t;if(0!=i&&void 0===r.knownBitPermutationFunc){if(r.effectMightCreateSuperpositions())return"no\nremix\n(sorry)";if(r.effectMightPermutesStates()&&(i!=n||this.hasCoherentControl(t)))return"no\nremix\n(sorry)"}if(void 0!==r.knownBitPermutationGroupMasks){var a=!0,i=!1,n=void 0;try{for(var o,u=r.knownBitPermutationGroupMasks[Symbol.iterator]();!(a=(o=u.next()).done);a=!0){var s=o.value,l=0==(s-1&s);if(!l){var c=((s<<=e)&t)!=s,d=0!=(s&t),m=this.hasCoherentControl(t),f=this.hasControl(t);if(d&&m||c&&d&&f)return"no\nremix\n(sorry)"}}}catch(e){i=!0,n=e}finally{try{a||null==u.return||u.return()}finally{if(i)throw n}}}},hasGatesWithGlobalEffects:function(){for(var e=0;e<this.gates.length;e++){var t=this.gates[e];if(void 0!==t&&t.shouldShowAsHavingGlobalEffect())return!0}return!1},indexOfNonUnitaryGate:function(){for(var e=0;e<this.gates.length;e++){var t=this.gates[e];if(void 0!==t&&!t.isDefinitelyUnitary())return e}},_disabledReason_controlInside:function(e){for(var t=this.gates[e],r=1;r<t.height&&e+r<this.gates.length;r++)if(void 0!==this.gates[e+r]&&this.gates[e+r].isControl())return"control\ninside"},minimumRequiredWireCount:function(){for(var e=0,t=0;t<this.gates.length;t++)void 0!==this.gates[t]&&(e=Math.max(e,this.gates[t].height+t));return e},maximumGateWidth:function(){var e=-1/0,t=!0,r=!1,n=void 0;try{for(var i,a=this.gates[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;void 0!==o&&(e=Math.max(e,o.width))}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}return e},perRowDisabledReasons:function(e,t,r,n,i){for(var a=b.mergeMaps(r,n),o=new Map(n),u=this.gates.length-1;0<=u;u--){var s=this.gates[u];if(void 0!==s){var l=!0,c=!1,d=void 0;try{for(var m,f=s.customColumnContextProvider(u+t,s)[Symbol.iterator]();!(l=(m=f.next()).done);l=!0){var h=m.value,g=h.key,p=h.val;a.set(g,p),s.isContextTemporary||o.set(g,p)}}catch(e){c=!0,d=e}finally{try{l||null==f.return||f.return()}finally{if(c)throw d}}}}for(var v=[],y=0;y<this.gates.length;y++)v.push(this._disabledReason(e,y,t,a,i));return{allReasons:v,stickyCtx:o}},_updateMeasureMask_gateStep:function(e,t,r){var n;void 0===r[t]&&void 0!==(r=this.gates[t])&&(r===a.Special.Measurement?e.measureMask|=1<<t:(n=r===a.PostSelectionGates.PostSelectOn||r===a.PostSelectionGates.PostSelectOff||r===a.Detectors.ZDetector||r===a.Detectors.ZDetectControlClear,!this.hasControl(0,1<<t)&&n?e.measureMask&=~(1<<t):(s._updateMeasureMask_swapGate(r,e,t),s._updateMeasureMask_customPermute(r,e,t))))},nextMeasureMask:function(e,t){for(var r={measureMask:e,earlierRowWithSwapGate:void 0},n=0;n<this.gates.length;n++)this._updateMeasureMask_gateStep(r,n,t);return r.measureMask},withGatesAdded:function(e,t){if(!Number.isInteger(e)||e<0||e>this.gates.length-t.gates.length)throw new i("Bad start index",{baseCol:this,startIndex:e,insertedCol:t});for(var r=this.gates.map(function(e){return e}),n=0;n<t.gates.length;n++)r[e+n]=t.gates[n];return new s(r)}},{empty:function(e){return new s(new Array(e).fill(void 0))},_disabledReason_inputs:function(e){var t=[],r=!0,n=!1,i=void 0;try{for(var a,o=e.gate.getUnmetContextKeys()[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var u=a.value;u.startsWith("Input Range ")&&e.context.has(u)&&t.push(e.context.get(u))}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return s._disabledReason_inputs_missing(e)||s._disabledReason_inputs_inside(e,t)||s._disabledReason_inputs_coherenceMismatch(e,t)},_disabledReason_inputs_missing:function(e){var t=[],r=!0,n=!1,i=void 0;try{for(var a,o=e.gate.getUnmetContextKeys()[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var u=a.value,s=u.replace("Input Range ","Input Default ").replace("Input NO_DEFAULT Range ","Input Range ");e.context.has(u)||e.context.has(s)||e.isNested||t.push(u)}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}if(0<t.length)return"Need\nInput\n "+t.map(function(e){return e.replace("Input NO_DEFAULT Range ","").replace("Input Range ","")}).join(", ")},_disabledReason_inputs_inside:function(e,t){var r=e.outerRow,n=!0,i=!1,a=void 0;try{for(var o,u=t[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value,l=s.offset;if(r<l+s.length&&r+e.gate.height>l)return"input\ninside"}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}},_disabledReason_inputs_coherenceMismatch:function(e,t){var r=e.outerRow;if(e.gate.effectMightPermutesStates()&&0!=(e.measuredMask>>r&(1<<e.gate.height)-1)){var n=!0,r=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var u=a.value,s=u.offset,l=u.length;if(0!=(~e.measuredMask>>s&(1<<l)-1))return"no\nremix\n(sorry)"}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}}},_updateMeasureMask_swapGate:function(e,t,r){var n;e===a.Special.SwapHalf&&(void 0===t.earlierRowWithSwapGate?t.earlierRowWithSwapGate=r:(e=1<<t.earlierRowWithSwapGate,n=r-t.earlierRowWithSwapGate,t.measureMask=t.measureMask&~(e|(r=1<<r))|(t.measureMask&e)<<n|(t.measureMask&r)>>n,t.earlierRowWithSwapGate=void 0))},_updateMeasureMask_customPermute:function(e,t,r){if(void 0!==e.knownBitPermutationFunc){var n=(1<<e.height)-1<<r,i=t.measureMask&n;t.measureMask&=~n;for(var a,o=0;o<e.height;o++)0!=(i&1<<r+o)&&(a=1<<r+e.knownBitPermutationFunc(o),t.measureMask|=a)}}});function s(e){this.gates=e}return{get GateColumn(){return r}}}),$traceurRuntime.registerModule("src/circuit/GateShaders.js",[],function(){"use strict";var f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/DetailedError.js","src/circuit/GateShaders.js")).DetailedError,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./KetShaderUtil.js","src/circuit/GateShaders.js")),h=e.ketArgs,t=e.ketShader,g=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/circuit/GateShaders.js")).Matrix,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/Shaders.js","src/circuit/GateShaders.js")).Shaders),p=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/circuit/GateShaders.js")).Util,v=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglArg.js","src/circuit/GateShaders.js")).WglArg,e=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglConfiguredShader.js","src/circuit/GateShaders.js")).WglConfiguredShader,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/ShaderCoders.js","src/circuit/GateShaders.js"))),r=e.Inputs,n=e.Outputs,y=e.currentShaderCoder,e=e.makePseudoShaderWithInputsAndOutputAndCode,i=$traceurRuntime.createClass(function(){},{},{});function a(e){return t("uniform vec4 coefs["+(1<<2*e-1)+"];","\n        int row = int(out_id);\n        vec2 t = vec2(0.0, 0.0);\n        for (int d = 0; d < "+(1<<e)+"; d++) {\n            // Can't index by row, since it's not a constant, so we do a const brute force loop searching for it.\n            if (d == row) {\n                for (int k = 0; k < "+(1<<e-1)+"; k++) {\n                    vec4 u = coefs[d*"+(1<<e-1)+" + k];\n                    t += cmul(inp(float(k*2)), u.xy);\n                    t += cmul(inp(float(k*2+1)), u.zw);\n                }\n            }\n        }\n        return t;\n    ",e)}var o,b=t("uniform vec2 a, b, c, d;","return cmul(inp(0.0), a+(c-a)*out_id) + cmul(inp(1.0), b+(d-b)*out_id);",1),R=[void 0,void 0,a(2),a(3),t("","\n        vec2 t = vec2(0.0, 0.0);\n        for (int k = 0; k < "+(1<<(o=4))+"; k++) {\n            t += cmul(inp(float(k)),\n                      read_coefs(out_id * "+(1<<o)+".0 + float(k)));\n        }\n        return t;\n    ",o,[r.vec2("coefs")])],u=(i.applyMatrixOperation=function(e,t){var r;if(!p.isPowerOf2(t.width()))throw new f("Matrix size isn't a power of 2.",{ctx:e,matrix:t});if(2===t.width()){var n=e;if(2!==(d=t).width()||2!==d.height())throw new f("Not a single-qubit operation.",{matrix:d});var i=(m=(d=d.rawBuffer()[Symbol.iterator]()).next()).done?void 0:m.value,a=(m=d.next()).done?void 0:m.value,o=(m=d.next()).done?void 0:m.value,u=(m=d.next()).done?void 0:m.value,s=(m=d.next()).done?void 0:m.value,l=(m=d.next()).done?void 0:m.value,c=(m=d.next()).done?void 0:m.value,d=(m=d.next()).done?void 0:m.value;n.applyOperation(b.withArgs.apply(b,$traceurRuntime.spread(h(n),[v.vec2("a",i,a),v.vec2("b",o,u),v.vec2("c",s,l),v.vec2("d",c,d)])))}else{var m=Math.round(Math.log2(t.width()));if(m<=3)e.applyOperation((n=R[m]).withArgs.apply(n,$traceurRuntime.spread(h(e),[v.vec4_array("coefs",t.rawBuffer())])));else{if(!(m<=4))throw new f("Matrix is past 4 qubits. Too expensive.",{ctx:e,matrix:t});i=g.data(y().vec2.dataToPixels(t.rawBuffer())).toVec2Texture(2*m);try{e.applyOperation((r=R[m]).withArgs.apply(r,$traceurRuntime.spread([i],h(e))))}finally{i.deallocByDepositingInPool()}}}},i.cycleAllBits=function(e,t){var r=y().vec2.arrayPowerSizeOfTexture(e);return u(e,v.float("shiftAmount",1<<p.properMod(-t,r)))},e([r.vec2("input")],n.vec2(),"\n    uniform float shiftAmount;\n\n    vec2 outputFor(float k) {\n        float span = len_input();\n        float shiftedState = k * shiftAmount;\n        float cycledState = mod(shiftedState, span) + floor(shiftedState / span);\n        return read_input(cycledState);\n    }")),s=(i.cycleAllBitsFloat=function(e,t){var r=y().float.arrayPowerSizeOfTexture(e);return s(e,v.float("shiftAmount",1<<p.properMod(-t,r)))},e([r.float("input")],n.float(),"\n    uniform float shiftAmount;\n\n    float outputFor(float k) {\n        float span = len_input();\n        float shiftedState = k * shiftAmount;\n        float cycledState = mod(shiftedState, span) + floor(shiftedState / span);\n        return read_input(cycledState);\n    }"));return{get GateShaders(){return i}}}),$traceurRuntime.registerModule("src/circuit/KetShaderUtil.js",[],function(){"use strict";function r(e,t){var r=void 0!==arguments[2]?arguments[2]:null;return{withArgs:i($traceurRuntime.spread(void 0!==arguments[3]?arguments[3]:[],[a.vec2("ketgen_ket"),a.bool("ketgen_control")]),o.vec2(),"\n    uniform float _ketgen_step;\n    "+(null===r?"uniform float span;":"")+"\n    float _ketgen_off;\n    float full_out_id;\n\n    "+(t.match(/\bcmul\b/)?"vec2 cmul(vec2 c1, vec2 c2) { return mat2(c1.x, c1.y, -c1.y, c1.x) * c2; }":"")+"\n    "+(t.match(/\binp\b/)?"vec2 inp(float k) { return read_ketgen_ket(_ketgen_off + _ketgen_step*k); }":"")+"\n\n    "+e+"\n\n    vec2 _ketgen_output_for(float out_id, vec2 amp) {\n        "+t+"\n    }\n\n    vec2 outputFor(float k) {\n        full_out_id = k;\n\n        float relevant_out_id = mod(floor(full_out_id / _ketgen_step), "+(null===r?"span":(1<<r)+".0")+");\n        _ketgen_off = full_out_id - relevant_out_id*_ketgen_step;\n\n        float c = read_ketgen_control(full_out_id);\n        vec2 vc = read_ketgen_ket(full_out_id);\n        vec2 vt = _ketgen_output_for(relevant_out_id, vc);\n        return (1.0-c)*vc + c*vt;\n    }")}}function e(e,t){return r(e+"float _ketgen_input_for(float out_id) { "+t+" }","return inp(_ketgen_input_for(out_id));",void 0!==arguments[2]?arguments[2]:null)}function t(e,t){return r(e+"\n        float _ketgen_phase_for(float out_id) {\n            "+t+"\n        }\n    ","\n        float angle = _ketgen_phase_for(out_id);\n        return cmul(amp, vec2(cos(angle), sin(angle)));\n    ",void 0!==arguments[2]?arguments[2]:null)}var l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglArg.js","src/circuit/KetShaderUtil.js")).WglArg,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/ShaderCoders.js","src/circuit/KetShaderUtil.js")),i=n.makePseudoShaderWithInputsAndOutputAndCode,a=n.Inputs,o=n.Outputs;function u(e){var t=arguments[1],r=void 0!==arguments[2]?arguments[2]:[],n=[e.stateTrader.currentTexture,e.controlsTexture,l.float("_ketgen_step",1<<e.row)],i=(void 0!==t&&n.push(l.float("span",1<<t)),!0),t=!1,a=void 0;try{for(var o,u=r[Symbol.iterator]();!(i=(o=u.next()).done);i=!0){var s=o.value;n.push.apply(n,$traceurRuntime.spread(c(e,s)))}}catch(e){t=!0,a=e}finally{try{i||null==u.return||u.return()}finally{if(t)throw a}}return n}function s(e){return"\n        //////// INPUT GATE "+e+" ////////\n        uniform float _gen_input_default_"+e+";\n        uniform float _gen_input_offset_"+e+";\n        uniform float _gen_input_span_"+e+";\n        \n        float read_input_"+e+"() {\n            return _gen_input_span_"+e+" == 0.0\n                ? _gen_input_default_"+e+"\n                : mod(floor(full_out_id / _gen_input_offset_"+e+"), _gen_input_span_"+e+");\n        }"}function c(e,t){var r=0,n=-1,i=e.customContextFromGates.get("Input Default "+t)||0,e=e.customContextFromGates.get("Input Range "+t);return void 0!==e&&(r=e.offset,n=e.length),[l.float("_gen_input_default_"+t,i),l.float("_gen_input_offset_"+t,1<<r),l.float("_gen_input_span_"+t,-1===n?0:1<<n)]}return{get ketArgs(){return u},get ketShader(){return r},get ketShaderPermute(){return e},get ketShaderPhase(){return t},get ketInputGateShaderCode(){return s},get ketInputGateArgs(){return c}}}),$traceurRuntime.registerModule("src/circuit/KetTextureUtil.js",[],function(){"use strict";var v=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./CircuitShaders.js","src/circuit/KetTextureUtil.js")).CircuitShaders,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./Controls.js","src/circuit/KetTextureUtil.js")).Controls,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/DetailedError.js","src/circuit/KetTextureUtil.js")).DetailedError,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/circuit/KetTextureUtil.js")).Matrix,y=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/Shaders.js","src/circuit/KetTextureUtil.js")).Shaders,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/circuit/KetTextureUtil.js")).Util,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglTexture.js","src/circuit/KetTextureUtil.js")).WglTexture,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Seq.js","src/circuit/KetTextureUtil.js")),R=e.seq,t=e.Seq,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/ShaderCoders.js","src/circuit/KetTextureUtil.js")),r=e.outputShaderCoder,w=e.currentShaderCoder,n=e.makePseudoShaderWithInputsAndOutputAndCode,i=e.Inputs,e=e.Outputs,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglTexturePool.js","src/circuit/KetTextureUtil.js")).WglTexturePool,M=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglTextureTrader.js","src/circuit/KetTextureUtil.js")).WglTextureTrader,_=$traceurRuntime.createClass(function(){},{},{});_.tradeTextureForVec2Output=function(e){return w().vec2.needRearrangingToBeInVec4Format&&e.shadeHalveAndTrade(y.packVec2IntoVec4),_.tradeTextureForVec4Output(e)},_.tradeTextureForVec4Output=function(e){var t;return t=(r()===w()?w:(t=w().vec4.arrayPowerSizeOfTexture(e.currentTexture)+r().vec4.powerSizeOverhead,e.shadeAndTrade(y.convertVec4CodingForOutput,g.take(t,r().vec4.pixelType)),r))().vec4.pixelsToData(e.currentTexture.readPixels()),e.currentTexture.deallocByDepositingInPool("tradeTextureForVec4Output"),t},_.mergedReadFloats=function(e){function r(e){return 0===e.width?0:1<<w().vec4.arrayPowerSizeOfTexture(e)}var t=Math.round(Math.log2(b.ceilingPowerOf2(R(e).map(r).sum()))),n=new M(y.color(0,0,0,0).toVec4Texture(t)),i=0,a=!0,t=!1,o=void 0;try{for(var u,s=e[Symbol.iterator]();!(a=(u=s.next()).done);a=!0)!function(){var t=u.value;0<t.width&&n.shadeAndTrade(function(e){return v.linearOverlay(i,t,e)}),i+=r(t)}()}catch(e){t=!0,o=e}finally{try{a||null==s.return||s.return()}finally{if(t)throw o}}var l=_.tradeTextureForVec4Output(n),c=[],d=0,m=!0,t=!1,o=void 0;try{for(var f,h=e[Symbol.iterator]();!(m=(f=h.next()).done);m=!0){var g=f.value,p=r(g)<<2;c.push(l.subarray(d,d+p)),d+=p,g.deallocByDepositingInPool()}}catch(e){t=!0,o=e}finally{try{m||null==h.return||h.return()}finally{if(t)throw o}}return c},_.pixelsToAmplitudes=function(e,t){t<1e-6&&(t=NaN);for(var r=Math.sqrt(t),t=e.length>>1,n=new Float32Array(2*t),i=0;i<e.length;i++)n[i]=e[i]/r;return new o(1,t,n)},_.superpositionToQubitDensities=function(e,t,r){if(0===r)return new h(0,0,w().vec4.pixelType);for(var n=!t.isEqualTo(m.NONE),i=new M(e),a=(i.dontDeallocCurrentTexture(),n&&(n=w().vec2.arrayPowerSizeOfTexture(e)-t.includedBitCount(),i.shadeAndTrade(function(e){return v.controlSelect(t,e)},g.takeVec2Tex(n))),1),o=1;o<=t.inclusionMask;o<<=1)0==(t.inclusionMask&o)?a<<=1:r=r&a-1|(r&~(a-1))>>1;var e=i,u=r;if(0===u)throw new f("keptBitMask === 0",{trader:e,keptBitMask:u});for(var n=w().vec2.arrayPowerSizeOfTexture(e.currentTexture),s=b.numberOfSetBits(u),e=(e.shadeAndTrade(function(e){return v.qubitDensities(e,u)},g.takeVec4Tex(n-1+b.ceilLg2(s))),b.numberOfSetBits(r)),l=i,n=e,c=b.ceilLg2(n),d=w().vec4.arrayPowerSizeOfTexture(l.currentTexture);c<d;)l.shadeHalveAndTrade(y.sumFoldVec4),--d;return i.currentTexture},_.pixelsToQubitDensityMatrices=function(a){var e=a.length/4;return t.range(e).map(function(e){var t,r=a[4*e],n=a[4*e+3],i=r+n;return i<1e-7||isNaN(i)?new o(2,2,new Float32Array([NaN,NaN,NaN,NaN,NaN,NaN,NaN,NaN])):(t=a[4*e+1]/i,e=a[4*e+2]/i,new o(2,2,new Float32Array([r/i,0,t,e,t,-e,n/i,0])))}).toArray()};var a=n([i.vec2("input")],e.float(),"float outputFor(float k) {\n        vec2 amp = read_input(k);\n        return dot(amp, amp);\n    }");return _.superpositionToNorm=function(e,t){if(!t)return new h(0,0,w().vec4.pixelType);var r=new M(e),n=(r.dontDeallocCurrentTexture(),w().vec2.arrayPowerSizeOfTexture(e));for(r.shadeAndTrade(a,g.takeVecFloatTex(n));0<n;)--n,r.shadeHalveAndTrade(y.sumFoldFloat);return r.shadeAndTrade(y.packFloatIntoVec4,g.takeVec4Tex(0)),r.currentTexture},{get KetTextureUtil(){return _}}}),$traceurRuntime.registerModule("src/circuit/Serializer.js",[],function(){"use strict";var c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./CircuitDefinition.js","src/circuit/Serializer.js")).CircuitDefinition,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Complex.js","src/circuit/Serializer.js")).Complex,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/circuit/Serializer.js")).Config,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./CustomGateSet.js","src/circuit/Serializer.js")).CustomGateSet,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Describe.js","src/circuit/Serializer.js")).describe,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/DetailedError.js","src/circuit/Serializer.js")).DetailedError,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Format.js","src/circuit/Serializer.js")).Format,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./Gate.js","src/circuit/Serializer.js")),n=e.Gate,g=e.GateBuilder,p=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./GateColumn.js","src/circuit/Serializer.js")).GateColumn,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../gates/AllGates.js","src/circuit/Serializer.js")),v=e.Gates,y=e.INITIAL_STATES_TO_GATES,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/circuit/Serializer.js")).Matrix,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/circuit/Serializer.js")).Util,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../fallback.js","src/circuit/Serializer.js")).notifyAboutRecoveryFromUnexpectedError,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../gates/Joke_MysteryGate.js","src/circuit/Serializer.js")),R=e.MysteryGateSymbol,w=e.MysteryGateMakerWithMatrix,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Seq.js","src/circuit/Serializer.js")).seq,M=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./CircuitComputeUtil.js","src/circuit/Serializer.js")).setGateBuilderEffectToCircuit,_=void 0,x=void 0,S=void 0,T=void 0;function N(e,t,r,n){S=e,_=t,x=r,T=n}function u(e){return e.toString(r.MINIFIED)}function s(e){if("string"!=typeof e)throw new Error("Not a packed matrix string: "+e);return i.parse(e)}function l(e){var t=void 0!==arguments[1]?arguments[1]:new m,r=v.findKnownGateById(e.serializedId,t);if(r===e)return e.serializedId;if(void 0!==r&&void 0!==r.param)return{id:e.serializedId,arg:e.param};if("Parse Error"===e.name)return e.tag;if(r={},""!==e.serializedId&&(r.id=e.serializedId),(e.serializedId.startsWith("~")?""!==e.symbol:e.symbol!==e.serializedId)&&(r.name=e.symbol),e.stableDuration()===1/0&&void 0!==e.knownMatrixAt(0))r.matrix=u(e.knownMatrixAt(.25));else{if(void 0===e.knownCircuit)throw new h("Don't known how to serialize gate's function.",{gate:e});r.circuit=j(e.knownCircuit,t)}return r}var D=$traceurRuntime.createClass(function(){},{},{toJson:function(e){var t,r,n=arguments[1],i=!0,a=!1,o=void 0;try{for(var u,s=k[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var l=(r=(t=u.value[Symbol.iterator]()).next()).done?void 0:r.value,c=(r=t.next()).done?void 0:r.value;(r=t.next()).done||r.value;if(e instanceof l)return c(e,n)}}catch(e){a=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(a)throw o}}throw new Error("Don't know how to convert "+f(e)+" to JSON.")},fromJson:function(e,t){var r,n,i=arguments[2],a=!0,o=!1,u=void 0;try{for(var s,l=k[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=(n=(r=s.value[Symbol.iterator]()).next()).done?void 0:n.value,d=((n=r.next()).done||n.value,(n=r.next()).done?void 0:n.value);if(c===e)return d(t,i)}}catch(e){o=!0,u=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw u}}throw new Error("Don't know how to deserialize JSON "+f(t)+" into an instance of "+e+".")}});function A(e){if(void 0===e)throw new Error("Unrecognized gate id, but no matrix specified.");e=s(e);if(e.width()!==e.height())throw new Error("Gate matrix must be square.");if(e.width()<2||16<e.width()||!a.isPowerOf2(e.width()))throw new Error("Supported gate matrix sizes are 2, 4, 8, and 16.");return e}function F(e){var t=void 0===(t="string"==typeof(t=e)?t:t.id)?"":"string"!=typeof t?f(t):t,r=e.matrix,n=e.circuit,i=e.arg,e=void 0!==e.name?e.name:t.startsWith("~")?"":t,a=t.startsWith("~")?(e||"Custom")+" Gate ["+t.substring(1)+"]":""!==e?e:t;return{id:t,matrix:r,circuit:n,symbol:e,name:a,param:i}}var C=function(t){var e,r,n,i,a,o,u=void 0!==arguments[1]?arguments[1]:new m,s=F(t);try{if(void 0!==s.matrix)return o=A((n=s).matrix),n.id===R?w(o):(o=Math.round(Math.log2(o.height())),i=""===n.symbol?o:1,a=A(n.matrix),o=(new g).setSerializedId(n.id).setSymbol(n.symbol).setTitle(n.name).setHeight(o).setWidth(i).setDrawer(""===n.symbol?_:a.isIdentity()?S:a.isScaler()?T:void 0).setKnownEffectToMatrix(a),a.isIdentity()&&o.markAsNotInterestedInControls(),o.gate);if(void 0!==s.circuit)return r=u,r=G((e=s).circuit,r).withMinimumWireCount(),M(new g,r).setSerializedId(e.id).setSymbol(e.symbol).setTitle(e.name).setDrawer(x).gate;var l=v.findKnownGateById(s.id,u);if(void 0===l)throw new h("No gate with the id '"+s.id+"'.",{json:t});if(void 0!==s.param){if(void 0===l.param)throw new h("Arg for gate without arg.",{json:t});l=l.withParam(s.param)}return l}catch(e){return b("Defaulted to a do-nothing 'parse error' gate. Failed to understand the json defining a gate.",{gate_json:t},e),(new g).setSerializedIdAndSymbol(s.id).setTitle("Parse Error").setBlurb(f(e)).promiseHasNoNetEffectOnStateVector().setExtraDisableReasonFinder(function(){return"parse\nerror"}).setTag(t).gate}};function E(e){var t=void 0!==arguments[1]?arguments[1]:new m;return e.gates.map(function(e){return void 0===e?1:l(e,t)})}function I(e){var t=void 0!==arguments[1]?arguments[1]:new m;if(Array.isArray(e))return new p(e.map(function(e){return 1===e||void 0===e?void 0:C(e,t)}));throw new Error("GateColumn json should be an array. Json: "+f(e))}function j(t,r){var e={cols:t.trimEmptyColumnsAtEndIgnoringGateWidths().columns.map(function(e){return E(e,r||t.customGateSet)}).map(function(e){return o(e).skipTailWhile(function(e){return 1===e}).toArray()})};if(void 0===r&&0<t.customGateSet.gates.length&&(e.gates=function(e){for(var t=[],r=0;r<e.gates.length;r++)t.push(l(e.gates[r],new(Function.prototype.bind.apply(m,$traceurRuntime.spread([null],e.gates.slice(0,r))))));return t}(t.customGateSet)),0<t.customInitialValues.size){e.init=[];for(var n=o(t.customInitialValues.keys()).max(),i=0;i<=n;i++){var a=t.customInitialValues.get(i);e.init.push(void 0===a?0:"1"===a?1:a)}}return e}var $=void 0,P=void 0;function O(e){return P!==e&&(P=e,$=G(JSON.parse(e),void 0)),$}function G(e){var t=e.cols,r=arguments[1]||(void 0===e.gates?new m:function(e){if(!Array.isArray(e))throw new h("Expected an array of gates.",{json:e});var t=new m,r=!0,n=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done);r=!0)var u=a.value,t=t.withGate(C(u,t))}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return t}(e.gates));if(!Array.isArray(t))throw new Error("CircuitDefinition json should contain an array of cols. Json: "+f(e));var t=t.map(function(e){return I(e,r)}),e=function(e){var t=e.init;if(void 0===t)return new Map;if(!Array.isArray(t))throw new h("Initial states must be an array.",{json:e});for(var r=new Map,n=0;n<t.length;n++){var i=t[n];if(0!==i)if(1===i)r.set(n,"1");else{if(!y.has(i))throw new h("Unrecognized initial state key.",{v:i,json:e});r.set(n,i)}}return r}(e),n=0,i=!0,a=!1,o=void 0;try{for(var u,s=t[Symbol.iterator]();!(i=(u=s.next()).done);i=!0)var l=u.value,n=Math.max(n,l.minimumRequiredWireCount())}catch(e){a=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(a)throw o}}return n=(a=Math).max.apply(a,$traceurRuntime.spread([d.MIN_WIRE_COUNT,Math.min(n,d.MAX_WIRE_COUNT)],$traceurRuntime.spread(e.keys()).map(function(e){return e+1}))),t=t.map(function(e){return new p($traceurRuntime.spread(e.gates,new Array(Math.max(0,n-e.gates.length)).fill(void 0)).slice(0,n))}),new c(n,t,void 0,void 0,r,!1,e).withTrailingSpacersIncluded()}var k=[[t,function(e){return e.toString(r.MINIFIED)},function(e){if("string"==typeof e)return t.parse(e);throw new Error("Not a packed complex string: "+e)}],[n,l,C],[i,u,s],[p,E,I],[c,j,G]];return{get Serializer(){return D},get initSerializer(){return N},get fromJsonText_CircuitDefinition(){return O}}}),$traceurRuntime.registerModule("src/Config.js",[],function(){"use strict";var e=$traceurRuntime.createClass(function(){},{},{});return e.EMPTY_CIRCUIT_TITLE="Quirk: Quantum Circuit Simulator",e.MAX_WIRE_COUNT=16,e.SIMPLE_SUPERPOSITION_DRAWING_WIRE_THRESHOLD=14,e.MIN_WIRE_COUNT=2,e.MIN_COL_COUNT=5,e.URL_CIRCUIT_PARAM_KEY="circuit",e.GATE_FILL_COLOR="white",e.HIGHLIGHTED_GATE_FILL_COLOR="#FB7",e.TIME_DEPENDENT_HIGHLIGHT_COLOR="#FFC",e.DISPLAY_GATE_IN_TOOLBOX_FILL_COLOR="#4F4",e.DISPLAY_GATE_BACK_COLOR="#EFE",e.DISPLAY_GATE_FORE_COLOR="#3F3",e.OPERATION_BACK_COLOR="#FFE",e.OPERATION_FORE_COLOR="#FF0",e.SUPERPOSITION_BACK_COLOR="#EFF",e.SUPERPOSITION_MID_COLOR="#8FF",e.SUPERPOSITION_FORE_COLOR="#0BB",e.CYCLE_DURATION_MS=8e3,e.TIME_CACHE_GRANULARITY=196,e.REDRAW_COOLDOWN_MILLIS=10,e.GATE_RADIUS=20,e.WIRE_SPACING=50,e.BACKGROUND_COLOR="white",e.BACKGROUND_COLOR_CIRCUIT="white",e.BACKGROUND_COLOR_TOOLBOX="#CCC",e.TOOLBOX_GATE_SPACING=2,e.TOOLBOX_GROUP_SPACING=24-e.TOOLBOX_GATE_SPACING,e.TOOLBOX_GATE_SPAN=2*e.GATE_RADIUS+e.TOOLBOX_GATE_SPACING,e.TOOLBOX_GROUP_SPAN=2*e.TOOLBOX_GATE_SPAN+e.TOOLBOX_GROUP_SPACING,e.TOOLBOX_MARGIN_X=35,e.TOOLBOX_MARGIN_Y=18,e.MINIMUM_CANVAS_HEIGHT=400,e.SUPPRESSED_GLSL_WARNING_PATTERNS=[],e.DEFAULT_FILL_COLOR="white",e.DEFAULT_STROKE_COLOR="black",e.DEFAULT_TEXT_COLOR="black",e.DEFAULT_FONT_SIZE=12,e.DEFAULT_FONT_FAMILY="sans-serif",e.DEFAULT_STROKE_THICKNESS=1,e.CHECK_WEB_GL_ERRORS_EVEN_ON_HOT_PATHS=!1,e.SEMI_STABLE_RANDOM_VALUE_LIFETIME_MILLIS=300,e.IGNORED_WEBGL_INFO_TERMS=[],{get Config(){return e}}}),$traceurRuntime.registerModule("src/draw/CachablePainting.js",[],function(){"use strict";var u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./Painter.js","src/draw/CachablePainting.js")).Painter,s=new($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/RestartableRng.js","src/draw/CachablePainting.js")).RestartableRng),e=$traceurRuntime.createClass(function(e,t){this.sizeFunc=e,this._drawingFunc=t,this._cachedCanvases=new Map},{paint:function(e,t,r){var n,i,a,o=arguments[3];this._cachedCanvases.has(o)||(n=document.createElement("canvas"),i=(a=this.sizeFunc(o)).width,a=a.height,n.width=i,n.height=a,this._drawingFunc(new u(n,s.restarted()),o),this._cachedCanvases.set(o,n)),r.ctx.drawImage(this._cachedCanvases.get(o),e,t)}},{});return{get CachablePainting(){return e}}}),$traceurRuntime.registerModule("src/draw/GateDrawParams.js",[],function(){"use strict";var e=$traceurRuntime.createClass(function(e,t,r,n,i,a,o,u,s,l,c,d){this.painter=e,this.hand=t,this.isInToolbox=r,this.isHighlighted=n,this.isResizeShowing=i,this.isResizeHighlighted=a,this.rect=o,this.gate=u,this.stats=s,this.positionInCircuit=l,this.focusPoints=c,this.customStats=d},{getGateContext:function(e){if(void 0!==this.positionInCircuit)return this.stats.circuitDefinition.colCustomContextFromGates(this.positionInCircuit.col,0).get(e)}},{});return{get GateDrawParams(){return e}}}),$traceurRuntime.registerModule("src/draw/GatePainting.js",[],function(){"use strict";var G=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/draw/GatePainting.js")).Config,r=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./GateDrawParams.js","src/draw/GatePainting.js")).GateDrawParams,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./MathPainter.js","src/draw/GatePainting.js")).MathPainter),k=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Point.js","src/draw/GatePainting.js")).Point,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Rect.js","src/draw/GatePainting.js")).Rect,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/draw/GatePainting.js")).Util,N=$traceurRuntime.createClass(function(){},{},{}),s="16px sans-serif";N.paintOutline=function(e){var t;e.isInToolbox&&(t=e.rect.shiftedBy(.5,.5),e.painter.strokeLine(t.topRight(),t.bottomRight()),e.painter.strokeLine(t.bottomLeft(),t.bottomRight())),e.painter.strokeRect(e.rect,"black")},N.paintBackground=function(e){var t=void 0!==arguments[1]?arguments[1]:G.GATE_FILL_COLOR,r=void 0!==arguments[2]?arguments[2]:G.GATE_FILL_COLOR,t=e.isInToolbox?t:r;e.isHighlighted&&(t=G.HIGHLIGHTED_GATE_FILL_COLOR),e.painter.fillRect(e.rect,t)},N.LABEL_DRAWER=function(e){var t;void 0===e.positionInCircuit||e.isHighlighted?N.DEFAULT_DRAWER(e):(t=Math.max(0,e.rect.h-2*G.GATE_RADIUS)/2,e.painter.fillRect(e.rect.skipTop(t).skipBottom(t),G.GATE_FILL_COLOR),N.paintGateSymbol(e))},N.MAKE_HIGHLIGHTED_DRAWER=function(){var t=void 0!==arguments[0]?arguments[0]:G.GATE_FILL_COLOR,r=void 0!==arguments[1]?arguments[1]:G.GATE_FILL_COLOR;return function(e){N.paintBackground(e,t,r),N.paintOutline(e),N.paintResizeTab(e),N.paintGateSymbol(e)}},N.DEFAULT_DRAWER=N.MAKE_HIGHLIGHTED_DRAWER(),N.rectForResizeTab=function(e){var t=Math.min(G.GATE_RADIUS,e.h/4);return new n(e.x,e.bottom()-t,e.w,2*G.GATE_RADIUS)},N.paintResizeTab=function(f){var h,e,g,p,t,r;f.isResizeShowing&&f.gate.canChangeInSize()&&(h=G.GATE_RADIUS,t=(e=N.rectForResizeTab(f.rect).skipLeft(2).skipRight(2)).center(),g=t.x,p=t.y,t=f.isResizeHighlighted?G.HIGHLIGHTED_GATE_FILL_COLOR:G.GATE_FILL_COLOR,r=f.isResizeHighlighted?"#222":"gray",f.painter.ctx.save(),f.painter.ctx.globalAlpha*=f.isResizeHighlighted?1:.7,f.painter.fillRect(e,t),f.painter.strokeRect(e,"gray"),f.painter.ctx.restore(),f.painter.print("resize",g,p,"center","middle",r,"monospace",e.w-4,e.h-4),f.painter.trace(function(e){var t=[f.gate.canIncreaseInSize()?1:-1,f.gate.canDecreaseInSize()?-1:1],r=[1,-1],n=!0,i=!1,a=void 0;try{for(var o,u=[-1,1][Symbol.iterator]();!(n=(o=u.next()).done);n=!0)for(var s=o.value,l=0;l<2;l++){var c=p+h*r[l]*5/8,d=c+h*t[l]/8,m=c-h*t[l]/8;e.line(g,d,g+h*s*.3,m)}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}}).thenStroke(r))},N.paintGateSymbol=function(e){var t,r,n,i=arguments[1],a=void 0===arguments[2]||arguments[2],o=e.painter,u=e.rect.paddedBy(-2),e=(void 0===i&&(i=e.gate.symbol),function(e,t,r){for(var n=t.split("\n"),i=1;i<n.length;i++)e.print(n[i],r.x+r.w/2,r.y+r.h/2+9*i,"center","hanging","black",s,r.w,16);return{symbol:n[0],offsetY:1<n.length?-5:0}}(e.painter,i,u)),i=e.symbol,e=e.offsetY,a=(o.ctx.font=s,a?i.indexOf("^"):-1),a=-1===a?[i]:[i.substr(0,a),i.substr(a+1)];2!==a.length||""===a[0]||""===a[1]?o.print(i,u.x+u.w/2,u.y+u.h/2+e,"center","middle","black",s,u.w,u.h):(t=(a=(i=a[Symbol.iterator]()).next()).done?void 0:a.value,i=(a=i.next()).done?void 0:a.value,t=t.split("\n")[0],a=o.ctx.measureText(t).width,r=o.ctx.measureText(i).width,n=Math.min(u.w,a+r)/(a+r),a=u.w/2+(a-r)*n/2,o.print(t,u.x+a,u.y+u.h/2+e,"right","hanging","black",s,a,u.h),o.print(i,u.x+a,u.y+u.h/2+e,"left","alphabetic","black",s,u.w-a,u.h))},N.traceLocationIndependentOutline=function(e,t){var r=(o=(a=[e.rect.x,e.rect.right(),e.rect.y,e.rect.bottom()][Symbol.iterator]()).next()).done?void 0:o.value,n=(o=a.next()).done?void 0:o.value,i=(o=a.next()).done?void 0:o.value,a=(o=a.next()).done?void 0:o.value,o=Math.min(e.rect.h,e.rect.w,2*G.GATE_RADIUS)/(2+Math.sqrt(2));t.polygon([r,i+o,r+o,i,n-o,i,n,i+o,n,a-o,n-o,a,r+o,a,r,a-o])},N.paintLocationIndependentFrame=function(t){var e=void 0!==arguments[1]?arguments[1]:G.GATE_FILL_COLOR,r=void 0!==arguments[2]?arguments[2]:G.GATE_FILL_COLOR;t.isInToolbox?(N.paintBackground(t,r,e),N.paintOutline(t)):(r=t.isHighlighted?G.HIGHLIGHTED_GATE_FILL_COLOR:e,t.painter.trace(function(e){return N.traceLocationIndependentOutline(t,e)}).thenFill(r).thenStroke("black"))},N.makeLocationIndependentGateDrawer=function(t){return function(e){N.paintLocationIndependentFrame(e,t),N.paintGateSymbol(e)}},N.LOCATION_INDEPENDENT_GATE_DRAWER=N.makeLocationIndependentGateDrawer(G.GATE_FILL_COLOR),N.SECTIONED_DRAWER_MAKER=function(o,u){return function(e){if(e.isInToolbox)N.DEFAULT_DRAWER(e);else{for(var t=e.isHighlighted?G.HIGHLIGHTED_GATE_FILL_COLOR:G.GATE_FILL_COLOR,r=(e.painter.fillRect(e.rect,t),0),n=0;n<o.length;n++){var i,a=void 0;n<o.length-1?(a=r+u[n],i=e.rect.y+e.rect.h*a,e.painter.strokeLine(new k(e.rect.x,i),new k(e.rect.right(),i),"#BBB")):a=1,e.painter.print(o[n],e.rect.x+e.rect.w/2,e.rect.y+e.rect.h*(r+a)/2,"center","middle","black","16px sans-serif",e.rect.w-2,e.rect.h*(a-r)),r=a}e.painter.strokeRect(e.rect),N.paintResizeTab(e)}}};var i=N.MAKE_HIGHLIGHTED_DRAWER(G.DISPLAY_GATE_IN_TOOLBOX_FILL_COLOR);function D(e,t){return e.rect.center().y+(t-e.gate.height/2+.5)*G.WIRE_SPACING}return N.makeDisplayDrawer=function(t){return function(e){void 0===e.positionInCircuit?i(e):(N.paintResizeTab(e),t(e),e.isHighlighted&&e.painter.strokeRect(e.rect,"black",1.5),e.painter.ctx.save(),e.painter.ctx.globalAlpha*=.25,N.paintResizeTab(e),e.painter.ctx.restore())}},N.MATRIX_DRAWER=function(e){var t=e.gate.knownMatrixAt(e.stats.time);void 0===t?N.DEFAULT_DRAWER(e):(e.painter.fillRect(e.rect,e.isHighlighted?G.HIGHLIGHTED_GATE_FILL_COLOR:G.GATE_FILL_COLOR),r.paintMatrix(e.painter,t,e.rect,G.OPERATION_FORE_COLOR,"black",void 0,G.OPERATION_BACK_COLOR,void 0,"transparent"),e.isHighlighted&&(e.painter.ctx.save(),e.painter.ctx.globalAlpha*=.9,e.painter.fillRect(e.rect,G.HIGHLIGHTED_GATE_FILL_COLOR),e.painter.ctx.restore()),N.paintOutline(e))},N.makeCycleDrawer=function(){var t=void 0!==arguments[0]?arguments[0]:1,r=void 0!==arguments[1]?arguments[1]:1,n=void 0!==arguments[2]?arguments[2]:1,i=void 0!==arguments[3]?arguments[3]:0;return function(e){N.MAKE_HIGHLIGHTED_DRAWER(G.TIME_DEPENDENT_HIGHLIGHT_COLOR)(e),e.isInToolbox&&!e.isHighlighted||N.paintCycleState(e,2*e.stats.time*Math.PI*n,t,r,i)}},N.paintCycleState=function(e,t){var r=void 0!==arguments[2]?arguments[2]:1,n=void 0!==arguments[3]?arguments[3]:1,i=void 0!==arguments[4]?arguments[4]:0,t=o.properMod(-t,2*Math.PI),a=e.rect.center();e.painter.ctx.save(),e.painter.ctx.translate(a.x,a.y),e.painter.ctx.scale(-r,-n),e.painter.ctx.rotate(i),e.painter.ctx.strokeStyle="black",e.painter.ctx.fillStyle="yellow",e.painter.ctx.globalAlpha*=.4,e.painter.ctx.beginPath(),e.painter.ctx.moveTo(0,0),e.painter.ctx.lineTo(0,16),e.painter.ctx.arc(0,0,16,Math.PI/2,Math.PI/2+t,!0),e.painter.ctx.lineTo(0,0),e.painter.ctx.closePath(),e.painter.ctx.stroke(),e.painter.ctx.fill(),e.painter.ctx.restore()},N.MATRIX_SYMBOL_DRAWER_EXCEPT_IN_TOOLBOX=function(e){e.isInToolbox?N.DEFAULT_DRAWER(e):N.MATRIX_DRAWER(e)},N.gateButtonRect=function(e){return 50<e.h?e.bottomHalf().skipTop(6).paddedBy(-7):e.bottomHalf().paddedBy(2)},N.paintGateButton=function(e){var t,r;!e.isHighlighted||e.isInToolbox||e.hand.isHoldingSomething()||(t=N.gateButtonRect(e.rect),r=!e.focusPoints.every(function(e){return!t.containsPoint(e)}),e.painter.fillRect(t,r?"red":"orange"),e.painter.print("change",t.center().x,t.center().y,"center","middle","black","12px sans-serif",t.w,t.h),e.painter.strokeRect(t,"black"))},N.PERMUTATION_DRAWER=function(e){var t,r;if(void 0===e.positionInCircuit)N.DEFAULT_DRAWER(e);else{if(e.isHighlighted||e.isResizeHighlighted||e.stats.circuitDefinition.colHasControls(e.positionInCircuit.col))N.paintBackground(e,"#F3F3F3","#F3F3F3"),N.paintOutline(e),N.paintResizeTab(e);else for(var n=e,i=0;i<n.gate.height;i++){var a=D(n,i),o=new k(n.rect.x,a),u=new k(n.rect.x+G.GATE_RADIUS,a),s=new k(n.rect.right(),a),a=new k(n.positionInCircuit.col,n.positionInCircuit.row+i),l=n.stats.circuitDefinition.locIsMeasured(a),a=n.stats.circuitDefinition.locIsMeasured(a.offsetBy(1,0)),c=!0,d=!1,m=void 0;try{for(var f,h=(l?[-1,1]:[0])[Symbol.iterator]();!(c=(f=h.next()).done);c=!0){var g=f.value;n.painter.strokeLine(o.offsetBy(0,g),u.offsetBy(1,g),"white")}}catch(e){d=!0,m=e}finally{try{c||null==h.return||h.return()}finally{if(d)throw m}}var p=!0,l=!1,d=void 0;try{for(var v,y=(a?[-1,1]:[0])[Symbol.iterator]();!(p=(v=y.next()).done);p=!0){var b=v.value;n.painter.strokeLine(u.offsetBy(-1,b),s.offsetBy(0,b),"white")}}catch(e){l=!0,d=e}finally{try{p||null==y.return||y.return()}finally{if(l)throw d}}}var R=e.rect.x,w=e.rect.right();e.painter.ctx.strokeStyle="black";for(var M=0;M<e.gate.height;M++){var _=e.gate.knownBitPermutationFunc(M),x=new k(e.positionInCircuit.col,e.positionInCircuit.row+M),x=e.stats.circuitDefinition.locIsMeasured(x),S=D(e,M),T=D(e,_),A=(e.painter.ctx.beginPath(),!0),C=!1,E=void 0;try{for(var I,j=(x?[[M<_?1:-1,-1],[0,1]]:[[0,0]])[Symbol.iterator]();!(A=(I=j.next()).done);A=!0){var $=(r=(t=I.value[Symbol.iterator]()).next()).done?void 0:r.value,P=(r=t.next()).done?void 0:r.value;e.painter.ctx.moveTo(Math.min(R,R+$),S+P),e.painter.ctx.lineTo(R+$,S+P),e.painter.ctx.lineTo(w+$,T+P),e.painter.ctx.lineTo(Math.max(w,w+$),T+P)}}catch(e){C=!0,E=e}finally{try{A||null==j.return||j.return()}finally{if(C)throw E}}e.painter.ctx.stroke()}}},{get GatePainting(){return N}}}),$traceurRuntime.registerModule("src/draw/MathPainter.js",[],function(){"use strict";$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./Painter.js","src/draw/MathPainter.js")).Painter;var p=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Format.js","src/draw/MathPainter.js")).Format,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Point.js","src/draw/MathPainter.js")).Point,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Rect.js","src/draw/MathPainter.js")).Rect,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Seq.js","src/draw/MathPainter.js")),g=e.seq,v=e.Seq,y=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/draw/MathPainter.js")).Util,R=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/draw/MathPainter.js")).Config,w=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Complex.js","src/draw/MathPainter.js")).Complex,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/draw/MathPainter.js")).Matrix),t=$traceurRuntime.createClass(M,{},{describeProbability:function(e,t){var e=100*e,r=Math.pow(10,-t);return 100-r/2<e?"On":e<r/2?"Off":Math.min(Math.max(e,r),100-r).toFixed(t)+"%"},paintProbabilityBox:function(e,t,r){var n=void 0!==arguments[3]?arguments[3]:[],i=void 0!==arguments[4]?arguments[4]:R.DISPLAY_GATE_BACK_COLOR,a=void 0!==arguments[5]?arguments[5]:R.DISPLAY_GATE_FORE_COLOR,i=(e.fillRect(r,i),r.center());isNaN(t)?(e.fillPolygon([r.bottomLeft(),r.topLeft(),r.topRight()],a),e.print("NaN",i.x,i.y,"center","middle","red","9pt sans-serif",r.w,r.h)):(e.fillRect(r.takeBottomProportion(t),a),e.print(M.describeProbability(t,1),i.x,i.y,"center","middle","black","9pt sans-serif",r.w,r.h)),e.strokeRect(r,"lightgray"),g(n).any(function(e){return r.containsPoint(e)})&&(e.strokeRect(r,"orange",2),M.paintDeferredValueTooltip(e,r.right(),r.y,"Chance of being ON if measured",(100*t).toFixed(5)+"%"))},paintMatrixTooltip:function(e,t,r,n,i,a){var o=void 0!==arguments[6]?arguments[6]:function(){},u=t.width(),s=t.height(),l=r.x,c=r.y,d=Math.min(r.w/u,r.h/s),m=!0,u=!1,r=void 0;try{for(var f,h=n[Symbol.iterator]();!(m=(f=h.next()).done);m=!0){var g,p=f.value,v=Math.floor((p.x-l)/d),y=Math.floor((p.y-c)/d);0<=v&&v<t.width()&&0<=y&&y<t.height()&&(e.strokeRect(new b(l+d*v,c+d*y,d,d),"orange",2),g=t.cell(v,y),M.paintDeferredValueTooltip(e,l+d*v+d,c+d*y,i(v,y),a(v,y,g),o(v,y,g)))}}catch(e){u=!0,r=e}finally{try{m||null==h.return||h.return()}finally{if(u)throw r}}},_traceAmplitudeProbabilitySquare:function(e,t,r,n,i,a){t=t*t+r*r;.001<t&&e.polygon([n,i+a*(1-t),n+a,i+a*(1-t),n+a,i+a,n,i+a])},_traceProbabilitySquare:function(e,t,r,n,i,a){.1<a*t&&e.polygon([n,i+a*(1-t),n+a,i+a*(1-t),n+a,i+a,n,i+a])},_traceAmplitudeProbabilityCircle:function(e,t,r,n,i,a){t=Math.sqrt(t*t+r*r);.5<a*t&&e.circle(n+a/2,i+a/2,t*a/2)},_traceAmplitudeLogarithmCircle:function(e,t,r,n,i,a){t=1+Math.log(t*t+r*r)/15;0<t&&e.circle(n+a/2,i+a/2,t*a/2)},_traceAmplitudePhaseDirection:function(e,t,r,n,i,a){var o=Math.sqrt(t*t+r*r),u=1+Math.log(o)/10,u=Math.max(1,u/o)*Math.max(a/2,5);u<.1||e.line(o=n+a/2,e=i+a/2,o+t*u,e-r*u)},paintMatrix:function(e,t,r,n,i,a){function o(i){return e.trace(function(e){for(var t=0;t<d;t++)for(var r=0;r<c;r++){var n=2*(t*c+r);i(e,m[n],m[1+n],g+f*r,p+f*t,f)}})}var u=void 0!==arguments[6]?arguments[6]:R.DISPLAY_GATE_BACK_COLOR,s=arguments[7],l=void 0!==arguments[8]?arguments[8]:"#AAA",c=t.width(),d=t.height(),m=t.rawBuffer(),f=Math.min(r.w/c,r.h/d),h=r=r.withW(f*c).withH(f*d),g=h.x,p=h.y,h=t.hasNaN(),s=s||i;e.fillRect(r,u);h||(void 0!==a&&o(M._traceAmplitudeProbabilitySquare).thenFill(a).thenStroke("lightgray",.5),void 0!==n&&(o(M._traceAmplitudeProbabilityCircle).thenFill(n).thenStroke(i,.5),o(M._traceAmplitudeLogarithmCircle).thenStroke(l,.5))),e.trace(function(e){return e.grid(g,p,r.w,r.h,c,d)}).thenStroke("lightgray"),h||void 0!==l&&o(M._traceAmplitudePhaseDirection).thenStroke(s),h&&e.print("NaN",r.x+r.w/2,r.y+r.h/2,"center","middle","red","16px sans-serif",r.w,r.h)},paintDeferredValueTooltip:function(l,a,c,d,m){var f=arguments[5],h=void 0!==arguments[6]?arguments[6]:R.DISPLAY_GATE_BACK_COLOR,g="12px sans-serif",p="bold 12px monospace";l.defer(function(){l.ctx.font=g;function e(i,a){l.print(m,u.x,u.bottom()-a,"left","bottom","black",p,u.w,o,function(e,t){var r,n;r=Math.max(i,e),n=a+t,l.print(d,u.x,u.bottom()-n,"left","bottom","black",g,u.w,o,function(e,t){return s(Math.max(r,e),n+t)})})}var t=l.ctx.measureText(d).width,r=(l.ctx.font=p,l.ctx.measureText(m).width),n=void 0===f?0:l.ctx.measureText(f).width,o=20,i=40+(void 0===f?0:20),t=Math.max(Math.max(t,r),n),u=new b(a,c-i,t,i).snapInside(new b(0,0,l.ctx.canvas.clientWidth,l.ctx.canvas.clientHeight)),s=function(e,t){var r=new b(u.x,u.bottom()-t,e,t).paddedBy(4);l.trace(function(e){return e.rect(r.x,r.y,r.w,r.h)}).thenFill(h).thenStroke("black")};void 0===f?e(0,0):l.print(f,u.x,u.bottom(),"left","bottom","black",p,u.w,o,e)})},coordinateSystem:function(e){return{dx:new h(e/3,-e/3),dy:new h(e,0),dz:new h(0,e)}},paintBlochSphereRotation:function(e,t,r){function s(e){return e=d.times(e),new h(e.cell(0,0).real,e.cell(0,1).real)}function n(e){return Math.sqrt(e.adjoint().times(e).cell(0,0).real)}var i=void 0!==arguments[3]?arguments[3]:R.DISPLAY_GATE_BACK_COLOR,a=void 0!==arguments[4]?arguments[4]:R.DISPLAY_GATE_FORE_COLOR,l=r.center(),c=Math.min(r.w,r.h)/2,r=M.coordinateSystem(c),o=r.dx,u=r.dy,r=r.dz,d=w.fromRows([[-o.x,-o.y],[u.x,u.y],[-r.x,-r.y]]).adjoint(),m=v.range(3).map(function(r){return w.generate(1,3,function(e,t){return e===r?1:0})}).toArray(),o=(e.fillCircle(l,c,i),e.trace(function(e){e.circle(l.x,l.y,c),e.ellipse(l.x,l.y,c,c/3),e.ellipse(l.x,l.y,c/3,c);var t=!0,r=!1,n=void 0;try{for(var i,a=m[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value,u=s(o);e.line(l.x-u.x,l.y-u.y,l.x+u.x,l.y+u.y)}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}).thenStroke("#BBB"),t.qubitOperationToAngleAxisRotation()),u=o.angle,r=o.axis,f=w.col.apply(w,$traceurRuntime.spread(r)),i=s(f),t=[w.col(r[0],r[1],0),f,w.col(0,0,r[2])].map(s),o=(e.strokePolygon(g(t).reverse().concat(t.map(function(e){return e.times(-1)})).map(function(e){return l.plus(e)}).toArray(),"#666"),e.strokeLine(l.plus(i),l.plus(i.times(-1)),"black",2),g(m).mapWithIndex(function(e,t){return e.times([-3,-2,1][t])}).map(function(e){return f.cross3(e)}).maxBy(n)),r=f.cross3(o),o=o.times(.15/n(o)),r=r.times(.15/n(r)),t=s(o),o=s(r);M._paintBlochSphereRotation_rotationGuideArrows(e,l,u,i,t,o,a)},_paintBlochSphereRotation_rotationGuideArrows:function(a,o,t,u,r,n,s){var l=v.range(Math.floor(32*Math.abs(t))).map(function(e){e=t<0?Math.PI-e/32:e/32;return r.times(Math.cos(e)).plus(n.times(Math.sin(e)))}).toArray();if(!(l.length<=1)){var e=!0,i=!1,c=void 0;try{for(var d,m=[-.55,0,.55][Symbol.iterator]();!(e=(d=m.next()).done);e=!0)!function(){var e=d.value,t=o.plus(u.times(e)),e=l.map(function(e){return t.plus(e)}),r=e[e.length-1],n=r.plus(e[e.length-2].times(-1)),n=[u.times(.15),n.times(30),u.times(-.15)].map(function(e){return r.plus(e)}),i=[].concat.apply([],n.map(function(e){return[e.x,e.y]}));a.strokePath(e,"#444"),a.trace(function(e){return e.polygon(i)}).thenFill(s).thenStroke("#444")}()}catch(e){i=!0,c=e}finally{try{e||null==m.return||m.return()}finally{if(i)throw c}}}},paintDensityMatrix:function(e,n,t){function r(i){return e.trace(function(e){for(var t=0;t<l;t++)for(var r=0;r<s;r++){var n=2*(t*s+r);i(e,c[n],c[1+n],m+d*r,f+d*t,d)}})}var i,a=void 0!==arguments[3]?arguments[3]:[],o=void 0!==arguments[4]?arguments[4]:R.DISPLAY_GATE_BACK_COLOR,u=void 0!==arguments[5]?arguments[5]:R.DISPLAY_GATE_FORE_COLOR,s=n.width(),l=n.height(),c=n.rawBuffer(),d=Math.min(t.w/s,t.h/l),m=t.x,f=t.y,h=n.hasNaN();e.fillRect(t,o),h||(i=M._traceProbabilitySquare,e.trace(function(e){for(var t=0;t<l;t++){var r=t*(s+1)*2;i(e,c[r],c[1+r],m+d*t,f+d*t,d)}}).thenFill(u).thenStroke("#040",.5),r(M._traceAmplitudeProbabilityCircle).thenFill(u).thenStroke("#040",.5),r(M._traceAmplitudeLogarithmCircle).thenStroke("#BBB",.5),r(M._traceAmplitudePhaseDirection).thenStroke("black"));2<t.w/s?e.trace(function(e){return e.grid(m,f,t.w,t.h,s,l)}).thenStroke("lightgray",Math.min(1,2/Math.log(s))):(e.ctx.save(),e.ctx.globalAlpha*=.2,e.fillRect(t,"lightgray"),e.ctx.restore()),h&&e.print("NaN",t.x+t.w/2,t.y+t.h/2,"center","middle","red","16px sans-serif",t.w,t.h);var g=Math.round(Math.log2(l));M.paintMatrixTooltip(e,n,t,a,function(e,t){return e===t?"Probability of |"+y.bin(e,g)+"⟩ (decimal "+e+")":"Coupling of |"+y.bin(t,g)+"⟩ to ⟨"+y.bin(e,g)+"| (decimal "+t+" to "+e+")"},function(e,t,r){return e===t?(100*n.cell(e,t).real).toFixed(4)+"%":n.cell(e,t).toString(new p(!1,0,6,", "))})}});function M(){}return{get MathPainter(){return t}}}),$traceurRuntime.registerModule("src/draw/Painter.js",[],function(){"use strict";var w=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/draw/Painter.js")).Config,M=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Point.js","src/draw/Painter.js")).Point,_=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Rect.js","src/draw/Painter.js")).Rect,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/RestartableRng.js","src/draw/Painter.js")).RestartableRng,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Seq.js","src/draw/Painter.js")),x=e.seq,S=e.Seq,T=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/draw/Painter.js")).Util,t=$traceurRuntime.createClass(function(e){var t=void 0!==arguments[1]?arguments[1]:new r;this.canvas=e,this.ctx=e.getContext("2d"),this._deferredPaintActions=[],this._traceAction=new i(this.ctx),this._tracer=new n(this.ctx),this.desiredCursorStyle=void 0,this.touchBlockers=[],this.rng=t,this._ignoringTouchBlockers=0},{startIgnoringIncomingTouchBlockers:function(){this._ignoringTouchBlockers+=1},stopIgnoringIncomingTouchBlockers:function(){--this._ignoringTouchBlockers},noteTouchBlocker:function(e){0===this._ignoringTouchBlockers&&this.touchBlockers.push(e)},setDesiredCursor:function(e){this.desiredCursorStyle=e},defer:function(e){this._deferredPaintActions.push(e)},paintDeferred:function(){var e=!0,t=!1,r=void 0;try{for(var n,i=this._deferredPaintActions[Symbol.iterator]();!(e=(n=i.next()).done);e=!0)(0,n.value)()}catch(e){t=!0,r=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}this._deferredPaintActions=[]},paintableArea:function(){return new _(0,0,this.canvas.width,this.canvas.height)},clear:function(){var e=void 0!==arguments[0]?arguments[0]:w.DEFAULT_FILL_COLOR;this.ctx.fillStyle=e,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)},strokeLine:function(e,t){var r=void 0!==arguments[2]?arguments[2]:w.DEFAULT_STROKE_COLOR,n=void 0!==arguments[3]?arguments[3]:1;this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(t.x,t.y),this.ctx.strokeStyle=r,this.ctx.lineWidth=n,this.ctx.stroke()},strokeRect:function(e){var t=void 0!==arguments[1]?arguments[1]:"black",r=void 0!==arguments[2]?arguments[2]:1;this.ctx.strokeStyle=t,this.ctx.lineWidth=r,this.ctx.strokeRect(e.x,e.y,e.w,e.h)},fillRect:function(e){var t=void 0!==arguments[1]?arguments[1]:w.DEFAULT_FILL_COLOR;this.ctx.fillStyle=t,this.ctx.fillRect(e.x,e.y,e.w,e.h)},strokeCircle:function(e,t){var r=void 0!==arguments[2]?arguments[2]:w.DEFAULT_STROKE_COLOR,n=void 0!==arguments[3]?arguments[3]:w.DEFAULT_STROKE_THICKNESS;this.ctx.beginPath(),this.ctx.strokeStyle=r,this.ctx.lineWidth=n,this.ctx.arc(e.x,e.y,Math.max(t-.5,0),0,2*Math.PI),this.ctx.stroke()},trace:function(e){return this.ctx.beginPath(),e(this._tracer),this._traceAction},fillCircle:function(e,t){var r=void 0!==arguments[2]?arguments[2]:w.DEFAULT_FILL_COLOR;this.ctx.beginPath(),this.ctx.arc(e.x,e.y,Math.max(t-.5,0),0,2*Math.PI),this.ctx.fillStyle=r,this.ctx.fill()},print:function(e,t,r,n,i,a,o,u,s){var l=arguments[9],c=void 0!==arguments[10]&&arguments[10],d=(this.ctx.font=o,this.ctx.measureText(e).width),m=2.5*this.ctx.measureText("0").width,u=Math.min(Math.min(u/d,s/m),1);void 0!==l&&l(d*u,m*u),this.ctx.save(),this.ctx.textAlign=n,this.ctx.textBaseline=i,this.ctx.font=o,this.ctx.fillStyle=a,this.ctx.translate(t,r),this.ctx.scale(u,u),c&&this.ctx.strokeText(e,0,0),this.ctx.fillText(e,0,0),this.ctx.restore()},printParagraph:function(e,t){for(var r,n,i,a,o=void 0!==arguments[2]?arguments[2]:new M(0,0),u=void 0!==arguments[3]?arguments[3]:w.DEFAULT_TEXT_COLOR,s=void 0!==arguments[4]?arguments[4]:w.DEFAULT_FONT_SIZE,l=void 0!==arguments[5]?arguments[5]:w.DEFAULT_FONT_FAMILY,c=this,d=function(e){e=e.fontBoundingBoxAscent;return void 0===e?.75*r:e},m=function(e){e=e.fontBoundingBoxDescent;return void 0===e?.25*r:e},f=function(e){return d(e)+m(e)},h=x(e.split("\n")),g=0;r=s-g,this.ctx.font=r+"px "+l,i=(n=h.flatMap(function(e){return T.breakLine(e,t.w,function(e){return c.ctx.measureText(e).width})}).toArray()).map(function(e){return c.ctx.measureText(e)}),!((a=x(i.map(f)).sum())<=t.h||r<=4);g++);for(var p=function(e,t,r,n){return e+(t-r)*n},v=function(e){return p(t.x,t.w,e,o.x)},y=(e=a,p(t.y,t.h,e,o.y)),b=(this.ctx.fillStyle=u,0),R=0;R<n.length;R++)b+=d(i[R]),this.ctx.fillText(n[R],v(i[R].width),y+b),b+=m(i[R]);e=new S(i).map(function(e){return e.width}).max(0);return new _(v(e),y,e,a)},printLine:function(e,t){for(var r,n,i=void 0!==arguments[2]?arguments[2]:0,a=void 0!==arguments[3]?arguments[3]:w.DEFAULT_TEXT_COLOR,o=void 0!==arguments[4]?arguments[4]:w.DEFAULT_FONT_SIZE,u=void 0!==arguments[5]?arguments[5]:w.DEFAULT_FONT_FAMILY,s=arguments[6],l=function(e){e=e.fontBoundingBoxAscent;return void 0===e?.75*r:e},c=function(e){e=e.fontBoundingBoxDescent;return void 0===e?.25*r:e},d=function(e){return l(e)+c(e)},m=0;r=o-m,this.ctx.font=r+"px "+u,!((n=this.ctx.measureText(e)).width<=t.w&&d(n)<=t.h||r<=4);m++);var f=d(n),s=void 0===s?l(n)/f:s,i=t.x+(t.w-n.width)*i,s=t.y+(t.h-f)*s;return this.ctx.fillStyle=a,this.ctx.fillText(e,i,s+l(n)),new _(i,s,n.width,f)},strokePolygon:function(e){var t=void 0!==arguments[1]?arguments[1]:w.DEFAULT_STROKE_COLOR,r=void 0!==arguments[2]?arguments[2]:w.DEFAULT_STROKE_THICKNESS;if(0!==e.length){var n=e[e.length-1],i=(this.ctx.beginPath(),this.ctx.moveTo(n.x,n.y),!0),n=!1,a=void 0;try{for(var o,u=e[Symbol.iterator]();!(i=(o=u.next()).done);i=!0){var s=o.value;this.ctx.lineTo(s.x,s.y)}}catch(e){n=!0,a=e}finally{try{i||null==u.return||u.return()}finally{if(n)throw a}}this.ctx.strokeStyle=t,this.ctx.lineWidth=r,this.ctx.stroke()}},strokePath:function(e){var t=void 0!==arguments[1]?arguments[1]:w.DEFAULT_STROKE_COLOR,r=void 0!==arguments[2]?arguments[2]:w.DEFAULT_STROKE_THICKNESS;if(0!==e.length){this.ctx.beginPath(),this.ctx.moveTo(e[0].x,e[0].y);var n=!0,i=!1,a=void 0;try{for(var o,u=e.slice(1)[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value;this.ctx.lineTo(s.x,s.y)}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}this.ctx.strokeStyle=t,this.ctx.lineWidth=r,this.ctx.stroke()}},fillPolygon:function(e,t){var r=e[e.length-1],n=(this.ctx.beginPath(),this.ctx.moveTo(r.x,r.y),!0),r=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var u=a.value;this.ctx.lineTo(u.x,u.y)}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}this.ctx.fillStyle=t,this.ctx.fill()}},{}),n=$traceurRuntime.createClass(function(e){this.ctx=e},{line:function(e,t,r,n){this.ctx.moveTo(e,t),this.ctx.lineTo(r,n)},rect:function(e,t,r,n){this.ctx.moveTo(e,t),this.ctx.lineTo(e+r,t),this.ctx.lineTo(e+r,t+n),this.ctx.lineTo(e,t+n),this.ctx.lineTo(e,t)},circle:function(e,t,r){this.ctx.moveTo(e+r,t),this.ctx.arc(e,t,r,0,2*Math.PI,!1)},ellipse:function(e,t,r,n){this.ctx.save(),this.ctx.translate(e-r,t-n),this.ctx.scale(r,n),this.ctx.moveTo(2,1),this.ctx.arc(1,1,1,0,2*Math.PI,!1),this.ctx.restore()},grid:function(e,t,r,n,i,a){for(var o=r/i,u=n/a,s=e+i*o,l=t+a*u,c=0;c<=i;c++)this.ctx.moveTo(e+c*o,t),this.ctx.lineTo(e+c*o,l);for(var d=0;d<=a;d++)this.ctx.moveTo(e,t+d*u),this.ctx.lineTo(s,t+d*u)},polygon:function(e){if(0!==e.length){var t=e.length;this.ctx.moveTo(e[t-2],e[t-1]);for(var r=0;r<t;r+=2)this.ctx.lineTo(e[r],e[r+1])}},arrowHead:function(e,t,r,n,i){var a=n+i/2+Math.PI,i=n-i/2+Math.PI;this.polygon([e+Math.cos(n)*r,t+Math.sin(n)*r,e+Math.cos(a)*r,t+Math.sin(a)*r,e+Math.cos(i)*r,t+Math.sin(i)*r])}},{}),i=$traceurRuntime.createClass(function(e){this.ctx=e},{thenFill:function(e){return this.ctx.fillStyle=e,this.ctx.fill(),this},thenStroke:function(e){var t=void 0!==arguments[1]?arguments[1]:1;return this.ctx.strokeStyle=e,this.ctx.lineWidth=t,this.ctx.stroke(),this}},{});return{get Painter(){return t}}}),$traceurRuntime.registerModule("src/draw/WidgetPainter.js",[],function(){"use strict";var i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Complex.js","src/draw/WidgetPainter.js")).Complex,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/draw/WidgetPainter.js")).Config,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Format.js","src/draw/WidgetPainter.js")).Format,g=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/draw/WidgetPainter.js")).Gate,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./MathPainter.js","src/draw/WidgetPainter.js")).MathPainter),p=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/draw/WidgetPainter.js")).Matrix,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./Painter.js","src/draw/WidgetPainter.js")).Painter,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Point.js","src/draw/WidgetPainter.js")).Point),v=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Rect.js","src/draw/WidgetPainter.js")).Rect,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Seq.js","src/draw/WidgetPainter.js")).Seq,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../ui/DisplayedCircuit.js","src/draw/WidgetPainter.js")).drawCircuitTooltip,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/draw/WidgetPainter.js")).Util,e=$traceurRuntime.createClass(y,{},{describeGateTransformations:function(i,a){var o=i.height(),u=Math.round(Math.log2(o));return d.range(o).map(function(t){var e,r=y.describeKet(u,t,1,h.SIMPLIFIED),n=i.getColumn(t);if(n.every(function(e){return e.isEqualTo(0)}))return"discards "+r;if(d.range(o).every(function(e){return n[e].isEqualTo(e===t?1:0)})){if(a!==h.CONSISTENT)return"doesn't affect "+r}else if(d.range(o).every(function(e){return e===t||n[e].isEqualTo(0)}))return e=180*n[t].ln().imag/Math.PI,"phases "+r+" by "+a.formatFloat(e)+"°";return"transforms "+r+" into "+new d(n).mapWithIndex(function(e,t){return y.describeKet(u,t,e,a)}).filter(function(e){return""!==e}).join(" + ").split(" + -").join(" - ").split(" + +").join(" + ")}).toArray()},_paintGateTooltip_matrix:function(e,t,r,n,i,a,o,u){if(void 0!==r){o(new v(0,u(),1,0),2*n),o(e.printParagraph("As matrix:",new v(n,u(),a,18),new p(0,0),"black",12),0);var u=new v(n,u(),i,i),s=new v(0,u.y,a-n,i).skipLeft(u.right()+n),l=(g.paintMatrix(e,r,u,f.OPERATION_FORE_COLOR,"black",void 0,f.OPERATION_BACK_COLOR,void 0,"transparent"),o(u),r.height());if(l<=4)for(var a=t.stableDuration()<.2?h.CONSISTENT:h.SIMPLIFIED,c=y.describeGateTransformations(r,a),d=s.h/l,m=0;m<l;m++)o(e.printParagraph(c[m],s.skipTop(m*d).takeTop(d),new p(0,.5),"black",12))}},_paintGateTooltip_rotation:function(e,t,r,n,i,a,o,u){var s,l,c;void 0!==r&&2===r.width()&&r.isUnitary(.001)&&(o(new v(0,u(),1,0),2*n),o(e.printParagraph("As rotation:",new v(n,u(),a,18),new p(0,0),"black",12),0),s=(c=r.qubitOperationToAngleAxisRotation()).angle,l=c.axis,c=c.phase,u=new v(n,u(),i,i),g.paintBlochSphereRotation(e,r,u,f.OPERATION_BACK_COLOR,f.OPERATION_FORE_COLOR),o(u),r=t.stableDuration()<.2?h.CONSISTENT:h.SIMPLIFIED,t=new d(["rotates: "+r.formatFloat(180*s/Math.PI)+"°","around: "+y.describeAxis(l,r),"","global phase: exp("+r.formatFloat(180*c/Math.PI)+"°i)",""]).join("\n"),o(e.printParagraph(t,new v(0,u.y,a-n,i).skipLeft(u.right()+n),new p(0,.5),"black",12)))},_paintGateTooltip_circuit:function(e,t,r,n,i,a,o,u){var s;void 0!==t&&(s=t.gateWeight(),a(new v(0,o(),1,0),2*r),a(e.printParagraph("As circuit (gate weight = "+s+"):",new v(r,o(),i,18),new p(0,0),"black",12),0),s=new v(r,o(),i,n),o=(r=l(e,t,s,!0,u)).maxW,i=r.maxH,a(s.withW(o).withH(i)))},paintGateTooltipHelper:function(e,t,r,n){function i(e){var t=void 0!==arguments[1]?arguments[1]:o;l=Math.max(l,e.bottom()+t),s=Math.max(s,e.right()+t)}var a,o=(c=(u=[4,65][Symbol.iterator]()).next()).done?void 0:c.value,u=(c=u.next()).done?void 0:c.value,s=(a=(c=[0,o][Symbol.iterator]()).next()).done?void 0:a.value,l=(a=c.next()).done?void 0:a.value,c=(i(e.printLine(r.name,new v(o,l,t,18),0,"blue",24)),""!==r.blurb&&i(e.printParagraph(r.blurb,new v(o,l,t,50),new p(0,0),"black",14)),r.knownMatrixAt(n));return r.definitelyHasNoEffect()||(y._paintGateTooltip_matrix(e,r,c,o,u,t,i,function(){return l}),y._paintGateTooltip_rotation(e,r,c,o,u,t,i,function(){return l}),y._paintGateTooltip_circuit(e,r.knownCircuitNested,o,u,t,i,function(){return l},n)),{maxX:s,maxY:l}},paintGateTooltip:function(e,t,r,n){var i=void 0===arguments[4]||arguments[4],a=(e.ctx.save(),e.ctx.translate(t.x,t.y),t=t.withX(0).withY(0),Math.min(t.w/500,t.h/300)),i=(i&&a<1&&(e.ctx.scale(a,a),t=t.withH(t.h/a).withW(t.w/a)),t.w),a=y.paintGateTooltipHelper(e,i,r,n),t=a.maxX,a=a.maxY,o=new v(0,0,t,a);return e.fillRect(o,"#F9FFF9"),e.strokeRect(o,"black"),y.paintGateTooltipHelper(e,i,r,n),e.ctx.restore(),{maxW:t,maxH:a}},describeKet:function(e,t,r,n){return(r=i.from(r)).isEqualTo(0)?"":(r.isEqualTo(1)?"":r.isEqualTo(-1)?"-":r.isEqualTo(i.I)?"i":r.isEqualTo(i.I.times(-1))?"-i":0!==r.real&&0!==r.imag||n===h.CONSISTENT?"("+r.toString(n)+")·":r.toString(n))+"|"+a.bin(t,e)+"⟩"},describeAxis:function(e,r){var t=new d(e).map(Math.abs).max();return new d(e).map(function(e){return e/t}).zip(["X","Y","Z"],function(e,t){return 0===e?"":1===e?t:-1===e?"-"+t:r.formatFloat(e)+"·"+t}).filter(function(e){return""!==e}).join(" + ").replace(" + -"," - ").replace(" + +"," + ")}});function y(){}return{get WidgetPainter(){return e}}}),$traceurRuntime.registerModule("src/fallback.js",[],function(){"use strict";var i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./base/Describe.js","src/fallback.js")).describe,c=[],a=!1;function e(){a=!0,window.onerror=n}function o(){var e=document.getElementById("drawCanvas");return void 0===e?"#":e.toDataURL("image/png")}function t(e,t,r){if(!a)throw r;console.error("Recovered from unexpected error",{recovery:e,context:t,error:r});var n=r.stack||"unknown",t=[e,"","URL",document.location,"","BROWSER",window.navigator.userAgent,window.navigator.appName,window.navigator.appVersion,"","RECOVERY DETAILS",i(t),"","ERROR OBJECT",i(r),"","ERROR LOCATION",m(n)].join("\n");d("Recovered from an error. :(",e+" ("+(r.message||"")+")",t,"(Recovered) "+e+" @ "+n.substr(0,200)+"[...]")}function r(e,t,r){function n(){return d("A known problem is happening. :(",e,"",e,t)}var i=!0,a=!1,o=void 0;try{for(var u,s=r[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var l=u.value;c.push({regex:l,handler:n})}}catch(e){a=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(a)throw o}}n()}var u=function(e,t,r,n){document.getElementById("error-happened-div").innerText=e,document.getElementById("error-message-div").innerText=t,document.getElementById("error-description-div").innerText=r,document.getElementById("error-mailto-anchor").innerText="Email the issue to craig.gidney@gmail.com",document.getElementById("error-mailto-anchor").href=["mailto:craig.gidney@gmail.com?subject=",encodeURIComponent("Quirk had an error: "+t),"&body=",encodeURIComponent("\n\n\n"+r)].join(""),document.getElementById("error-github-anchor").href=["https://github.com/Strilanc/Quirk/issues/new?title=",encodeURIComponent("Encountered error: "+t),"&body=",encodeURIComponent("\n\n\n"+r)].join(""),document.getElementById("error-image-pre").src=o(),setTimeout(function(){document.getElementById("error-image-post").src=o()},0),void 0===n?(document.getElementById("error-report-div").style.display="block",document.getElementById("error-known-div").style.display="none"):(document.getElementById("error-report-div").style.display="none",document.getElementById("error-known-div").style.display="block",document.getElementById("error-known-issue-anchor").href=n)},s=[],l=[],d=function(e,t,r,n){var i=arguments[4],a=document.getElementById("error-div").style;a.opacity<.7&&(s=[],l=[]),a.backgroundColor="#FFA",a.opacity=1,a.display="block",-1===s.indexOf(r)&&(s.push(r),0<l.length&&(r+="\n\nCOVERED\n"+l.join("\n-------------\n")),-1===l.indexOf(n)&&l.push(n),void 0!==(a=function(e,t){if(void 0===t){var r=!0,t=!1,n=void 0;try{for(var i,a=c[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var o=i.value,u=o.regex,s=o.handler;if(u.test(e))return s}}catch(e){t=!0,n=e}finally{try{r||null==a.return||a.return()}finally{if(t)throw n}}}}(t,i))?a():u(e,t,r,i))},m=function(e){return e.replace(/http.+?\/src\.min\.js/g,"src.min.js")},f=function(t){var e=document.getElementById("drawCanvas");if(void 0!==e){var r=e.getContext("2d"),n=(r.font="12px monospace",t.split("\n")),i=0,a=!0,t=!1,o=void 0;try{for(var u,s=n[Symbol.iterator]();!(a=(u=s.next()).done);a=!0)var l=u.value,i=Math.max(i,r.measureText(l).width)}catch(e){t=!0,o=e}finally{try{a||null==s.return||s.return()}finally{if(t)throw o}}for(var t=12*n.length,c=(e.clientWidth-i)/2,d=(e.clientHeight-t)/2,m=(r.fillStyle="white",r.globalAlpha=.9,r.fillRect(c-10,d-10,i+20,20+t),r.globalAlpha=1,r.strokeStyle="red",r.strokeRect(c-10,d-10,i+20,20+t),r.fillStyle="red",0),f=0;f<n.length;f++)r.fillText(n[f],c,d+(m+=3)),m+=9}};function n(e,t,r,n,i){try{var a=m((i instanceof Object?i.stack:void 0)||t+":"+r+":"+n),o=["URL",document.location,"","BROWSER",window.navigator.userAgent,window.navigator.appName,window.navigator.appVersion,"","ERROR OBJECT",i instanceof Object&&void 0!==i.toString?i.toString():String(i),"","ERROR LOCATION",m(a)].join("\n");d("An error happened. :(",e,o,"(Unexpected) "+e+" @ "+a.substr(0,200)+"[...]"),f(["An error is happening. :(","",e,"","Scroll down for more information"].join("\n"))}catch(e){console.error("Caused an exception when handling unexpected error.",e)}return!1}return{get hookErrorHandler(){return e},get notifyAboutRecoveryFromUnexpectedError(){return t},get onErrorHandler(){return n},get notifyAboutKnownIssue(){return r}}}),$traceurRuntime.registerModule("src/gates/AllGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ArithmeticGates.js","src/gates/AllGates.js")).ArithmeticGates,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./AmplitudeDisplay.js","src/gates/AllGates.js")).AmplitudeDisplayFamily,N=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./BitCountGates.js","src/gates/AllGates.js")).BitCountGates,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./BlochSphereDisplay.js","src/gates/AllGates.js")).BlochSphereDisplay,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ComparisonGates.js","src/gates/AllGates.js")).ComparisonGates,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./Controls.js","src/gates/AllGates.js")).Controls,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./CountingGates.js","src/gates/AllGates.js")).CountingGates,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./CycleBitsGates.js","src/gates/AllGates.js")).CycleBitsGates,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./DensityMatrixDisplay.js","src/gates/AllGates.js")).DensityMatrixDisplayFamily,D=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./Debug_ErrorInjectionGate.js","src/gates/AllGates.js")).ErrorInjectionGate,F=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ExponentiatingGates.js","src/gates/AllGates.js")).ExponentiatingGates,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./FourierTransformGates.js","src/gates/AllGates.js")).FourierTransformGates,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./HalfTurnGates.js","src/gates/AllGates.js")).HalfTurnGates,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./Joke_ImaginaryGate.js","src/gates/AllGates.js")),d=c.ImaginaryGate,m=c.AntiImaginaryGate,f=c.SqrtImaginaryGate,c=c.AntiSqrtImaginaryGate,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./IncrementGates.js","src/gates/AllGates.js")).IncrementGates,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./InputGates.js","src/gates/AllGates.js")).InputGates,p=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./InterleaveBitsGates.js","src/gates/AllGates.js")).InterleaveBitsGates,v=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./MeasurementGate.js","src/gates/AllGates.js")).MeasurementGate,y=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ModularIncrementGates.js","src/gates/AllGates.js")).ModularIncrementGates,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ModularAdditionGates.js","src/gates/AllGates.js")).ModularAdditionGates,R=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ModularMultiplicationGates.js","src/gates/AllGates.js")).ModularMultiplicationGates,O=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ModularMultiplyAccumulateGates.js","src/gates/AllGates.js")).ModularMultiplyAccumulateGates,w=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./MultiplicationGates.js","src/gates/AllGates.js")).MultiplicationGates,M=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./MultiplyAccumulateGates.js","src/gates/AllGates.js")).MultiplyAccumulateGates,_=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./Joke_NeGate.js","src/gates/AllGates.js")).NeGate,x=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ParametrizedRotationGates.js","src/gates/AllGates.js")).ParametrizedRotationGates,S=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./PhaseGradientGates.js","src/gates/AllGates.js")).PhaseGradientGates,z=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./PivotFlipGates.js","src/gates/AllGates.js")).PivotFlipGates,T=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./PostSelectionGates.js","src/gates/AllGates.js")).PostSelectionGates,A=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./PoweringGates.js","src/gates/AllGates.js")).PoweringGates,C=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ProbabilityDisplay.js","src/gates/AllGates.js")).ProbabilityDisplayFamily,E=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./QuarterTurnGates.js","src/gates/AllGates.js")).QuarterTurnGates,I=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ReverseBitsGate.js","src/gates/AllGates.js")).ReverseBitsGateFamily,B=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./SampleDisplay.js","src/gates/AllGates.js")).SampleDisplayFamily,j=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./Detector.js","src/gates/AllGates.js")).Detectors,L=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./SpacerGate.js","src/gates/AllGates.js")).SpacerGate,U=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./SwapGateHalf.js","src/gates/AllGates.js")).SwapGateHalf,W=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./Impossible_UniversalNotGate.js","src/gates/AllGates.js")).UniversalNotGate,$=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./VariousXGates.js","src/gates/AllGates.js")).VariousXGates,P=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./VariousYGates.js","src/gates/AllGates.js")).VariousYGates,G=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./VariousZGates.js","src/gates/AllGates.js")).VariousZGates,H=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./XorGates.js","src/gates/AllGates.js")).XorGates,q=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./Joke_ZeroGate.js","src/gates/AllGates.js")).ZeroGate,X=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Seq.js","src/gates/AllGates.js")).seq,k={},Y=(k.Special={Measurement:v,SwapHalf:U},k.Displays={AmplitudeDisplayFamily:t,ProbabilityDisplayFamily:C,SampleDisplayFamily:B,DensityMatrixDisplayFamily:u,BlochSphereDisplay:r},k.Arithmetic=e,k.BitCountGates=N,k.ComparisonGates=n,k.Controls=i,k.CountingGates=a,k.CycleBitsGates=o,k.Displays.DensityMatrixDisplay=u.ofSize(1),k.Displays.DensityMatrixDisplay2=u.ofSize(2),k.Displays.ChanceDisplay=k.Displays.ProbabilityDisplayFamily.ofSize(1),k.ErrorInjection=D,k.Exponentiating=F,k.FourierTransformGates=s,k.HalfTurns=l,k.ImaginaryGate=d,k.AntiImaginaryGate=m,k.SqrtImaginaryGate=f,k.AntiSqrtImaginaryGate=c,k.IncrementGates=h,k.InputGates=g,k.InterleaveBitsGates=p,k.ModularIncrementGates=y,k.ModularAdditionGates=b,k.ModularMultiplicationGates=R,k.ModularMultiplyAccumulateGates=O,k.MultiplicationGates=w,k.MultiplyAccumulateGates=M,k.NeGate=_,k.OtherX=$,k.OtherY=P,k.OtherZ=G,k.ParametrizedRotationGates=x,k.PhaseGradientGates=S,k.PivotFlipGates=z,k.PostSelectionGates=T,k.Powering=A,k.QuarterTurns=E,k.ReverseBitsGateFamily=I,k.Detectors=j,k.SpacerGate=L,k.UniversalNot=W,k.XorGates=H,k.ZeroGate=q,k.KnownToSerializer=$traceurRuntime.spread(i.all,g.all,[v,U,L,W,D,q,_,d,m,f,c],t.all,C.all,B.all,u.all,[r],e.all,N.all,n.all,a.all,o.all,j.all,F.all,s.all,l.all,h.all,p.all,b.all,y.all,R.all,O.all,w.all,M.all,E.all,x.all,S.all,z.all,T.all,A.all,I.all,$.all,P.all,G.all,H.all),X(k.KnownToSerializer).keyedBy(function(e){return e.serializedId})),K=(k.findKnownGateById=function(e,t){return Y.has(e)?Y.get(e):t.findGateWithSerializedId(e)},k.TopToolboxGroups=[{hint:"Probes",gates:[v,void 0,T.PostSelectOff,T.PostSelectOn,i.AntiControl,i.Control]},{hint:"Displays",gates:[void 0,void 0,u.ofSize(1),r,C.ofSize(1),t.ofSize(2)]},{hint:"Half Turns",gates:[l.Z,U,l.Y,void 0,l.X,l.H]},{hint:"Quarter Turns",gates:[E.SqrtZForward,E.SqrtZBackward,E.SqrtYForward,E.SqrtYBackward,E.SqrtXForward,E.SqrtXBackward]},{hint:"Eighth Turns",gates:[G.Z4,G.Z4i,P.Y4,P.Y4i,$.X4,$.X4i]},{hint:"Spinning",gates:[A.ZForward,A.ZBackward,A.YForward,A.YBackward,A.XForward,A.XBackward]},{hint:"Formulaic",gates:[x.FormulaicRotationZ,x.FormulaicRotationRz,x.FormulaicRotationY,x.FormulaicRotationRy,x.FormulaicRotationX,x.FormulaicRotationRx]},{hint:"Parametrized",gates:[x.ZToA,x.ZToMinusA,x.YToA,x.YToMinusA,x.XToA,x.XToMinusA]},{hint:"Sampling",gates:[j.ZDetector,j.ZDetectControlClear,j.YDetector,j.YDetectControlClear,j.XDetector,j.XDetectControlClear]},{hint:"Parity",gates:[i.ZParityControl,void 0,i.YParityControl,void 0,i.XParityControl,void 0]}],k.BottomToolboxGroups=[{hint:"X/Y Probes",gates:[i.XAntiControl,i.XControl,i.YAntiControl,i.YControl,T.PostSelectAntiX,T.PostSelectX,T.PostSelectAntiY,T.PostSelectY]},{hint:"Order",gates:[a.CountingFamily.ofSize(3),a.UncountingFamily.ofSize(3),I.ofSize(2),void 0,o.CycleBitsFamily.ofSize(3),o.ReverseCycleBitsFamily.ofSize(3),p.InterleaveBitsGateFamily.ofSize(6),p.DeinterleaveBitsGateFamily.ofSize(6)]},{hint:"Frequency",gates:[s.FourierTransformFamily.ofSize(2),s.InverseFourierTransformFamily.ofSize(2),void 0,void 0,S.PhaseGradientFamily.ofSize(2),S.PhaseDegradientFamily.ofSize(2),S.DynamicPhaseGradientFamily.ofSize(2),S.DynamicPhaseDegradientFamily.ofSize(2)]},{hint:"Inputs",gates:[g.InputAFamily.ofSize(2),g.SetA,g.InputBFamily.ofSize(2),g.SetB,g.InputRFamily.ofSize(2),g.SetR,void 0,void 0]},{hint:"Arithmetic",gates:[h.IncrementFamily.ofSize(2),h.DecrementFamily.ofSize(2),e.PlusAFamily.ofSize(2),e.MinusAFamily.ofSize(2),M.MultiplyAddInputsFamily.ofSize(2),M.MultiplySubtractInputsFamily.ofSize(2),w.TimesAFamily.ofSize(2),w.TimesAInverseFamily.ofSize(2)]},{hint:"Compare",gates:[n.ALessThanB,n.AGreaterThanB,n.ALessThanOrEqualToB,n.AGreaterThanOrEqualToB,n.AEqualToB,n.ANotEqualToB,void 0,void 0]},{hint:"Modular",gates:[y.IncrementModRFamily.ofSize(2),y.DecrementModRFamily.ofSize(2),b.PlusAModRFamily.ofSize(2),b.MinusAModRFamily.ofSize(2),R.TimesAModRFamily.ofSize(2),R.TimesAModRInverseFamily.ofSize(2),R.TimesBToTheAModRFamily.ofSize(2),R.TimesInverseBToTheAModRFamily.ofSize(2)]},{hint:"Scalar",gates:[L,q,_,void 0,d,m,f,c]}],new Map([[void 0,[]],["1",[k.HalfTurns.X]],["+",[k.HalfTurns.H]],["-",[k.HalfTurns.H,k.HalfTurns.Z]],["i",[k.HalfTurns.H,k.QuarterTurns.SqrtZForward]],["-i",[k.HalfTurns.H,k.QuarterTurns.SqrtZBackward]]]));return{get Gates(){return k},get INITIAL_STATES_TO_GATES(){return K}}}),$traceurRuntime.registerModule("src/gates/AmplitudeDisplay.js",[],function(){"use strict";var s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/gates/AmplitudeDisplay.js")).Config,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/CircuitShaders.js","src/gates/AmplitudeDisplay.js")).CircuitShaders,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/AmplitudeDisplay.js")).Gate,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GatePainting.js","src/gates/AmplitudeDisplay.js")).GatePainting,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/GateShaders.js","src/gates/AmplitudeDisplay.js")).GateShaders,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Format.js","src/gates/AmplitudeDisplay.js")).Format,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/MathPainter.js","src/gates/AmplitudeDisplay.js")).MathPainter,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/gates/AmplitudeDisplay.js")),T=r.Matrix,a=r.complexVectorToReadableJson,o=r.realVectorToReadableJson,p=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ProbabilityDisplay.js","src/gates/AmplitudeDisplay.js")).probabilityStatTexture,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Point.js","src/gates/AmplitudeDisplay.js")).Point,v=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/gates/AmplitudeDisplay.js")).Util,y=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/Shaders.js","src/gates/AmplitudeDisplay.js")).Shaders,r=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglConfiguredShader.js","src/gates/AmplitudeDisplay.js")).WglConfiguredShader,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/ShaderCoders.js","src/gates/AmplitudeDisplay.js"))),n=r.Inputs,i=r.Outputs,b=r.currentShaderCoder,r=r.makePseudoShaderWithInputsAndOutputAndCode,R=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglTexturePool.js","src/gates/AmplitudeDisplay.js")).WglTexturePool,w=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglTextureTrader.js","src/gates/AmplitudeDisplay.js")).WglTextureTrader;function u(e,t,r,n,i){var r=p(e,r,n,i),a=new w(e),e=(a.dontDeallocCurrentTexture(),b().vec2.arrayPowerSizeOfTexture(e)),o=v.numberOfSetBits(t.inclusionMask),u=v.numberOfSetBits(t.inclusionMask&(1<<n)-1),e=e-o,s=e-i,l=(a.shadeAndTrade(function(e){return h.controlSelect(t,e)},R.takeVec2Tex(e)),a.shadeAndTrade(function(e){return g.cycleAllBits(e,u-n)}),a.dontDeallocCurrentTexture());a.shadeAndTrade(M,R.takeVecFloatTex(e));for(var c=0;c<i;c++)a.shadeHalveAndTrade(y.sumFoldFloatAdjacents);a.shadeAndTrade(_,R.takeVec2Tex(s));for(var d=0;d<s;d++)a.shadeHalveAndTrade(x);a.shadeAndTrade(function(e){return S(l,e)},R.takeVec2Tex(i));o=a.dontDeallocCurrentTexture();a.shadeAndTrade(function(e){return A(e,l)},R.takeVec2Tex(e)),l.deallocByDepositingInPool("ketJustAfterCycle in makeAmplitudeSpanPipeline");for(var m=0;m<i;m++)a.shadeHalveAndTrade(y.sumFoldVec2Adjacents);a.shadeAndTrade(M,R.takeVecFloatTex(s));for(var f=0;f<s;f++)a.shadeHalveAndTrade(y.sumFoldFloat);b().float.needRearrangingToBeInVec4Format&&a.shadeHalveAndTrade(y.packFloatIntoVec4);e=a.currentTexture;return a.currentTexture=o,b().vec2.needRearrangingToBeInVec4Format&&a.shadeHalveAndTrade(y.packVec2IntoVec4),[a.currentTexture,e,r]}function m(e,t,r){var n=(u=(t=t[Symbol.iterator]()).next()).done?void 0:u.value,i=(u=t.next()).done?void 0:u.value,a=(u=t.next()).done?void 0:u.value,t=i[0],o=1<<e,u=2==o?2:1<<Math.floor(Math.round(Math.log2(o))/2),i=o/u,s=0,l=!0,c=!1,d=void 0;try{for(var m,f=n[Symbol.iterator]();!(l=(m=f.next()).done);l=!0){var h=m.value;s+=h*h}}catch(e){c=!0,d=e}finally{try{l||null==f.return||f.return()}finally{if(c)throw d}}for(var g=new Float32Array(u*i*2),p=0,v=0;v<o;v++)p+=a[v];for(var y=0;y<o;y++)g[y<<1]=Math.sqrt(a[y]/p);if(isNaN(p)||p<1e-6)return{quality:0,ket:T.zero(u,i).times(NaN),phaseLockIndex:0,incoherentKet:T.zero(u,i).times(NaN)};for(var c=t/s/p,d=e===r.numWires?void 0:function(e){for(var t=0,r=0,n=0;n<e.length;n+=2){var i=e[n],a=e[n+1],i=i*i+a*a;1e4*r<i&&(r=i,t=n>>1)}return t}(n),t=void 0===d?0:Math.atan2(n[2*d+1],n[2*d]),b=Math.cos(t),R=-Math.sin(t),w=new Float32Array(2*o),M=Math.sqrt(s),_=0;_<o;_++){var x=n[2*_]/M,S=n[2*_+1]/M;w[2*_]=x*b+S*-R,w[2*_+1]=x*R+S*b}return{quality:c,ket:new T(u,i,w),phaseLockIndex:d,incoherentKet:new T(u,i,g)}}var M=r([n.vec2("input")],i.float(),"float outputFor(float k) {\n        vec2 ri = read_input(k);\n        return dot(ri, ri);\n    }"),_=r([n.float("input")],i.vec2(),"vec2 outputFor(float k) {\n        return vec2(float(k), read_input(k));\n    }"),x=r([n.vec2("input")],i.vec2(),"vec2 outputFor(float k) {\n        vec2 a = read_input(k);\n        vec2 b = read_input(k + len_output());\n        return a.y >= b.y ? a : b;\n    }"),S=r([n.vec2("input"),n.vec2("indexed_mag")],i.vec2(),"vec2 outputFor(float k) {\n        return read_input(k + read_indexed_mag(0.0).x * len_output());\n    }"),A=r([n.vec2("small_input"),n.vec2("large_input")],i.vec2(),"\n    vec2 cmul_conj(vec2 c1, vec2 c2) {\n        return mat2(c1.x, -c1.y, c1.y, c1.x) * c2;\n    }\n    vec2 outputFor(float k) {\n        vec2 in1 = read_small_input(floor(mod(k + 0.5, len_small_input())));\n        vec2 in2 = read_large_input(k);\n        return cmul_conj(in1, in2);\n    }\n    "),f=t.makeDisplayDrawer(function(r){var e=r.gate.height,e=r.customStats||{ket:(1===e?T.zero(2,1):T.zero(1<<Math.floor(e/2),1<<Math.ceil(e/2))).times(NaN),quality:1,phaseLockIndex:0,incoherentKet:void 0},t=e.quality,n=e.ket,i=e.phaseLockIndex,e=e.incoherentKet,a=t<.99,o=a?e:n,e=r.rect.w-r.rect.h*n.width()/n.height(),n=r.rect.skipLeft(e/2).skipRight(e/2),e=Math.min(1,Math.max(0,(t-.9999)/1e-4)),i=(c.paintMatrix(r.painter,o,n,s.SUPERPOSITION_MID_COLOR,"black",s.SUPERPOSITION_FORE_COLOR,s.SUPERPOSITION_BACK_COLOR,"rgba(0, 0, 0, "+e+")"),a?c.paintMatrixTooltip(r.painter,o,n,r.focusPoints,function(e,t){return"Chance of |"+v.bin(t*o.width()+e,r.gate.height)+"⟩ (decimal "+(t*o.width()+e)+") [amplitude not defined]"},function(e,t,r){return"raw: "+(100*r.norm2()).toFixed(4)+"%, log: "+(10*Math.log10(r.norm2())).toFixed(1)+" dB"},function(e,t,r){return"[entangled with other qubits]"}):(c.paintMatrixTooltip(r.painter,o,n,r.focusPoints,function(e,t){return"Amplitude of |"+v.bin(t*o.width()+e,r.gate.height)+"⟩ (decimal "+(t*o.width()+e)+")"},function(e,t,r){return"val:"+r.toString(new l(!1,0,5,", "))},function(e,t,r){return"mag²:"+(100*r.norm2()).toFixed(4)+"%, phase:"+(0<=(r=180*r.phase()/Math.PI)?"+":"")+r.toFixed(2)+"°"}),void 0!==i&&(t=n.w/o.width(),a=n.h/o.height(),u=i%o.width(),i=Math.floor(i/o.width()),u=n.x+t*(.5+u),n=n.y+a*(i+.5),r.painter.strokeLine(new d(u,n),new d(u+t/2,n),"rgba(255,0,0,"+e+")",2),r.painter.print("fixed",u+.5*t,n,"right","bottom","rgba(255,0,0,"+e+")","12px monospace",.5*t,.5*a))),r),u=e,n=void 0,a=(t=i.positionInCircuit).col,t=t.row;0!=(i.stats.circuitDefinition.colIsMeasuredMask(a)>>t&(1<<i.gate.height)-1)?(u=0,n=i.gate.width<=2?"(w/ measure defer)":"(assuming measurement deferred)"):u<.999&&(n="incoherent"),void 0!==n&&i.painter.print(n,i.rect.x+i.rect.w/2,i.rect.y+i.rect.h,"center","hanging","rgba(255,0,0,"+(1-u)+")","12px sans-serif",i.rect.w,i.rect.h,void 0)});function C(e){var t=e.quality,r=e.ket,n=e.phaseLockIndex,e=e.incoherentKet,i=r.width()*r.height();return{coherence_measure:t,superposition_phase_locked_state_index:void 0===n?null:n,ket:a(new T(1,i,r.rawBuffer()).getColumn(0)),incoherentKet:o(new T(1,i,e.rawBuffer()).getColumn(0))}}var E=e.buildFamily(1,16,function(r,e){return e.setSerializedId("Amps"+r).setSymbol("Amps").setTitle("Amplitude Display").setBlurb("Shows the amplitudes of some wires, if separable.\nUse controls to see conditional amplitudes.").setWidth(1===r?2:r%2==0?r:Math.ceil(r/2)).promiseHasNoNetEffectOnStateVector().setExtraDisableReasonFinder(function(e){return e.isNested?"can't\nnest\ndisplays\n(sorry)":void 0}).setStatTexturesMaker(function(e){return u(e.stateTrader.currentTexture,e.controls,e.controlsTexture,e.row,r)}).setStatPixelDataPostProcessor(function(e,t){return m(r,e,t)}).setProcessedStatsToJsonFunc(C).setDrawer(f)});return{get AmplitudeDisplayFamily(){return E},get AMPS_TO_SQUARED_MAGS_SHADER(){return M},get MAGS_TO_INDEXED_MAGS_SHADER(){return _},get FOLD_MAX_INDEXED_MAG_SHADER(){return x},get LOOKUP_KET_AT_INDEXED_MAG_SHADER(){return S},get POINTWISE_CMUL_CONJ_SHADER(){return A},get amplitudeDisplayStatTextures(){return u}}}),$traceurRuntime.registerModule("src/gates/ArithmeticGates.js",[],function(){"use strict";function r(i,a){return function(e){var t=Math.floor(i/2),r=Math.ceil(i/2),n=e&(1<<t)-1,e=e>>t;return n+((e+n*a&(1<<r)-1)<<t)}}var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/ArithmeticGates.js")).Gate,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GatePainting.js","src/gates/ArithmeticGates.js")).GatePainting,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/KetShaderUtil.js","src/gates/ArithmeticGates.js")),i=t.ketArgs,a=t.ketShaderPermute,t=t.ketInputGateShaderCode,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglArg.js","src/gates/ArithmeticGates.js")).WglArg,u={},s=a("\n        uniform float factor;\n        "+t("A")+"\n    ","\n        float d = read_input_A();\n        d *= factor;\n        d = mod(d, span);\n        return mod(out_id + span - d, span);");return u.Legacy_AdditionFamily=e.buildFamily(2,16,function(t,e){return e.setSerializedId("add"+t).setSymbol("b+=a").setTitle("Addition Gate").setBlurb("Adds a little-endian number into another.").setDrawer(n.SECTIONED_DRAWER_MAKER(["a","b+=a"],[Math.floor(t/2)/t])).setActualEffectToUpdateFunc(function(e){return u.PlusAFamily.ofSize(Math.ceil(t/2)).customOperation(e.withRow(e.row+Math.floor(t/2)).withInputSetToRange("A",e.row,Math.floor(t/2)))}).setKnownEffectToPermutation(r(t,1))}),u.Legacy_SubtractionFamily=e.buildFamily(2,16,function(t,e){return e.setAlternateFromFamily(u.Legacy_AdditionFamily).setSerializedId("sub"+t).setSymbol("b-=a").setTitle("Subtraction Gate").setBlurb("Subtracts a little-endian number from another.").setDrawer(n.SECTIONED_DRAWER_MAKER(["a","b-=a"],[Math.floor(t/2)/t])).setActualEffectToUpdateFunc(function(e){return u.MinusAFamily.ofSize(Math.ceil(t/2)).customOperation(e.withRow(e.row+Math.floor(t/2)).withInputSetToRange("A",e.row,Math.floor(t/2)))}).setKnownEffectToPermutation(r(t,-1))}),u.PlusAFamily=e.buildFamily(1,16,function(r,e){return e.setSerializedId("+=A"+r).setSymbol("+A").setTitle("Addition Gate [input A]").setBlurb("Adds input A into the qubits covered by this gate.").setRequiredContextKeys("Input Range A").setActualEffectToShaderProvider(function(e){return s.withArgs.apply(s,$traceurRuntime.spread(i(e,r,["A"]),[o.float("factor",1)]))}).setKnownEffectToParametrizedPermutation(function(e,t){return e+t&(1<<r)-1})}),u.MinusAFamily=e.buildFamily(1,16,function(r,e){return e.setAlternateFromFamily(u.PlusAFamily).setSerializedId("-=A"+r).setSymbol("−A").setTitle("Subtraction Gate [input A]").setBlurb("Subtracts input A out of the qubits covered by this gate.").setRequiredContextKeys("Input Range A").setActualEffectToShaderProvider(function(e){return s.withArgs.apply(s,$traceurRuntime.spread(i(e,r,["A"]),[o.float("factor",-1)]))}).setKnownEffectToParametrizedPermutation(function(e,t){return e-t&(1<<r)-1})}),u.all=$traceurRuntime.spread(u.Legacy_AdditionFamily.all,u.Legacy_SubtractionFamily.all,u.PlusAFamily.all,u.MinusAFamily.all),{get ArithmeticGates(){return u}}}),$traceurRuntime.registerModule("src/gates/BitCountGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/gates/BitCountGates.js")).Config,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/BitCountGates.js")).Gate,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/KetShaderUtil.js","src/gates/BitCountGates.js")),n=r.ketArgs,i=r.ketShaderPermute,r=r.ketInputGateShaderCode,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/gates/BitCountGates.js")).Util,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglArg.js","src/gates/BitCountGates.js")).WglArg,u={},s=i("\n        uniform float factor;\n        "+r("A")+"\n    ","\n        float d = read_input_A();\n        float popcnt = 0.0;\n        for (int i = 0; i < "+e.MAX_WIRE_COUNT+"; i++) {\n            popcnt += mod(d, 2.0);\n            d = floor(d / 2.0);\n        }\n        float offset = mod(popcnt * factor, span);\n        return mod(out_id + span - offset, span);");return u.PlusBitCountAFamily=t.buildFamily(1,16,function(r,e){return e.setSerializedIdAndSymbol("+cntA"+r).setSymbol("+1s(A)").setTitle("Bit Count Gate").setBlurb("Counts the number of ON bits in input A and adds that into this output.").setRequiredContextKeys("Input Range A").setActualEffectToShaderProvider(function(e){return s.withArgs.apply(s,$traceurRuntime.spread(n(e,r,["A"]),[o.float("factor",1)]))}).setKnownEffectToParametrizedPermutation(function(e,t){return e+a.numberOfSetBits(t)&(1<<r)-1})}),u.MinusBitCountAFamily=t.buildFamily(1,16,function(r,e){return e.setAlternateFromFamily(u.PlusBitCountAFamily).setSerializedIdAndSymbol("-cntA"+r).setSymbol("-1s(A)").setTitle("Bit Un-Count Gate").setBlurb("Counts the number of ON bits in input A and subtracts that into this output.").setRequiredContextKeys("Input Range A").setActualEffectToShaderProvider(function(e){return s.withArgs.apply(s,$traceurRuntime.spread(n(e,r,["A"]),[o.float("factor",-1)]))}).setKnownEffectToParametrizedPermutation(function(e,t){return e-a.numberOfSetBits(t)&(1<<r)-1})}),u.all=$traceurRuntime.spread(u.PlusBitCountAFamily.all,u.MinusBitCountAFamily.all),{get BitCountGates(){return u}}}),$traceurRuntime.registerModule("src/gates/BlochSphereDisplay.js",[],function(){"use strict";var _=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/gates/BlochSphereDisplay.js")).Config,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/BlochSphereDisplay.js")).GateBuilder,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GatePainting.js","src/gates/BlochSphereDisplay.js")).GatePainting,x=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/MathPainter.js","src/gates/BlochSphereDisplay.js")).MathPainter,S=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Point.js","src/gates/BlochSphereDisplay.js")).Point;function n(e,t,r){var n=void 0!==arguments[3]?arguments[3]:[],i=void 0!==arguments[4]?arguments[4]:_.DISPLAY_GATE_BACK_COLOR,a=void 0!==arguments[5]?arguments[5]:_.DISPLAY_GATE_FORE_COLOR,u=r.center(),s=Math.min(r.w,r.h)/2,o=x.coordinateSystem(s),l=o.dx,c=o.dy,d=o.dz;e.fillCircle(u,s,i),e.trace(function(e){e.circle(u.x,u.y,s),e.ellipse(u.x,u.y,c.x,l.y),e.ellipse(u.x,u.y,l.x,d.y);var t=!0,r=!1,n=void 0;try{for(var i,a=[l,c,d][Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;e.line(u.x-o.x,u.y-o.y,u.x+o.x,u.y+o.y)}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}).thenStroke("#BBB");var m,f,h,g,p,v,y,b,R,w=(i=(o=[NaN,NaN,NaN][Symbol.iterator]()).next()).done?void 0:i.value,M=(i=o.next()).done?void 0:i.value,o=(i=o.next()).done?void 0:i.value;t.hasNaN()?e.printParagraph("NaN",r,new S(.5,.5),"red"):(w=(t=(i=t.qubitDensityMatrixToBlochVector()[Symbol.iterator]()).next()).done?void 0:t.value,M=(t=i.next()).done?void 0:t.value,o=(t=i.next()).done?void 0:t.value,i=e,t=w,f=M,h=o,a=a,v=(m=r).center(),m=Math.min(m.w,m.h)/2,y=(m=x.coordinateSystem(m)).dx,g=m.dy,m=m.dz,y=v.plus(y.times(t)).plus(g.times(f)).plus(m.times(h)),g=3.8/(1+t/6),i.strokeLine(v,y,"black",1.5),i.fillCircle(y,g,a),i.ctx.save(),i.ctx.globalAlpha*=Math.min(1,Math.max(0,1-t*t-f*f-h*h)),i.fillCircle(y,g,"yellow"),i.ctx.restore(),i.strokeCircle(y,g,"black"),i.ctx.save(),i.ctx.globalAlpha*=Math.min(1,Math.max(0,.5+5*t)),i.strokeLine(v,y,"black",2),i.ctx.restore()),m=e,a=w,f=M,h=o,g=n,b=(t=r).center(),R=Math.min(t.w,t.h)/2,g.every(function(e){return e.distanceTo(b)>=R})||(p=2*Math.PI,t=function(e){return(0<=e?"+":"")+(360*e/p).toFixed(2)+"°"},g=function(e){return(0<=e?"+":"")+e.toFixed(4)},v=Math.sqrt(a*a+f*f+h*h),y=Math.atan2(f,-a),i=Math.max(0,Math.PI/2-Math.atan2(-h,Math.sqrt(f*f+a*a))),m.strokeCircle(b,R,"orange",2),x.paintDeferredValueTooltip(m,b.x+R*Math.sqrt(.5),b.y-R*Math.sqrt(.5),"Bloch sphere representation of local state","r:"+g(v)+", ϕ:"+t(y)+", θ:"+t(i),"x:"+g(-a)+", y:"+g(f)+", z:"+g(-h)))}var r=(new e).setSerializedIdAndSymbol("Bloch").setTitle("Bloch Sphere Display").setBlurb("Shows a wire's local state as a point on the Bloch Sphere.\nUse controls to see conditional states.").markAsDrawerNeedsSingleQubitDensityStats().setDrawer(t.makeDisplayDrawer(function(e){var t=e.positionInCircuit,r=t.row,t=t.col,t=e.stats.qubitDensityMatrix(t,r);n(e.painter,t,e.rect,e.focusPoints)})).promiseHasNoNetEffectOnStateVector().setExtraDisableReasonFinder(function(e){return e.isNested?"can't\nnest\ndisplays\n(sorry)":void 0}).gate;return{get paintBlochSphereDisplay(){return n},get BlochSphereDisplay(){return r}}}),$traceurRuntime.registerModule("src/gates/ComparisonGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/ComparisonGates.js")).GateBuilder,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/KetShaderUtil.js","src/gates/ComparisonGates.js")),r=t.ketArgs,n=t.ketShaderPermute,i=t.ketInputGateShaderCode,a=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglConfiguredShader.js","src/gates/ComparisonGates.js")).WglConfiguredShader,{});function o(e){var t=n("\n            "+i("A")+"\n            "+i("B")+"\n        ","\n            float lhs = read_input_A();\n            float rhs = read_input_B();\n            return mod(out_id + (("+e+") ? 1.0 : 0.0), 2.0);");return function(e){return t.withArgs.apply(t,$traceurRuntime.spread(r(e,1,["A","B"])))}}return a.ALessThanB=(new e).setSerializedId("^A<B").setSymbol("⊕A<B").setTitle("Less-Than Gate").setBlurb("Toggles a qubit if input A is less than input B.").setRequiredContextKeys("Input Range A","Input Range B").setActualEffectToShaderProvider(o("lhs < rhs")).setKnownEffectToParametrizedPermutation(function(e,t,r){return e^(t<r?1:0)}).gate,a.ALessThanOrEqualToB=(new e).setSerializedId("^A<=B").setSymbol("⊕A≤B").setTitle("At-Most Gate").setBlurb("Toggles a qubit if input A is at most input B.").setRequiredContextKeys("Input Range A","Input Range B").setActualEffectToShaderProvider(o("lhs <= rhs")).setKnownEffectToParametrizedPermutation(function(e,t,r){return e^(t<=r?1:0)}).gate,a.AGreaterThanB=(new e).setAlternate(a.ALessThanOrEqualToB).setSerializedId("^A>B").setSymbol("⊕A>B").setTitle("Greater-Than Gate").setBlurb("Toggles a qubit if input A is greater than input B.").setRequiredContextKeys("Input Range A","Input Range B").setActualEffectToShaderProvider(o("lhs > rhs")).setKnownEffectToParametrizedPermutation(function(e,t,r){return e^(r<t?1:0)}).gate,a.AGreaterThanOrEqualToB=(new e).setAlternate(a.ALessThanB).setSerializedId("^A>=B").setSymbol("⊕A≥B").setTitle("At-Least Gate").setBlurb("Toggles a qubit if input A is at least input B.").setRequiredContextKeys("Input Range A","Input Range B").setActualEffectToShaderProvider(o("lhs >= rhs")).setKnownEffectToParametrizedPermutation(function(e,t,r){return e^(r<=t?1:0)}).gate,a.AEqualToB=(new e).setSerializedId("^A=B").setSymbol("⊕A=B").setTitle("Equality Gate").setBlurb("Toggles a qubit if input A is equal to input B.").setRequiredContextKeys("Input Range A","Input Range B").setActualEffectToShaderProvider(o("lhs == rhs")).setKnownEffectToParametrizedPermutation(function(e,t,r){return e^(t===r?1:0)}).gate,a.ANotEqualToB=(new e).setAlternate(a.AEqualToB).setSerializedId("^A!=B").setSymbol("⊕A≠B").setTitle("Inequality Gate").setBlurb("Toggles a qubit if input A isn't equal to input B.").setRequiredContextKeys("Input Range A","Input Range B").setActualEffectToShaderProvider(o("lhs != rhs")).setKnownEffectToParametrizedPermutation(function(e,t,r){return e^(t!==r?1:0)}).gate,a.all=[a.ALessThanB,a.AGreaterThanB,a.AEqualToB,a.ANotEqualToB,a.ALessThanOrEqualToB,a.AGreaterThanOrEqualToB],{get ComparisonGates(){return a}}}),$traceurRuntime.registerModule("src/gates/Controls.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/Controls.js")).GateBuilder,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GatePainting.js","src/gates/Controls.js")).GatePainting,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/GateShaders.js","src/gates/Controls.js")).GateShaders,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./HalfTurnGates.js","src/gates/Controls.js")).HalfTurnGates,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./QuarterTurnGates.js","src/gates/Controls.js")).QuarterTurnGates,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/gates/Controls.js")).Config,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/KetShaderUtil.js","src/gates/Controls.js")),u=o.ketArgs,o=o.ketShaderPermute,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglArg.js","src/gates/Controls.js")).WglArg,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/gates/Controls.js")).Util,c={},d=(c.Control=(new e).setSerializedIdAndSymbol("•").setTitle("Control").setBlurb("Conditions on a qubit being ON.\nGates in the same column only apply to states meeting the condition.").promiseHasNoNetEffectOnStateVector().markAsControlExpecting(!0).promiseEffectIsUnitary().setDrawer(function(e){(e.isInToolbox||e.isHighlighted)&&(n.paintBackground(e),n.paintOutline(e)),e.painter.fillCircle(e.rect.center(),5,"black")}).gate,c.AntiControl=(new e).setAlternate(c.Control).setSerializedIdAndSymbol("◦").setTitle("Anti-Control").setBlurb("Conditions on a qubit being OFF.\nGates in the same column only apply to states meeting the condition.").promiseHasNoNetEffectOnStateVector().markAsControlExpecting(!1).promiseEffectIsUnitary().setDrawer(function(e){(e.isInToolbox||e.isHighlighted)&&(n.paintBackground(e),n.paintOutline(e));var t=e.rect.center();e.painter.fillCircle(t,5),e.painter.strokeCircle(t,5)}).gate,c.XAntiControl=(new e).setSerializedId("⊕").setSymbol("⊖").setTitle("X-Axis Anti-Control").setBlurb("Conditions on a qubit being ON+OFF.\nGates in the same column only apply to states meeting the condition.").markAsControlExpecting(!1).setSetupCleanupEffectToUpdateFunc(r.H.customOperation,r.H.customOperation).setActualEffectToUpdateFunc(function(){}).promiseEffectIsStable().promiseEffectIsUnitary().setDrawer(function(e){(e.isInToolbox||e.isHighlighted)&&(n.paintBackground(e),n.paintOutline(e));var t=e.rect.center();e.painter.fillCircle(t,5),e.painter.strokeCircle(t,5),e.painter.strokeLine(t.offsetBy(-5,0),t.offsetBy(5,0))}).gate,c.XControl=(new e).setAlternate(c.XAntiControl).setSerializedId("⊖").setSymbol("⊕").setTitle("X-Axis Control").setBlurb("Conditions on a qubit being ON-OFF.\nGates in the same column only apply to states meeting the condition.").markAsControlExpecting(!0).setSetupCleanupEffectToUpdateFunc(r.H.customOperation,r.H.customOperation).setActualEffectToUpdateFunc(function(){}).promiseEffectIsStable().promiseEffectIsUnitary().setDrawer(function(e){(e.isInToolbox||e.isHighlighted)&&(n.paintBackground(e),n.paintOutline(e));var t=e.rect.center();e.painter.fillCircle(t,5),e.painter.strokeCircle(t,5),e.painter.strokeLine(t.offsetBy(0,-5),t.offsetBy(0,5)),e.painter.strokeLine(t.offsetBy(-5,0),t.offsetBy(5,0))}).gate,c.YAntiControl=(new e).setSerializedId("⊗").setSymbol("(/)").setTitle("Y-Axis Anti-Control").setBlurb("Conditions on a qubit being ON+iOFF.\nGates in the same column only apply to states meeting the condition.").markAsControlExpecting(!1).setSetupCleanupEffectToUpdateFunc(function(e){return t.applyMatrixOperation(e,i.SqrtXForward._knownMatrix)},function(e){return t.applyMatrixOperation(e,i.SqrtXBackward._knownMatrix)}).setActualEffectToUpdateFunc(function(){}).promiseEffectIsStable().promiseEffectIsUnitary().setDrawer(function(e){(e.isInToolbox||e.isHighlighted)&&(n.paintBackground(e),n.paintOutline(e));var t=e.rect.center(),r=(e.painter.fillCircle(t,5),e.painter.strokeCircle(t,5),5*Math.sqrt(.5)*1.1);e.painter.strokeLine(t.offsetBy(r,-r),t.offsetBy(-r,r)),(e.isInToolbox||e.isHighlighted)&&n.paintOutline(e)}).gate,c.YControl=(new e).setAlternate(c.YAntiControl).setSerializedId("(/)").setSymbol("⊗").setTitle("Y-Axis Control").setBlurb("Conditions on a qubit being ON-iOFF.\nGates in the same column only apply to states meeting the condition.").markAsControlExpecting(!0).setSetupCleanupEffectToUpdateFunc(function(e){return t.applyMatrixOperation(e,i.SqrtXForward._knownMatrix)},function(e){return t.applyMatrixOperation(e,i.SqrtXBackward._knownMatrix)}).setActualEffectToUpdateFunc(function(){}).promiseEffectIsStable().promiseEffectIsUnitary().setDrawer(function(e){(e.isInToolbox||e.isHighlighted)&&(n.paintBackground(e),n.paintOutline(e));var t=e.rect.center(),r=(e.painter.fillCircle(t,5),e.painter.strokeCircle(t,5),5*Math.sqrt(.5));e.painter.strokeLine(t.offsetBy(r,r),t.offsetBy(-r,-r)),e.painter.strokeLine(t.offsetBy(r,-r),t.offsetBy(-r,r)),(e.isInToolbox||e.isHighlighted)&&n.paintOutline(e)}).gate,o("\n        uniform float parityMask;\n    ","\n        float bitPos = 1.0;\n        float result = 0.5;\n        for (int i = 0; i < "+a.MAX_WIRE_COUNT+"; i++) {\n            float maskBit = mod(floor(parityMask/bitPos), 2.0);\n            float posBit = mod(floor(full_out_id/bitPos), 2.0);\n            float flip = maskBit * posBit;\n            result += flip;\n            bitPos *= 2.0;\n        }\n        return mod(result, 2.0) - 0.5;",1));function m(e,t){var r=e.rawControls,n=2<<e.row>r.parityMask,i=1<<e.row==(r.parityMask&~(r.parityMask-1));(t?n:i)&&e.applyOperation(d.withArgs.apply(d,$traceurRuntime.spread(u(e.withRow(l.ceilLg2(r.parityMask&r.inclusionMask))),[s.float("parityMask",r.parityMask)])))}function f(r){return function(e){(e.isInToolbox||e.isHighlighted)&&(n.paintBackground(e),n.paintOutline(e));var t=e.rect.paddedBy(-10);e.painter.fillRect(t),e.painter.strokeRect(t),e.painter.fillRect(t.paddedBy(-4).skipBottom(-6).skipTop(-6)),e.painter.printLine(r,t,.5,void 0,void 0,void 0,0),e.painter.printLine("par",t,.5,"red",10,void 0,1)}}return c.XParityControl=(new e).setSerializedIdAndSymbol("xpar").setTitle("Parity Control (X)").setBlurb("Includes a qubit's X observable in the column parity control.\nGates in the same column only apply if an odd number of parity controls are satisfied.").setActualEffectToUpdateFunc(function(){}).promiseEffectIsStable().promiseEffectIsUnitary().markAsControlExpecting("parity").setSetupCleanupEffectToUpdateFunc(function(e){r.H.customOperation(e),m(e,!0)},function(e){m(e,!1),r.H.customOperation(e)}).setDrawer(f("X")).gate,c.YParityControl=(new e).setSerializedIdAndSymbol("ypar").setTitle("Parity Control (Y)").setBlurb("Includes a qubit's Y observable in the column parity control.\nGates in the same column only apply if an odd number of parity controls are satisfied.").setActualEffectToUpdateFunc(function(){}).promiseEffectIsStable().promiseEffectIsUnitary().markAsControlExpecting("parity").setSetupCleanupEffectToUpdateFunc(function(e){t.applyMatrixOperation(e,i.SqrtXForward._knownMatrix),m(e,!0)},function(e){m(e,!1),t.applyMatrixOperation(e,i.SqrtXBackward._knownMatrix)}).setDrawer(f("Y")).gate,c.ZParityControl=(new e).setSerializedIdAndSymbol("zpar").setTitle("Parity Control (Z)").setBlurb("Includes a qubit's Z observable in the column parity control.\nGates in the same column only apply if an odd number of parity controls are satisfied.").promiseHasNoNetEffectOnStateVector().markAsControlExpecting("parity").setSetupCleanupEffectToUpdateFunc(function(e){return m(e,!0)},function(e){return m(e,!1)}).setActualEffectToUpdateFunc(function(){}).promiseEffectIsUnitary().setDrawer(f("Z")).gate,c.all=[c.Control,c.AntiControl,c.XAntiControl,c.XControl,c.YAntiControl,c.YControl,c.XParityControl,c.YParityControl,c.ZParityControl],{get Controls(){return c}}}),$traceurRuntime.registerModule("src/gates/CountingGates.js",[],function(){"use strict";function p(e){e=Math.min(128,e);for(var t=[],r=0;r<e;r++){var n=r/e,i=r/(e-1);e<128&&t.push(new b(n,i)),t.push(new b(n+1/e,i))}return t}function t(f,h){var g=void 0!==arguments[2]&&arguments[2];return function(e){var t,r;if(y.MAKE_HIGHLIGHTED_DRAWER(v.TIME_DEPENDENT_HIGHLIGHT_COLOR)(e),!e.isInToolbox||e.isHighlighted){var n=(e.stats.time+f)%1,i=e.rect.y+3,a=e.rect.bottom(),o=e.rect.bottom()-3,u=(g||(i=(r=(t=[o,i][Symbol.iterator]()).next()).done?void 0:r.value,o=(r=t.next()).done?void 0:r.value,a=e.rect.y),e.rect.x),s=e.rect.right(),l=function(e){return Math.min(Math.max(u+(s-u)*e,u),s)},c=function(e){return o+(i-o)*e},d=[];d.push(new b(u,a)),d.push.apply(d,$traceurRuntime.spread(p(h).map(function(e){return new b(l(e.x-n),c(e.y))}))),d.push.apply(d,$traceurRuntime.spread(p(h).map(function(e){return new b(l(e.x+1-n),c(e.y))}))),d.push(new b(s,a)),e.painter.ctx.save(),e.painter.ctx.globalAlpha*=.3,e.painter.fillPolygon(d,"yellow");for(var m=1;m<d.length-2;m++)e.painter.strokeLine(d[m],d[m+1],"black");2===h&&n<.5&&(e.painter.fillRect(e.rect,"white"),e.painter.fillRect(e.rect,"white"),e.painter.fillRect(e.rect,"white")),e.painter.ctx.restore()}}}var v=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/gates/CountingGates.js")).Config,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/CountingGates.js")),r=e.Gate,e=e.GateBuilder,y=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GatePainting.js","src/gates/CountingGates.js")).GatePainting,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/gates/CountingGates.js")).Matrix,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Point.js","src/gates/CountingGates.js")).Point,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/KetShaderUtil.js","src/gates/CountingGates.js")).ketArgs,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglArg.js","src/gates/CountingGates.js")).WglArg,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./IncrementGates.js","src/gates/CountingGates.js")).offsetShader,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./CycleBitsGates.js","src/gates/CountingGates.js")),s=u.makeCycleBitsPermutation,l=u.cycleBitsShader,c={};function d(e,t,r,n){return n+Math.floor(e*(1<<r))*t&(1<<r)-1}function m(e,t,r,n){e=Math.floor(e*r)*t;return s(e,r)(n)}return c.ClockPulseGate=(new e).setSerializedIdAndSymbol("X^⌈t⌉").setTitle("Clock Pulse Gate").setBlurb("Xors a square wave into the target wire.").setDrawer(t(0,2)).setEffectToTimeVaryingMatrix(function(e){return e%1<.5?n.identity(2):n.PAULI_X}).promiseEffectOnlyPermutesAndPhases().gate,c.QuarterPhaseClockPulseGate=(new e).setSerializedIdAndSymbol("X^⌈t-¼⌉").setTitle("Clock Pulse Gate (Quarter Phase)").setBlurb("Xors a quarter-phased square wave into the target wire.").setDrawer(t(.75,2)).setEffectToTimeVaryingMatrix(function(e){return(e+.75)%1<.5?n.identity(2):n.PAULI_X}).promiseEffectOnlyPermutesAndPhases().gate,c.CountingFamily=r.buildFamily(1,16,function(r,e){return e.setSerializedId("Counting"+r).setSymbol("+⌈t⌉").setTitle("Counting Gate").setBlurb("Adds an increasing little-endian count into a block of qubits.").setDrawer(t(0,1<<r)).setActualEffectToShaderProvider(function(e){return o.withArgs.apply(o,$traceurRuntime.spread(i(e,r),[a.float("amount",Math.floor(e.time*(1<<r)))]))}).setKnownEffectToTimeVaryingPermutation(function(e,t){return d(e,1,r,t)})}),c.UncountingFamily=r.buildFamily(1,16,function(r,e){return e.setAlternateFromFamily(c.CountingFamily).setSerializedId("Uncounting"+r).setSymbol("-⌈t⌉").setTitle("Down Counting Gate").setBlurb("Subtracts an increasing little-endian count from a block of qubits.").setDrawer(t(0,1<<r,!0)).setActualEffectToShaderProvider(function(e){return o.withArgs.apply(o,$traceurRuntime.spread(i(e,r),[a.float("amount",-Math.floor(e.time*(1<<r)))]))}).setKnownEffectToTimeVaryingPermutation(function(e,t){return d(e,-1,r,t)})}),c.RightShiftRotatingFamily=r.buildFamily(2,16,function(r,e){return e.setSerializedId(">>t"+r).setSymbol("↟⌈t⌉").setTitle("Right-Shift Cycling Gate").setBlurb("Right-rotates a block of bits by more and more.").setDrawer(t(0,r,!0)).setActualEffectToShaderProvider(function(e){return l(e,r,-Math.floor(e.time*r))}).setKnownEffectToTimeVaryingPermutation(function(e,t){return m(e,-1,r,t)})}),c.LeftShiftRotatingFamily=r.buildFamily(2,16,function(r,e){return e.setSerializedId("<<t"+r).setSymbol("↡⌈t⌉").setTitle("Left-Shift Cycling Gate").setBlurb("Left-rotates a block of bits by more and more.").setDrawer(t(0,r)).setActualEffectToShaderProvider(function(e){return l(e,r,Math.floor(e.time*r))}).setKnownEffectToTimeVaryingPermutation(function(e,t){return m(e,1,r,t)})}),c.all=$traceurRuntime.spread([c.ClockPulseGate,c.QuarterPhaseClockPulseGate],c.CountingFamily.all,c.UncountingFamily.all,c.RightShiftRotatingFamily.all,c.LeftShiftRotatingFamily.all),{get CountingGates(){return c}}}),$traceurRuntime.registerModule("src/gates/CycleBitsGates.js",[],function(){"use strict";function r(e,t,r){return h.withArgs.apply(h,$traceurRuntime.spread(o(e,t),[m.float("amount",1<<s.properMod(-r,t))]))}function n(t,r){return function(e){return e<<(t=s.properMod(t,r))&(1<<r)-1|e>>r-t}}function i(e,t){return u.generateTransition(1<<t,n(e,t))}function a(s){return function(e){if(void 0!==e.positionInCircuit)c.PERMUTATION_DRAWER(e);else{c.paintBackground(e),c.paintOutline(e),c.paintResizeTab(e);for(var t=e.rect.x+6,r=e.rect.right()-6,n=e.rect.center().y-l.GATE_RADIUS+6,i=2*(l.GATE_RADIUS-6)/2,a=0;a<3;a++){var o=n+a*i,u=n+(a+(s?2:1))%3*i;e.painter.strokePath([new d(t,o),new d(t+8,o),new d(r-8,u),new d(r,u)])}}}}var l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/gates/CycleBitsGates.js")).Config,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/CycleBitsGates.js")).Gate,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GatePainting.js","src/gates/CycleBitsGates.js")).GatePainting,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/KetShaderUtil.js","src/gates/CycleBitsGates.js")),o=t.ketArgs,t=t.ketShaderPermute,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/gates/CycleBitsGates.js")).Matrix,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Point.js","src/gates/CycleBitsGates.js")).Point,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/gates/CycleBitsGates.js")).Util,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglArg.js","src/gates/CycleBitsGates.js")).WglArg,f=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglConfiguredShader.js","src/gates/CycleBitsGates.js")).WglConfiguredShader,{}),h=t("uniform float amount;","out_id *= amount; return mod(out_id, span) + floor(out_id / span);");return f.CycleBitsFamily=e.buildFamily(2,16,function(t,e){return e.setSerializedId("<<"+t).setSymbol("<<<").setTitle("Left Rotate").setBlurb("Rotates bits downward.").setDrawer(a(!1)).setTooltipMatrixFunc(function(){return i(1,t)}).setActualEffectToShaderProvider(function(e){return r(e,t,1)}).setKnownEffectToBitPermutation(function(e){return(e+1)%t})}),f.ReverseCycleBitsFamily=e.buildFamily(2,16,function(t,e){return e.setAlternateFromFamily(f.CycleBitsFamily).setSerializedId(">>"+t).setSymbol(">>>").setTitle("Right Rotate").setBlurb("Rotates bits upward.").setDrawer(a(!0)).setTooltipMatrixFunc(function(){return i(-1,t)}).setActualEffectToShaderProvider(function(e){return r(e,t,-1)}).setKnownEffectToBitPermutation(function(e){return(e+t-1)%t})}),f.all=$traceurRuntime.spread(f.CycleBitsFamily.all,f.ReverseCycleBitsFamily.all),{get CycleBitsGates(){return f},get cycleBitsShader(){return r},get makeCycleBitsPermutation(){return n}}}),$traceurRuntime.registerModule("src/gates/Debug_ErrorInjectionGate.js",[],function(){"use strict";var t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/DetailedError.js","src/gates/Debug_ErrorInjectionGate.js")).DetailedError,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/Debug_ErrorInjectionGate.js")).GateBuilder,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GatePainting.js","src/gates/Debug_ErrorInjectionGate.js")).GatePainting,n=(new e).setSerializedId("__error__").setSymbol("ERR!").setTitle("Error Injection Gate").setBlurb("Throws an exception during circuit stat computations, for testing error paths.").setDrawer(r.MAKE_HIGHLIGHTED_DRAWER("red","red")).setActualEffectToUpdateFunc(function(e){throw new t("Applied an Error Injection Gate",{qubit:e.row})}).promiseEffectIsStable().gate;return{get ErrorInjectionGate(){return n}}}),$traceurRuntime.registerModule("src/gates/DensityMatrixDisplay.js",[],function(){"use strict";var c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/CircuitShaders.js","src/gates/DensityMatrixDisplay.js")).CircuitShaders,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/DensityMatrixDisplay.js")),t=e.Gate,r=(e.GateBuilder,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GatePainting.js","src/gates/DensityMatrixDisplay.js")).GatePainting),d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/GateShaders.js","src/gates/DensityMatrixDisplay.js")).GateShaders,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/MathPainter.js","src/gates/DensityMatrixDisplay.js")).MathPainter,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/gates/DensityMatrixDisplay.js")).Matrix,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/Shaders.js","src/gates/DensityMatrixDisplay.js")).Shaders,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/gates/DensityMatrixDisplay.js")).Util,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglArg.js","src/gates/DensityMatrixDisplay.js")).WglArg,e=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglConfiguredShader.js","src/gates/DensityMatrixDisplay.js")).WglConfiguredShader,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/ShaderCoders.js","src/gates/DensityMatrixDisplay.js"))),a=e.Inputs,o=e.Outputs,h=e.currentShaderCoder,e=e.makePseudoShaderWithInputsAndOutputAndCode,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglTexturePool.js","src/gates/DensityMatrixDisplay.js")).WglTexturePool,p=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglTextureTrader.js","src/gates/DensityMatrixDisplay.js")).WglTextureTrader;var v=function(e,t){return u(e,i.float("qubitSpan",1<<t))},u=e([a.vec2("input")],o.vec2(),"\n    uniform float qubitSpan;\n\n    vec2 outputFor(float k) {\n        float k_ket = mod(k, qubitSpan);\n        float k_bra = mod(floor(k / qubitSpan), qubitSpan);\n        float k_rest = floor(k / qubitSpan / qubitSpan);\n        float offset = k_rest*qubitSpan;\n\n        vec2 ampKet = read_input(k_ket + offset);\n        vec2 ampBra = read_input(k_bra + offset);\n        float r = dot(ampKet, ampBra);\n        float i = dot(ampKet, vec2(-ampBra.y, ampBra.x));\n\n        return vec2(r, i);\n    }");function s(e,t,r,n){for(var i=e.length>>1,a=Math.round(Math.sqrt(i)),o=0,u=0;u<a;u++)o+=e[2*u*(a+1)];if(isNaN(o)||o<1e-6)return l.zero(a,a).times(NaN);for(var s=0;s<e.length;s++)e[s]/=o;i=t.colIsMeasuredMask(r)>>n;return function(e,t){if(0===t)return e;for(var r=new Float32Array(e.rawBuffer()),n=e.width(),i=0;i<n;i++)for(var a,o=0;o<n;o++)0!=((i^o)&t)&&(r[a=2*(i*n+o)]=0,r[1+a]=0);return new l(n,n,r)}(new l(a,a,e),i).transpose()}function y(e){return e.setSymbol("Density").setTitle("Density Matrix Display").setBlurb("Shows the density matrix of the local mixed state of some wires.\nUse controls to see conditional states.").promiseHasNoNetEffectOnStateVector().setExtraDisableReasonFinder(function(e){return e.isNested?"can't\nnest\ndisplays\n(sorry)":void 0})}function b(l,e){return y(e).setSerializedId("Density"+l).setWidth(l).setDrawer(R).setProcessedStatsToJsonFunc(function(e){return{density_matrix:e.toReadableJson()}}).setStatTexturesMaker(function(e){var t=e.stateTrader.currentTexture,r=e.wireCount,n=e.controls,i=e.row,a=l,o=new p(t),t=(o.dontDeallocCurrentTexture(),h().vec2.arrayPowerSizeOfTexture(t)),e=f.numberOfSetBits(n.inclusionMask),u=f.numberOfSetBits(n.inclusionMask&(1<<i)-1),s=(o.shadeAndTrade(function(e){return c.controlSelect(n,e)},g.takeVec2Tex(t-e)),o.shadeAndTrade(function(e){return d.cycleAllBits(e,u-i)}),r-e+a);for(o.shadeAndTrade(function(e){return v(e,a)},g.takeVec2Tex(s));2*a<s;)s--,o.shadeHalveAndTrade(m.sumFoldVec2);return h().vec2.needRearrangingToBeInVec4Format&&o.shadeHalveAndTrade(m.packVec2IntoVec4),o.currentTexture}).setStatPixelDataPostProcessor(s)}var R=r.makeDisplayDrawer(function(e){var t=e.gate.height,t=e.customStats||l.zero(1<<t,1<<t).times(NaN);n.paintDensityMatrix(e.painter,t,e.rect,e.focusPoints)}),w=t.buildFamily(1,8,function(e,t){return 1===e?y(t).setSerializedId("Density").markAsDrawerNeedsSingleQubitDensityStats().setDrawer(r.makeDisplayDrawer(function(e){var t=e.positionInCircuit,r=t.col,t=t.row,r=e.stats.qubitDensityMatrix(r,t).transpose();n.paintDensityMatrix(e.painter,r,e.rect,e.focusPoints)})):b(e,t)});return{get DensityMatrixDisplayFamily(){return w},get amplitudesToCouplings(){return v}}}),$traceurRuntime.registerModule("src/gates/Detector.js",[],function(){"use strict";var t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/Detector.js")).GateBuilder,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../gates/ProbabilityDisplay.js","src/gates/Detector.js")).amplitudesToProbabilities,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglTexturePool.js","src/gates/Detector.js")).WglTexturePool,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglTextureTrader.js","src/gates/Detector.js")).WglTextureTrader,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/Shaders.js","src/gates/Detector.js")).Shaders,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/ShaderCoders.js","src/gates/Detector.js")),l=e.currentShaderCoder,e=e.Inputs,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/CircuitShaders.js","src/gates/Detector.js")).CircuitShaders,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Controls.js","src/gates/Detector.js")).Controls,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglArg.js","src/gates/Detector.js")).WglArg,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/gates/Detector.js")).Config,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GatePainting.js","src/gates/Detector.js")).GatePainting,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/ShaderCoders.js","src/gates/Detector.js")),f=i.makePseudoShaderWithInputsAndOutputAndCode,i=i.Outputs,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/gates/Detector.js")).Matrix,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/GateShaders.js","src/gates/Detector.js")).GateShaders,w=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Point.js","src/gates/Detector.js")).Point,M=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/DetailedError.js","src/gates/Detector.js")).DetailedError,p=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./QuarterTurnGates.js","src/gates/Detector.js")).QuarterTurnGates,v=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./HalfTurnGates.js","src/gates/Detector.js")).HalfTurnGates;function y(e,t){e=l().vec2.arrayPowerSizeOfTexture(e.stateTrader.currentTexture);return r.controlMask(t).toBoolTexture(e)}function b(e,t){for(var r=l().vec2.arrayPowerSizeOfTexture(e),n=new u(e),i=(n.dontDeallocCurrentTexture(),n.shadeAndTrade(function(e){return a(e,t)},o.takeVecFloatTex(r)),l().vec2.arrayPowerSizeOfTexture(e));0<i;)--i,n.shadeHalveAndTrade(s.sumFoldFloat);return n.shadeAndTrade(s.packFloatIntoVec4,o.takeVec4Tex(0)),n.currentTexture}function R(e){var t=y(e,e.controls.and(c.bit(e.row,!0)));try{return b(e.stateTrader.currentTexture,t,!0)}finally{t.deallocByDepositingInPool("textureWithTotalWeightMatchingPositiveMeasurement:mask")}}var _=f([e.float("total_weight"),e.float("detection_weight"),e.bool("classification"),e.vec2("ket")],i.vec2(),"\n        uniform float rnd;\n    \n        vec2 outputFor(float k) {\n            float detectChance = read_detection_weight(0.0) / read_total_weight(0.0);\n            float detection_type = float(rnd < detectChance);\n            float own_type = read_classification(k);\n            if (detection_type == own_type) {\n                float matchChance = detectChance * own_type + (1.0 - own_type) * (1.0 - detectChance);\n                return read_ket(k) / sqrt(matchChance);\n            } else {\n                return vec2(0.0, 0.0);\n            }\n        }\n    ");function x(e,t,r){switch(t){case"X":g.applyMatrixOperation(e,v.H.knownMatrixAt(0));break;case"Y":r?g.applyMatrixOperation(e,p.SqrtXBackward.knownMatrixAt(0)):g.applyMatrixOperation(e,p.SqrtXForward.knownMatrixAt(0));break;case"Z":break;default:throw new M("Unrecognized axis.",{axis:t})}}function S(e){var t=y(e,c.NONE),r=y(e,e.controls.and(c.bit(e.row,!0))),n=b(e.stateTrader.currentTexture,t),i=b(e.stateTrader.currentTexture,r);e.applyOperation(_(n,i,r,e.stateTrader.currentTexture,d.float("rnd",Math.random()))),i.deallocByDepositingInPool(),n.deallocByDepositingInPool(),r.deallocByDepositingInPool(),t.deallocByDepositingInPool()}function T(e){(e.isHighlighted||e.isInToolbox)&&(e.painter.fillRect(e.rect,e.isHighlighted?m.HIGHLIGHTED_GATE_FILL_COLOR:m.GATE_FILL_COLOR),n.paintOutline(e))}function A(e,t){var r=2*Math.PI,n=Math.min(e.rect.h/2,e.rect.w)-1,i=e.rect.center(),a=i.x,o=i.y,a=a-.5*n+.5;o+=.5,e.painter.trace(function(e){e.ctx.arc(a,o,n,3*r/4,r/4),e.ctx.lineTo(a,o-n-1)}).thenStroke("black",2).thenFill(m.TIME_DEPENDENT_HIGHLIGHT_COLOR),e.painter.printLine(t,e.rect,.5,void 0,void 0,void 0,.5)}function C(e,t){var r;e.customStats&&(r=Math.min(e.rect.h/2,e.rect.w),e.painter.ctx.save(),e.painter.ctx.translate(e.rect.center().x,e.rect.center().y),e.painter.ctx.rotate(void 0===t?Math.PI/3:Math.PI/4),e.painter.ctx.strokeStyle="white",e.painter.ctx.lineWidth=3,e.painter.print("*click*",0,void 0===t?0:-5,"center","middle","black","bold 16px sans-serif",2.8*r,2.8*r,void 0,!0),void 0!==t&&e.painter.print(t,0,10,"center","middle","black","bold 16px sans-serif",2.8*r,2.8*r,void 0,!0),e.painter.ctx.restore())}function E(e,t){var r=e;if(void 0!==r.positionInCircuit&&!r.isHighlighted){var n=r.painter,i=r.positionInCircuit.col,a=Math.round(r.rect.center().x-.5)+.5,o=r.stats.circuitDefinition,u=(o.columns[i].hasGatesWithGlobalEffects()&&(n.ctx.save(),n.ctx.setLineDash([1,4]),n.strokeLine(new w(a,r.rect.y),new w(a,r.rect.bottom())),n.ctx.restore()),r.positionInCircuit.row),s=!0,l=!1,c=void 0;try{for(var d=void 0,m=o.controlLinesRanges(i)[Symbol.iterator]();!(s=(d=m.next()).done);s=!0){var f,h,g=d.value,p=g.first,v=g.last,y=g.measured;p<=u&&u<=v&&(f=(p===u?r.rect.center():r.rect).y,h=v===u?r.rect.center().y:r.rect.bottom(),y?(n.strokeLine(new w(a+1,f),new w(a+1,h)),n.strokeLine(new w(a-1,f),new w(a-1,h))):n.strokeLine(new w(a,f),new w(a,h)))}}catch(e){l=!0,c=e}finally{try{s||null==m.return||m.return()}finally{if(l)throw c}}}var b=e.rect.center();switch(t){case"X":e.painter.fillCircle(b,5),e.painter.strokeCircle(b,5),e.painter.strokeLine(b.offsetBy(0,-5),b.offsetBy(0,5)),e.painter.strokeLine(b.offsetBy(-5,0),b.offsetBy(5,0));break;case"Y":e.painter.fillCircle(b,5),e.painter.strokeCircle(b,5);var R=5*Math.sqrt(.5)*1.1;e.painter.strokeLine(b.offsetBy(R,-R),b.offsetBy(-R,R)),e.painter.strokeLine(b.offsetBy(-R,-R),b.offsetBy(R,R));break;case"Z":e.painter.fillCircle(b,5,"black");break;default:throw new M("Unrecognized axis.",{axis:t})}}function I(n){return function(e){var t=e.controls,r=e.controlsTexture;try{return e.controls=c.NONE,e.controlsTexture=y(e,e.controls),n(e)}finally{e.controlsTexture.deallocByDepositingInPool("withClearedControls"),e.controlsTexture=r,e.controls=t}}}function j(o){var e=(new t).setSerializedIdAndSymbol(o+"DetectControlReset").setTitle(o+" Detect-Control-Reset").setBlurb("Does a sampled "+o+"-axis measurement.\nControls operations with the result.\nResets the target to |0⟩.").setDrawer(function(e){return t=o,r=(e=e).rect,n=r.leftHalf(),i=r.rightHalf(),(a=r.rightHalf()).y+=a.h/2-2,a.h=5,e.painter.fillRect(a,"white"),T(e),e.painter.printLine("|0⟩",i,1,void 0,void 0,void 0,.5),e.rect=n,A(e,t),e.rect=r,E(e,t),e.rect=n,C(e,void 0),void(e.rect=r);var t,r,n,i,a}).markAsControlExpecting(!0,!0).markAsReachingOtherWires().setActualEffectToUpdateFunc(function(){}).setStatTexturesMaker(I(R)).setSetupCleanupEffectToUpdateFunc(I(function(e){x(e,o,!1),S(e)}),I(function(e){g.applyMatrixOperation(e,h.square(1,1,0,0))})).setStatPixelDataPostProcessor(function(e,t,r,n){return 0<e[0]});return"Z"===o&&e.promiseEffectIsDiagonal(),e.gate}function $(r){var e=new Map([["X","|0⟩-|1⟩"],["Y","|0⟩-i|1⟩"],["Z","|1⟩"]]).get(r),e=(new t).setSerializedIdAndSymbol(r+"Detector").setTitle(r+" Axis Detector").setBlurb("Sampled "+r+"-axis measurement.\nShows *click* when the target qubit is "+e+" and controls are satisfied.").setDrawer(function(e){return t=r,T(e=e),A(e,t),void C(e,t);var t}).markAsReachingOtherWires().setSetupCleanupEffectToUpdateFunc(function(e){return x(e,r,!1)},function(e){return x(e,r,!0)}).setActualEffectToUpdateFunc(S).setStatTexturesMaker(R).setStatPixelDataPostProcessor(function(e,t,r,n){return 0<e[0]});return"Z"===r&&e.promiseEffectIsDiagonal(),e.gate}var P={};return P.XDetector=$("X"),P.YDetector=$("Y"),P.ZDetector=$("Z"),P.XDetectControlClear=j("X"),P.YDetectControlClear=j("Y"),P.ZDetectControlClear=j("Z"),P.all=[P.XDetector,P.YDetector,P.ZDetector,P.XDetectControlClear,P.YDetectControlClear,P.ZDetectControlClear],{get Detectors(){return P}}}),$traceurRuntime.registerModule("src/gates/ExponentiatingGates.js",[],function(){"use strict";function t(e){var t=Math.cos(u*e),e=Math.sin(u*e);return new a(2,2,new Float32Array([t,0,0,-e,0,-e,t,0]))}function r(e){var t=Math.cos(u*e),e=Math.sin(u*e);return new a(2,2,new Float32Array([t,0,-e,0,e,0,t,0]))}function n(e){var t=Math.cos(u*e),e=Math.sin(u*e);return new a(2,2,new Float32Array([t,-e,0,0,0,0,t,e]))}var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/ExponentiatingGates.js")).GateBuilder,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GatePainting.js","src/gates/ExponentiatingGates.js")).GatePainting,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/gates/ExponentiatingGates.js")).Matrix,o={},u=2*Math.PI;return o.XForward=(new e).setSerializedIdAndSymbol("e^-iXt").setTitle("X-Exponentiating Gate (forward)").setBlurb("Right-hand rotation around the X axis.\nPasses through ±iX instead of X.").setDrawer(i.makeCycleDrawer(1,1,2)).setEffectToTimeVaryingMatrix(t).promiseEffectIsUnitary().gate,o.XBackward=(new e).setAlternate(o.XForward).setSerializedIdAndSymbol("e^iXt").setTitle("X-Exponentiating Gate (backward)").setBlurb("Left-hand rotation around the X axis.\nPasses through ±iX instead of X.").setDrawer(i.makeCycleDrawer(-1,1,2)).setEffectToTimeVaryingMatrix(function(e){return t(-e)}).promiseEffectIsUnitary().gate,o.YForward=(new e).setSerializedIdAndSymbol("e^-iYt").setTitle("Y-Exponentiating Gate (forward)").setBlurb("Right-hand rotation around the Y axis.\nPasses through ±iY instead of Y.").setDrawer(i.makeCycleDrawer(.5,1,2)).setEffectToTimeVaryingMatrix(r).promiseEffectIsUnitary().gate,o.YBackward=(new e).setAlternate(o.YForward).setSerializedIdAndSymbol("e^iYt").setTitle("Y-Exponentiating Gate (backward)").setBlurb("Left-hand rotation around the Y axis.\nPasses through ±iY instead of Y.").setDrawer(i.makeCycleDrawer(-.5,1,2)).setEffectToTimeVaryingMatrix(function(e){return r(-e)}).promiseEffectIsUnitary().gate,o.ZForward=(new e).setSerializedIdAndSymbol("e^-iZt").setTitle("Z-Exponentiating Gate (forward)").setBlurb("Right-hand rotation around the Z axis.\nPasses through ±iZ instead of Z.").setDrawer(i.makeCycleDrawer(-1,-.5,2)).setEffectToTimeVaryingMatrix(n).promiseEffectOnlyPhases().gate,o.ZBackward=(new e).setAlternate(o.ZForward).setSerializedIdAndSymbol("e^iZt").setTitle("Z-Exponentiating Gate (backward)").setBlurb("Left-hand rotation around the Z axis.\nPasses through ±iZ instead of Z.").setDrawer(i.makeCycleDrawer(1,-.5,2)).setEffectToTimeVaryingMatrix(function(e){return n(-e)}).promiseEffectOnlyPhases().gate,o.all=[o.XBackward,o.YBackward,o.ZBackward,o.XForward,o.YForward,o.ZForward],{get ExponentiatingGates(){return o},get XExp(){return t},get YExp(){return r},get ZExp(){return n}}}),$traceurRuntime.registerModule("src/gates/FourierTransformGates.js",[],function(){"use strict";var n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Complex.js","src/gates/FourierTransformGates.js")).Complex,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/FourierTransformGates.js")).Gate,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/KetShaderUtil.js","src/gates/FourierTransformGates.js")),i=t.ketArgs,t=t.ketShaderPhase,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/gates/FourierTransformGates.js")).Matrix,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./HalfTurnGates.js","src/gates/FourierTransformGates.js")).HalfTurnGates,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ReverseBitsGate.js","src/gates/FourierTransformGates.js")).reverseShaderForSize,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglArg.js","src/gates/FourierTransformGates.js")).WglArg;function l(e,t){var r=void 0!==arguments[2]?arguments[2]:1;e.applyOperation(c.withArgs.apply(c,$traceurRuntime.spread(i(e,t),[s.float("factor",r)])))}function r(r){return a.generate(1<<r,1<<r,function(e,t){return n.polar(Math.pow(.5,r/2),2*Math.PI*e*t/(1<<r))})}var c=t("uniform float factor;","\n        float hold = floor(out_id * 2.0 / span);\n        float step = mod(out_id, span / 2.0);\n        return hold * step * factor * 6.2831853071795864769 / span;\n    "),d={};return d.FourierTransformFamily=e.buildFamily(1,16,function(i,e){return e.setSerializedId("QFT"+i).setSymbol("QFT").setTitle("Fourier Transform Gate").setBlurb("Transforms to/from phase frequency space.").setActualEffectToUpdateFunc(function(e){var t=e,r=i;1<r&&t.applyOperation(u(r));for(var n=0;n<r;n++)0<n&&l(t,n+1,1),o.H.customOperation(t.withRow(t.row+n))}).promiseEffectIsUnitary().setTooltipMatrixFunc(function(){return r(i)})}),d.InverseFourierTransformFamily=e.buildFamily(1,16,function(n,e){return e.setSerializedId("QFT†"+n).setSymbol("QFT^†").setAlternateFromFamily(d.FourierTransformFamily).setTitle("Inverse Fourier Transform Gate").setBlurb("Transforms from/to phase frequency space.").setActualEffectToUpdateFunc(function(e){for(var t=e,e=n,r=e-1;0<=r;r--)o.H.customOperation(t.withRow(t.row+r)),0<r&&l(t,r+1,-1);1<e&&t.applyOperation(u(e))}).promiseEffectIsUnitary().setTooltipMatrixFunc(function(){return r(n).adjoint()})}),d.all=$traceurRuntime.spread(d.FourierTransformFamily.all,d.InverseFourierTransformFamily.all),{get applyControlledPhaseGradient(){return l},get FourierTransformGates(){return d}}}),$traceurRuntime.registerModule("src/gates/HalfTurnGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/HalfTurnGates.js")),e=(e.Gate,e.GateBuilder),i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GatePainting.js","src/gates/HalfTurnGates.js")).GatePainting,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/gates/HalfTurnGates.js")).Matrix,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Point.js","src/gates/HalfTurnGates.js")).Point,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/KetShaderUtil.js","src/gates/HalfTurnGates.js")),n=r.ketArgs,o=r.ketShader,r=r.ketShaderPermute,u={};var s=r("","return 1.0-out_id;",1),l=(u.X=(new e).setSerializedIdAndSymbol("X").setTitle("Pauli X Gate").setBlurb("The NOT gate.\nToggles between ON and OFF.").setDrawer(function(e){var t,r,n;e.isHighlighted?i.DEFAULT_DRAWER(e):(void 0===e.positionInCircuit&&(i.paintBackground(e),i.paintOutline(e)),t=e.rect.scaledOutwardBy(.6),e.painter.fillCircle(t.center(),t.w/2),e.painter.strokeCircle(t.center(),t.w/2),r=void 0!==e.positionInCircuit&&e.stats.circuitDefinition.colHasSingleWireControl(e.positionInCircuit.col),n=void 0!==e.positionInCircuit&&e.stats.circuitDefinition.colHasDoubleWireControl(e.positionInCircuit.col),!r&&n||e.painter.strokeLine(t.topCenter(),t.bottomCenter()),n&&(e.painter.strokeLine(t.topCenter().offsetBy(-1,0),t.bottomCenter().offsetBy(-1,0)),e.painter.strokeLine(t.topCenter().offsetBy(1,0),t.bottomCenter().offsetBy(1,0))),void 0!==e.positionInCircuit&&e.stats.circuitDefinition.locIsMeasured(new a(e.positionInCircuit.col,e.positionInCircuit.row))?(e.painter.strokeLine(t.centerLeft().offsetBy(0,-1),t.centerRight().offsetBy(0,-1)),e.painter.strokeLine(t.centerLeft().offsetBy(0,1),t.centerRight().offsetBy(0,1))):e.painter.strokeLine(t.centerLeft(),t.centerRight()))}).setActualEffectToShaderProvider(function(e){return s.withArgs.apply(s,$traceurRuntime.spread(n(e)))}).setKnownEffectToMatrix(t.PAULI_X).gate,o("","vec2 v = inp(1.0-out_id); return (out_id*2.0 - 1.0)*vec2(-v.y, v.x);",1)),c=(u.Y=(new e).setSerializedIdAndSymbol("Y").setTitle("Pauli Y Gate").setBlurb("A combination of the X and Z gates.").setActualEffectToShaderProvider(function(e){return l.withArgs.apply(l,$traceurRuntime.spread(n(e)))}).setKnownEffectToMatrix(t.PAULI_Y).gate,o("","return amp*(1.0 - out_id*2.0);",1)),d=(u.Z=(new e).setSerializedIdAndSymbol("Z").setTitle("Pauli Z Gate").setBlurb("The phase flip gate.\nNegates phases when the qubit is ON.").setActualEffectToShaderProvider(function(e){return c.withArgs.apply(c,$traceurRuntime.spread(n(e)))}).setKnownEffectToMatrix(t.PAULI_Z).gate,o("","return 0.7071067811865476*(amp*(1.0-2.0*out_id) + inp(1.0-out_id));",1));return u.H=(new e).setSerializedIdAndSymbol("H").setTitle("Hadamard Gate").setBlurb("Creates simple superpositions.\nMaps ON to ON + OFF.\nMaps OFF to ON - OFF.").setActualEffectToShaderProvider(function(e){return d.withArgs.apply(d,$traceurRuntime.spread(n(e)))}).setKnownEffectToMatrix(t.HADAMARD).gate,u.all=[u.X,u.Y,u.Z,u.H],{get HalfTurnGates(){return u}}}),$traceurRuntime.registerModule("src/gates/Impossible_UniversalNotGate.js",[],function(){"use strict";function e(e){return i.withArgs.apply(i,$traceurRuntime.spread(n(e)))}var t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/Impossible_UniversalNotGate.js")).GateBuilder,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/KetShaderUtil.js","src/gates/Impossible_UniversalNotGate.js")),n=r.ketArgs,r=r.ketShader,i=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglConfiguredShader.js","src/gates/Impossible_UniversalNotGate.js")).WglConfiguredShader,r("","vec2 other = inp(1.0 - out_id); return vec2(other.x, -other.y) * (1.0 - 2.0 * out_id);",1)),a=(new t).setSerializedId("__unstable__UniversalNot").setSymbol("UniNot").setTitle("Universal Not Gate").setBlurb("Mirrors through the origin of the Bloch sphere.\nImpossible in practice.").setActualEffectToShaderProvider(e).promiseEffectIsStable().gate;return{get universalNot(){return e},get UniversalNotGate(){return a}}}),$traceurRuntime.registerModule("src/gates/IncrementGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/IncrementGates.js")).Gate,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit//KetShaderUtil.js","src/gates/IncrementGates.js")),r=t.ketArgs,t=t.ketShaderPermute,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglArg.js","src/gates/IncrementGates.js")).WglArg,i={},a=t("uniform float amount;","return mod(out_id - amount + span, span);");return i.IncrementFamily=e.buildFamily(1,16,function(t,e){return e.setSerializedId("inc"+t).setSymbol("+1").setTitle("Increment Gate").setBlurb("Adds 1 to the little-endian number represented by a block of qubits.").setActualEffectToShaderProvider(function(e){return a.withArgs.apply(a,$traceurRuntime.spread(r(e,t),[n.float("amount",1)]))}).setKnownEffectToPermutation(function(e){return e+1&(1<<t)-1})}),i.DecrementFamily=e.buildFamily(1,16,function(t,e){return e.setAlternateFromFamily(i.IncrementFamily).setSerializedId("dec"+t).setSymbol("−1").setTitle("Decrement Gate").setBlurb("Subtracts 1 from the little-endian number represented by a block of qubits.").setActualEffectToShaderProvider(function(e){return a.withArgs.apply(a,$traceurRuntime.spread(r(e,t),[n.float("amount",-1)]))}).setKnownEffectToPermutation(function(e){return e-1&(1<<t)-1})}),i.all=$traceurRuntime.spread(i.IncrementFamily.all,i.DecrementFamily.all),{get IncrementGates(){return i},get offsetShader(){return a}}}),$traceurRuntime.registerModule("src/gates/InputGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/InputGates.js")),t=e.Gate,r=e.GateBuilder,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GatePainting.js","src/gates/InputGates.js")).GatePainting,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ReverseBitsGate.js","src/gates/InputGates.js")).reverseShaderForSize,i={};function a(a,o){return t.buildFamily(1,16,function(t,e){return e.setSerializedId((o?"rev":"")+"input"+a+t).setSymbol((o?"rev ":"")+"input "+a).setTitle("Input Gate ["+a+"]"+(o?" [reversed]":"")).setBlurb("Temporarily uses some qubits as input "+a+(o?", in big-endian order":"")+".").setDrawer(function(e){return e=e,t=a,r=o,u.paintBackground(e,"#DDD","#DDD"),e.isInToolbox?u.paintOutline(e):e.painter.strokeRect(e.rect,"#888"),u.paintResizeTab(e),n=(i=e.rect.center()).x,i=i.y,e.painter.print("input",n,i-2,"center","bottom","black","16px sans-serif",e.rect.w-2,e.rect.h/2),void e.painter.print(t+(r?"[::-1]":""),n,i+2,"center","top","black","16px sans-serif",e.rect.w-2,e.rect.h/2);var t,r,n,i}).promiseHasNoNetEffectOnStateVector().markAsNotInterestedInControls().setSetupCleanupEffectsToShaderProviders(o&&1<t?n(t):void 0,o&&1<t?n(t):void 0).setContextProvider(function(e){return[{key:"Input Range "+a,val:{offset:e,length:t}}]})})}function o(n){return(new r).setSerializedIdAndSymbol("set"+n).setTitle("Set Default "+n).setBlurb("Sets a default value for input "+n+", for when an inline input isn't given.").setWidth(2).setHeight(2).promiseHasNoNetEffectOnStateVector().markAsNotInterestedInControls().markAsReachingOtherWires().setStickyContextProvider(function(e,t){return[{key:"Input Default "+n,val:t.param,sticky:!0}]}).setDrawer(function(e){u.paintLocationIndependentFrame(e,"#EEE","#EEE"),e.isInToolbox?u.paintGateSymbol(e,n+"=#\ndefault"):u.paintGateSymbol(e,n+"="+e.gate.param),u.paintGateButton(e)}).setOnClickGateFunc(function(e){var t,r=prompt("Enter new fallback value for input "+n+" (between 0 and 65535).",""+e.param);return null===r||""===r.trim()?e:(t=parseInt(r),!Number.isInteger(t)||t<0||65536<=t?(alert("'"+r+"' isn't an integer between 0 and 65535. Keeping "+e.param+"."),e):e.withParam(t))}).setExtraDisableReasonFinder(function(e){e=e.gate.param;if(!Number.isInteger(e)||e<0||65536<e)return"bad\nvalue"}).gate.withParam(2)}return i.InputAFamily=a("A",!1),i.InputBFamily=a("B",!1),i.InputRFamily=a("R",!1),i.InputRevAFamily=a("A",!0),i.InputRevBFamily=a("B",!0),i.SetA=o("A"),i.SetB=o("B"),i.SetR=o("R"),i.Letters=["A","B","R"],i.all=$traceurRuntime.spread(i.InputAFamily.all,i.InputBFamily.all,i.InputRFamily.all,i.InputRevAFamily.all,i.InputRevBFamily.all,[i.SetA,i.SetB,i.SetR]),{get InputGates(){return i}}}),$traceurRuntime.registerModule("src/gates/InterleaveBitsGates.js",[],function(){"use strict";var c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/gates/InterleaveBitsGates.js")).Config,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/InterleaveBitsGates.js")).Gate,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/KetShaderUtil.js","src/gates/InterleaveBitsGates.js")),n=t.ketArgs,i=t.ketShaderPermute,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GatePainting.js","src/gates/InterleaveBitsGates.js")).GatePainting,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Point.js","src/gates/InterleaveBitsGates.js")).Point,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Seq.js","src/gates/InterleaveBitsGates.js")).Seq,a={};function f(e,t){t=Math.ceil(t/2);return 2*(e%t)+Math.floor(e/t)}function o(e,t){t=Math.ceil(t/2);return Math.floor(e/2)+e%2*t}function r(e,t){for(var r=[],n=0;n<e;n++)r.push("r += mod(floor(out_id / "+(1<<t(n,e))+".0), 2.0) * "+(1<<n)+".0;");return i("","\n            float r = 0.0;\n            "+r.join("\n            ")+"\n            return r;\n        ",e)}function u(l){return function(e){if(void 0!==e.positionInCircuit)d.PERMUTATION_DRAWER(e);else{d.paintBackground(e),d.paintOutline(e),d.paintResizeTab(e);for(var t=e.rect.x+6,r=e.rect.right()-6,n=e.rect.center().y-c.GATE_RADIUS+6,i=(2*(c.GATE_RADIUS-6)-14)/5,a=0;a<6;a++){var o=f(a,6),u=n+a*i+14*Math.floor(a/3),o=n+o*i+7*Math.floor(o/2),s=(o=(u=(l?[o,u]:[u,o])[Symbol.iterator]()).next()).done?void 0:o.value,u=(o=u.next()).done?void 0:o.value;e.painter.strokePath([new m(t,s),new m(t+8,s),new m(r-8,u),new m(r,u)])}}}}var s=t.range(c.MAX_WIRE_COUNT+1).skip(2).toMap(function(e){return e},function(e){return r(e,f)}),l=t.range(c.MAX_WIRE_COUNT+1).skip(2).toMap(function(e){return e},function(e){return r(e,o)});return a.InterleaveBitsGateFamily=e.buildFamily(4,16,function(r,e){return e.setSerializedId("weave"+r).setSymbol("Interleave").setTitle("Interleave").setBlurb("Re-orders blocks of bits into stripes of bits.").setWidth(r<=8?1:2).setDrawer(u(!1)).setActualEffectToShaderProvider(function(e){var t;return(t=s.get(r)).withArgs.apply(t,$traceurRuntime.spread(n(e,r)))}).setKnownEffectToBitPermutation(function(e){return f(e,r)})}),a.DeinterleaveBitsGateFamily=e.buildFamily(4,16,function(r,e){return e.setAlternateFromFamily(a.InterleaveBitsGateFamily).setSerializedId("split"+r).setSymbol("Deinterleave").setTitle("Deinterleave").setBlurb("Re-orders stripes of bits into blocks of bits.").setWidth(r<=8?1:2).setDrawer(u(!0)).setActualEffectToShaderProvider(function(e){var t;return(t=l.get(r)).withArgs.apply(t,$traceurRuntime.spread(n(e,r)))}).setKnownEffectToBitPermutation(function(e){return o(e,r)})}),a.all=$traceurRuntime.spread(a.InterleaveBitsGateFamily.all,a.DeinterleaveBitsGateFamily.all),{get InterleaveBitsGates(){return a},get interleaveBit(){return f},get deinterleaveBit(){return o},get shaderFromBitPermutation(){return r}}}),$traceurRuntime.registerModule("src/gates/Joke_ImaginaryGate.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/Joke_ImaginaryGate.js")).GateBuilder,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/gates/Joke_ImaginaryGate.js")).Matrix,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Complex.js","src/gates/Joke_ImaginaryGate.js")).Complex,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GatePainting.js","src/gates/Joke_ImaginaryGate.js")).GatePainting,i=(new e).setSerializedIdAndSymbol("i").setTitle("Imaginary Gate").setBlurb("Phases everything by i.").setDrawer(function(e){n.paintLocationIndependentFrame(e),n.paintGateSymbol(e)}).setKnownEffectToMatrix(t.square(r.I,0,0,r.I)).gate,a=(new e).setAlternate(i).setSerializedIdAndSymbol("-i").setTitle("Anti-Imaginary Gate").setBlurb("Phases everything by -i.").setDrawer(function(e){n.paintLocationIndependentFrame(e),n.paintGateSymbol(e)}).setKnownEffectToMatrix(t.square(r.I.neg(),0,0,r.I.neg())).gate,o=(new e).setSerializedIdAndSymbol("√i").setTitle("Half Imaginary Gate").setBlurb("Phases everything by √i.").setDrawer(function(e){n.paintLocationIndependentFrame(e),n.paintGateSymbol(e)}).setKnownEffectToMatrix(t.square(1,0,0,1).times(new r(Math.sqrt(.5),Math.sqrt(.5)))).gate,u=(new e).setAlternate(o).setSerializedIdAndSymbol("√-i").setTitle("Half Anti-Imaginary Gate").setBlurb("Phases everything by √-i.").setDrawer(function(e){n.paintLocationIndependentFrame(e),n.paintGateSymbol(e)}).setKnownEffectToMatrix(t.square(1,0,0,1).times(new r(Math.sqrt(.5),-Math.sqrt(.5)))).gate;return{get AntiImaginaryGate(){return a},get ImaginaryGate(){return i},get SqrtImaginaryGate(){return o},get AntiSqrtImaginaryGate(){return u}}}),$traceurRuntime.registerModule("src/gates/Joke_MysteryGate.js",[],function(){"use strict";function e(e){return(new n).setSerializedIdAndSymbol(o).setTitle("Mystery Gate").setBlurb("Different every time.\n(Use shift+drag to copy circuit gates.)").setDrawer(i.MATRIX_SYMBOL_DRAWER_EXCEPT_IN_TOOLBOX).setKnownEffectToMatrix(e).gate}function t(){return e(a.square(new r(Math.random()-.5,Math.random()-.5),new r(Math.random()-.5,Math.random()-.5),new r(Math.random()-.5,Math.random()-.5),new r(Math.random()-.5,Math.random()-.5)).closestUnitary(1e-5))}var r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Complex.js","src/gates/Joke_MysteryGate.js")).Complex,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/Joke_MysteryGate.js")).GateBuilder,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GatePainting.js","src/gates/Joke_MysteryGate.js")).GatePainting,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/gates/Joke_MysteryGate.js")).Matrix,o="?";return{get MysteryGateSymbol(){return o},get MysteryGateMaker(){return t},get MysteryGateMakerWithMatrix(){return e}}}),$traceurRuntime.registerModule("src/gates/Joke_NeGate.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/Joke_NeGate.js")).GateBuilder,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/gates/Joke_NeGate.js")).Matrix,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Point.js","src/gates/Joke_NeGate.js")).Point,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GatePainting.js","src/gates/Joke_NeGate.js")).GatePainting,r=(new e).setSerializedId("NeGate").setTitle("Ne-Gate").setBlurb("Negates all amplitudes.").setDrawer(function(e){i.paintLocationIndependentFrame(e);var t=e.rect.center(),r=t.x,t=t.y;e.painter.strokeLine(new n(r-6,t),new n(r+6,t),"black",2)}).setKnownEffectToMatrix(t.square(-1,0,0,-1)).gate;return{get NeGate(){return r}}}),$traceurRuntime.registerModule("src/gates/Joke_ZeroGate.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/Joke_ZeroGate.js")).GateBuilder,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GatePainting.js","src/gates/Joke_ZeroGate.js")).GatePainting,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/gates/Joke_ZeroGate.js")).Matrix,n=(new e).setSerializedIdAndSymbol("0").setTitle("Nothing Gate").setBlurb("Destroys the universe.").setDrawer(t.makeLocationIndependentGateDrawer("#666")).setKnownEffectToMatrix(r.square(0,0,0,0)).gate;return{get ZeroGate(){return n}}}),$traceurRuntime.registerModule("src/gates/MeasurementGate.js",[],function(){"use strict";var d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/gates/MeasurementGate.js")).Config,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/MeasurementGate.js")).GateBuilder,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GatePainting.js","src/gates/MeasurementGate.js")).GatePainting;var t=(new e).setSerializedIdAndSymbol("Measure").setTitle("Measurement Gate").setBlurb("Measures whether a qubit is ON or OFF, without conditioning on the result.").promiseHasNoNetEffectOnStateVector().setDrawer(function(e){var t,r=d.GATE_FILL_COLOR,n=(e.isHighlighted&&(r=d.HIGHLIGHTED_GATE_FILL_COLOR),e.painter.fillRect(e.rect,r),m.paintOutline(e),2*Math.PI),i=.4*e.rect.w,a=(r=e.rect.center()).x,o=r.y,u=(o+=.6*i,-n/6),s=(t=(r=[Math.cos(u)*i*1.5,Math.sin(u)*i*1.5][Symbol.iterator]()).next()).done?void 0:t.value,r=(t=r.next()).done?void 0:t.value,l=(s=(t=[a+s,o+r][Symbol.iterator]()).next()).done?void 0:s.value,c=(s=t.next()).done?void 0:s.value;e.painter.trace(function(e){e.ctx.arc(a,o,i,n/2,n),e.line(a,o,l,c)}).thenStroke("black"),e.painter.trace(function(e){return e.arrowHead(l,c,.3*i,u,n/4)}).thenFill("black")}).setExtraDisableReasonFinder(function(e){var t;return e.isNested?"can't\nnest\nmeasure\n(sorry)":(t=0!=(e.measuredMask&1<<e.outerRow),e.innerColumn.hasControl()&&!t?"can't\ncontrol\n(sorry)":void 0)}).gate;return{get MeasurementGate(){return t}}}),$traceurRuntime.registerModule("src/gates/ModularAdditionGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/ModularAdditionGates.js")).Gate,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/KetShaderUtil.js","src/gates/ModularAdditionGates.js")),r=t.ketArgs,n=t.ketShaderPermute,t=t.ketInputGateShaderCode,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/gates/ModularAdditionGates.js")).Util,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglArg.js","src/gates/ModularAdditionGates.js")).WglArg,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ModularIncrementGates.js","src/gates/ModularAdditionGates.js")).modulusTooBigChecker,u={},s=n("\n        uniform float factor;\n        "+t("A")+"\n        "+t("R")+"\n    ","\n        float r = read_input_R();\n        if (out_id >= r) {\n            return out_id;\n        }\n        float d = read_input_A();\n        d *= factor;\n        d = floor(mod(d + 0.5, r));\n        return floor(mod(out_id + r - d + 0.5, r));\n    ");return u.PlusAModRFamily=e.buildFamily(1,16,function(t,e){return e.setSerializedId("+AmodR"+t).setSymbol("+A\nmod R").setTitle("Modular Addition Gate").setBlurb("Adds input A into the target, mod input R.\nOnly affects values below R.").setRequiredContextKeys("Input Range A","Input Range R").setExtraDisableReasonFinder(o("R",t)).setActualEffectToShaderProvider(function(e){return s.withArgs.apply(s,$traceurRuntime.spread(r(e,t,["A","R"]),[a.float("factor",1)]))}).setKnownEffectToParametrizedPermutation(function(e,t,r){return e<r?(e+t)%r:e})}),u.MinusAModRFamily=e.buildFamily(1,16,function(t,e){return e.setAlternateFromFamily(u.PlusAModRFamily).setSerializedId("-AmodR"+t).setSymbol("−A\nmod R").setTitle("Modular Subtraction Gate").setBlurb("Subtracts input A out of the target, mod input R.\nOnly affects values below R.").setRequiredContextKeys("Input Range A","Input Range R").setExtraDisableReasonFinder(o("R",t)).setActualEffectToShaderProvider(function(e){return s.withArgs.apply(s,$traceurRuntime.spread(r(e,t,["A","R"]),[a.float("factor",-1)]))}).setKnownEffectToParametrizedPermutation(function(e,t,r){return e<r?i.properMod(e-t,r):e})}),u.all=$traceurRuntime.spread(u.PlusAModRFamily.all,u.MinusAModRFamily.all),{get ModularAdditionGates(){return u}}}),$traceurRuntime.registerModule("src/gates/ModularIncrementGates.js",[],function(){"use strict";function r(r,n){var i=void 0!==arguments[2]?arguments[2]:"mod";return function(e){var t=e.context.get("Input Range "+r),e=e.context.get("Input Default "+r);return void 0!==t&&t.length>n||void 0===t&&void 0!==e&&1<<n<e?i+"\ntoo\nbig":void 0}}var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/ModularIncrementGates.js")).Gate,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/KetShaderUtil.js","src/gates/ModularIncrementGates.js")),n=t.ketArgs,i=t.ketShaderPermute,t=t.ketInputGateShaderCode,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/gates/ModularIncrementGates.js")).Util,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglArg.js","src/gates/ModularIncrementGates.js")).WglArg,u={},s=i("\n        uniform float amount;\n        "+t("R")+"\n    ","\n        float r = read_input_R();\n        return out_id >= r\n            ? out_id\n            // HACK: sometimes mod(value-equal-to-r, r) returns r instead of 0. The perturbation works around it.\n            : floor(mod(out_id + r - amount, r - 0.000001));");return u.IncrementModRFamily=e.buildFamily(1,16,function(t,e){return e.setSerializedId("incmodR"+t).setSymbol("+1\nmod R").setTitle("Modular Increment Gate").setBlurb("Adds 1 into the target, but wraps R-1 to 0.\nOnly affects values less than R.").setRequiredContextKeys("Input Range R").setExtraDisableReasonFinder(r("R",t)).setActualEffectToShaderProvider(function(e){return s.withArgs.apply(s,$traceurRuntime.spread(n(e,t,["R"]),[o.float("amount",1)]))}).setKnownEffectToParametrizedPermutation(function(e,t){return e<t?(e+1)%t:e})}),u.DecrementModRFamily=e.buildFamily(1,16,function(t,e){return e.setAlternateFromFamily(u.IncrementModRFamily).setSerializedId("decmodR"+t).setSymbol("−1\nmod R").setTitle("Modular Decrement Gate").setBlurb("Subtracts 1 out of the target, but wraps 0 to R-1.\nOnly affects values less than R.").setRequiredContextKeys("Input Range R").setExtraDisableReasonFinder(r("R",t)).setActualEffectToShaderProvider(function(e){return s.withArgs.apply(s,$traceurRuntime.spread(n(e,t,["R"]),[o.float("amount",-1)]))}).setKnownEffectToParametrizedPermutation(function(e,t){return e<t?a.properMod(e-1,t):e})}),u.all=$traceurRuntime.spread(u.IncrementModRFamily.all,u.DecrementModRFamily.all),{get ModularIncrementGates(){return u},get modulusTooBigChecker(){return r}}}),$traceurRuntime.registerModule("src/gates/ModularMultiplicationGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/gates/ModularMultiplicationGates.js")).Config,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/ModularMultiplicationGates.js")).Gate,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/KetShaderUtil.js","src/gates/ModularMultiplicationGates.js")),n=r.ketArgs,i=r.ketShaderPermute,r=r.ketInputGateShaderCode,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ModularIncrementGates.js","src/gates/ModularMultiplicationGates.js")).modulusTooBigChecker,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./MultiplyAccumulateGates.js","src/gates/ModularMultiplicationGates.js")).BIG_MUL_MOD_SHADER_CODE,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/gates/ModularMultiplicationGates.js")).Util,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglArg.js","src/gates/ModularMultiplicationGates.js")).WglArg,l={},c="\n    vec2 _mod_mul_step(vec2 v, float q) {\n        return vec2(v.y - q * v.x, v.x);\n    }\n    \n    "+o+"\n\n    float modular_multiplicative_inverse(float value, float modulus) {\n        vec2 s = vec2(0.0, 1.0);\n        vec2 t = vec2(1.0, 0.0);\n        vec2 r = vec2(modulus, value);\n        float q;\n        // For values up to x, a number of iterations n satisfying phi^n > x should be sufficient.\n        for (int repeat = 0; repeat < "+Math.ceil(e.MAX_WIRE_COUNT/(Math.log2(1+Math.sqrt(5))-1))+"; repeat++) {\n            if (r.x != 0.0) {\n                q = floor(r.y / r.x);\n                r = _mod_mul_step(r, q);\n                s = _mod_mul_step(s, q);\n                t = _mod_mul_step(t, q);\n            }\n        }\n        if (r.y != 1.0) {\n            return -1.0;\n        }\n        return floor(mod(floor(mod(s.y + 0.5, modulus)) + modulus + 0.5, modulus));\n    }\n",d="\n    "+c+"\n\n    float pow_mod(float base, float exponent, float modulus) {\n        float base_inverse = modular_multiplicative_inverse(base, modulus);\n        if (base_inverse == -1.0) {\n            return -1.0;\n        }\n\n        if (exponent < 0.0) {\n            base = base_inverse;\n            exponent = -exponent;\n        }\n\n        float f = 1.0;\n        for (int k = 0; k < "+e.MAX_WIRE_COUNT+"; k++) {\n            if (floor(mod(exponent + 0.5, 2.0)) == 1.0) {\n                exponent -= 1.0;\n                f = big_mul_mod(f, base, modulus);\n            }\n            base = big_mul_mod(base, base, modulus);\n            exponent /= 2.0;\n        }\n        return f;\n    }\n";function m(e,t,r){return r<=e||0===(t=u.properMod(t,r))||1!==u.extended_gcd(t,r).gcd?e:e*t%r}function f(e,t,r){return r<=e||0===(t=u.properMod(t,r))||void 0===(t=u.modular_multiplicative_inverse(t,r))?e:e*t%r}function h(e,t,r,n){if(!(n<=e)){t=u.properMod(t,n);var i=u.modular_multiplicative_inverse(t,n);if(void 0!==i)for(r<0&&(r=-r,t=i);0<r;)0!=(1&r)&&(e=e*t%n),t=t*t%n,r>>=1}return e}var g=i("\n        "+c+"\n        "+r("A")+"\n        "+r("R")+"\n    ","\n        float input_a = read_input_A();\n        float modulus = read_input_R();\n        input_a = floor(mod(input_a + 0.5, modulus));\n        float v = modular_multiplicative_inverse(input_a, modulus);\n        if (v == -1.0 || out_id >= modulus) {\n            return out_id;\n        }\n        return big_mul_mod(out_id, v, modulus);\n    "),p=i("\n        "+c+"\n        "+r("A")+"\n        "+r("R")+"\n    ","\n        float input_a = read_input_A();\n        float modulus = read_input_R();\n        input_a = floor(mod(input_a + 0.5, modulus));\n        if (modular_multiplicative_inverse(input_a, modulus) == -1.0 || out_id >= modulus) {\n            return out_id;\n        }\n        return big_mul_mod(out_id, input_a, modulus);\n    "),v=i("\n        uniform float factor;\n        "+r("A")+"\n        "+r("B")+"\n        "+r("R")+"\n        "+d+"\n    ","\n        float exponent = -read_input_A() * factor;\n        float base = read_input_B();\n        float modulus = read_input_R();\n        float f = pow_mod(base, exponent, modulus);\n        if (f == -1.0 || out_id >= modulus) {\n            return out_id;\n        }\n        return big_mul_mod(out_id, f, modulus);\n    ");return l.TimesAModRFamily=t.buildFamily(1,16,function(t,e){return e.setSerializedId("*AmodR"+t).setSymbol("×A\nmod R").setTitle("Modular Multiplication Gate").setBlurb("Multiplies the target by input A mod input R.\nOnly affects values less than R.\nNo effect if the multiplication would be irreversible.").setRequiredContextKeys("Input Range A","Input Range R").setExtraDisableReasonFinder(a("R",t)).setActualEffectToShaderProvider(function(e){return g.withArgs.apply(g,$traceurRuntime.spread(n(e,t,["A","R"])))}).setKnownEffectToParametrizedPermutation(m)}),l.TimesAModRInverseFamily=t.buildFamily(1,16,function(t,e){return e.setAlternateFromFamily(l.TimesAModRFamily).setSerializedId("/AmodR"+t).setSymbol("×A^-1\nmod R").setTitle("Modular Division Gate").setBlurb("Inverse-multiplies the target by input A mod input R.\nOnly affects values less than R.\nNo effect if the multiplication would be irreversible.").setRequiredContextKeys("Input Range A","Input Range R").setExtraDisableReasonFinder(a("R",t)).setActualEffectToShaderProvider(function(e){return p.withArgs.apply(p,$traceurRuntime.spread(n(e,t,["A","R"])))}).setKnownEffectToParametrizedPermutation(f)}),l.TimesBToTheAModRFamily=t.buildFamily(1,16,function(t,e){return e.setSerializedId("*BToAmodR"+t).setSymbol("×B^A\nmod R").setTitle("Modular Power Multiplication Gate").setBlurb("Multiplies the target by input B raised to the input A mod input R.\nOnly affects values less than R.\nNo effect if the multiplication would be irreversible.").setRequiredContextKeys("Input Range A","Input Range B","Input Range R").setExtraDisableReasonFinder(a("R",t)).setActualEffectToShaderProvider(function(e){return v.withArgs.apply(v,$traceurRuntime.spread(n(e,t,["A","B","R"]),[s.float("factor",1)]))}).setKnownEffectToParametrizedPermutation(function(e,t,r,n){return h(e,r,t,n)})}),l.TimesInverseBToTheAModRFamily=t.buildFamily(1,16,function(t,e){return e.setAlternateFromFamily(l.TimesBToTheAModRFamily).setSerializedId("/BToAmodR"+t).setSymbol("×B^-A\nmod R").setTitle("Modular Power Division Gate").setBlurb("Inverse-multiplies the target by input B raised to the input A mod input R.\nOnly affects values less than R.\nNo effect if the multiplication would be irreversible.").setRequiredContextKeys("Input Range A","Input Range B","Input Range R").setExtraDisableReasonFinder(a("R",t)).setActualEffectToShaderProvider(function(e){return v.withArgs.apply(v,$traceurRuntime.spread(n(e,t,["A","B","R"]),[s.float("factor",-1)]))}).setKnownEffectToParametrizedPermutation(function(e,t,r,n){return h(e,r,-t,n)})}),l.all=$traceurRuntime.spread(l.TimesAModRFamily.all,l.TimesAModRInverseFamily.all,l.TimesBToTheAModRFamily.all,l.TimesInverseBToTheAModRFamily.all),{get ModularMultiplicationGates(){return l},get MODULAR_INVERSE_SHADER_CODE(){return c},get POW_MOD_SHADER_CODE(){return d},get modularMultiply(){return m},get modularUnmultiply(){return f},get modularPowerMultiply(){return h}}}),$traceurRuntime.registerModule("src/gates/ModularMultiplyAccumulateGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./MultiplyAccumulateGates.js","src/gates/ModularMultiplyAccumulateGates.js")).BIG_MUL_MOD_SHADER_CODE,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/ModularMultiplyAccumulateGates.js")).Gate,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/KetShaderUtil.js","src/gates/ModularMultiplyAccumulateGates.js")),n=r.ketArgs,i=r.ketShaderPermute,r=r.ketInputGateShaderCode,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ModularIncrementGates.js","src/gates/ModularMultiplyAccumulateGates.js")).modulusTooBigChecker,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/gates/ModularMultiplyAccumulateGates.js")).Util,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglArg.js","src/gates/ModularMultiplyAccumulateGates.js")).WglArg,s={},l=i("\n        uniform float factor;\n        "+r("A")+"\n        "+r("B")+"\n        "+r("R")+"\n        "+e+"\n    ","\n        float r = read_input_R();\n        float a = read_input_A();\n        float b = read_input_B();\n\n        float d = big_mul_mod(factor * a, b, r);\n\n        float in_id = floor(mod(out_id - d + 0.5, r));\n        if (in_id < 0.0) {\n            in_id += r;\n        }\n        if (in_id >= r) {\n            in_id -= r;\n        }\n\n        return out_id >= r ? out_id : in_id;\n    ");return s.PlusABModRFamily=t.buildFamily(1,16,function(t,e){return e.setSerializedId("+ABmodR"+t).setSymbol("+AB\nmod R").setTitle("Modular Multiply-Add Gate").setBlurb("Adds input A times input B into the target, mod input R.\nOnly affects values below R.").setRequiredContextKeys("Input Range A","Input Range B","Input Range R").setExtraDisableReasonFinder(a("R",t)).setActualEffectToShaderProvider(function(e){return l.withArgs.apply(l,$traceurRuntime.spread(n(e,t,["A","B","R"]),[u.float("factor",1)]))}).setKnownEffectToParametrizedPermutation(function(e,t,r,n){return e<n?(e+t*r)%n:e})}),s.MinusABModRFamily=t.buildFamily(1,16,function(t,e){return e.setAlternateFromFamily(s.PlusABModRFamily).setSerializedId("-ABmodR"+t).setSymbol("−AB\nmod R").setTitle("Modular Multiply-Subtract Gate").setBlurb("Subtracts input A times input B out of the target, mod input R.\nOnly affects values below R.").setRequiredContextKeys("Input Range A","Input Range B","Input Range R").setExtraDisableReasonFinder(a("R",t)).setActualEffectToShaderProvider(function(e){return l.withArgs.apply(l,$traceurRuntime.spread(n(e,t,["A","B","R"]),[u.float("factor",-1)]))}).setKnownEffectToParametrizedPermutation(function(e,t,r,n){return e<n?o.properMod(e-t*r,n):e})}),s.all=$traceurRuntime.spread(s.PlusABModRFamily.all,s.MinusABModRFamily.all),{get ModularMultiplyAccumulateGates(){return s}}}),$traceurRuntime.registerModule("src/gates/MultiplicationGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/MultiplicationGates.js")).Gate,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/KetShaderUtil.js","src/gates/MultiplicationGates.js")),n=t.ketArgs,r=t.ketShaderPermute,t=t.ketInputGateShaderCode,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ModularMultiplicationGates.js","src/gates/MultiplicationGates.js")),a=i.modularMultiply,o=i.modularUnmultiply,u=i.MODULAR_INVERSE_SHADER_CODE,s={},l=r("\n        "+u+"\n        "+t("A")+"\n    ","\n        float input_a = read_input_A();\n        input_a = mod(input_a, span);\n        float v = modular_multiplicative_inverse(input_a, span);\n        if (v == -1.0) {\n            return out_id;\n        }\n        return big_mul_mod(out_id, v, span);\n    "),c=r("\n        "+u+"\n        "+t("A")+"\n    ","\n        float input_a = read_input_A();\n        input_a = mod(input_a, span);\n        if (modular_multiplicative_inverse(input_a, span) == -1.0) {\n            return out_id;\n        }\n        return big_mul_mod(out_id, input_a, span);\n    ");return s.TimesAFamily=e.buildFamily(1,16,function(r,e){return e.setSerializedId("*A"+r).setSymbol("×A").setTitle("Multiplication Gate").setBlurb("Multiplies the target by input A.\nNo effect if the input is even (would be irreversible).").setRequiredContextKeys("Input Range A").setActualEffectToShaderProvider(function(e){return l.withArgs.apply(l,$traceurRuntime.spread(n(e,r,["A"])))}).setKnownEffectToParametrizedPermutation(function(e,t){return a(e,t,1<<r)})}),s.TimesAInverseFamily=e.buildFamily(1,16,function(r,e){return e.setAlternateFromFamily(s.TimesAFamily).setSerializedId("/A"+r).setSymbol("×A^-1").setTitle("Inverse Multiplication Gate").setBlurb("Inverse-multiplies the target by input A (modulo 2^n).\nNo effect if the input is even (would be irreversible).").setRequiredContextKeys("Input Range A").setKnownEffectToParametrizedPermutation(function(e,t){return o(e,t,1<<r)}).setActualEffectToShaderProvider(function(e){return c.withArgs.apply(c,$traceurRuntime.spread(n(e,r,["A"])))})}),s.all=$traceurRuntime.spread(s.TimesAFamily.all,s.TimesAInverseFamily.all),{get MultiplicationGates(){return s},get MODULAR_INVERSE_SHADER_CODE(){return u}}}),$traceurRuntime.registerModule("src/gates/MultiplyAccumulateGates.js",[],function(){"use strict";function s(e){var t=Math.ceil(e/2),r=Math.ceil((e-t)/2);return[t=Math.max(e-t-r,1),r,e-t-r]}function t(o,u){return function(e){var t=(i=(n=s(o)[Symbol.iterator]()).next()).done?void 0:i.value,r=(i=n.next()).done?void 0:i.value,n=(i=n.next()).done?void 0:i.value,i=e&(1<<t)-1,a=e>>t&(1<<r)-1,e=e>>t+r;return i|a<<t|(e+i*a*u&(1<<n)-1)<<t+r}}var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/gates/MultiplyAccumulateGates.js")).Config,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/MultiplyAccumulateGates.js")).Gate,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GatePainting.js","src/gates/MultiplyAccumulateGates.js")).GatePainting,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/KetShaderUtil.js","src/gates/MultiplyAccumulateGates.js")),a=i.ketArgs,o=i.ketShaderPermute,i=i.ketInputGateShaderCode,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglArg.js","src/gates/MultiplyAccumulateGates.js")).WglArg,l={},c="\n    // Avoids large multiplications that lose precision.\n    float big_mul_mod(float b, float f, float modulus) {\n        float t = 0.0;\n        float r;\n        for (int k = 0; k < "+Math.ceil(e.MAX_WIRE_COUNT/6)+"; k++) {\n            r = floor(mod(f + 0.5, 64.0));\n            f -= r;\n            t = floor(mod(t + b*r + 0.5, modulus));\n            b = floor(mod(b * 64.0 + 0.5, modulus));\n            f /= 64.0;\n        }\n        return t;\n    }\n",d=o("\n        uniform float factor;\n        "+i("A")+"\n        "+i("B")+"\n        "+c+"\n    ","\n        float d1 = read_input_A();\n        float d2 = read_input_B();\n        float d = floor(mod(big_mul_mod(d1, d2, span)*factor + 0.5, span));\n        return mod(out_id + span - d, span);");return l.Legacy_MultiplyAddFamily=r.buildFamily(3,16,function(a,e){return e.setSerializedId("c+=ab"+a).setSymbol("c+=ab").setTitle("Multiply-Add Gate").setBlurb("Adds the product of two numbers into a third.").setDrawer(n.SECTIONED_DRAWER_MAKER(["a","b","c+=ab"],s(a).slice(0,2).map(function(e){return e/a}))).setActualEffectToUpdateFunc(function(e){var t,r=(t=(i=s(a)[Symbol.iterator]()).next()).done?void 0:t.value,n=(t=i.next()).done?void 0:t.value,i=(t=i.next()).done?void 0:t.value;return l.MultiplyAddInputsFamily.ofSize(i).customOperation(e.withRow(e.row+r+n).withInputSetToRange("A",e.row,r).withInputSetToRange("B",e.row+r,n))}).setKnownEffectToPermutation(t(a,1))}),l.Legacy_MultiplySubtractFamily=r.buildFamily(3,16,function(a,e){return e.setAlternateFromFamily(l.Legacy_MultiplyAddFamily).setSerializedId("c-=ab"+a).setSymbol("c-=ab").setTitle("Multiply-Subtract Gate").setBlurb("Subtracts the product of two numbers from a third.").setDrawer(n.SECTIONED_DRAWER_MAKER(["a","b","c-=ab"],s(a).slice(0,2).map(function(e){return e/a}))).setActualEffectToUpdateFunc(function(e){var t,r=(t=(i=s(a)[Symbol.iterator]()).next()).done?void 0:t.value,n=(t=i.next()).done?void 0:t.value,i=(t=i.next()).done?void 0:t.value;return l.MultiplySubtractInputsFamily.ofSize(i).customOperation(e.withRow(e.row+r+n).withInputSetToRange("A",e.row,r).withInputSetToRange("B",e.row+r,n))}).setKnownEffectToPermutation(t(a,-1))}),l.MultiplyAddInputsFamily=r.buildFamily(1,16,function(n,e){return e.setSerializedId("+=AB"+n).setSymbol("+AB").setTitle("Multiply-Add Gate [Inputs A, B]").setBlurb("Adds the product of inputs A and B into the qubits covered by this gate.").setRequiredContextKeys("Input Range A","Input Range B").setActualEffectToShaderProvider(function(e){return d.withArgs.apply(d,$traceurRuntime.spread(a(e,n,["A","B"]),[u.float("factor",1)]))}).setKnownEffectToParametrizedPermutation(function(e,t,r){return e+t*r&(1<<n)-1})}),l.MultiplySubtractInputsFamily=r.buildFamily(1,16,function(n,e){return e.setAlternateFromFamily(l.MultiplyAddInputsFamily).setSerializedId("-=AB"+n).setSymbol("−AB").setTitle("Multiply-Subtract Gate [Inputs A, B]").setBlurb("Subtracts the product of inputs A and B out of the qubits covered by this gate.").setRequiredContextKeys("Input Range A","Input Range B").setActualEffectToShaderProvider(function(e){return d.withArgs.apply(d,$traceurRuntime.spread(a(e,n,["A","B"]),[u.float("factor",-1)]))}).setKnownEffectToParametrizedPermutation(function(e,t,r){return e-t*r&(1<<n)-1})}),l.SquareAddInputFamily=r.buildFamily(1,16,function(r,e){return e.setSerializedId("+=AA"+r).setSymbol("+A^2").setTitle("Square-Add Gate [Input A]").setBlurb("Adds the square of input A into the qubits covered by this gate.").setRequiredContextKeys("Input Range A").setActualEffectToUpdateFunc(function(e){return l.MultiplyAddInputsFamily.ofSize(r).customOperation(e.withInputSetToOtherInput("B","A"))}).setKnownEffectToParametrizedPermutation(function(e,t){return e+t*t&(1<<r)-1})}),l.SquareSubtractInputFamily=r.buildFamily(1,16,function(r,e){return e.setAlternateFromFamily(l.SquareAddInputFamily).setSerializedId("-=AA"+r).setSymbol("-A^2").setTitle("Square-Subtract Gate [Input A]").setBlurb("Subtracts the square of input A out of the qubits covered by this gate.").setRequiredContextKeys("Input Range A").setActualEffectToUpdateFunc(function(e){return l.MultiplySubtractInputsFamily.ofSize(r).customOperation(e.withInputSetToOtherInput("B","A"))}).setKnownEffectToParametrizedPermutation(function(e,t){return e-t*t&(1<<r)-1})}),l.all=$traceurRuntime.spread(l.Legacy_MultiplyAddFamily.all,l.Legacy_MultiplySubtractFamily.all,l.MultiplyAddInputsFamily.all,l.MultiplySubtractInputsFamily.all,l.SquareAddInputFamily.all,l.SquareSubtractInputFamily.all),{get MultiplyAccumulateGates(){return l},get BIG_MUL_MOD_SHADER_CODE(){return c},get MUL_STEP(){return 6}}}),$traceurRuntime.registerModule("src/gates/ParametrizedRotationGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/ParametrizedRotationGates.js")).GateBuilder,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GatePainting.js","src/gates/ParametrizedRotationGates.js")).GatePainting,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Complex.js","src/gates/ParametrizedRotationGates.js")),a=t.Complex,u=t.PARSE_COMPLEX_TOKEN_MAP_RAD,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/gates/ParametrizedRotationGates.js")).Matrix,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/KetShaderUtil.js","src/gates/ParametrizedRotationGates.js")),n=t.ketArgs,i=t.ketShader,s=t.ketShaderPhase,t=t.ketInputGateShaderCode,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglArg.js","src/gates/ParametrizedRotationGates.js")).WglArg,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/gates/ParametrizedRotationGates.js")).Util,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/FormulaParser.js","src/gates/ParametrizedRotationGates.js")).parseFormula,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ExponentiatingGates.js","src/gates/ParametrizedRotationGates.js")),f=m.XExp,h=m.YExp,g=m.ZExp,p=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/gates/ParametrizedRotationGates.js")).Config,v={};function y(r,e,n){var i=[1,.5,-1][e],a=[1,1,-.5][e];return function(e){o.paintBackground(e,p.TIME_DEPENDENT_HIGHLIGHT_COLOR),o.paintOutline(e);var t=r,t=(e.isInToolbox||(t=t.split("f(t)").join(e.gate.param)),o.paintGateSymbol(e,t,-1!==r.indexOf("^")),o.paintGateButton(e),e.gate.stableDuration()===1/0);e.isInToolbox&&!e.isHighlighted||t||(t=n*_(e.gate.param,2*e.stats.time-1,!1)||0,o.paintCycleState(e,t,i,a))}}function b(e){var t=e.getGateContext("Input Range A"),t=void 0===t?"ⁿ":c.digits_to_superscript_digits(""+t.length),t=e.gate.symbol.replace("ⁿ",t);o.paintBackground(e),o.paintOutline(e),o.paintGateSymbol(e,t)}var R=i("\n        uniform float factor;\n        "+t("A")+"\n    ","\n        float angle = read_input_A() * factor / _gen_input_span_A;\n        float c = cos(angle) * 0.5;\n        float s = sin(angle) * 0.5;\n        vec2 u = vec2(0.5 + c, s);\n        vec2 v = vec2(0.5 - c, -s);\n        // multiply state by the matrix [[u, v], [v, u]]\n        vec2 amp2 = inp(1.0-out_id);\n        return cmul(u, amp) + cmul(v, amp2);\n    "),w=i("\n        uniform float factor;\n        "+t("A")+"\n    ","\n        float angle = read_input_A() * factor / _gen_input_span_A;\n        float c = cos(angle) * 0.5;\n        float s = sin(angle) * 0.5;\n        vec2 u = vec2(c + 0.5, s);\n        vec2 v = vec2(s, 0.5 - c);\n        // multiply state by the matrix [[u, v], [-v, u]]\n        vec2 amp2 = inp(1.0-out_id);\n        vec2 vs = v * (-1.0 + 2.0 * out_id);\n        return cmul(u, amp) + cmul(vs, amp2);\n    "),M=s("\n        uniform float factor;\n        "+t("A")+"\n    ","\n        return read_input_A() * out_id * factor / _gen_input_span_A;\n    ");function _(e,t,r){var n=new Map($traceurRuntime.spread(u.entries()));void 0!==t&&n.set("t",t);try{var i=a.from(d(e,n));if(1e-4<Math.abs(i.imag))throw new Error("Non-real angle: "+e+" = "+i);return i.real}catch(e){r&&console.warn(e)}}function x(e){if("number"==typeof e.gate.param)return e.gate.param;if("string"!=typeof e.gate.param)return"bad\nvalue";var t=!0,r=!1,n=void 0;try{for(var i,a=[.01,.63,.98][Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;if(void 0===_(e.gate.param,o,!1))return"bad\nformula"}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}function S(e){var t=void 0!==_(e.param,void 0,!1);e._stableDuration=t?1/0:0,"string"==typeof e.param?(e.width=Math.ceil((e.param.length+1)/5),e.alternate=e._copy(),(e.alternate.alternate=e).param.startsWith("-(")&&e.param.endsWith(")")?e.alternate.param=e.param.substring(2,e.param.length-1):e.alternate.param="-("+e.param+")"):(e.width=1,e.alternate=e)}function T(r){return function(e){var t=prompt("Enter a formula to use for the "+r+".\n\nThe formula can depend on the time variable t.\nTime t starts at -1, grows to +1 over time, then jumps back to -1.\nInvalid results will default to 0.\n\nAvailable constants: e, pi\nAvailable functions: cos, sin, acos, asin, tan, atan, ln, sqrt, exp\nAvailable operators: + * / - ^",""+e.param);return null===t||""===t.trim()?e:e.withParam(t)}}return v.XToA=(new e).setSerializedId("X^(A/2^n)").setSymbol("X^A/2ⁿ").setTitle("Parametrized X Gate").setBlurb("Rotates the target by input A / 2ⁿ'th of a half turn around the X axis.\nn is the number of qubits in input A.").setRequiredContextKeys("Input NO_DEFAULT Range A").setDrawer(b).setActualEffectToShaderProvider(function(e){return R.withArgs.apply(R,$traceurRuntime.spread(n(e,1,["A"]),[l.float("factor",Math.PI)]))}).promiseEffectIsStable().promiseEffectIsUnitary().gate,v.XToMinusA=(new e).setAlternate(v.XToA).setSerializedId("X^(-A/2^n)").setSymbol("X^-A/2ⁿ").setTitle("Parametrized -X Gate").setBlurb("Counter-rotates the target by input A / 2ⁿ'th of a half turn around the X axis.\nn is the number of qubits in input A.").setRequiredContextKeys("Input NO_DEFAULT Range A").setDrawer(b).setActualEffectToShaderProvider(function(e){return R.withArgs.apply(R,$traceurRuntime.spread(n(e,1,["A"]),[l.float("factor",-Math.PI)]))}).promiseEffectIsStable().promiseEffectIsUnitary().gate,v.YToA=(new e).setSerializedId("Y^(A/2^n)").setSymbol("Y^A/2ⁿ").setTitle("Parametrized Y Gate").setBlurb("Rotates the target by input A / 2ⁿ'th of a half turn around the Y axis.\nn is the number of qubits in input A.").setRequiredContextKeys("Input NO_DEFAULT Range A").setDrawer(b).setActualEffectToShaderProvider(function(e){return w.withArgs.apply(w,$traceurRuntime.spread(n(e,1,["A"]),[l.float("factor",Math.PI)]))}).promiseEffectIsStable().promiseEffectIsUnitary().gate,v.YToMinusA=(new e).setAlternate(v.YToA).setSerializedId("Y^(-A/2^n)").setSymbol("Y^-A/2ⁿ").setTitle("Parametrized -Y Gate").setBlurb("Counter-rotates the target by input A / 2ⁿ'th of a half turn around the Y axis.\nn is the number of qubits in input A.").setRequiredContextKeys("Input NO_DEFAULT Range A").setDrawer(b).setActualEffectToShaderProvider(function(e){return w.withArgs.apply(w,$traceurRuntime.spread(n(e,1,["A"]),[l.float("factor",-Math.PI)]))}).promiseEffectIsStable().promiseEffectIsUnitary().gate,v.ZToA=(new e).setSerializedId("Z^(A/2^n)").setSymbol("Z^A/2ⁿ").setTitle("Parametrized Z Gate").setBlurb("Rotates the target by input A / 2ⁿ'th of a half turn around the Z axis.\nn is the number of qubits in input A.").setRequiredContextKeys("Input NO_DEFAULT Range A").setDrawer(b).setActualEffectToShaderProvider(function(e){return M.withArgs.apply(M,$traceurRuntime.spread(n(e,1,["A"]),[l.float("factor",Math.PI)]))}).promiseEffectIsStable().promiseEffectOnlyPhases().gate,v.ZToMinusA=(new e).setAlternate(v.ZToA).setSerializedId("Z^(-A/2^n)").setSymbol("Z^-A/2ⁿ").setTitle("Parametrized -Z Gate").setBlurb("Counter-rotates the target by input A / 2ⁿ'th of a half turn around the Z axis.\nn is the number of qubits in input A.").setRequiredContextKeys("Input NO_DEFAULT Range A").setDrawer(b).setActualEffectToShaderProvider(function(e){return M.withArgs.apply(M,$traceurRuntime.spread(n(e,1,["A"]),[l.float("factor",-Math.PI)]))}).promiseEffectIsStable().promiseEffectOnlyPhases().gate,v.FormulaicRotationX=(new e).setSerializedIdAndSymbol("X^ft").setTitle("Formula X Rotation").setBlurb("Rotates around X by an amount determined by a formula.").setDrawer(y("X^f(t)",0,Math.PI)).setWidth(2).setExtraDisableReasonFinder(x).setOnClickGateFunc(T("X gate's exponent")).setEffectToTimeVaryingMatrix(function(e,t){t=_(t,2*e-1,!0)||0;return r.fromPauliRotation(t/2,0,0)}).setWithParamPropertyRecomputeFunc(S).promiseEffectIsUnitary().gate.withParam("sin(pi t)"),v.FormulaicRotationY=(new e).setSerializedIdAndSymbol("Y^ft").setTitle("Formula Y Rotation").setBlurb("Rotates around Y by an amount determined by a formula.").setDrawer(y("Y^f(t)",1,Math.PI)).setWidth(2).setExtraDisableReasonFinder(x).setOnClickGateFunc(T("Y gate's exponent")).setEffectToTimeVaryingMatrix(function(e,t){t=_(t,2*e-1,!0)||0;return r.fromPauliRotation(0,t/2,0)}).setWithParamPropertyRecomputeFunc(S).promiseEffectIsUnitary().gate.withParam("sin(pi t)"),v.FormulaicRotationZ=(new e).setSerializedIdAndSymbol("Z^ft").setTitle("Formula Z Rotation").setBlurb("Rotates around Z by an amount determined by a formula.").setDrawer(y("Z^f(t)",2,Math.PI)).setWidth(2).setExtraDisableReasonFinder(x).setOnClickGateFunc(T("Z gate's exponent")).setEffectToTimeVaryingMatrix(function(e,t){t=_(t,2*e-1,!0)||0;return r.fromPauliRotation(0,0,t/2)}).setWithParamPropertyRecomputeFunc(S).promiseEffectOnlyPhases().gate.withParam("sin(pi t)"),v.FormulaicRotationRx=(new e).setSerializedIdAndSymbol("Rxft").setTitle("Formula Rx Gate").setBlurb("Rotates around X by an angle in radians determined by a formula.").setDrawer(y("Rx(f(t))",0,1)).setWidth(2).setExtraDisableReasonFinder(x).setOnClickGateFunc(T("Rx gate's angle in radians")).setEffectToTimeVaryingMatrix(function(e,t){return f((_(t,2*e-1,!0)||0)/Math.PI/4)}).setWithParamPropertyRecomputeFunc(S).promiseEffectIsUnitary().gate.withParam("pi t^2"),v.FormulaicRotationRy=(new e).setSerializedIdAndSymbol("Ryft").setTitle("Formula Ry Gate").setBlurb("Rotates around Y by an angle in radians determined by a formula.").setDrawer(y("Ry(f(t))",1,1)).setWidth(2).setExtraDisableReasonFinder(x).setOnClickGateFunc(T("Ry gate's angle in radians")).setEffectToTimeVaryingMatrix(function(e,t){return h((_(t,2*e-1,!0)||0)/Math.PI/4)}).setWithParamPropertyRecomputeFunc(S).promiseEffectIsUnitary().gate.withParam("pi t^2"),v.FormulaicRotationRz=(new e).setSerializedIdAndSymbol("Rzft").setTitle("Formula Rz Gate").setBlurb("Rotates around Z by an angle in radians determined by a formula.").setDrawer(y("Rz(f(t))",2,1)).setWidth(2).setExtraDisableReasonFinder(x).setOnClickGateFunc(T("Rz gate's angle in radians")).setEffectToTimeVaryingMatrix(function(e,t){return g((_(t,2*e-1,!0)||0)/Math.PI/4)}).setWithParamPropertyRecomputeFunc(S).promiseEffectOnlyPhases().gate.withParam("pi t^2"),v.all=[v.XToA,v.XToMinusA,v.YToA,v.YToMinusA,v.ZToA,v.ZToMinusA,v.FormulaicRotationX,v.FormulaicRotationY,v.FormulaicRotationZ,v.FormulaicRotationRx,v.FormulaicRotationRy,v.FormulaicRotationRz],{get ParametrizedRotationGates(){return v}}}),$traceurRuntime.registerModule("src/gates/PhaseGradientGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/gates/PhaseGradientGates.js")).Config,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/PhaseGradientGates.js")).Gate,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GatePainting.js","src/gates/PhaseGradientGates.js")).GatePainting,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/KetShaderUtil.js","src/gates/PhaseGradientGates.js")),i=r.ketArgs,r=r.ketShaderPhase,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./MultiplyAccumulateGates.js","src/gates/PhaseGradientGates.js")).MUL_STEP,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglArg.js","src/gates/PhaseGradientGates.js")).WglArg,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/gates/PhaseGradientGates.js")).Matrix,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Complex.js","src/gates/PhaseGradientGates.js")).Complex,l=r("\n        uniform float factor;\n\n        /// Scales an angle by an integer factor.\n        /// Performs the multiplication gradually, to avoid losing precision.\n        float angle_mul(float base_angle, float whole_factor) {\n            float result = 0.0;\n            for (int k = 0; k < "+Math.ceil(e.MAX_WIRE_COUNT/a)+"; k++) {\n                result += base_angle * mod(whole_factor, "+(1<<a)+".0);\n                result = mod(result, 6.283185307179586476925286766559);\n                whole_factor = floor(whole_factor / "+(1<<a)+".0);\n                base_angle = mod(base_angle * "+(1<<a)+".0, 6.283185307179586476925286766559);\n            }\n            return result;\n        }\n    ","\n        return angle_mul(factor, out_id);\n    "),c={};return c.PhaseGradientFamily=t.buildFamily(1,16,function(t,e){return e.setSerializedId("PhaseGradient"+t).setSymbol("Grad^½").setTitle("Half Gradient Gate").setBlurb("Phases the target by an amount proportional its value.").setActualEffectToShaderProvider(function(e){return l.withArgs.apply(l,$traceurRuntime.spread(i(e,t),[o.float("factor",Math.PI/(1<<t))]))}).setKnownEffectToPhaser(function(e){return e/(2<<t)})}),c.PhaseDegradientFamily=t.buildFamily(1,16,function(t,e){return e.setAlternateFromFamily(c.PhaseGradientFamily).setSerializedId("PhaseUngradient"+t).setSymbol("Grad^-½").setTitle("Inverse Half Gradient Gate").setBlurb("Counter-phases the target by an amount proportional its value.").setActualEffectToShaderProvider(function(e){return l.withArgs.apply(l,$traceurRuntime.spread(i(e,t),[o.float("factor",-Math.PI/(1<<t))]))}).setKnownEffectToPhaser(function(e){return-e/(2<<t)})}),c.DynamicPhaseGradientFamily=t.buildFamily(1,16,function(r,e){return e.setSerializedId("grad^t"+r).setSymbol("Grad^t").setTitle("Cycling Gradient Gate").setBlurb("Phases the target by a cycling amount proportional its value.").setActualEffectToShaderProvider(function(e){return l.withArgs.apply(l,$traceurRuntime.spread(i(e,r),[o.float("factor",e.time*Math.PI*2)]))}).setEffectToTimeVaryingMatrix(function(t){return u.generateDiagonal(1<<r,function(e){return s.polar(1,2*t*Math.PI*e)})}).promiseEffectOnlyPhases().setDrawer(n.makeCycleDrawer(-1,-1,1,-Math.PI/2))}),c.DynamicPhaseDegradientFamily=t.buildFamily(1,16,function(r,e){return e.setAlternateFromFamily(c.DynamicPhaseGradientFamily).setSerializedId("grad^-t"+r).setSymbol("Grad^-t").setTitle("Inverse Cycling Gradient Gate").setBlurb("Counter-phases the target by a cycling amount proportional its value.").setActualEffectToShaderProvider(function(e){return l.withArgs.apply(l,$traceurRuntime.spread(i(e,r),[o.float("factor",-e.time*Math.PI*2)]))}).setEffectToTimeVaryingMatrix(function(t){return u.generateDiagonal(1<<r,function(e){return s.polar(1,2*t*Math.PI*-e)})}).promiseEffectOnlyPhases().setDrawer(n.makeCycleDrawer(1,-1,1,Math.PI/2))}),c.all=$traceurRuntime.spread(c.PhaseGradientFamily.all,c.PhaseDegradientFamily.all,c.DynamicPhaseGradientFamily.all,c.DynamicPhaseDegradientFamily.all),{get PhaseGradientGates(){return c},get PHASE_GRADIENT_SHADER(){return l}}}),$traceurRuntime.registerModule("src/gates/PivotFlipGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/PivotFlipGates.js")).Gate,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/KetShaderUtil.js","src/gates/PivotFlipGates.js")),r=t.ketArgs,n=t.ketShaderPermute,t=t.ketInputGateShaderCode,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ModularIncrementGates.js","src/gates/PivotFlipGates.js")).modulusTooBigChecker,a={},o=n("\n        "+t("A")+"\n    ","\n        float a = read_input_A();\n        return out_id >= a ? out_id : a - out_id - 1.0;\n    ");return a.FlipUnderA=e.buildFamily(1,16,function(t,e){return e.setSerializedId("Flip<A"+t).setSymbol("Flip\n< A").setTitle("Pivot-Flip Gate").setBlurb("Reverses the order of states below the pivot value.").setRequiredContextKeys("Input Range A").setExtraDisableReasonFinder(i("A",t,"pivot")).setActualEffectToShaderProvider(function(e){return o.withArgs.apply(o,$traceurRuntime.spread(r(e,t,["A"])))}).setKnownEffectToParametrizedPermutation(function(e,t){return t<=e?e:t-e-1})}),a.all=$traceurRuntime.spread(a.FlipUnderA.all),{get PivotFlipGates(){return a}}}),$traceurRuntime.registerModule("src/gates/PostSelectionGates.js",[],function(){"use strict";function e(e){var t,r,n,i;e.isInToolbox||e.isHighlighted?a.DEFAULT_DRAWER(e):(e.painter.fillRect(e.rect,"white"),a.paintGateSymbol(e)),e.isInToolbox||(t=(i=e.rect).x,r=i.y,n=i.w,i=i.h,e.painter.print("post-",t+n/2,r,"center","hanging","red","10px sans-serif",n,i/2),e.painter.print("select",t+n/2,r+i,"center","bottom","red","10px sans-serif",n,i/2))}var t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Complex.js","src/gates/PostSelectionGates.js")).Complex,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/PostSelectionGates.js")).GateBuilder,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GatePainting.js","src/gates/PostSelectionGates.js")).GatePainting,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/gates/PostSelectionGates.js")).Matrix,i={};return i.PostSelectOff=(new r).setSerializedIdAndSymbol("|0⟩⟨0|").setTitle("Postselect Off").setBlurb("Keeps OFF states, discards/retries ON states.").setDrawer(e).setKnownEffectToMatrix(n.square(1,0,0,0)).gate,i.PostSelectOn=(new r).setAlternate(i.PostSelectOff).setSerializedIdAndSymbol("|1⟩⟨1|").setTitle("Postselect On").setBlurb("Keeps On states, discards/retries Off states.").setDrawer(e).setKnownEffectToMatrix(n.square(0,0,0,1)).gate,i.PostSelectAntiX=(new r).setSerializedId("|+⟩⟨+|").setSymbol("|+⟩⟨+|").setTitle("Postselect X-Off").setBlurb("Keeps ON+OFF states, discards/retries ON-OFF states.").setDrawer(e).setKnownEffectToMatrix(n.square(1,1,1,1).times(.5)).gate,i.PostSelectX=(new r).setAlternate(i.PostSelectAntiX).setSerializedId("|-⟩⟨-|").setSymbol("|-⟩⟨-|").setTitle("Postselect X-On").setBlurb("Keeps ON-OFF states, discards/retries ON+OFF states.").setDrawer(e).setKnownEffectToMatrix(n.square(1,-1,-1,1).times(.5)).gate,i.PostSelectAntiY=(new r).setSerializedId("|X⟩⟨X|").setSymbol("|i⟩⟨i|").setTitle("Postselect Y-Off").setBlurb("Keeps ON+iOFF states, discards ON-iOFF states.").setDrawer(e).setKnownEffectToMatrix(n.square(1,t.I.neg(),t.I,1).times(.5)).gate,i.PostSelectY=(new r).setAlternate(i.PostSelectAntiY).setSerializedId("|/⟩⟨/|").setSymbol("|-i⟩⟨-i|").setTitle("Postselect Y-On").setBlurb("Keeps ON-iOFF states, discards/retries ON+iOFF states.").setDrawer(e).setKnownEffectToMatrix(n.square(1,t.I,t.I.neg(),1).times(.5)).gate,i.all=[i.PostSelectOff,i.PostSelectOn,i.PostSelectAntiX,i.PostSelectX,i.PostSelectAntiY,i.PostSelectY],{get PostSelectionGates(){return i}}}),$traceurRuntime.registerModule("src/gates/PoweringGates.js",[],function(){"use strict";function t(e){var t=Math.cos(u*e)/2,e=Math.sin(u*e)/2;return new a(2,2,new Float32Array([.5+t,e,.5-t,-e,.5-t,-e,.5+t,e]))}function r(e){var t=Math.cos(u*e)/2,e=Math.sin(u*e)/2;return new a(2,2,new Float32Array([.5+t,e,-e,t-.5,e,.5-t,.5+t,e]))}function n(e){var t=Math.cos(u*e),e=Math.sin(u*e);return new a(2,2,new Float32Array([1,0,0,0,0,0,t,e]))}var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/PoweringGates.js")).GateBuilder,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GatePainting.js","src/gates/PoweringGates.js")).GatePainting,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/gates/PoweringGates.js")).Matrix,o={},u=2*Math.PI;return o.XForward=(new e).setSerializedIdAndSymbol("X^t").setTitle("X-Raising Gate (forward)").setBlurb("Right-handed cycle from no-op to X.").setDrawer(i.makeCycleDrawer(1,1)).setEffectToTimeVaryingMatrix(t).promiseEffectIsUnitary().gate,o.XBackward=(new e).setAlternate(o.XForward).setSerializedIdAndSymbol("X^-t").setTitle("X-Raising Gate (backward)").setBlurb("Left-handed cycle from no-op to X.").setDrawer(i.makeCycleDrawer(-1,1)).setEffectToTimeVaryingMatrix(function(e){return t(-e)}).promiseEffectIsUnitary().gate,o.YForward=(new e).setSerializedIdAndSymbol("Y^t").setTitle("Y-Raising Gate (forward)").setBlurb("Right-handed cycle from no-op to Y.").setDrawer(i.makeCycleDrawer(.5,1)).setEffectToTimeVaryingMatrix(r).promiseEffectIsUnitary().gate,o.YBackward=(new e).setAlternate(o.YForward).setSerializedIdAndSymbol("Y^-t").setTitle("Y-Raising Gate (backward)").setBlurb("Left-handed cycle from no-op to Y.").setDrawer(i.makeCycleDrawer(-.5,1)).setEffectToTimeVaryingMatrix(function(e){return r(-e)}).promiseEffectIsUnitary().gate,o.ZForward=(new e).setSerializedIdAndSymbol("Z^t").setTitle("Z-Raising Gate (forward)").setBlurb("Right-handed cycle from no-op to Z.").setDrawer(i.makeCycleDrawer(-1,-.5)).setEffectToTimeVaryingMatrix(n).promiseEffectOnlyPhases().gate,o.ZBackward=(new e).setAlternate(o.ZForward).setSerializedIdAndSymbol("Z^-t").setTitle("Z-Raising Gate (backward)").setBlurb("Left-handed cycle from no-op to Z.").setDrawer(i.makeCycleDrawer(1,-.5)).setEffectToTimeVaryingMatrix(function(e){return n(-e)}).promiseEffectOnlyPhases().gate,o.all=[o.XForward,o.YForward,o.ZForward,o.XBackward,o.YBackward,o.ZBackward],{get PoweringGates(){return o}}}),$traceurRuntime.registerModule("src/gates/ProbabilityDisplay.js",[],function(){"use strict";var r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Complex.js","src/gates/ProbabilityDisplay.js")).Complex,ee=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/gates/ProbabilityDisplay.js")).Config,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/ProbabilityDisplay.js")).Gate,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GatePainting.js","src/gates/ProbabilityDisplay.js")).GatePainting,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/GateShaders.js","src/gates/ProbabilityDisplay.js")).GateShaders,te=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/MathPainter.js","src/gates/ProbabilityDisplay.js")).MathPainter,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/gates/ProbabilityDisplay.js")).Matrix,re=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Point.js","src/gates/ProbabilityDisplay.js")).Point,ne=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Rect.js","src/gates/ProbabilityDisplay.js")).Rect,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Seq.js","src/gates/ProbabilityDisplay.js")).Seq,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/Shaders.js","src/gates/ProbabilityDisplay.js")).Shaders,ie=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/gates/ProbabilityDisplay.js")).Util,t=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglConfiguredShader.js","src/gates/ProbabilityDisplay.js")).WglConfiguredShader,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/ShaderCoders.js","src/gates/ProbabilityDisplay.js"))),a=t.Inputs,l=t.Outputs,c=t.currentShaderCoder,t=t.makePseudoShaderWithInputsAndOutputAndCode,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglTexturePool.js","src/gates/ProbabilityDisplay.js")).WglTexturePool,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../webgl/WglTextureTrader.js","src/gates/ProbabilityDisplay.js")).WglTextureTrader;function f(e,t,r,n){var i=new m(e),a=(i.dontDeallocCurrentTexture(),c().vec2.arrayPowerSizeOfTexture(e));for(i.shadeAndTrade(function(e){return h(e,t)},d.takeVecFloatTex(a)),i.shadeAndTrade(function(e){return o.cycleAllBitsFloat(e,-r)});n<a;)--a,i.shadeHalveAndTrade(s.sumFoldFloat);return c().float.needRearrangingToBeInVec4Format&&i.shadeQuarterAndTrade(s.packFloatIntoVec4),i.currentTexture}var h=function(e,t){return g(e,t)},g=t([a.vec2("input"),a.bool("control")],l.float(),"float outputFor(float k) {\n        vec2 amp = read_input(k);\n        return dot(amp, amp) * read_control(k);\n    }");function p(e,t){for(var r=1<<t,n=0,i=0;i<r;i++)n+=e[i];if(isNaN(n)||n<1e-6)return u.zero(1,r).times(NaN);for(var a=new Float32Array(2*r),o=0;o<r;o++)a[2*o]=e[o]/n;return new u(1,r,a)}function v(t){return{probabilities:i.range(t.height()).map(function(e){return r.realPartOf(t.cell(0,e))}).toArray()}}function y(e){u=(s=e).painter,r=(t=s.rect).x,n=t.y,i=t.w,t=t.h,a=1<<s.gate.height,o=t/a,u.fillRect(s.rect,ee.DISPLAY_GATE_BACK_COLOR),o<1?(s.painter.ctx.save(),s.painter.ctx.globalAlpha*=.2,u.fillRect(s.rect,"lightgray"),s.painter.ctx.restore()):(t=s.gate.height-5,u.trace(function(e){for(var t=1;t<a;t++)e.line(r,n+o*t,r+i,n+o*t)}).thenStroke("lightgray",t<=0?1:1/t),u.strokeRect(s.rect,"lightgray"));var r,n,i,a,o,t=e.customStats;if(void 0===t||t.hasNaN())e.painter.printParagraph("NaN",e.rect,new re(.5,.5),"red");else{var u=8<e.rect.h/t.height();if(!u){for(var s=e,l=s.painter,c=(t=s.rect).x,d=t.y,N=t.w,t=t.h,D=s.customStats,m=1<<s.gate.height,f=t/m,F=Math.max(f,1),O=(l.ctx.save(),l.ctx.beginPath(),l.ctx.moveTo(c,d),1/(4+Math.max(8,s.gate.height))),h=0;h<m;h++){var g=D.rawBuffer()[2*h],g=c+N*Math.min(1,Math.max(0,1+Math.log(g)*O)),p=d+f*h;l.ctx.lineTo(g,p),l.ctx.lineTo(g,p+F)}l.ctx.lineTo(c,d+t),l.ctx.lineWidth=1,l.ctx.strokeStyle="#CCC",l.ctx.stroke(),l.ctx.restore()}var s=e,v=s.painter,y=(t=s.rect).x,b=t.y,z=t.w,t=t.h,B=s.customStats,R=1<<s.gate.height,w=t/R,L=Math.max(w,1);v.ctx.save(),v.ctx.beginPath(),v.ctx.moveTo(y,b);for(var M=0;M<R;M++){var _=y+z*B.rawBuffer()[2*M],x=b+w*M;v.ctx.lineTo(_,x),v.ctx.lineTo(_,x+L)}if(v.ctx.lineTo(y,b+t),v.ctx.lineTo(y,b),v.ctx.strokeStyle="gray",v.ctx.lineWidth=1,v.ctx.stroke(),v.ctx.fillStyle=ee.DISPLAY_GATE_FORE_COLOR,v.ctx.fill(),v.ctx.restore(),u)for(var s=e,U=s.painter,W=(t=s.rect).x,H=t.y,S=t.w,t=t.h,T=s.customStats,A=t/T.height(),C=0;C<T.height();C++){var q=T.rawBuffer()[2*C];U.print((100*q).toFixed(1)+"%",W+S-2,H+A*(C+.5),"right","middle","black","8pt monospace",S-4,A)}}var E=e,X=E.painter,Y=(u=E.rect).x,I=u.y,K=u.w,u=u.h,V=E.customStats,Z=1<<E.gate.height,j=u/Z,$=!0,u=!1,s=void 0;try{for(var Q,P=E.focusPoints[Symbol.iterator]();!($=(Q=P.next()).done);$=!0){var G,J=Q.value,k=Math.floor((J.y-I)/j);E.rect.containsPoint(J)&&0<=k&&k<Z&&(G=void 0===V?NaN:V.rawBuffer()[2*k],X.strokeRect(new ne(Y,I+k*j,K,j),"orange",2),te.paintDeferredValueTooltip(X,Y+K,I+k*j,"Chance of |"+ie.bin(k,E.gate.height)+"⟩ (decimal "+k+") if measured","raw: "+(100*G).toFixed(4)+"%","log: "+(10*Math.log10(G)).toFixed(1)+" dB"))}}catch(e){u=!0,s=e}finally{try{$||null==P.return||P.return()}finally{if(u)throw s}}}function b(e){return e.setSymbol("Chance").setTitle("Probability Display").setBlurb("Shows chances of outcomes if a measurement was performed.\nUse controls to see conditional probabilities.").promiseHasNoNetEffectOnStateVector().setExtraDisableReasonFinder(function(e){return e.isNested?"can't\nnest\ndisplays\n(sorry)":void 0})}var R=e.buildFamily(1,16,function(e,t){return 1===e?b(t).setSerializedId("Chance").markAsDrawerNeedsSingleQubitDensityStats().setDrawer(n.makeDisplayDrawer(function(e){var t=e.positionInCircuit,r=t.row,t=t.col;te.paintProbabilityBox(e.painter,e.stats.controlledWireProbabilityJustAfter(r,t),e.rect,e.focusPoints)})):(r=e,b(t).setSerializedId("Chance"+r).setStatTexturesMaker(function(e){return f(e.stateTrader.currentTexture,e.controlsTexture,e.row,r)}).setStatPixelDataPostProcessor(function(e){return p(e,r)}).setProcessedStatsToJsonFunc(v).setDrawer(n.makeDisplayDrawer(y)));var r});return{get ProbabilityDisplayFamily(){return R},get probabilityStatTexture(){return f},get probabilityPixelsToColumnVector(){return p},get amplitudesToProbabilities(){return h},get probabilityDataToJson(){return v}}}),$traceurRuntime.registerModule("src/gates/QuarterTurnGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/QuarterTurnGates.js")),e=(e.Gate,e.GateBuilder),t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/gates/QuarterTurnGates.js")).Matrix,r={};return r.SqrtXForward=(new e).setSerializedIdAndSymbol("X^½").setTitle("√X Gate").setBlurb("Principle square root of Not.").setKnownEffectToMatrix(t.fromPauliRotation(.25,0,0)).gate,r.SqrtXBackward=(new e).setAlternate(r.SqrtXForward).setSerializedIdAndSymbol("X^-½").setTitle("X^-½ Gate").setBlurb("Adjoint square root of Not.").setKnownEffectToMatrix(t.fromPauliRotation(.75,0,0)).gate,r.SqrtYForward=(new e).setSerializedIdAndSymbol("Y^½").setTitle("√Y Gate").setBlurb("Principle square root of Y.").setKnownEffectToMatrix(t.fromPauliRotation(0,.25,0)).gate,r.SqrtYBackward=(new e).setAlternate(r.SqrtYForward).setSerializedIdAndSymbol("Y^-½").setTitle("Y^-½ Gate").setBlurb("Adjoint square root of Y.").setKnownEffectToMatrix(t.fromPauliRotation(0,.75,0)).gate,r.SqrtZForward=(new e).setSerializedId("Z^½").setSymbol("S").setTitle("√Z Gate").setBlurb("Principle square root of Z.\nAlso known as the 'S' gate.").setKnownEffectToMatrix(t.fromPauliRotation(0,0,.25)).gate,r.SqrtZBackward=(new e).setAlternate(r.SqrtZForward).setSerializedId("Z^-½").setSymbol("S^-1").setTitle("Z^-½ Gate").setBlurb("Adjoint square root of Z.").setKnownEffectToMatrix(t.fromPauliRotation(0,0,.75)).gate,r.all=[r.SqrtXForward,r.SqrtYForward,r.SqrtZForward,r.SqrtXBackward,r.SqrtYBackward,r.SqrtZBackward],{get QuarterTurnGates(){return r}}}),$traceurRuntime.registerModule("src/gates/ReverseBitsGate.js",[],function(){"use strict";function r(r){return function(e){var t;return(t=o[r]).withArgs.apply(t,$traceurRuntime.spread(i(e,r)))}}var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/gates/ReverseBitsGate.js")).Config,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/ReverseBitsGate.js")).Gate,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/KetShaderUtil.js","src/gates/ReverseBitsGate.js")),i=n.ketArgs,a=n.ketShaderPermute,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Seq.js","src/gates/ReverseBitsGate.js")).Seq.range(e.MAX_WIRE_COUNT+1).map(function(e){return e<2?void 0:a("","\n        float rev = 0.0;\n        for (int k = 0; k < "+e+"; k++) {\n            rev *= 2.0;\n            rev += mod(out_id, 2.0);\n            out_id = floor(out_id*0.5);\n        }\n        return rev;\n    ",e)}).toArray(),u=t.buildFamily(2,16,function(t,e){return e.setSerializedId("rev"+t).setSymbol("Reverse").setTitle("Reverse Order").setBlurb("Swaps bits into the opposite order.").setKnownEffectToBitPermutation(function(e){return t-1-e}).setActualEffectToShaderProvider(r(t))});return{get ReverseBitsGateFamily(){return u},get reverseShaderForSize(){return r}}}),$traceurRuntime.registerModule("src/gates/SampleDisplay.js",[],function(){"use strict";var y=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/gates/SampleDisplay.js")).Config,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/SampleDisplay.js")).Gate,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GatePainting.js","src/gates/SampleDisplay.js")).GatePainting,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/MathPainter.js","src/gates/SampleDisplay.js")).MathPainter,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Point.js","src/gates/SampleDisplay.js")).Point,R=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Rect.js","src/gates/SampleDisplay.js")).Rect,w=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/gates/SampleDisplay.js")).Util,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ProbabilityDisplay.js","src/gates/SampleDisplay.js")),i=t.probabilityStatTexture,a=t.probabilityPixelsToColumnVector,o=t.probabilityDataToJson;function u(e){for(var t=e.painter,r=e.rect,n=r.x,i=r.y,a=r.w,r=r.h,o=y.WIRE_SPACING,u=i+r/2-o*e.gate.height/2,r=function(e){for(var t=e.customStats,r=t.rawBuffer(),n=e.painter.rng.random(),i=t.height(),a=0;;a++){var o=r[2*a];if(n-=o,a===i-1||n<1e-5)return{i:a,p:o}}}(e),s=r.i,l=r.p,c=0;c<e.gate.height;c++){var d=0!=(s>>c&1);d&&t.fillRect(new R(n,u+o*c+5,a,o-10),y.OPERATION_FORE_COLOR),t.print(d?"on":"off",n+a/2,u+o*(c+.5),"center","middle","black","16px sans-serif",a,o)}var m=!0,r=!1,f=void 0;try{for(var h,g=e.focusPoints[Symbol.iterator]();!(m=(h=g.next()).done);m=!0){var p=h.value,v=Math.floor(2*(p.y-i)/o)/2;e.rect.containsPoint(p)&&b.paintDeferredValueTooltip(t,n+a,i+v*o,"Sampled |"+w.bin(s,e.gate.height)+"⟩","decimal: |"+s+"⟩","chance: "+(100*l).toFixed(4)+"%",y.OPERATION_BACK_COLOR)}}catch(e){r=!0,f=e}finally{try{m||null==g.return||g.return()}finally{if(r)throw f}}}function s(e){e.painter.fillRect(e.rect,y.OPERATION_BACK_COLOR);var t=e.customStats;void 0===t||t.hasNaN()?e.painter.printParagraph("NaN",e.rect,new n(.5,.5),"red"):u(e),e.painter.strokeRect(e.rect,"lightgray")}var l=e.buildFamily(1,16,function(t,e){return e.setSerializedId("Sample"+t).setSymbol("Sample").setTitle("Sampled Results Display").setBlurb("Shows a random sample of possible measurement outcomes.\nUse controls to see conditional samples.").setStatTexturesMaker(function(e){return i(e.stateTrader.currentTexture,e.controlsTexture,e.row,t)}).setStatPixelDataPostProcessor(function(e){return a(e,t)}).promiseHasNoNetEffectOnStateVectorButStillRequiresDynamicRedraw().setProcessedStatsToJsonFunc(o).setDrawer(r.makeDisplayDrawer(s)).setExtraDisableReasonFinder(function(e){return e.isNested?"can't\nnest\ndisplays\n(sorry)":void 0})});return{get SampleDisplayFamily(){return l}}}),$traceurRuntime.registerModule("src/gates/SpacerGate.js",[],function(){"use strict";var n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/gates/SpacerGate.js")).Config,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/SpacerGate.js")).GateBuilder,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GatePainting.js","src/gates/SpacerGate.js")).GatePainting,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Rect.js","src/gates/SpacerGate.js")).Rect,t=(new e).setSerializedIdAndSymbol("…").setTitle("Spacer").setBlurb("A gate with no effect.").markAsNotInterestedInControls().promiseHasNoNetEffectOnStateVector().setDrawer(function(e){var t,r;e.isInToolbox||e.isHighlighted?(t=n.GATE_FILL_COLOR,e.isHighlighted&&(t=n.HIGHLIGHTED_GATE_FILL_COLOR),e.painter.fillRect(e.rect,t),i.paintOutline(e)):(r=(t=e.rect.center()).x,t=t.y,r=new a(r-14,t-2,28,4),e.painter.fillRect(r,n.BACKGROUND_COLOR_CIRCUIT)),e.painter.fillCircle(e.rect.center().offsetBy(7,0),2,"black"),e.painter.fillCircle(e.rect.center(),2,"black"),e.painter.fillCircle(e.rect.center().offsetBy(-7,0),2,"black")}).gate;return{get SpacerGate(){return t}}}),$traceurRuntime.registerModule("src/gates/SwapGateHalf.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/SwapGateHalf.js")).GateBuilder,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GatePainting.js","src/gates/SwapGateHalf.js")).GatePainting,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/gates/SwapGateHalf.js")).Matrix,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Rect.js","src/gates/SwapGateHalf.js")).Rect,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Seq.js","src/gates/SwapGateHalf.js")).Seq,a=(new e).setSerializedIdAndSymbol("Swap").setTitle("Swap Gate [Half]").setBlurb("Swaps the values of two qubits.\n(Place two in the same column.)").setKnownEffectToMatrix(t.square(1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1)).setDrawer(function(e){var t;e.isInToolbox||e.isHighlighted?r.DEFAULT_DRAWER(e):(t=n.centeredSquareWithRadius(e.rect.center(),e.rect.w/6),e.painter.strokeLine(t.topLeft(),t.bottomRight()),e.painter.strokeLine(t.topRight(),t.bottomLeft()))}).setExtraDisableReasonFinder(function(t){var r=t.innerColumn,e=i.range(r.gates.length).filter(function(e){return r.gates[e]===a}),n=e.count();return 1===n?"need\nother\nswap":2<n?"too\nmany\nswap":(n=e.any(function(e){return 0!=(t.measuredMask&1<<e)}),e=e.any(function(e){return 0==(t.measuredMask&1<<e)}),n&&r.hasCoherentControl(t.measuredMask)||n&&e&&r.hasControl()?"no\nremix\n(sorry)":void 0)}).gate;return{get SwapGateHalf(){return a}}}),$traceurRuntime.registerModule("src/gates/VariousXGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/VariousXGates.js")).Gate,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/gates/VariousXGates.js")).Matrix,r={};return r.X3=e.fromKnownMatrix("X^⅓",t.fromPauliRotation(1/6,0,0),"X^⅓ Gate","Principle third root of X."),r.X3i=e.fromKnownMatrix("X^-⅓",t.fromPauliRotation(-1/6,0,0),"X^-⅓ Gate","Adjoint third root of X.",void 0,r.X3),r.X4=e.fromKnownMatrix("X^¼",t.fromPauliRotation(1/8,0,0),"X^¼ Gate","Principle fourth root of X."),r.X4i=e.fromKnownMatrix("X^-¼",t.fromPauliRotation(-1/8,0,0),"X^-¼ Gate","Adjoint fourth root of X.",void 0,r.X4),r.X8=e.fromKnownMatrix("X^⅛",t.fromPauliRotation(1/16,0,0),"X^⅛ Gate","Principle eighth root of X."),r.X8i=e.fromKnownMatrix("X^-⅛",t.fromPauliRotation(-1/16,0,0),"X^-⅛ Gate","Adjoint eighth root of X.",void 0,r.X8),r.X16=e.fromKnownMatrix("X^⅟₁₆",t.fromPauliRotation(1/32,0,0),"X^⅟₁₆ Gate","Principle sixteenth root of X."),r.X16i=e.fromKnownMatrix("X^-⅟₁₆",t.fromPauliRotation(-1/32,0,0),"X^-⅟₁₆ Gate","Adjoint sixteenth root of X.",void 0,r.X16),r.X32=e.fromKnownMatrix("X^⅟₃₂",t.fromPauliRotation(1/64,0,0),"X^⅟₃₂ Gate","Principle 32'nd root of X."),r.X32i=e.fromKnownMatrix("X^-⅟₃₂",t.fromPauliRotation(-1/64,0,0),"X^-⅟₃₂ Gate","Adjoint 32'nd root of X.",void 0,r.X32),r.all=[r.X3,r.X4,r.X8,r.X16,r.X32,r.X3i,r.X4i,r.X8i,r.X16i,r.X32i],{get VariousXGates(){return r}}}),$traceurRuntime.registerModule("src/gates/VariousYGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/VariousYGates.js")).Gate,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/gates/VariousYGates.js")).Matrix,r={};return r.Y3=e.fromKnownMatrix("Y^⅓",t.fromPauliRotation(0,1/6,0),"Y^⅓ Gate","Principle third root of Y."),r.Y3i=e.fromKnownMatrix("Y^-⅓",t.fromPauliRotation(0,-1/6,0),"Y^-⅓ Gate","Adjoint third root of Y.",void 0,r.Y3),r.Y4=e.fromKnownMatrix("Y^¼",t.fromPauliRotation(0,1/8,0),"Y^¼ Gate","Principle fourth root of Y."),r.Y4i=e.fromKnownMatrix("Y^-¼",t.fromPauliRotation(0,-1/8,0),"Y^-¼ Gate","Adjoint fourth root of Y.",void 0,r.Y4),r.Y8=e.fromKnownMatrix("Y^⅛",t.fromPauliRotation(0,1/16,0),"Y^⅛ Gate","Principle eighth root of Y."),r.Y8i=e.fromKnownMatrix("Y^-⅛",t.fromPauliRotation(0,-1/16,0),"Y^-⅛ Gate","Adjoint eighth root of Y.",void 0,r.Y8),r.Y16=e.fromKnownMatrix("Y^⅟₁₆",t.fromPauliRotation(0,1/32,0),"Y^⅟₁₆ Gate","Principle sixteenth root of Y."),r.Y16i=e.fromKnownMatrix("Y^-⅟₁₆",t.fromPauliRotation(0,-1/32,0),"Y^-⅟₁₆ Gate","Adjoint sixteenth root of Y.",void 0,r.Y16),r.Y32=e.fromKnownMatrix("Y^⅟₃₂",t.fromPauliRotation(0,1/64,0),"Y^⅟₃₂ Gate","Principle 32'nd root of Y."),r.Y32i=e.fromKnownMatrix("Y^-⅟₃₂",t.fromPauliRotation(0,-1/64,0),"Y^-⅟₃₂ Gate","Adjoint 32'nd root of Y.",void 0,r.Y32),r.all=[r.Y3,r.Y4,r.Y8,r.Y16,r.Y32,r.Y3i,r.Y4i,r.Y8i,r.Y16i,r.Y32i],{get VariousYGates(){return r}}}),$traceurRuntime.registerModule("src/gates/VariousZGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/VariousZGates.js")).Gate,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/gates/VariousZGates.js")).Matrix,r={};return r.Z3=e.fromKnownMatrix("Z^⅓",t.fromPauliRotation(0,0,1/6),"Z^⅓ Gate","Principle third root of Z."),r.Z3i=e.fromKnownMatrix("Z^-⅓",t.fromPauliRotation(0,0,-1/6),"Z^-⅓ Gate","Adjoint third root of Z.",void 0,r.Z3),r.Z4=e.fromKnownMatrix("T",t.fromPauliRotation(0,0,1/8),"Z^¼ Gate","Principle fourth root of Z.","Z^¼"),r.Z4i=e.fromKnownMatrix("T^-1",t.fromPauliRotation(0,0,-1/8),"Z^-¼ Gate","Adjoint fourth root of Z.","Z^-¼",r.Z4),r.Z8=e.fromKnownMatrix("Z^⅛",t.fromPauliRotation(0,0,1/16),"Z^⅛ Gate","Principle eighth root of Z."),r.Z8i=e.fromKnownMatrix("Z^-⅛",t.fromPauliRotation(0,0,-1/16),"Z^-⅛ Gate","Adjoint eighth root of Z.",void 0,r.Z8),r.Z16=e.fromKnownMatrix("Z^⅟₁₆",t.fromPauliRotation(0,0,1/32),"Z^⅟₁₆ Gate","Principle 16'th root of Z."),r.Z16i=e.fromKnownMatrix("Z^-⅟₁₆",t.fromPauliRotation(0,0,-1/32),"Z^-⅟₁₆ Gate","Adjoint 16'th root of Z.",void 0,r.Z16),r.Z32=e.fromKnownMatrix("Z^⅟₃₂",t.fromPauliRotation(0,0,1/64),"Z^⅟₃₂ Gate","Principle 32'nd root of Z."),r.Z64=e.fromKnownMatrix("Z^⅟₆₄",t.fromPauliRotation(0,0,1/128),"Z^⅟₆₄ Gate","Principle 64'th root of Z."),r.Z128=e.fromKnownMatrix("Z^⅟₁₂₈",t.fromPauliRotation(0,0,1/256),"Z^⅟₁₂₈ Gate","Principle 128'th root of Z."),r.all=[r.Z3,r.Z4,r.Z8,r.Z16,r.Z32,r.Z64,r.Z128,r.Z3i,r.Z4i,r.Z8i,r.Z16i],{get VariousZGates(){return r}}}),$traceurRuntime.registerModule("src/gates/XorGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/gates/XorGates.js")).Config,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/gates/XorGates.js")).Gate,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/KetShaderUtil.js","src/gates/XorGates.js")),n=r.ketArgs,i=r.ketShaderPermute,r=r.ketInputGateShaderCode,a={},o=i(r("A"),"\n        float srcMask = mod(read_input_A(), span);\n        float bitPos = 1.0;\n        float result = 0.0;\n        for (int i = 0; i < "+e.MAX_WIRE_COUNT+"; i++) {\n            float srcBit = mod(floor(srcMask/bitPos), 2.0);\n            float dstBit = mod(floor(out_id/bitPos), 2.0);\n            result += (dstBit + srcBit - dstBit * srcBit * 2.0) * bitPos;\n            bitPos *= 2.0;\n        }\n        return result;");return a.XorAFamily=t.buildFamily(1,16,function(r,e){return e.setSerializedId("^=A"+r).setSymbol("⊕A").setTitle("Xor Gate [input A]").setBlurb("Xors input A into the qubits covered by this gate.").setRequiredContextKeys("Input Range A").setKnownEffectToParametrizedPermutation(function(e,t){return e^t&(1<<r)-1}).setActualEffectToShaderProvider(function(e){return o.withArgs.apply(o,$traceurRuntime.spread(n(e,r,["A"])))})}),a.all=$traceurRuntime.spread(a.XorAFamily.all),{get XorGates(){return a}}}),$traceurRuntime.registerModule("src/issues.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./fallback.js","src/issues.js")).notifyAboutKnownIssue,t=document.createElement("canvas"),r=t.getContext("webgl")||t.getContext("experimental-webgl");function n(){null==r&&e("Can't simulate circuits. Your browser doesn't support WebGL, or has it disabled.","https://github.com/Strilanc/Quirk/issues/168",[/Computing circuit values failed/,/Error creating WebGL context./])}return{get doDetectIssues(){return n},get canvasCreatedForTesting(){return t},get webglContextCreatedForTesting(){return r}}}),$traceurRuntime.registerModule("src/main.js",[],function(){"use strict";$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./browser/Polyfills.js","src/main.js")),(0,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./fallback.js","src/main.js")).hookErrorHandler)();(0,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./issues.js","src/main.js")).doDetectIssues)();var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./circuit/CircuitStats.js","src/main.js")).CircuitStats,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./base/CooldownThrottle.js","src/main.js")).CooldownThrottle,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./Config.js","src/main.js")).Config,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ui/DisplayedInspector.js","src/main.js")).DisplayedInspector,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./draw/Painter.js","src/main.js")).Painter,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./math/Rect.js","src/main.js")).Rect,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./base/RestartableRng.js","src/main.js")).RestartableRng,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./base/Revision.js","src/main.js")).Revision,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./circuit/Serializer.js","src/main.js")),l=s.initSerializer,c=s.fromJsonText_CircuitDefinition,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./browser/TouchScrollBlocker.js","src/main.js")).TouchScrollBlocker,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./base/Util.js","src/main.js")).Util,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./webgl/WglContext.js","src/main.js")).initializedWglContext,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./browser/MouseWatcher.js","src/main.js")),h=f.watchDrags,g=f.isMiddleClicking,p=f.eventPosRelativeTo,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./base/Obs.js","src/main.js")),v=f.ObservableValue,f=f.ObservableSource,y=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ui/exports.js","src/main.js")),N=y.initExports,y=y.obsExportsIsShowing,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ui/forge.js","src/main.js")),D=b.initForge,b=b.obsForgeIsShowing,R=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ui/menu.js","src/main.js")),F=R.initMenu,O=R.obsMenuIsShowing,z=R.closeMenu,R=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ui/undo.js","src/main.js")).initUndoRedo,B=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ui/clear.js","src/main.js")).initClear,L=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ui/url.js","src/main.js")).initUrlCircuitSync,U=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ui/title.js","src/main.js")).initTitleSync,W=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ui/sim.js","src/main.js")).simulate,w=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./draw/GatePainting.js","src/main.js")).GatePainting,H=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ui/DisplayedCircuit.js","src/main.js")).GATE_CIRCUIT_DRAWER,q=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./circuit/GateColumn.js","src/main.js")).GateColumn,X=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./math/Point.js","src/main.js")).Point,M=(l(w.LABEL_DRAWER,w.MATRIX_DRAWER,H,w.LOCATION_INDEPENDENT_GATE_DRAWER),document.getElementById("canvasDiv")),_=document.getElementById("drawCanvas");if(!_)throw new Error("Couldn't find 'drawCanvas'");_.width=M.clientWidth,_.height=.9*window.innerHeight;function x(e){var t=$(e);return e.updateArea(new a(0,0,t.w,t.h)),e}function S(){var e,t,r;C&&(e=x(E.get()).previewDrop(),E.get().hand.isHoldingSomething()&&!e.hand.isHoldingSomething()&&(e=e.withHand(e.hand.withHeldGateColumn(new q([]),new X(0,0)))),t=W(e.displayedCircuit.circuitDefinition),I.set(t),r=$(e),_.width=r.w,_.height=r.h,r=new i(_,Y.cur.restarted()),e.updateArea(r.paintableArea()),e.paint(r,t),r.paintDeferred(),E.get().hand.paintCursor(r),V.setBlockers(r.touchBlockers,r.desiredCursorStyle),_.style.cursor=r.desiredCursorStyle||"auto",E.get().stableDuration()<1/0)&&window.requestAnimationFrame(function(){return P.trigger()})}var T,A,C=!1,Y=(T={cur:new o},(A=function(){T.cur=new o,setTimeout(A,.99*r.SEMI_STABLE_RANDOM_VALUE_LIFETIME_MILLIS)})(),T),K=document.getElementById("inspectorDiv"),E=new v(n.empty(new a(0,0,_.clientWidth,_.clientHeight))),I=new v(e.EMPTY),j=u.startingAt(E.get().snapshot()),$=(j.latestActiveCommit().subscribe(function(e){e=c(e),e=E.get().withCircuitDefinition(e);E.set(e)}),function(e){return{w:Math.max(M.clientWidth,e.desiredWidth()),h:e.desiredHeight()}}),V=(E.observable().map(function(e){return e.displayedCircuit.circuitDefinition}).whenDifferent(d.CUSTOM_IS_EQUAL_TO_EQUALITY).subscribe(function(){var e=document.getElementById("error-div").style;e.opacity*=.9,e.opacity<.06&&(e.display="None")}),new s(M)),P=new t(S,r.REDRAW_COOLDOWN_MILLIS,.1,!0),G=(window.addEventListener("resize",function(){return P.trigger()},!1),E.observable().subscribe(function(){return P.trigger()}),void 0),k=(M.addEventListener("click",function(e){var e=p(e,M),t=E.get();t.tryGetHandOverButtonKey()===G&&void 0!==(t=x(t.withHand(t.hand.withPos(e))).tryClick())&&j.commit(t.afterTidyingUp().snapshot())}),h(M,function(e,t){var r=E.get(),e=r.hand.withPos(e),n=x(r.withHand(e));void 0!==(G=t.ctrlKey||t.metaKey||t.shiftKey||t.altKey?void 0:n.tryGetHandOverButtonKey())?E.set(n):(n=n.afterGrabbing(t.shiftKey,t.ctrlKey||t.metaKey),!E.get().isEqualTo(n)&&n.hand.isBusy()&&(j.startedWorkingOnCommit(),E.set(x(r.withHand(e).withJustEnoughWires(n.hand,1)).afterGrabbing(t.shiftKey,t.ctrlKey||t.metaKey,!1,t.altKey)),t.preventDefault()))},function(e){j.cancelCommitBeingWorkedOn(),e.preventDefault()},function(e,t){E.get().hand.isBusy()&&(e=E.get().hand.withPos(e),e=E.get().withHand(e),E.set(e),t.preventDefault())},function(e,t){var r;E.get().hand.isBusy()&&(e=E.get().hand.withPos(e),r=(e=x(E.get()).withHand(e).afterDropping().afterTidyingUp()).hand.withPos(void 0),e=e.withJustEnoughWires(r,0),j.commit(e.snapshot()),t.preventDefault())}),M.addEventListener("mousedown",function(e){var t,r,n;g(e)&&(n=(t=x(E.get())).tryGetHandOverButtonKey(),r=t.hand.withPos(p(e,_)),n=void 0!==n&&n.startsWith("wire-init-")?(n=t.displayedCircuit.circuitDefinition.withSwitchedInitialStateOn(parseInt(n.substr(10)),0),t.withCircuitDefinition(n).withHand(r).afterTidyingUp()):t.withHand(r).afterGrabbing(!1,!1,!0,!1).withHand(r).afterTidyingUp().withJustEnoughWires(r,0),E.get().isEqualTo(n)||(j.commit(n.snapshot()),e.preventDefault()))}),M.addEventListener("mousemove",function(e){E.get().hand.isBusy()||(e=E.get().hand.withPos(p(e,_)),e=E.get().withHand(e),E.set(e))}),M.addEventListener("mouseleave",function(){var e;E.get().hand.isBusy()||(e=E.get().hand.withPos(void 0),e=E.get().withHand(e),E.set(e))}),new f);return L(j),N(j,I,k.observable()),D(j,k.observable()),R(j,k.observable()),B(j,k.observable()),F(j,k.observable()),U(j),b.zipLatest(y,function(e,t){return e||t}).zipLatest(O,function(e,t){return e||t}).whenDifferent().subscribe(function(e){k.send(e),M.tabIndex=e?-1:0}),C=!0,setTimeout(function(){K.style.display="block",S(),document.getElementById("loading-div").style.display="none",document.getElementById("close-menu-button").style.display="block",E.get().displayedCircuit.circuitDefinition.isEmpty()||z();try{m().onContextRestored=function(){return P.trigger()}}catch(e){console.error(e)}},0),{}}),$traceurRuntime.registerModule("src/math/Axis.js",[],function(){"use strict";var r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/DetailedError.js","src/math/Axis.js")).DetailedError,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Format.js","src/math/Axis.js")).UNICODE_FRACTIONS,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./FormulaParser.js","src/math/Axis.js")).parseFormula,i=new Map,t=$traceurRuntime.createClass(s,{toString:function(){return this.x+"X + "+this.y+"Y + "+this.z+"Z"},isEqualTo:function(e){return e instanceof s&&e.x===this.x&&e.y===this.y&&e.z===this.z}},{parse:function(e){var t=n(e,i);if(t instanceof s)return t;throw new r("Not an axis.",{text:e,result:t})},classify:function(e){if("number"==typeof e)return!1;if(e instanceof s)return!0;throw new r("Not an axis or a number",{v:e})},op:function(e,t,r,n,i,a){var o=s.classify(e),u=s.classify(t);return(o&&u?a:o||u?o?n:i:r)(e,t)},times:function(e,t){return s.op(e,t,function(e,t){return e*t},function(e,t){return new s(e.x*t,e.y*t,e.z*t)},function(e,t){return new s(t.x*e,t.y*e,t.z*e)},function(e,t){throw new r("Can't multiply axes.",{a:e,b:t})})},add:function(e,t){return s.op(e,t,function(e,t){return e+t},function(e,t){throw new r("Can't add axes to numbers.",{a:e,b:t})},function(e,t){throw new r("Can't add axes to numbers.",{a:e,b:t})},function(e,t){return new s(e.x+t.x,e.y+t.y,e.z+t.z)})},negate:function(e){return s.classify(e)?new s(-e.x,-e.y,-e.z):-e},subtract:function(e,t){return s.op(e,t,function(e,t){return e-t},function(e,t){throw new r("Can't subtract axes and numbers.",{a:e,b:t})},function(e,t){throw new r("Can't subtract axes and numbers.",{a:e,b:t})},function(e,t){return new s(e.x-t.x,e.y-t.y,e.z-t.z)})},divide:function(e,t){return s.op(e,t,function(e,t){return e/t},function(e,t){return new s(e.x/t,e.y/t,e.z/t)},function(e,t){throw new r("Can't divide by an axis.",{a:e,b:t})},function(e,t){throw new r("Can't divide by an axis.",{a:e,b:t})})},raisedTo:function(e,t){return s.op(e,t,function(e,t){return Math.pow(e,t)},function(e,t){throw new r("Can't raise an axis to a power.",{a:e,b:t})},function(e,t){throw new r("Can't raise to an axis power.",{a:e,b:t})},function(e,t){throw new r("Can't raise to an axis power.",{a:e,b:t})})}});function s(e,t,r){this.x=e,this.y=t,this.z=r}i.set("x",new t(1,0,0)),i.set("y",new t(0,1,0)),i.set("z",new t(0,0,1)),i.set("(","("),i.set(")",")");var a=!0,o=!1,u=void 0;try{for(var l,c=e[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var d=l.value,m=d.character,f=d.value;i.set(m,f)}}catch(e){o=!0,u=e}finally{try{a||null==c.return||c.return()}finally{if(o)throw u}}return i.set("sqrt",{unary_action:function(e){return t.raisedTo(e,.5)},priority:4}),i.set("^",{binary_action:t.raisedTo,priority:3}),i.set("*",{binary_action:t.times,priority:2}),i.set("/",{binary_action:t.divide,priority:2}),i.set("-",{unary_action:t.negate,binary_action:t.subtract,priority:1}),i.set("+",{unary_action:function(e){return e},binary_action:t.add,priority:1}),i.set("√",i.get("sqrt")),{get Axis(){return t}}}),$traceurRuntime.registerModule("src/math/Complex.js",[],function(){"use strict";var e,t,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/DetailedError.js","src/math/Complex.js")).DetailedError,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Format.js","src/math/Complex.js")),i=n.Format,n=n.UNICODE_FRACTIONS,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/math/Complex.js")).Util,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./FormulaParser.js","src/math/Complex.js")).parseFormula,u=new Map,s=new Map,l=new Map,c=$traceurRuntime.createClass(d,{isEqualTo:function(e){return e instanceof d?this.real===e.real&&this.imag===e.imag:"number"==typeof e&&this.real===e&&0===this.imag},isApproximatelyEqualTo:function(e,t){return(e instanceof d||"number"==typeof e)&&(e=this.minus(d.from(e)),Math.abs(e.real)<=t)&&Math.abs(e.imag)<=t&&e.abs()<=t},toString:function(e){return(e=e||i.EXACT).allowAbbreviation?this._toString_allowSingleValue(e):this._toString_bothValues(e)},_toString_allowSingleValue:function(e){return Math.abs(this.imag)<=e.maxAbbreviationError?e.formatFloat(this.real):Math.abs(this.real)<=e.maxAbbreviationError?Math.abs(this.imag-1)<=e.maxAbbreviationError?"i":Math.abs(this.imag+1)<=e.maxAbbreviationError?"-i":e.formatFloat(this.imag)+"i":this._toString_bothValues(e)},_toString_bothValues:function(e){var t=0<=this.imag?"+":"-",r=e.allowAbbreviation&&Math.abs(Math.abs(this.imag)-1)<=e.maxAbbreviationError?"":e.formatFloat(Math.abs(this.imag));return(e.allowAbbreviation||void 0===e.fixedDigits||this.real<0?"":"+")+e.formatFloat(this.real)+t+r+"i"},norm2:function(){return this.real*this.real+this.imag*this.imag},abs:function(){return Math.sqrt(this.norm2())},conjugate:function(){return new d(this.real,-this.imag)},neg:function(){return new d(-this.real,-this.imag)},phase:function(){return Math.atan2(this.imag,this.real)},unit:function(){var e=this.norm2();return e<1e-5?d.polar(1,this.phase()):this.dividedBy(Math.sqrt(e))},plus:function(e){e=d.from(e);return new d(this.real+e.real,this.imag+e.imag)},minus:function(e){e=d.from(e);return new d(this.real-e.real,this.imag-e.imag)},times:function(e){e=d.from(e);return new d(this.real*e.real-this.imag*e.imag,this.real*e.imag+this.imag*e.real)},dividedBy:function(e){var e=d.from(e),t=e.norm2();if(0===t)throw new Error("Division by Zero");e=this.times(e.conjugate());return new d(e.real/t,e.imag/t)},sqrts:function(){var e=(r=(t=[this.real,this.imag][Symbol.iterator]()).next()).done?void 0:r.value,t=(r=t.next()).done?void 0:r.value,r=Math.sqrt(Math.sqrt(e*e+t*t));return 0===r?[d.ZERO]:0===t&&e<0?[new d(0,r),new d(0,-r)]:(t=this.phase()/2,[e=d.polar(r,t),e.times(-1)])},exp:function(){return d.polar(Math.exp(this.real),this.imag)},cos:function(){var e=this.times(d.I);return e.exp().plus(e.neg().exp()).times(.5)},sin:function(){var e=this.times(d.I);return e.exp().minus(e.neg().exp()).dividedBy(new d(0,2))},tan:function(){return this.sin().dividedBy(this.cos())},ln:function(){return new d(Math.log(this.abs()),this.phase())},raisedTo:function(e){return.5===e&&0===this.imag&&0<=this.real?new d(Math.sqrt(this.real),0):d.ZERO.isEqualTo(e)?d.ONE:this.isEqualTo(d.ZERO)?d.ZERO:this.ln().times(d.from(e)).exp()}},{from:function(e){if(e instanceof d)return e;if("number"==typeof e)return new d(e,0);throw new r("Unrecognized value type.",{v:e})},polar:function(e,t){var r;return new d(e*((r=(t=a.snappedCosSin(t)[Symbol.iterator]()).next()).done?void 0:r.value),e*((r=t.next()).done?void 0:r.value))},realPartOf:function(e){if(e instanceof d)return e.real;if("number"==typeof e)return e;throw new r("Unrecognized value type.",{v:e})},imagPartOf:function(e){if(e instanceof d)return e.imag;if("number"==typeof e)return 0;throw new r("Unrecognized value type.",{v:e})},parse:function(e){return d.from(o(e,l))},rootsOfQuadratic:function(e,t,r){if(e=d.from(e),t=d.from(t),r=d.from(r),e.isEqualTo(0)){if(!t.isEqualTo(0))return[r.times(-1).dividedBy(t)];if(r.isEqualTo(0))throw Error("Degenerate");return[]}var r=t.times(t).minus(e.times(r).times(4)).sqrts(),n=t.times(-1),i=e.times(2);return r.map(function(e){return n.minus(e).dividedBy(i)})}});function d(e,t){this.real=e,this.imag=t}c.ZERO=new c(0,0),c.ONE=new c(1,0),c.I=new c(0,1),u.set("i",c.I),u.set("e",c.from(Math.E)),u.set("pi",c.from(Math.PI)),u.set("(","("),u.set(")",")");var m=!0,f=!1,h=void 0;try{for(var g,p=n[Symbol.iterator]();!(m=(g=p.next()).done);m=!0){var v=g.value,y=v.character,b=v.value;u.set(y,b)}}catch(e){f=!0,h=e}finally{try{m||null==p.return||p.return()}finally{if(f)throw h}}u.set("sqrt",{unary_action:function(e){return c.from(e).raisedTo(.5)},priority:4}),u.set("exp",{unary_action:function(e){return c.from(e).exp()},priority:4}),u.set("ln",{unary_action:function(e){return c.from(e).ln()},priority:4}),u.set("^",{binary_action:function(e,t){return c.from(e).raisedTo(t)},priority:3}),u.set("*",{binary_action:function(e,t){return c.from(e).times(t)},priority:2}),u.set("/",{binary_action:function(e,t){return c.from(e).dividedBy(t)},priority:2}),u.set("-",{unary_action:function(e){return c.from(e).neg()},binary_action:function(e,t){return c.from(e).minus(t)},priority:1}),u.set("+",{unary_action:function(e){return e},binary_action:function(e,t){return c.from(e).plus(t)},priority:1}),u.set("√",u.get("sqrt")),l.set("cos",{unary_action:function(e){return new c(Math.PI/180,0).times(e).cos()},priority:4}),l.set("sin",{unary_action:function(e){return new c(Math.PI/180,0).times(e).sin()},priority:4}),l.set("asin",{unary_action:function(e){if(0!==c.imagPartOf(e))throw new r("asin input out of range",{e:e});return c.from(180*Math.asin(c.realPartOf(e))/Math.PI)},priority:4}),l.set("acos",{unary_action:function(e){if(0!==c.imagPartOf(e))throw new r("acos input out of range",{e:e});return c.from(180*Math.acos(c.realPartOf(e))/Math.PI)},priority:4}),l.set("arccos",l.get("acos")),l.set("arcsin",l.get("asin")),s.set("cos",{unary_action:function(e){return c.from(e).cos()},priority:4}),s.set("sin",{unary_action:function(e){return c.from(e).sin()},priority:4}),s.set("tan",{unary_action:function(e){return c.from(e).tan()},priority:4}),s.set("asin",{unary_action:function(e){if(0!==c.imagPartOf(e))throw new r("asin input out of range",{e:e});return c.from(Math.asin(c.realPartOf(e)))},priority:4}),s.set("acos",{unary_action:function(e){if(0!==c.imagPartOf(e))throw new r("acos input out of range",{e:e});return c.from(Math.acos(c.realPartOf(e)))},priority:4}),s.set("atan",{unary_action:function(e){if(0!==c.imagPartOf(e))throw new r("atan input out of range",{e:e});return c.from(Math.atan(c.realPartOf(e)))},priority:4});var R=!0,n=!1,f=void 0;try{for(var w,M=u.entries()[Symbol.iterator]();!(R=(w=M.next()).done);R=!0){var _=(t=(e=w.value[Symbol.iterator]()).next()).done?void 0:t.value,x=(t=e.next()).done?void 0:t.value;l.set(_,x),s.set(_,x)}}catch(e){n=!0,f=e}finally{try{R||null==M.return||M.return()}finally{if(n)throw f}}return{get Complex(){return c},get PARSE_COMPLEX_TOKEN_MAP_DEG(){return l},get PARSE_COMPLEX_TOKEN_MAP_RAD(){return s}}}),$traceurRuntime.registerModule("src/math/FormulaParser.js",[],function(){"use strict";var p=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/DetailedError.js","src/math/FormulaParser.js")).DetailedError,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Seq.js","src/math/FormulaParser.js")).seq;function v(e){for(var t=a(e.toLowerCase().split(/\s/)).flatMap(function(e){return a(e).segmentBy(function(e){return""===e.trim()?" ":e.match(/[\.0-9]/)?"#":e.match(/[_a-z]/)?"a":NaN}).map(function(e){return e.join("")})}).filter(function(e){return""!==e.trim()}).toArray(),r=(t=$traceurRuntime.spread(t)).indexOf("e",1);-1!==r;r=t.indexOf("e",r+1)){var n=r-1,i=r+1;t[n].match(/[0-9]/)&&((t[i]+"").match(/[+-]/)&&(i+=1),(t[i]+"").match(/[0-9]/))&&(i+=1,t.splice(n,i-n,t.slice(n,i).join("")),--r)}return t}function e(n,i){function a(e){for(;0<o.length&&2<=u.length&&void 0!==u[u.length-1];){var t=o[o.length-1];if(void 0===t.w||t.w<e)break;r(o.pop())}}var e,t=v(n).map(function(e){var t=i;if(e.match(/[0-9]+(\.[0-9]+)?/))return parseFloat(e);if(t.has(e))return t.get(e);throw new p("Unrecognized token",{token:e})}),o=(0<t.length&&void 0!==t[t.length-1].priority&&(t=t.slice(0,t.length-1)),[]),u=[],r=function(e){if("("===e)throw new p("Bad expression: unmatched '('",{text:n});if(u.length<2)throw new p("Bad expression: operated on nothing",{text:n});var t=u.pop(),r=u.pop();u.push(e.f(r,t))},s=!1,l=!0,c=!1,d=void 0;try{for(var m,f=t[Symbol.iterator]();!(l=(m=f.next()).done);l=!0){var h=m.value;if(!function(e,r){var t=i.get("*");if(e&&void 0===r.binary_action&&")"!==r&&(a(t.priority),o.push({f:t.binary_action,w:t.priority})),e&&void 0!==r.binary_action)a(r.priority),o.push({f:r.binary_action,w:r.priority});else if(void 0!==r.unary_action)a(r.priority),u.push(void 0),o.push({f:function(e,t){return r.unary_action(t)},w:1/0});else if(void 0!==r.binary_action)throw new p("Bad expression: binary op in bad spot",{text:n})}(s,h),s="("!==(e=h)&&void 0===e.priority,"("===h)o.push("(");else if(")"===h)for(g=void 0;;){if(0===o.length)throw new p("Bad expression: unmatched ')'",{text:n});var g=o.pop();if("("===g)break;r(g)}else s&&u.push(h)}}catch(e){c=!0,d=e}finally{try{l||null==f.return||f.return()}finally{if(c)throw d}}if(a(-1/0),1!==u.length||0!==o.length)throw new p("Incomplete expression",{text:n});return u[0]}return{get parseFormula(){return e}}}),$traceurRuntime.registerModule("src/math/Matrix.js",[],function(){"use strict";var v=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./Complex.js","src/math/Matrix.js")).Complex,y=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/DetailedError.js","src/math/Matrix.js")).DetailedError,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Format.js","src/math/Matrix.js")).Format,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Seq.js","src/math/Matrix.js")),b=e.seq,f=e.Seq,A=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/math/Matrix.js")).Util,t=$traceurRuntime.createClass(C,{cell:function(e,t){if(e<0||t<0||e>=this._width||t>=this._height)throw new y("Cell out of range",{col:e,row:t,width:this._width,height:this._height});t=2*(this._width*t+e);return new v(this._buffer[t],this._buffer[1+t])},rawBuffer:function(){return this._buffer},toReadableJson:function(){return b(this.rows()).map(r).toArray()},rows:function(){var r=this;return f.range(this._height).map(function(t){return f.range(r._width).map(function(e){return r.cell(e,t)}).toArray()}).toArray()},isEqualTo:function(e){var t,r=this;return this===e||e instanceof C&&this._width===(t=e)._width&&this._height===t._height&&f.range(this._buffer.length).every(function(e){return r._buffer[e]===t._buffer[e]})},isApproximatelyEqualTo:function(e,t){return e instanceof C&&this._width===e._width&&this._height===e._height&&Math.sqrt(this.minus(e).norm2())<=t},toString:function(){var t=void 0!==arguments[0]?arguments[0]:u.EXACT;return"{{"+this.rows().map(function(e){return e.map(function(e){return e.toString(t)}).join(t.itemSeparator)}).join("}"+t.itemSeparator+"{")+"}}"},width:function(){return this._width},height:function(){return this._height},isUnitary:function(e){var t=this.width();return this.height()===t&&this.times(this.adjoint()).isApproximatelyEqualTo(C.identity(t),e)},isLowerTriangular:function(){for(var e=void 0!==arguments[0]?arguments[0]:0,t=0;t<this._height;t++)for(var r=t+1;r<this._width;r++){var n=2*(t*this._width+r),i=this._buffer[n],n=this._buffer[1+n];if(isNaN(i)||isNaN(n)||e*e<i*i+n*n)return!1}return!0},isUpperTriangular:function(){for(var e=void 0!==arguments[0]?arguments[0]:0,t=0;t<this._height;t++)for(var r=0;r<t&&r<this._width;r++){var n=2*(t*this._width+r),i=this._buffer[n],n=this._buffer[1+n];if(isNaN(i)||isNaN(n)||e*e<i*i+n*n)return!1}return!0},isPhasedPermutation:function(){var e=void 0!==arguments[0]?arguments[0]:0;if(this._width!==this._height)return!1;for(var t=this._width,r=new Uint32Array(t),n=new Uint32Array(t),i=0;i<t;i++)for(var a=0;a<t;a++){var o=2*(a*t+i),o=Math.max(Math.abs(this._buffer[o]),Math.abs(this._buffer[1+o]));(isNaN(o)||e<o)&&(r[i]+=1,n[a]+=1)}return b(r).concat(n).every(function(e){return e<=1})},isApproximatelyHermitian:function(e){if(this._width!==this._height)return!1;for(var t=0;t<this._width;t++)for(var r=0;r<this._height;r++){var n=2*(this._width*r+t),i=2*(this._width*t+r);if(Math.abs(this._buffer[n]-this._buffer[i])>e)return!1;if(Math.abs(this._buffer[1+n]+this._buffer[1+i])>e)return!1}return!0},isIdentity:function(){var e=void 0!==arguments[0]?arguments[0]:0;if(this._width!==this._height)return!1;for(var t=0;t<this._width;t++)for(var r=0;r<this._height;r++){var n=2*(this._width*r+t),i=Math.abs(this._buffer[n]-(r===t?1:0)),n=Math.abs(this._buffer[1+n]);if(Math.max(i,n)>e)return!1}return!this.hasNaN()},isScaler:function(){var e=void 0!==arguments[0]?arguments[0]:0;if(this._width!==this._height)return!1;for(var t=this._buffer[0],r=this._buffer[1],n=0;n<this._width;n++)for(var i=0;i<this._height;i++){var a=2*(this._width*i+n),o=Math.abs(this._buffer[a]-(i===n?t:0)),a=Math.abs(this._buffer[1+a]-(i===n?r:0));if(Math.max(o,a)>e)return!1}return!this.hasNaN()},hasNaN:function(){for(var e=0;e<this._buffer.length;e++)if(isNaN(this._buffer[e]))return!0;return!1},isDiagonal:function(){for(var e=void 0!==arguments[0]?arguments[0]:0,t=0;t<this._width;t++)for(var r=0;r<this._height;r++)if(r!==t){var n=2*(this._width*r+t),i=Math.abs(this._buffer[n]),n=Math.abs(this._buffer[1+n]),i=Math.max(i,n);if(isNaN(i)||e<i)return!1}return this._width===this._height},adjoint:function(){for(var e=this._height,t=this._width,r=new Float64Array(e*t*2),n=0;n<t;n++)for(var i=0;i<e;i++){var a=2*(i*this._width+n),o=2*(n*e+i);r[o]=this._buffer[a],r[1+o]=-this._buffer[1+a]}return new C(e,t,r)},transpose:function(){for(var e=this._height,t=this._width,r=new Float64Array(e*t*2),n=0;n<t;n++)for(var i=0;i<e;i++){var a=2*(i*this._width+n),o=2*(n*e+i);r[o]=this._buffer[a],r[1+o]=this._buffer[1+a]}return new C(e,t,r)},trace:function(){for(var e=0,t=0,r=2*this._width+2,n=0;n<this._buffer.length;n+=r)e+=this._buffer[n],t+=this._buffer[n+1];return new v(e,t)},_timesScalar:function(e){for(var t=new Float64Array(this._buffer.length),r=v.realPartOf(e),n=v.imagPartOf(e),i=0;i<t.length;i+=2){var a=this._buffer[i],o=this._buffer[i+1];t[i]=a*r-o*n,t[i+1]=a*n+o*r}return new C(this._width,this._height,t)},plus:function(e){for(var t=this._width,r=this._height,n=this._buffer,i=e._buffer,a=(A.need(e._width===t&&e._height===r,"Matrix.plus: compatible sizes"),new Float64Array(this._buffer.length)),o=0;o<a.length;o++)a[o]=n[o]+i[o];return new C(t,r,a)},minus:function(e){for(var t=this._width,r=this._height,n=this._buffer,i=e._buffer,a=(A.need(e._width===t&&e._height===r,"Matrix.minus: compatible sizes"),new Float64Array(this._buffer.length)),o=0;o<a.length;o++)a[o]=n[o]-i[o];return new C(t,r,a)},_timesMatrix:function(e){if(this._width!==e._height)throw new y("Incompatible sizes.",{this:this,other:e});for(var t=e._width,r=this._height,n=this._width,i=new Float64Array(t*r*2),a=0;a<r;a++)for(var o=0;o<t;o++)for(var u=2*(a*t+o),s=0;s<n;s++){var l=2*(a*n+s),c=2*(s*t+o),d=this._buffer[l],l=this._buffer[1+l],m=e._buffer[c],c=e._buffer[1+c],f=d*c+m*l;i[u]+=d*m-l*c,i[1+u]+=f}return new C(t,r,i)},times:function(e){return e instanceof C?this._timesMatrix(e):this._timesScalar(e)},expandedForQubitInRegister:function(e,t,r){for(var n=Math.round(Math.log2(this._width)),i=C.identity(1<<t-e-n).tensorProduct(this).tensorProduct(C.identity(1<<e))._clone(),a=0;a<i._width;a++)for(var o,u=0;u<i._height;u++)r.allowsState(a)&&r.allowsState(u)||(o=2*(a+u*i._width),i._buffer[o]=a===u?1:0,i._buffer[1+o]=0);return i},applyToStateVectorAtQubitWithControls:function(e,t,r){for(var n=2*this._width,i=e._buffer.slice(0,n),a=2<<t,o=a*n>>1,u=e._buffer.slice(),s=0;s<u.length;s+=o)for(var l=0;l<a;l+=2)if(r.allowsState((s|l)>>1)){for(var c=s+l,d=0;d<i.length;d+=2)i[d]=e._buffer[c],i[d+1]=e._buffer[c+1],c+=a;for(var m=this.times(new C(1,i.length>>1,i)),c=s+l,f=0;f<i.length;f+=2)u[c]=m._buffer[f],u[c+1]=m._buffer[f+1],c+=a}return new C(1,e.height(),u)},norm2:function(){var e=0,t=!0,r=!1,n=void 0;try{for(var i,a=this._buffer[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;e+=o*o}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}return e},tensorProduct:function(e){for(var t=this._width,r=this._height,n=e._width,i=e._height,a=t*n,o=r*i,u=new Float64Array(a*o*2),s=0;s<r;s++)for(var l=0;l<i;l++)for(var c=0;c<t;c++)for(var d=0;d<n;d++){var m=2*(s*t+c),f=2*(l*n+d),h=2*((s*i+l)*a+(c*n+d)),g=this._buffer[m],m=this._buffer[1+m],p=e._buffer[f],f=e._buffer[1+f],v=g*f+m*p;u[h]=g*p-m*f,u[1+h]=v}return new C(a,o,u)},timesQubitOperation:function(e,t,r,n){A.need(0==(r&1<<t),"Matrix.timesQubitOperation: self-controlled"),A.need(2===e._width&&2===e._height,"Matrix.timesQubitOperation: not 2x2");for(var i,a=this._width,o=this._height,u=this._buffer,s=(i=(e=e._buffer[Symbol.iterator]()).next()).done?void 0:i.value,l=(i=e.next()).done?void 0:i.value,c=(i=e.next()).done?void 0:i.value,d=(i=e.next()).done?void 0:i.value,m=(i=e.next()).done?void 0:i.value,f=(i=e.next()).done?void 0:i.value,h=(i=e.next()).done?void 0:i.value,g=(i=e.next()).done?void 0:i.value,p=(A.need(2<<t<=o,"Matrix.timesQubitOperation: qubit index out of range"),new Float64Array(u)),v=0,y=0;y<o;y++)for(var b,R,w,M,_,x=0!=(r&y^n),S=0!=(y&1<<t),T=0;T<a;T++)x||S||(R=p[v],w=p[v+1],M=p[b=v+2*(1<<t)*a],_=p[b+1],p[v]=R*s-w*l+M*c-_*d,p[v+1]=R*l+w*s+M*d+_*c,p[b]=R*m-w*f+M*h-_*g,p[b+1]=R*f+w*m+M*g+_*h),v+=2;return new C(a,o,p)},tensorPower:function(e){if(!Number.isInteger(e)||e<0)throw new y("Bad exponent",{exponent:e});for(var t=C.identity(1),r=this,n=1;n<=e;n*=2)0!=(n&e)&&(t=t.tensorProduct(r)),r=r.tensorProduct(r);return t},transformRealAndImagComponentsWith:function(e){for(var t=this._buffer.slice(),r=0;r<t.length;r++)t[r]=e(t[r]);return new C(this._width,this._height,t)},_inline_rowScale_preMultiply:function(e,t){for(var r=0;r<this._width;r++){var n=this.cell(r,e).times(t),i=2*(e*this._width+r);this._buffer[i]=n.real,this._buffer[1+i]=n.imag}},_inline_colScale_postMultiply:function(e,t){for(var r=0;r<this._height;r++){var n=this.cell(e,r).times(t),i=2*(r*this._width+e);this._buffer[i]=n.real,this._buffer[1+i]=n.imag}},_inline_rowMix_preMultiply:function(e,t,r){for(var n,i=(n=(r=r._2x2Breakdown()[Symbol.iterator]()).next()).done?void 0:n.value,a=(n=r.next()).done?void 0:n.value,o=(n=r.next()).done?void 0:n.value,u=(n=r.next()).done?void 0:n.value,s=0;s<this._width;s++){var l=this.cell(s,e),c=this.cell(s,t),d=l.times(i).plus(c.times(a)),l=l.times(o).plus(c.times(u)),c=2*(e*this._width+s),m=2*(t*this._width+s);this._buffer[c]=d.real,this._buffer[1+c]=d.imag,this._buffer[m]=l.real,this._buffer[1+m]=l.imag}},_inline_colMix_postMultiply:function(e,t,r){for(var n,i=(n=(r=r._2x2Breakdown()[Symbol.iterator]()).next()).done?void 0:n.value,a=(n=r.next()).done?void 0:n.value,o=(n=r.next()).done?void 0:n.value,u=(n=r.next()).done?void 0:n.value,s=0;s<this._width;s++){var l=this.cell(e,s),c=this.cell(t,s),d=l.times(i).plus(c.times(o)),l=l.times(a).plus(c.times(u)),c=2*(s*this._width+e),m=2*(s*this._width+t);this._buffer[c]=d.real,this._buffer[1+c]=d.imag,this._buffer[m]=l.real,this._buffer[1+m]=l.imag}},_clone:function(){return new C(this._width,this._height,this._buffer.slice())},qrDecomposition:function(){if(this._width!==this._height)throw new y("Expected a square matrix.",this);for(var e=C.identity(this._width),t=this._clone(),r=0;r<this._height;r++){for(var n=0;n<r&&n<this._width;n++){var i=t.cell(n,r),a=t.cell(n,n),o=a.abs(),u=i.abs();0!==u&&(u=-Math.atan2(u,o),o=Math.cos(u),u=Math.sin(u),a=a.unit().conjugate(),i=i.unit().conjugate(),a=C.square(a.times(o),i.times(-u),a.times(u),i.times(o)),t._inline_rowMix_preMultiply(n,r,a),e._inline_colMix_postMultiply(n,r,a.adjoint()))}var s=t.cell(r,r).unit();t._inline_rowScale_preMultiply(r,s.conjugate()),e._inline_colScale_postMultiply(r,s)}return{Q:e,R:t}},lqDecomposition:function(){var e=this.adjoint().qrDecomposition(),t=e.Q;return{L:e.R.adjoint(),Q:t.adjoint()}},eigenvalueMagnitudes:function(e){var t=void 0!==arguments[1]?arguments[1]:1e3;if(this._width!==this._height)throw new y("Expected a square matrix.",this);for(var r=0,n=this;!n.isUpperTriangular(e)&&r<t;){var i=n.qrDecomposition(),a=i.Q,i=i.R;if(i.isIdentity(e))return f.repeat(1,this._width).toArray();n=i.times(a),r++}return f.range(this._width).map(function(e){return n.cell(e,e).abs()}).sortedBy(function(e){return-e}).toArray()},eigenDecomposition:function(){var e;if(2!==this.width()||2!==this.height())throw new Error("Not implemented: non-2x2 eigen decomposition");var a=(e=(t=this._2x2Breakdown()[Symbol.iterator]()).next()).done?void 0:e.value,o=(e=t.next()).done?void 0:e.value,u=(e=t.next()).done?void 0:e.value,s=(e=t.next()).done?void 0:e.value,t=v.rootsOfQuadratic(v.ONE,a.plus(s).times(-1),a.times(s).minus(o.times(u)));if(0===t.length)throw new Error("Degenerate");return 1===t.length?[{val:t[0],vec:C.col(1,0)},{val:t[0],vec:C.col(0,1)}]:t.map(function(e){var t,r=(i=(n=[o.times(-1),a.minus(e)][Symbol.iterator]()).next()).done?void 0:i.value,n=(i=n.next()).done?void 0:i.value,i=(r.isEqualTo(0)&&n.isEqualTo(0)&&(r=(t=(i=[e.minus(s),u][Symbol.iterator]()).next()).done?void 0:t.value,n=(t=i.next()).done?void 0:t.value),r.isEqualTo(0)||(n=n.dividedBy(r),r=v.ONE),Math.sqrt(r.norm2()+n.norm2()));if(0===i)throw new Error("Unexpected degenerate");return{val:e,vec:C.col(r,n).times(1/i)}})},liftApply:function(e){var t=this.times(0),r=!0,n=!1,i=void 0;try{for(var a,o=this.eigenDecomposition()[Symbol.iterator]();!(r=(a=o.next()).done);r=!0)var u=a.value,s=u.val,l=u.vec,c=e(s),d=l.times(l.adjoint()),t=t.plus(d.times(c))}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return t},qubitDensityMatrixToBlochVector:function(){var e,t,r,n,i,a,o,u;if(2!==this._width||2!==this._height)throw new y("Need a 2x2 density matrix.",this);if(!this.isApproximatelyHermitian(.01))throw new y("Density matrix should be Hermitian.",this);if(this.trace().isApproximatelyEqualTo(1,.01))return r=(t=(e=this._buffer[Symbol.iterator]()).next()).done?void 0:t.value,(t=e.next()).done||t.value,n=(t=e.next()).done?void 0:t.value,i=(t=e.next()).done?void 0:t.value,a=(t=e.next()).done?void 0:t.value,o=(t=e.next()).done?void 0:t.value,u=(t=e.next()).done?void 0:t.value,(t=e.next()).done||t.value,[-a-n,i-o,u-r];throw new y("Density matrix should have unit trace.",this)},determinant:function(){var n=this,e=(A.need(this.width()===this.height(),"Must be square"),this.width());return 1===e?this.cell(0,0):f.range(e).map(function(r){return C.generate(e-1,e-1,function(e,t){return n.cell(t+(t<r?0:1),e+1)}).determinant().times(n.cell(r,0)).times(Math.pow(-1,r))}).aggregate(v.ZERO,function(e,t){return e.plus(t)})},_2x2Breakdown:function(){return[new v(this._buffer[0],this._buffer[1]),new v(this._buffer[2],this._buffer[3]),new v(this._buffer[4],this._buffer[5]),new v(this._buffer[6],this._buffer[7])]},qubitOperationToAngleAxisRotation:function(){A.need(2===this.width()&&2===this.height(),"Need a 2x2 matrix."),A.need(this.isUnitary(.01),"Need a unitary matrix.");var e=(i=(n=this._2x2Breakdown()[Symbol.iterator]()).next()).done?void 0:i.value,t=(i=n.next()).done?void 0:i.value,r=(i=n.next()).done?void 0:i.value,n=(i=n.next()).done?void 0:i.value,i=e.plus(n),a=t.plus(r).dividedBy(v.I),t=t.minus(r),r=e.minus(n).dividedBy(v.I),e=b([i,a,t,r]).maxBy(function(e){return e.abs()}).unit().times(2),n=Math.min(1,Math.max(-1,i.dividedBy(e).real)),i=a.dividedBy(e).real,a=t.dividedBy(e).real,t=r.dividedBy(e).real,r=-2*Math.acos(n),n=Math.sqrt(i*i+a*a+t*t);return n<1e-7?{axis:[1,0,0],angle:0,phase:e.phase()}:(i/=n,a/=n,t/=n,r<=-Math.PI&&(r+=2*Math.PI,e=e.times(-1)),i+a+t<0&&(i=-i,a=-a,t=-t,r=-r),{axis:[i,a,t],angle:r,phase:e.phase()})},cross3:function(n){var i=this;return A.need(1===this.width()&&3===this.height(),"This isn't a 3d column vector."),A.need(1===n.width()&&3===n.height(),"Other's not a 3d column vector."),C.generate(1,3,function(e){var t=(r=(e=[(e+1)%3,(e+2)%3][Symbol.iterator]()).next()).done?void 0:r.value,e=(r=e.next()).done?void 0:r.value,r=i.cell(0,t).times(n.cell(0,e)),e=i.cell(0,e).times(n.cell(0,t));return r.minus(e)})},_unordered_singularValueDecomposition_2x2:function(){var e=C.identity(2),t=this.lqDecomposition(),r=t.L,t=t.Q,n=r.cell(0,0).unit(),i=r.cell(0,1).unit(),n=(e._inline_colScale_postMultiply(0,n),e._inline_colScale_postMultiply(1,i),r._inline_rowScale_preMultiply(0,n.conjugate()),r._inline_rowScale_preMultiply(1,i.conjugate()),r.cell(1,1).unit());r._inline_colScale_postMultiply(1,n.conjugate()),t._inline_rowScale_preMultiply(1,n);var a=(n=(i=r._buffer[Symbol.iterator]()).next()).done?void 0:n.value,o=(i.next(),(n=i.next()).done?void 0:n.value),u=(i.next(),(n=i.next()).done?void 0:n.value),i=(i.next(),(n=i.next()).done?void 0:n.value),n=a+i,s=o+u,o=o-u,u=a-i,a=Math.atan2(s,n)/2,i=Math.atan2(o,u)/2,n=Math.sqrt(n*n+s*s)/2,s=Math.sqrt(u*u+o*o)/2;return e._inline_colMix_postMultiply(0,1,C.rotation(a-i)),t._inline_rowMix_preMultiply(0,1,C.rotation(a+i)),{U:e,S:r=C.square(n+s,0,0,n-s),V:t}},_unordered_singularValueDecomposition_iterative:function(){for(var e=void 0!==arguments[0]?arguments[0]:0,t=void 0!==arguments[1]?arguments[1]:100,r=C.identity(this._width),n=this._clone(),i=C.identity(this._width),a=0;!n.isDiagonal(e)&&a++<t;)var o=n.qrDecomposition(),u=o.Q,o=o.R.lqDecomposition(),s=o.L,o=o.Q,r=r.times(u),n=s,i=o.times(i);return{U:r,S:n,V:i}},singularValueDecomposition:function(){var e,t=void 0!==arguments[0]?arguments[0]:0,r=void 0!==arguments[1]?arguments[1]:100;if(this._width!==this._height)throw new y("Expected a square matrix.",this);for(var t=2===this._width?this._unordered_singularValueDecomposition_2x2():this._unordered_singularValueDecomposition_iterative(t,r),n=t.U,i=t.S,a=t.V,o=f.range(this._width).sortedBy(function(e){return-i.cell(e,e).norm2()}).toArray(),u=0;u<i._width;u++){var s,l,c,d=o.indexOf(u);u!==d&&(n._inline_colMix_postMultiply(u,d,C.PAULI_X),a._inline_rowMix_preMultiply(u,d,C.PAULI_X),s=u*(i._width+1)*2,l=d*(i._width+1)*2,c=[i._buffer[l],i._buffer[s]],i._buffer[s]=(e=(c=c[Symbol.iterator]()).next()).done?void 0:e.value,i._buffer[l]=(e=c.next()).done?void 0:e.value,c=[i._buffer[1+l],i._buffer[1+s]],i._buffer[1+s]=(s=(e=c[Symbol.iterator]()).next()).done?void 0:s.value,i._buffer[1+l]=(s=e.next()).done?void 0:s.value,c=[o[u],o[d]],o[d]=(e=(l=c[Symbol.iterator]()).next()).done?void 0:e.value,o[u]=(e=l.next()).done?void 0:e.value)}for(var m=0;m<i._width;m++)n._inline_colScale_postMultiply(m,i.cell(m,m).unit());return{U:n,S:i=C.generateDiagonal(i._width,function(e){return i.cell(e,e).abs()}),V:a}},getColumn:function(e){A.need(0<=e&&e<=this.width(),"colIndex >= 0 && colIndex <= this.width()");for(var t=[],r=0;r<this._height;r++)t.push(this.cell(e,r));return t},getRow:function(e){A.need(0<=e&&e<=this.height(),"rowIndex >= 0 && rowIndex <= this.height()");for(var t=[],r=0;r<this._width;r++)t.push(this.cell(r,e));return t},closestUnitary:function(){var e=this.singularValueDecomposition(void 0!==arguments[0]?arguments[0]:0,void 0!==arguments[1]?arguments[1]:100);return e.U.times(e.V)}},{fromRows:function(e){A.need(Array.isArray(e)&&e.every(Array.isArray),"array rows",e),A.need(0<e.length,"non-zero height",arguments);var t=b(e),r=e.length,t=t.map(function(e){return e.length}).distinct().single(null);if(null===t)throw new y("Inconsistent row widths.",{rows:e});var n=new Float64Array(t*r*2),i=0,a=!0,o=!1,u=void 0;try{for(var s,l=e[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value,d=!0,m=!1,f=void 0;try{for(var h,g=c[Symbol.iterator]();!(d=(h=g.next()).done);d=!0){var p=h.value;n[i]=v.realPartOf(p),n[i+1]=v.imagPartOf(p),i+=2}}catch(e){m=!0,f=e}finally{try{d||null==g.return||g.return()}finally{if(m)throw f}}}}catch(e){o=!0,u=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw u}}return new C(t,r,n)},parse:function(e){if((e=e.replace(/\s/g,"")).length<4||"{{"!==e.substr(0,2)||"}}"!==e.substr(e.length-2,2))throw new Error("Not surrounded by {{}}.");return C.fromRows(e.substr(2,e.length-4).split("},{").map(function(e){return e.split(",").map(v.parse)}))},generate:function(e,t,r){for(var n=new Float64Array(e*t*2),i=0;i<t;i++)for(var a=0;a<e;a++){var o=2*(i*e+a),u=r(i,a);n[o]=v.realPartOf(u),n[1+o]=v.imagPartOf(u)}return new C(e,t,n)},generateDiagonal:function(e,t){for(var r=new Float64Array(e*e*2),n=0;n<e;n++){var i=n*(e+1)*2,a=t(n);r[i]=v.realPartOf(a),r[1+i]=v.imagPartOf(a)}return new C(e,e,r)},generateTransition:function(e,t){for(var r=new Float64Array(e*e*2),n=0;n<e;n++)r[2*(t(n)*e+n)]=1;return new C(e,e,r)},zero:function(e,t){return new C(e,t,new Float64Array(e*t*2))},solo:function(e){return new C(1,1,new Float64Array([v.realPartOf(e),v.imagPartOf(e)]))},square:function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];A.need(Array.isArray(r),"Array.isArray(coefs)",arguments);var n=Math.round(Math.sqrt(r.length));return A.need(n*n===r.length,"Matrix.square: non-square number of arguments"),C.generate(n,n,function(e,t){return r[e*n+t]})},col:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return A.need(Array.isArray(t),"Array.isArray(coefs)",arguments),C.generate(1,t.length,function(e){return t[e]})},row:function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return A.need(Array.isArray(r),"Array.isArray(coefs)",arguments),C.generate(r.length,1,function(e,t){return r[t]})},fromPauliRotation:function(e,t,r){function n(e){return Math.abs(e)<2e-4?1-e*e/6:Math.sin(e)/e}var i=0<=-11*(e=-e*Math.PI*2)+-13*(t=-t*Math.PI*2)+-17*(r=-r*Math.PI*2)?1:-1,a=Math.sqrt(e*e+t*t+r*r),e=C.PAULI_X.times(e).plus(C.PAULI_Y.times(t)).plus(C.PAULI_Z.times(r)),o=(r=(t=A.snappedCosSin(i*a)[Symbol.iterator]()).next()).done?void 0:r.value,t=(r=t.next()).done?void 0:r.value,r=new v(1+o,t).times(.5),o=new v(Math.sin(a/2)*n(a/2),-i*n(a)).times(.5*i);return C.identity(2).times(r).minus(e.times(o)).transformRealAndImagComponentsWith(function(e){return u.simplifyByRounding(e,1e-13)})},fromWireSwap:function(e,i,a){return C.generateTransition(1<<e,function(e){var t=1<<i,r=1<<a,n=e&~(t|r);return 0!=(e&t)&&(n|=r),0!=(e&r)&&(n|=t),n})},identity:function(e){if(!Number.isInteger(e)||e<=0)throw new y("Bad size",{size:e});for(var t=new Float64Array(e*e*2),r=0;r<e;r++)t[r*(e+1)*2]=1;return new C(e,e,t)},rotation:function(e){var t=Math.cos(e),e=Math.sin(e);return C.square(t,-e,e,t)},fromAngleAxisPhaseRotation:function(e,t,r){var n=(a=(t=t[Symbol.iterator]()).next()).done?void 0:a.value,i=(a=t.next()).done?void 0:a.value,t=(a=t.next()).done?void 0:a.value,a=(A.need(Math.abs(n*n+i*i+t*t-1)<1e-6,"Not a unit axis."),C.PAULI_X.times(n).plus(C.PAULI_Y.times(i)).plus(C.PAULI_Z.times(t))),t=(i=(n=A.snappedCosSin(-e/2)[Symbol.iterator]()).next()).done?void 0:i.value,e=(i=n.next()).done?void 0:i.value;return C.identity(2).times(t).plus(a.times(new v(0,e))).times(v.polar(1,r))}});function C(e,t,r){if(e*t*2!==r.length)throw new y("width*height*2 !== buffer.length",{width:e,height:t,len:r.length});this._width=e,this._height=t,this._buffer=r}function r(e){return b(e).map(function(e){return{r:v.realPartOf(e),i:v.imagPartOf(e)}}).toArray()}function n(e){return b(e).map(v.realPartOf).toArray()}return t.PAULI_X=t.square(0,1,1,0),t.PAULI_Y=t.square(0,new v(0,-1),v.I,0),t.PAULI_Z=t.square(1,0,0,-1),t.HADAMARD=t.square(1,1,1,-1).times(Math.sqrt(.5)),{get Matrix(){return t},get complexVectorToReadableJson(){return r},get realVectorToReadableJson(){return n}}}),$traceurRuntime.registerModule("src/math/Point.js",[],function(){"use strict";var e=$traceurRuntime.createClass(r,{isEqualTo:function(e){return e instanceof r&&e.x===this.x&&e.y===this.y},toString:function(){return"(x: "+this.x+", y: "+this.y+")"},offsetBy:function(e,t){return new r(this.x+e,this.y+t)},plus:function(e){return new r(this.x+e.x,this.y+e.y)},minus:function(e){return new r(this.x-e.x,this.y-e.y)},times:function(e){return new r(this.x*e,this.y*e)},distanceTo:function(e){var t=this.x-e.x,e=this.y-e.y;return Math.sqrt(t*t+e*e)}},{});function r(e,t){this.x=e,this.y=t}return{get Point(){return e}}}),$traceurRuntime.registerModule("src/math/Rect.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./Point.js","src/math/Rect.js")).Point,t=$traceurRuntime.createClass(n,{isEqualTo:function(e){return e instanceof n&&e.x===this.x&&e.y===this.y&&e.w===this.w&&e.h===this.h},isApproximatelyEqualTo:function(e,t){return e instanceof n&&(e=e,Math.abs(e.x-this.x)<=t)&&Math.abs(e.y-this.y)<=t&&Math.abs(e.right()-this.right())<=t&&Math.abs(e.bottom()-this.bottom())<=t},toString:function(){return"["+this.x+":"+this.right()+"]x["+this.y+":"+this.bottom()+"]"},center:function(){return new e(this.x+this.w/2,this.y+this.h/2)},topLeft:function(){return new e(this.x,this.y)},topRight:function(){return new e(this.x+this.w,this.y)},bottomLeft:function(){return new e(this.x,this.y+this.h)},bottomRight:function(){return new e(this.x+this.w,this.y+this.h)},centerLeft:function(){return new e(this.x,this.y+this.h/2)},centerRight:function(){return new e(this.x+this.w,this.y+this.h/2)},topCenter:function(){return new e(this.x+this.w/2,this.y)},bottomCenter:function(){return new e(this.x+this.w/2,this.y+this.h)},right:function(){return this.x+this.w},bottom:function(){return this.y+this.h},skipLeft:function(e){e=Math.min(e,this.w);return new n(this.x+e,this.y,this.w-e,this.h)},skipRight:function(e){e=Math.min(e,this.w);return new n(this.x,this.y,this.w-e,this.h)},skipTop:function(e){e=Math.min(e,this.h);return new n(this.x,this.y+e,this.w,this.h-e)},skipBottom:function(e){e=Math.min(e,this.h);return new n(this.x,this.y,this.w,this.h-e)},takeLeft:function(e){e=Math.max(e,0);return new n(this.x,this.y,e,this.h)},takeRight:function(e){e=Math.max(e,0);return new n(this.x+this.w-e,this.y,e,this.h)},takeTop:function(e){e=Math.max(e,0);return new n(this.x,this.y,this.w,e)},takeBottom:function(e){e=Math.max(e,0);return new n(this.x,this.y+this.h-e,this.w,e)},paddedBy:function(e){return new n(this.x-e,this.y-e,this.w+2*e,this.h+2*e)},scaledOutwardBy:function(e){var t=this.center(),r=this.w*e,e=this.h*e;return new n(t.x-r/2,t.y-e/2,r,e)},containsPoint:function(e){return e.x>=this.x&&e.x<this.x+this.w&&e.y>=this.y&&e.y<this.y+this.h},takeLeftProportion:function(e){return this.takeLeft(this.w*e)},takeRightProportion:function(e){return this.takeRight(this.w*e)},takeTopProportion:function(e){return this.takeTop(this.h*e)},takeBottomProportion:function(e){return this.takeBottom(this.h*e)},leftHalf:function(){return this.skipRight(this.w/2)},rightHalf:function(){return this.skipLeft(this.w/2)},topHalf:function(){return this.skipBottom(this.h/2)},bottomHalf:function(){return this.skipTop(this.h/2)},shiftedBy:function(e,t){return new n(this.x+e,this.y+t,this.w,this.h)},proportionalShiftedBy:function(e,t){return this.shiftedBy(e*this.w,t*this.h)},withX:function(e){return new n(e,this.y,this.w,this.h)},withY:function(e){return new n(this.x,e,this.w,this.h)},withW:function(e){return new n(this.x,this.y,e,this.h)},withH:function(e){return new n(this.x,this.y,this.w,e)},snapInside:function(e){var t=Math.min(e.w,this.w),r=Math.min(e.h,this.h);return new n(Math.max(Math.min(this.x,e.right()-t),e.x),Math.max(Math.min(this.y,e.bottom()-r),e.y),t,r)}},{centeredSquareWithRadius:function(e,t){return new n(e.x-t,e.y-t,2*t,2*t)}});function n(e,t,r,n){this.x=e,this.y=t,this.w=r,this.h=n}return{get Rect(){return t}}}),$traceurRuntime.registerModule("src/ui/clear.js",[],function(){"use strict";function e(r,e){var n='{"cols":[]}',i=document.getElementById("clear-all-button"),a=(r.latestActiveCommit().zipLatest(e,function(e,t){return{r:e,v:t}}).subscribe(function(e){var t=e.r,e=e.v;i.disabled=t===n||e}),i.addEventListener("click",function(){return r.commit(n)}),document.getElementById("clear-circuit-button"));r.latestActiveCommit().zipLatest(e,function(e,t){return{r:e,v:t}}).subscribe(function(e){var t=e.r,e=e.v;a.disabled=t===o(r)||e}),a.addEventListener("click",function(){return r.commit(o(r))})}function o(e){e=JSON.parse(e.peekActiveCommit());return e.cols=[],JSON.stringify(e)}return{get initClear(){return e}}}),$traceurRuntime.registerModule("src/ui/DisplayedCircuit.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/CachablePainting.js","src/ui/DisplayedCircuit.js")).CachablePainting,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/CircuitDefinition.js","src/ui/DisplayedCircuit.js")).CircuitDefinition,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/CircuitStats.js","src/ui/DisplayedCircuit.js")).CircuitStats,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/ui/DisplayedCircuit.js")).Config,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/DetailedError.js","src/ui/DisplayedCircuit.js")).DetailedError,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Equate.js","src/ui/DisplayedCircuit.js")).equate,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Format.js","src/ui/DisplayedCircuit.js")).Format,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/GateColumn.js","src/ui/DisplayedCircuit.js")).GateColumn,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GateDrawParams.js","src/ui/DisplayedCircuit.js")).GateDrawParams,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GatePainting.js","src/ui/DisplayedCircuit.js")).GatePainting,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../ui/Hand.js","src/ui/DisplayedCircuit.js")).Hand,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/MathPainter.js","src/ui/DisplayedCircuit.js")).MathPainter,p=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Point.js","src/ui/DisplayedCircuit.js")).Point,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/ui/DisplayedCircuit.js")).Matrix,v=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Rect.js","src/ui/DisplayedCircuit.js")).Rect,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/ui/DisplayedCircuit.js")).Util,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Seq.js","src/ui/DisplayedCircuit.js")),y=r.seq,b=r.Seq,R=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../gates/BlochSphereDisplay.js","src/ui/DisplayedCircuit.js")).paintBlochSphereDisplay,w=$traceurRuntime.createClass(M,{isBeingEdited:function(){return void 0!==this._extraWireStartIndex},_groundedWireCount:function(){var e=void 0!==this._extraWireStartIndex&&this._extraWireStartIndex!==d.MAX_WIRE_COUNT?1:0,e=Math.max(d.MIN_WIRE_COUNT,this.circuitDefinition.numWires)-e;return Math.max(e,this.circuitDefinition.minimumRequiredWireCount())},desiredHeight:function(){return void 0!==arguments[0]&&arguments[0]?this.circuitDefinition.numWires*d.WIRE_SPACING:this._groundedWireCount()*d.WIRE_SPACING+55},desiredWidth:function(){return void 0!==arguments[0]&&arguments[0]?this.opRect(this.circuitDefinition.columns.length-1).right()+35:this._rectForSuperpositionDisplay().right()+101},wireRect:function(e){if(e<0)throw new o("Bad wireIndex",{wireIndex:e});return new v(0,this.top+d.WIRE_SPACING*e,1/0,d.WIRE_SPACING)},wireIndexAt:function(e){return Math.floor((e-this.top)/d.WIRE_SPACING)},toColumnSpaceCoordinate:function(e){return(e-30)/(10+2*d.GATE_RADIUS)-.5},indexOfDisplayedRowAt:function(e){e=Math.floor((e-this.top)/d.WIRE_SPACING);if(!(e<0||e>=this.circuitDefinition.numWires))return e},indexOfDisplayedColumnAt:function(e){e=this.toColumnSpaceCoordinate(e),e=void 0===this._compressedColumnIndex||e<this._compressedColumnIndex-.75?Math.round(e):e<this._compressedColumnIndex-.25?this._compressedColumnIndex:Math.round(e)-1;if(!(e<0||e>=this.circuitDefinition.columns.length))return e},findOpHalfColumnAt:function(e){if(!(e.x<0||e.y<this.top||e.y>this.top+this.desiredHeight()))return Math.max(-.5,Math.round(2*this.toColumnSpaceCoordinate(e.x))/2)},_findModificationIndex_helperColRow:function(e){if(void 0!==e.pos&&void 0!==e.heldGate){var e=e.pos.minus(e.holdOffset).plus(new p(d.GATE_RADIUS,d.GATE_RADIUS)),t=this.findOpHalfColumnAt(e),e=this.indexOfDisplayedRowAt(e.y);if(void 0!==t&&void 0!==e)return{col:Math.ceil(t),row:e,halfColIndex:t}}},findModificationIndex:function(e){var t,r,n=this._findModificationIndex_helperColRow(e);if(void 0!==n)return t=n.col,r=n.row,n=n.halfColIndex,n=.5===Math.abs(n%1),t>=this.circuitDefinition.columns.length||n||this.circuitDefinition.isSlotRectCoveredByGateInSameColumn(t,r,e.heldGate.height)&&(n=!0,e.pos.x>this.opRect(t).center().x)&&(t+=1),{col:t,row:r,isInsert:n}},opRect:function(e){var t=2*d.GATE_RADIUS,r=10+t,n=0,e=(void 0!==this._compressedColumnIndex&&e===this._compressedColumnIndex&&(n=r/2),r*e-(n=void 0!==this._compressedColumnIndex&&e>this._compressedColumnIndex?r:n)+35);return new v(e,this.top,t,this.desiredHeight())},gateRect:function(e,t){var r=void 0!==arguments[2]?arguments[2]:1,n=void 0!==arguments[3]?arguments[3]:1,t=this.opRect(t),e=this.wireRect(e),t=new v(t.center().x-d.GATE_RADIUS,e.center().y-d.GATE_RADIUS,2*d.GATE_RADIUS+(r-1)*d.WIRE_SPACING,2*d.GATE_RADIUS+(n-1)*d.WIRE_SPACING);return new v(Math.round(t.x-.5)+.5,Math.round(t.y-.5)+.5,Math.round(t.w),Math.round(t.h))},afterTidyingUp:function(){return this.withCircuit(this.circuitDefinition.withUncoveredColumnsRemoved().withHeightOverlapsFixed().withWidthOverlapsFixed().withUncoveredColumnsRemoved().withTrailingSpacersIncluded())._withCompressedColumnIndex(void 0)._withExtraWireStartIndex(void 0)._withHighlightedSlot(void 0)},isEqualTo:function(e){return this===e||e instanceof M&&this.top===e.top&&this.circuitDefinition.isEqualTo(e.circuitDefinition)&&this._compressedColumnIndex===e._compressedColumnIndex&&this._extraWireStartIndex===e._extraWireStartIndex&&t(this._highlightedSlot,e._highlightedSlot)},paint:function(e,t,r){var n=void 0!==arguments[3]&&arguments[3];void 0!==arguments[4]&&!arguments[4]||this._drawWires(e,!n,t);for(var i=0;i<this.circuitDefinition.columns.length;i++)this._drawColumn(e,this.circuitDefinition.columns[i],i,t,r);n||(this._drawOutputDisplays(e,r,t),this._drawHintLabels(e,r)),this._drawRowDragHighlight(e)},_drawWires:function(u,s,e){var l=this,t=Math.min(this.circuitDefinition.numWires,(this._extraWireStartIndex||1/0)+1);if(s)for(var r=0;r<t;r++){var n=this.wireRect(r).center().y,i=this.circuitDefinition.customInitialValues.get(r),a=(void 0===i&&(i="0"),this._wireInitialStateClickableRect(r));u.noteTouchBlocker({rect:a,cursor:"pointer"}),void 0===this._highlightedSlot&&void 0!==e.pos&&a.containsPoint(e.pos)&&u.fillRect(a,d.HIGHLIGHTED_GATE_FILL_COLOR),u.print("|"+i+"⟩",20,n,"right","middle","black","14px sans-serif",20,d.WIRE_SPACING)}u.ctx.save();for(var c=this,o=0;o<t;o++)!function(o){o===c._extraWireStartIndex&&(u.ctx.globalAlpha*=.5),u.trace(function(e){for(var t=l.wireRect(o),r=Math.round(t.center().y-.5)+.5,n=s?25:5,i=0;s?n<u.canvas.width:i<=l.circuitDefinition.columns.length;i++){var a=l.opRect(i).center().x;l.circuitDefinition.locIsMeasured(new p(i,o))?(e.line(n,r-1,a,r-1),e.line(n,r+1,a,r+1)):e.line(n,r,a,r),n=a}}).thenStroke("black")}(o);u.ctx.restore(),void 0!==this._extraWireStartIndex&&this.circuitDefinition.numWires===d.MAX_WIRE_COUNT&&u.print("(Max wires. Qubit limit is "+d.MAX_WIRE_COUNT+".)",5,this.wireRect(d.MAX_WIRE_COUNT).y,"left","top","red","16px bold monospace",400,d.WIRE_SPACING)},_highlightStatusAt:function(t,r,e){var n,i,a,o,u=this;return void 0!==this._highlightedSlot&&this._highlightedSlot.col===t&&this._highlightedSlot.row===r?{isResizeShowing:!0,isResizeHighlighted:this._highlightedSlot.resizeStyle,isHighlighted:!this._highlightedSlot.resizeStyle}:void 0===(n=this.circuitDefinition.gateInSlot(t,r))||void 0!==this._highlightedSlot?{isResizeShowing:!1,isResizeHighlighted:!1,isHighlighted:!1}:(o=this.gateRect(r,t,n.width,n.height),i=f.rectForResizeTab(o),a=function(e){e=u.findGateOverlappingPos(e);return void 0===e||e.col===t&&e.row===r},{isHighlighted:e=!(o=n.canChangeInSize()&&y(e).any(function(e){return a(e)&&i.containsPoint(e)}))&&y(e).any(function(e){e=u.findGateOverlappingPos(e);return void 0!==e&&e.col===t&&e.row===r}),isResizeShowing:n.canChangeInSize()&&(o||e),isResizeHighlighted:o})},_drawGate_disabledReason:function(e,t,r,n,i){t=this.circuitDefinition.gateAtLocIsDisabledReason(t,r);void 0!==t&&(e.ctx.save(),i&&(e.ctx.globalAlpha*=.3),e.ctx.globalAlpha*=.5,e.fillRect(n.paddedBy(5),"yellow"),e.ctx.globalAlpha*=2,e.strokeLine(n.topLeft(),n.bottomRight(),"orange",3),r=e.printParagraph(t,n.paddedBy(5),new p(.5,.5),"red"),e.ctx.globalAlpha*=.5,e.fillRect(r.paddedBy(2),"yellow"),e.ctx.globalAlpha*=2,e.printParagraph(t,n.paddedBy(5),new p(.5,.5),"red"),e.ctx.restore())},_drawColumn:function(e,t,r,n,i){this._drawColumnControlWires(e,r),this._drawColumnDragHighlight(e,r);for(var a,o,u,s,l,c,d=0;d<this.circuitDefinition.numWires;d++)void 0!==t.gates[d]&&(a=t.gates[d],o=this.gateRect(d,r,a.width,a.height),u=(l=this._highlightStatusAt(r,d,n.hoverPoints())).isHighlighted,s=l.isResizeShowing,l=l.isResizeHighlighted,c=a.customDrawer||f.DEFAULT_DRAWER,e.noteTouchBlocker({rect:o,cursor:"pointer"}),a.canChangeInSize()&&e.noteTouchBlocker({rect:f.rectForResizeTab(o),cursor:"ns-resize"}),c(new m(e,n,!1,u&&!l,s,l,o,a,i,{row:d,col:r},void 0===this._highlightedSlot?n.hoverPoints():[],i.customStatsForSlot(r,d))),this._drawGate_disabledReason(e,r,d,o,u));this._drawColumnSurvivalRate(e,t,r,i)},_drawColumnSurvivalRate:function(e,t,r,n){var i;void 0===t.indexOfNonUnitaryGate()||(t=n.survivalRate(r-1),n=(n.survivalRate(r)-t)/t,isNaN(n))||Math.abs(n)<=.005||(t=n<0?(t=Math.round(100*-n),i=(-1==n?"100":t<100?t:">99")+"%","omits"):(i=Math.round(100*n+100)+"%","gains"),n=this.opRect(r).bottomCenter(),e.print(t,n.x,n.y-28,"center","bottom","red","14px sans-serif",800,50),e.print(i,n.x,n.y-13,"center","bottom","red","14px sans-serif",800,50))},_drawColumnDragHighlight:function(e,t){void 0!==this._highlightedSlot&&this._highlightedSlot.col===t&&void 0===this._highlightedSlot.row&&(t=this.gateRect(0,t,1,this._groundedWireCount()).paddedBy(3),e.fillRect(t,"rgba(255, 196, 112, 0.7)"),e.strokeRect(t,"black"))},_drawRowDragHighlight:function(e){var t,r;void 0!==this._highlightedSlot&&void 0===this._highlightedSlot.col&&void 0!==this._highlightedSlot.row&&(r=this._highlightedSlot.row,t=this.gateRect(r,this.clampedCircuitColCount()+1).x,r=this.wireRect(r).takeLeft(t),e.fillRect(r,"rgba(255, 196, 112, 0.7)"),e.strokeRect(r,"black"))},_drawColumnControlWires:function(e,t){var r=Math.round(this.opRect(t).center().x-.5)+.5,n=(this.circuitDefinition.columns[t].hasGatesWithGlobalEffects()&&(e.ctx.save(),e.ctx.setLineDash([1,4]),e.strokeLine(new p(r,this.gateRect(0,0).y),new p(r,this.opRect(0).bottom()-40)),e.ctx.restore()),!0),i=!1,a=void 0;try{for(var o,u=this.circuitDefinition.controlLinesRanges(t)[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value,l=s.first,c=s.last,d=s.measured,m=this.wireRect(l).center().y,f=this.wireRect(c).center().y;d?(e.strokeLine(new p(r+1,m),new p(r+1,f)),e.strokeLine(new p(r-1,m),new p(r-1,f))):e.strokeLine(new p(r,m),new p(r,f))}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}},previewDrop:function(e){return void 0!==e.heldRow?this._previewDropMovedRow(e):void 0!==e.heldColumn?this._previewDropMovedGateColumn(e):void 0!==e.heldGate?this._previewDropMovedGate(e):this._previewResizedGate(e)},_previewDropMovedRow:function(e){if(void 0===e.pos)return this;if((n=this.wireIndexAt(e.pos.y))<0||n>=this.circuitDefinition.numWires)return this;for(var t=y(e.heldRow.gates).map(function(e){return void 0===e?1:e.height}).max(1),n=Math.min(n,this.circuitDefinition.numWires-t),r=[],i=0;i<this.circuitDefinition.columns.length;i++){var a=$traceurRuntime.spread(this.circuitDefinition.columns[i].gates);a.splice(n,0,e.heldRow.gates[i]),a.pop(),r.push(new s(a))}t=y(this.circuitDefinition.customInitialValues.entries()).map(function(e){var t,r=(t=(e=e[Symbol.iterator]()).next()).done?void 0:t.value,e=(t=e.next()).done?void 0:t.value;return[r+(n<=r?1:0),e]}).toMap(function(e){var t,r=(t=(e=e[Symbol.iterator]()).next()).done?void 0:t.value;(t=e.next()).done||t.value;return r},function(e){var t;(t=(e=e[Symbol.iterator]()).next()).done||t.value;return(t=e.next()).done?void 0:t.value}),void 0!==e.heldRow.initialState&&t.set(n,e.heldRow.initialState),t=this.circuitDefinition.withColumns(r).withInitialStates(t);return this.withCircuit(t)._withHighlightedSlot({row:n,col:void 0,resizeStyle:!1})},_previewDropMovedGateColumn:function(e){var t,r,n;return void 0===e.pos||(r=this.wireIndexAt(e.pos.y))<0||r>=d.MAX_WIRE_COUNT||e.pos.x<=1?this:((r=this.findOpHalfColumnAt(new p(e.pos.x,this.top)))%1!=0||void 0===this.circuitDefinition.columns[r]||this.circuitDefinition.columns[r].isEmpty()||(r+=e.pos.x>this.opRect(r).center().x?.5:-.5),t=Math.ceil(r),r=r%1!=0,n=Math.round((e.pos.y-e.holdOffset.y-this.top)/d.WIRE_SPACING),n=this._shiftAndSpliceColumn(n,$traceurRuntime.spread(e.heldColumn.gates),t,r),this.withCircuit(n)._withHighlightedSlot({row:void 0,col:t,resizeStyle:!1})._withCompressedColumnIndex(r?t:void 0))},_shiftAndSpliceColumn:function(e,t,r,n){for(;e<0&&void 0===t[0];)t.shift(),t.push(void 0),e+=1;for(;0<e&&new s(t).minimumRequiredWireCount()<d.MAX_WIRE_COUNT;)t.unshift(void 0),new s(t).minimumRequiredWireCount()<t.length&&t.pop(),--e;for(var i=this.circuitDefinition.withWireCount(t.length),a=$traceurRuntime.spread(i.columns);a.length<r;)a.push(s.empty(i.numWires));return a.splice(r,n?0:1,new s(t)),i.withColumns(a).withTrailingSpacersIncluded()},_previewDropMovedGate:function(e){var t,r,n,i,a,o,u=this.findModificationIndex(e);return void 0===u||(i=Math.floor(e.holdOffset.y/d.WIRE_SPACING),u.row+i>=this.circuitDefinition.numWires)||(t=e.heldGate,r=s.empty(this.circuitDefinition.numWires),n=u.col,i=u.isInsert,a=Math.min(u.row,Math.max(0,d.MAX_WIRE_COUNT-t.height)),e=y(this.circuitDefinition.columns).padded(n,r).ifThen(i,function(e){return e.withInsertedItem(n,r)}).padded(n+t.width,r).withTransformedItem(n,function(e){return e.withGatesAdded(a,new s([t]))}).toArray(),(o=Math.max(this._extraWireStartIndex||0,Math.max(this.circuitDefinition.numWires,t.height+a)))>d.MAX_WIRE_COUNT)?this:(e=this.circuitDefinition.withColumns(e).withWireCount(o),this.withCircuit(e)._withHighlightedSlot({row:a,col:u.col,resizeStyle:!1})._withCompressedColumnIndex(i?n:void 0)._withFallbackExtraWireStartIndex(this.circuitDefinition.numWires))},_previewResizedGate:function(t){var r,n,e,i,a;return void 0===t.resizingGateSlot||void 0===t.pos||void 0===(i=this.circuitDefinition.gateInSlot(t.resizingGateSlot.x,t.resizingGateSlot.y))?this:(r=Math.min(this.wireIndexAt(t.pos.y-t.holdOffset.y),d.MAX_WIRE_COUNT-1),n=y(i.gateFamily).minBy(function(e){return Math.abs(e.height-(r-t.resizingGateSlot.y+1))}),i=Math.min(d.MAX_WIRE_COUNT,Math.max(this.circuitDefinition.numWires,n.height+t.resizingGateSlot.y)),e=y(this.circuitDefinition.columns).withTransformedItem(t.resizingGateSlot.x,function(e){return new s(y(e.gates).withOverlayedItem(t.resizingGateSlot.y,n).toArray())}).toArray(),a=(i=(e=this.circuitDefinition.withColumns(e).withWireCount(i)).withHeightOverlapsFixed()).withTrailingSpacersIncluded(),this.withCircuit(a)._withHighlightedSlot(this._highlightedSlot)._withCompressedColumnIndex(e.isEqualTo(i)?void 0:t.resizingGateSlot.x+1)._withFallbackExtraWireStartIndex(this.circuitDefinition.numWires))},afterDropping:function(e){return this.previewDrop(e)._withCompressedColumnIndex(void 0)},withCircuit:function(e){return new M(this.top,e,this._compressedColumnIndex,this._highlightedSlot,this._extraWireStartIndex)},_withCompressedColumnIndex:function(e){return new M(this.top,this.circuitDefinition,e,this._highlightedSlot,this._extraWireStartIndex)},_withHighlightedSlot:function(e){return new M(this.top,this.circuitDefinition,this._compressedColumnIndex,e,this._extraWireStartIndex)},_withExtraWireStartIndex:function(e){return new M(this.top,this.circuitDefinition,this._compressedColumnIndex,this._highlightedSlot,e)},_withFallbackExtraWireStartIndex:function(e){return this._withExtraWireStartIndex(this._extraWireStartIndex||e)},withJustEnoughWires:function(e,t){var e=void 0!==e.heldGate?e.heldGate.height:0,r=this.circuitDefinition.minimumRequiredWireCount(),e=Math.min(d.MAX_WIRE_COUNT,Math.max(Math.min(1,e),Math.max(d.MIN_WIRE_COUNT,r)+t));return this.withCircuit(this.circuitDefinition.withWireCount(e))._withExtraWireStartIndex(0===t?void 0:this.circuitDefinition.numWires)},findGateOverlappingPos:function(e){var t=this.indexOfDisplayedColumnAt(e.x),r=this.indexOfDisplayedRowAt(e.y);if(void 0!==t&&void 0!==r){t=this.circuitDefinition.findGateCoveringSlot(t,r);if(void 0!==t){r=this.gateRect(t.row,t.col,t.gate.width,t.gate.height);if(r.containsPoint(e))return{col:t.col,row:t.row,offset:e.minus(r.topLeft())}}}},findGateWithButtonContaining:function(e){var t=this.findGateOverlappingPos(e);if(void 0!==t){var r=this.circuitDefinition.gateInSlot(t.col,t.row);if(void 0!==r.onClickGateFunc)if(f.gateButtonRect(this.gateRect(t.row,t.col,r.width,r.height)).containsPoint(e))return{col:t.col,row:t.row,gate:r}}},_wireInitialStateClickableRect:function(e){e=this.wireRect(e);return e.x=0,e.y+=5,e.w=30,e.h-=10,e},findWireWithInitialStateAreaContaining:function(e){if(!(e.x<0||30<e.x)){var t=this.wireIndexAt(e.y);if(!(t<0||t>=this.circuitDefinition.numWires))if(this._wireInitialStateClickableRect(t).containsPoint(e))return t}},tryClick:function(e){var t,r,n;if(void 0!==e.pos&&void 0===e.heldGate)return void 0!==(t=this.findWireWithInitialStateAreaContaining(e.pos))?this.withCircuit(this.circuitDefinition.withSwitchedInitialStateOn(t)):void 0!==(t=this.findGateWithButtonContaining(e.pos))?(e=t.gate.onClickGateFunc(t.gate),n=(r=$traceurRuntime.spread(this.circuitDefinition.columns))[t.col],(n=$traceurRuntime.spread(n.gates)).splice(t.row,1,e),r.splice(t.col,1,new s(n)),this.withCircuit(this.circuitDefinition.withColumns(r))):void 0},tryGrab:function(e){var t,r=void 0!==arguments[1]&&arguments[1],n=void 0!==arguments[2]&&arguments[2],i=void 0!==arguments[3]&&arguments[3],a=void 0!==arguments[4]&&arguments[4];return n?void 0!==(n=this._tryGrabRow(e,a))?n:this._tryGrabWholeColumn(e,r,a)||{newCircuit:this,newHand:e}:(n=e,t=this,i||void 0!==(i=this._tryGrabResizeTab(e))&&(n=i.newHand,t=i.newCircuit),t._tryGrabGate(n,r,a)||{newCircuit:t,newHand:n})},_tryGrabRow:function(e,t){if(void 0!==e.pos){var r=this.wireIndexAt(e.pos.y);if(!(r<0||r>=this.circuitDefinition.numWires)){var n,i,a=this._wireInitialStateClickableRect(r);if(a.containsPoint(e.pos))return n=(r=this._cutRow(r)).newCircuit,i=r.initialState,r=r.rowGates,a=new p(0,e.pos.y-a.y),t&&(r=r.map(function(e){return void 0===e?e:e.alternate})),{newCircuit:this.withCircuit(n),newHand:e.withHeldRow({initialState:i,gates:r},a)}}}},_cutRow:function(n){for(var e=[],t=[],r=0;r<this.circuitDefinition.columns.length;r++){var i=$traceurRuntime.spread(this.circuitDefinition.columns[r].gates);e.push(i[n]),i.splice(n,1),i.push(void 0),t.push(new s(i))}var a=y(this.circuitDefinition.customInitialValues.entries()).filter(function(e){var t,r=(t=(e=e[Symbol.iterator]()).next()).done?void 0:t.value;(t=e.next()).done||t.value;return r!==n}).map(function(e){var t,r=(t=(e=e[Symbol.iterator]()).next()).done?void 0:t.value,e=(t=e.next()).done?void 0:t.value;return[r-(n<r?1:0),e]}).toMap(function(e){var t,r=(t=(e=e[Symbol.iterator]()).next()).done?void 0:t.value;(t=e.next()).done||t.value;return r},function(e){var t;(t=(e=e[Symbol.iterator]()).next()).done||t.value;return(t=e.next()).done?void 0:t.value});return{newCircuit:this.circuitDefinition.withColumns(t).withInitialStates(a),rowGates:e,initialState:this.circuitDefinition.customInitialValues.get(n)}},_tryGrabGate:function(e,t,r){if(!e.isBusy()&&void 0!==e.pos){var n,i,a,o=this.findGateOverlappingPos(e.pos);if(void 0!==o)return n=o.col,i=o.row,o=o.offset,a=this.circuitDefinition.columns[n].gates[i],r&&(a=a.alternate),r=y(this.circuitDefinition.columns[n].gates).toArray(),t||(r[i]=void 0),t=y(this.circuitDefinition.columns).withOverlayedItem(n,new s(r)).toArray(),{newCircuit:new M(this.top,this.circuitDefinition.withColumns(t),void 0,void 0,this._extraWireStartIndex),newHand:e.withHeldGate(a,o)}}},_tryGrabResizeTab:function(e){if(!e.isBusy()&&void 0!==e.pos)for(var t=0;t<this.circuitDefinition.columns.length;t++)for(var r=0;r<this.circuitDefinition.numWires;r++){var n=this.circuitDefinition.columns[t].gates[r];if(void 0!==n)if(this._highlightStatusAt(t,r,e.hoverPoints()).isResizeHighlighted)return n=e.pos.minus(this.gateRect(r+n.height-1,t,1,1).center()),{newCircuit:this._withHighlightedSlot({col:t,row:r,resizeStyle:!0}),newHand:e.withResizeSlot(new p(t,r),n)}}},_tryGrabWholeColumn:function(e,t,r){if(!e.isBusy()&&void 0!==e.pos){var n,i=Math.round(this.toColumnSpaceCoordinate(e.pos.x));if(!(i<0||i>=this.circuitDefinition.columns.length||this.circuitDefinition.columns[i].isEmpty()))return n=$traceurRuntime.spread(this.circuitDefinition.columns),t||n.splice(i,1,s.empty(this.circuitDefinition.numWires)),t=new p(0,this.wireIndexAt(e.pos.y)*d.WIRE_SPACING+d.WIRE_SPACING/2),i=this.circuitDefinition.columns[i],r&&(i=new s(i.gates.map(function(e){return void 0===e?e:e.alternate}))),{newCircuit:this.withCircuit(this.circuitDefinition.withColumns(n)),newHand:e.withHeldGateColumn(i,t)}}},stableDuration:function(){return this.circuitDefinition.stableDuration()},importantWireCount:function(){return Math.max(this.circuitDefinition.numWires-(this._extraWireStartIndex===d.MAX_WIRE_COUNT?0:1),d.MIN_WIRE_COUNT,this.circuitDefinition.minimumRequiredWireCount())},_drawOutputDisplays:function(e,t,r){for(var n=this.clampedCircuitColCount()+1,i=n+1,a=this.importantWireCount(),o=0;o<a;o++){var u=t.controlledWireProbabilityJustAfter(o,1/0),u=(g.paintProbabilityBox(e,u,this.gateRect(o,n),r.hoverPoints()),t.qubitDensityMatrix(1/0,o));void 0!==u&&R(e,u,this.gateRect(o,i),r.hoverPoints())}var s=this.wireRect(a-1).bottom(),l=this.opRect(n-1).x;e.printParagraph("Local wire states\n(Chance/Bloch)",new v(l,s+4,190,40),new p(.5,0),"gray"),this._drawOutputSuperpositionDisplay(e,t,r)},clampedCircuitColCount:function(){return Math.max(this.circuitDefinition.columns.length,d.MIN_COL_COUNT+(void 0!==this._compressedColumnIndex?1:0))},_drawOutputSuperpositionDisplay:function(e,t,r){var n=this._outputStateAsMatrix(t),t=this._rectForSuperpositionDisplay(),i=this.importantWireCount();g.paintMatrix(e,n,t,i<d.SIMPLE_SUPERPOSITION_DRAWING_WIRE_THRESHOLD?d.SUPERPOSITION_MID_COLOR:void 0,"black",i<d.SIMPLE_SUPERPOSITION_DRAWING_WIRE_THRESHOLD?d.SUPERPOSITION_FORE_COLOR:void 0,d.SUPERPOSITION_BACK_COLOR);g.paintMatrixTooltip(e,n,t,r.hoverPoints(),function(e,t){return"Amplitude of |"+l.bin(t*n.width()+e,i)+"⟩ (decimal "+(t*n.width()+e)+")"},function(e,t,r){return"val:"+r.toString(new u(!1,0,5,", "))},function(e,t,r){return"mag²:"+(100*r.norm2()).toFixed(4)+"%, phase:"+(0<=(r=180*r.phase()/Math.PI)?"+":"")+r.toFixed(2)+"°"}),this._drawOutputSuperpositionDisplay_labels(e)},_drawOutputSuperpositionDisplay_labels:function(e){var t=this._rectForSuperpositionDisplay(),r=this.importantWireCount();S.paint(t.right(),t.y,e,r),T.paint(t.x,t.bottom(),e,r)},_outputStateAsMatrix:function(e){var t=this.importantWireCount(),r=e.finalState.rawBuffer();e.circuitDefinition.numWires!==t&&((e=new Float32Array(2<<t)).set(r.slice(0,e.length)),r=e);var n=(t=(e=[1<<((t=(e=[Math.floor(t/2),Math.ceil(t/2)][Symbol.iterator]()).next()).done?void 0:t.value),1<<((t=e.next()).done?void 0:t.value)][Symbol.iterator]()).next()).done?void 0:t.value,e=(t=e.next()).done?void 0:t.value;return new i(n,e,r)},_rectForSuperpositionDisplay:function(){var e=this.clampedCircuitColCount()+2+1,t=this.importantWireCount(),r=(i=(n=[1<<((i=(n=[Math.floor(t/2),Math.ceil(t/2)][Symbol.iterator]()).next()).done?void 0:i.value),1<<((i=n.next()).done?void 0:i.value)][Symbol.iterator]()).next()).done?void 0:i.value,n=(i=n.next()).done?void 0:i.value,i=this.gateRect(0,e),t=this.gateRect(t-1,e),e=new v(i.x,i.y,0,t.bottom()-i.y);return e.withW(e.h*(r/n))},_drawHintLabels:function(e,t){var r,n=this._rectForSuperpositionDisplay(),t=(e.print("Final amplitudes",n.right()+3,n.bottom()+3,"left","top","gray","12px sans-serif",100,20),0!==this.circuitDefinition.colIsMeasuredMask(1/0)&&e.printParagraph("(assuming measurement deferred)",new v(n.right()+3,n.bottom()+20,100,75),new p(.5,0),"red"),t.survivalRate(1/0));.01<Math.abs(t-1)&&(r=t<1?(r=Math.round(100*t),"kept: "+(0===t?"0":0<r?r:"<1")+"%"):"over-unity: "+Math.round(100*t)+"%",e.print(r,this._rectForSuperpositionDisplay().x-5,n.bottom()+50,"right","bottom","red","14px sans-serif",800,50))}},{empty:function(e){return new M(e,new a(d.MIN_WIRE_COUNT,[]),void 0,void 0,void 0)},fromTextDiagram:function(t,r){var n=r.split("\n").map(function(e){e=e.split("|");if(2!==e.length)throw new o("Bad diagram",{diagramText:r,gateMap:t});return e[1]}),e=y(n).skip(1).stride(2).map(function(e){return y(e).skip(1).stride(2).join("")}).join("\n");return{circuit:new M(10,a.fromTextDiagram(t,e),void 0,void 0,void 0),pts:b.naturals().takeWhile(function(e){return-1!==r.indexOf(e)}).map(function(r){var e=y(n).mapWithIndex(function(e,t){return{row:t,col:e.indexOf(r)}}).filter(function(e){return-1!==e.col}).single();return"^"===n[e.row][e.col+1]&&(--e.row,e.col+=1),new p(e.col*d.WIRE_SPACING/2+35.5,e.row*d.WIRE_SPACING/2+10.5)}).toArray()}}});function M(e,t,r,n,i){if(!Number.isFinite(e))throw new o("Bad top",{top:e,circuitDefinition:t});if(!(t instanceof a))throw new o("Bad circuitDefinition",{top:e,circuitDefinition:t});this.top=e,this.circuitDefinition=t,this._compressedColumnIndex=r,this._highlightedSlot=n,this._extraWireStartIndex=i}function n(e,t,r,n,i){var a=new w(0,t,void 0,void 0,void 0),o=a.desiredWidth(!0),u=a.desiredHeight(!0),s=r.w/o,l=r.h/u,t=(n&&(l=s=Math.min(s,l)),c.withNanDataFromCircuitAtTime(t,i));try{e.ctx.save(),e.ctx.translate(r.x,r.y),e.ctx.scale(Math.min(1,s),Math.min(1,l)),e.ctx.translate(0,0),a.paint(e,h.EMPTY,t,!0,n)}finally{e.ctx.restore()}return{maxW:o*s,maxH:u*l}}function _(e){var t;void 0===e.gate.knownCircuit||""!==e.gate.symbol?e.gate.stableDuration()===1/0?f.DEFAULT_DRAWER(e):f.makeCycleDrawer()(e):(t=e.gate.stableDuration()===1/0?d.GATE_FILL_COLOR:d.TIME_DEPENDENT_HIGHLIGHT_COLOR,f.paintBackground(e,t),n(e.painter,e.gate.knownCircuitNested,e.rect,!1,e.stats.time),f.paintOutline(e),e.isHighlighted&&(e.painter.ctx.save(),e.painter.ctx.globalAlpha*=.9,e.painter.fillRect(e.rect,d.HIGHLIGHTED_GATE_FILL_COLOR),e.painter.ctx.restore()),f.paintOutline(e))}function x(e,t,r,n,i){var a=e.ctx,o=(a.save(),a.textAlign="left",a.textBaseline="middle",e.ctx.font="12px monospace",Math.max(e.ctx.measureText(n(0)).width,e.ctx.measureText(n(r-1)).width)),u=2.5*a.measureText("0").width,e=Math.min(Math.min((i-2)/o,t/u),1),s=t/e,l=1/e;if(a.scale(e,e),a.translate(0,.5*t/e-.5*u),a.fillStyle="lightgray",u<.95*s)for(var c=0;c<r;c++)a.fillRect(0,s*c,o+2*l,u);else a.fillRect(0,0,o+2*l,s*r);a.fillStyle="black";for(var d=0;d<r;d++)a.fillText(n(d),l,.5*u+s*d);a.restore()}var S=new e(function(e){return{width:50,height:(e-1)*d.WIRE_SPACING+2*d.GATE_RADIUS}},function(e,t){var r,n=(r=(t=[Math.floor(t/2),Math.ceil(t/2)][Symbol.iterator]()).next()).done?void 0:r.value,i=(r=t.next()).done?void 0:r.value,t=1<<i,a=n<4?"_".repeat(n):"_..";x(e,e.canvas.height/t,t,function(e){return l.bin(e,i)+a},50)}),T=new e(function(e){var t,r=(t=(n=[1<<((t=(n=[Math.floor(e/2),Math.ceil(e/2)][Symbol.iterator]()).next()).done?void 0:t.value),1<<((t=n.next()).done?void 0:t.value)][Symbol.iterator]()).next()).done?void 0:t.value,n=(t=n.next()).done?void 0:t.value;return{width:r*(((e-1)*d.WIRE_SPACING+2*d.GATE_RADIUS)/n),height:50}},function(e,t){var r=(i=(t=[Math.floor(t/2),Math.ceil(t/2)][Symbol.iterator]()).next()).done?void 0:i.value,t=(i=t.next()).done?void 0:i.value,n=1<<r,i=e.canvas.width/n,a=(e.ctx.translate(n*i,0),e.ctx.rotate(Math.PI/2),t<4?"_".repeat(t):".._");x(e,i,n,function(e){return a+l.bin(n-1-e,r)},50)});return{get DisplayedCircuit(){return w},get drawCircuitTooltip(){return n},get GATE_CIRCUIT_DRAWER(){return _}}}),$traceurRuntime.registerModule("src/ui/DisplayedInspector.js",[],function(){"use strict";$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/CircuitDefinition.js","src/ui/DisplayedInspector.js")).CircuitDefinition,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/CircuitStats.js","src/ui/DisplayedInspector.js")).CircuitStats;var i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/ui/DisplayedInspector.js")).Config,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../ui/DisplayedCircuit.js","src/ui/DisplayedInspector.js")).DisplayedCircuit,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../ui/DisplayedToolbox.js","src/ui/DisplayedInspector.js")).DisplayedToolbox,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GateDrawParams.js","src/ui/DisplayedInspector.js")).GateDrawParams,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GatePainting.js","src/ui/DisplayedInspector.js")).GatePainting,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../gates/AllGates.js","src/ui/DisplayedInspector.js")).Gates,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../ui/Hand.js","src/ui/DisplayedInspector.js")).Hand,d=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/Painter.js","src/ui/DisplayedInspector.js")).Painter,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Rect.js","src/ui/DisplayedInspector.js")).Rect),e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Serializer.js","src/ui/DisplayedInspector.js")).Serializer,t=$traceurRuntime.createClass(m,{desiredWidth:function(){return Math.max(this.displayedToolboxTop.desiredWidth(),Math.max(this.displayedCircuit.desiredWidth(),this.displayedToolboxBottom.desiredWidth()))},updateArea:function(e){this.drawArea=e,this.displayedToolboxTop=this.displayedToolboxTop.withTop(0),this.displayedToolboxBottom=this.displayedToolboxBottom.withTop(this.drawArea.bottom()-this.displayedToolboxBottom.desiredHeight())},paint:function(e,t){e.fillRect(this.drawArea,i.BACKGROUND_COLOR),this.displayedToolboxTop.paint(e,t,this.hand),this.displayedToolboxBottom.paint(e,t,this.hand),this.displayedCircuit.paint(e,this.hand,t),this._paintHand(e,t),this._drawHint(e)},_paintHand:function(e,t){var r,n;void 0!==this.hand.pos&&void 0!==this.hand.heldGate&&(r=this.hand.heldGate,n=this.hand.pos.minus(this.hand.holdOffset),n=new d(Math.round(n.x-.5)+.5,Math.round(n.y-.5)+.5,2*i.GATE_RADIUS+i.WIRE_SPACING*(r.width-1),2*i.GATE_RADIUS+i.WIRE_SPACING*(r.height-1)),(r.customDrawer||s.DEFAULT_DRAWER)(new u(e,this.hand,!1,!0,!0,!1,n,r,t,void 0,[],void 0)))},tryGetHandOverButtonKey:function(){var e;if(void 0!==this.hand.pos)return void 0!==(e=this.displayedCircuit.findGateWithButtonContaining(this.hand.pos))?"gate-button-"+e.col+":"+e.row:void 0!==(e=this.displayedCircuit.findWireWithInitialStateAreaContaining(this.hand.pos))?"wire-init-"+e:void 0},tryClick:function(){var e=this.displayedCircuit.tryClick(this.hand);return void 0===e?void 0:this.withDisplayedCircuit(e)},afterGrabbing:function(){var e=void 0!==arguments[0]&&arguments[0],t=void 0!==arguments[1]&&arguments[1],r=void 0!==arguments[2]&&arguments[2],n=void 0!==arguments[3]&&arguments[3],i=this.hand,a=this.displayedCircuit,i=this.displayedToolboxTop.tryGrab(i),e=(i=this.displayedToolboxBottom.tryGrab(i),a.tryGrab(i,e,t,r,n));return i=e.newHand,a=e.newCircuit,new m(this.drawArea,a,this.displayedToolboxTop,this.displayedToolboxBottom,i)},isEqualTo:function(e){return this===e||e instanceof m&&this.drawArea.isEqualTo(e.drawArea)&&this.displayedCircuit.isEqualTo(e.displayedCircuit)&&this.displayedToolboxTop.isEqualTo(e.displayedToolboxTop)&&this.displayedToolboxBottom.isEqualTo(e.displayedToolboxBottom)&&this.hand.isEqualTo(e.hand)},withDisplayedCircuit:function(e){return e===this.displayedCircuit?this:new m(this.drawArea,e,this.displayedToolboxTop,this.displayedToolboxBottom,this.hand)},withJustEnoughWires:function(e,t){return this.withDisplayedCircuit(this.displayedCircuit.withJustEnoughWires(e,t))},afterTidyingUp:function(){return this.withDisplayedCircuit(this.displayedCircuit.afterTidyingUp())},previewDrop:function(){var e,t,r;return this.hand.isBusy()?(e=this.hand,r=(t=(r=this.displayedCircuit).previewDrop(e))===r?e:e.withDrop(),this.withHand(r).withDisplayedCircuit(t)):this},afterDropping:function(){return this.withDisplayedCircuit(this.displayedCircuit.afterDropping(this.hand)).withHand(this.hand.withDrop())},stableDuration:function(){return Math.min(this.displayedToolboxTop.stableDuration(this.hand),this.displayedToolboxBottom.stableDuration(this.hand),this.hand.stableDuration(),this.displayedCircuit.stableDuration())},withHand:function(e){return new m(this.drawArea,this.displayedCircuit,this.displayedToolboxTop,this.displayedToolboxBottom,e)},withCircuitDefinition:function(e){return new m(this.drawArea,a.empty(this.displayedToolboxTop.desiredHeight()).withCircuit(e),this.displayedToolboxTop,this.displayedToolboxBottom,this.hand.withDrop())},desiredHeight:function(){var e=this.displayedToolboxBottom.desiredHeight()+this.displayedToolboxTop.desiredHeight()+this.displayedCircuit.desiredHeight();return Math.max(i.MINIMUM_CANVAS_HEIGHT,e)},snapshot:function(){return JSON.stringify(e.toJson(this.displayedCircuit.circuitDefinition),null,0)},_drawHint:function(e){this._drawHint_dragGatesOntoCircuit(e),this._drawHint_watchOutputsChange(e),this._drawHint_useControls(e)},_drawHint_watchOutputsChange:function(e){var t=this._hintVisibility();t<=0||(e.ctx.save(),e.ctx.globalAlpha*=Math.min(1,t),e.ctx.translate(this.displayedCircuit.opRect(this.displayedCircuit.clampedCircuitColCount()).x-280,15),e.ctx.save(),e.ctx.translate(268,250),e.ctx.rotate(.02*Math.PI),e.ctx.fillStyle="red",e.ctx.textAlign="right",e.ctx.font="16px sans-serif",e.ctx.fillText("outputs change",0,0),e.ctx.restore(),e.ctx.beginPath(),e.ctx.moveTo(270,245),e.ctx.bezierCurveTo(300,245,315,235,325,225),e.ctx.strokeStyle="red",e.ctx.lineWidth=3,e.ctx.stroke(),e.trace(function(e){e.arrowHead(330,219,10,-.265*Math.PI,1.3)}).thenFill("red"),e.ctx.restore())},_hintVisibility:function(){return 0<this.displayedCircuit.circuitDefinition.columns.length?0:void 0===this.hand.pos||!this.hand.isBusy()||void 0!==this.hand.heldGate&&this.hand.heldGate.isControl()?1:(150-this.hand.pos.y)/50},_drawHint_dragGatesOntoCircuit:function(e){var t=this._hintVisibility();t<=0||(e.ctx.save(),e.ctx.globalAlpha*=Math.min(1,t),e.ctx.save(),e.ctx.translate(130,195),e.ctx.rotate(.05*Math.PI),e.ctx.fillStyle="red",e.ctx.font="16px sans-serif",e.ctx.fillText("drag gates onto circuit",0,0),e.ctx.restore(),e.ctx.beginPath(),e.ctx.moveTo(268,132),e.ctx.bezierCurveTo(260,170,235,175,217,187),e.ctx.strokeStyle="red",e.ctx.lineWidth=3,e.ctx.stroke(),e.trace(function(e){e.arrowHead(210,190,10,.84*Math.PI,1.3)}).thenFill("red"),e.ctx.restore())},_drawHint_useControls:function(e){var t,r=this._hintVisibility();r<=0||(e.ctx.save(),e.ctx.globalAlpha*=Math.min(1,r),t=(r=void 0===this.displayedCircuit.circuitDefinition.gateInSlot(0,0))?173:223,e.ctx.save(),e.ctx.translate(70,t-3),e.ctx.rotate(-.01*Math.PI),e.ctx.fillStyle="red",e.ctx.font="16px sans-serif",e.ctx.fillText("use controls",0,0),e.ctx.restore(),e.ctx.beginPath(),r?(e.ctx.moveTo(90,125),e.ctx.bezierCurveTo(60,140,48,160,55,t)):(e.ctx.moveTo(100,125),e.ctx.bezierCurveTo(115,150,105,170,55,t)),e.ctx.strokeStyle="red",e.ctx.lineWidth=3,e.ctx.stroke(),e.ctx.beginPath(),e.ctx.arc(55,t,5,0,2*Math.PI),e.ctx.fillStyle="red",e.ctx.fill(),e.ctx.restore())}},{empty:function(e){var t=new o("Toolbox",0,l.TopToolboxGroups,!0),r=a.empty(t.desiredHeight()),n=new o("Toolbox₂",r.top+r.desiredHeight(),l.BottomToolboxGroups,!1);return new m(e,r,t,n,c.EMPTY)}});function m(e,t,r,n,i){this.displayedCircuit=t,this.displayedToolboxTop=r,this.displayedToolboxBottom=n.withCustomGatesInserted(t.circuitDefinition.customGateSet),this.hand=i,this.drawArea=new d(0,0,0,0),this.updateArea(e)}return{get DisplayedInspector(){return t}}}),$traceurRuntime.registerModule("src/ui/DisplayedToolbox.js",[],function(){"use strict";var m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/CachablePainting.js","src/ui/DisplayedToolbox.js")).CachablePainting,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/CircuitStats.js","src/ui/DisplayedToolbox.js")).CircuitStats,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/ui/DisplayedToolbox.js")).Config,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GateDrawParams.js","src/ui/DisplayedToolbox.js")).GateDrawParams,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/GatePainting.js","src/ui/DisplayedToolbox.js")).GatePainting,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../ui/Hand.js","src/ui/DisplayedToolbox.js")).Hand,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../gates/Joke_MysteryGate.js","src/ui/DisplayedToolbox.js")),n=e.MysteryGateSymbol,i=e.MysteryGateMaker,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Rect.js","src/ui/DisplayedToolbox.js")).Rect,d=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/Painter.js","src/ui/DisplayedToolbox.js")).Painter,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Point.js","src/ui/DisplayedToolbox.js")).Point),r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Seq.js","src/ui/DisplayedToolbox.js")).seq,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/WidgetPainter.js","src/ui/DisplayedToolbox.js")).WidgetPainter,t=$traceurRuntime.createClass(h,{withCustomGatesInserted:function(e){for(var t=$traceurRuntime.spread(this._originalGroups),r=0;r<Math.max(1,e.gates.length);r+=2*this.groupHeight){for(var n={hint:"Custom Gates",gates:[void 0,void 0,void 0,void 0,void 0,void 0]},i=0;i<2*this.groupHeight&&r+i<e.gates.length;i++)n.gates[i]=e.gates[r+i];t.push(n)}return new h(this.name,this.top,t,this.labelsOnTop,this._originalGroups,this._standardApperance)},gateDrawRect:function(e,t){var r=t%2,t=Math.floor(t/2),r=a.TOOLBOX_MARGIN_X+r*a.TOOLBOX_GATE_SPAN+e*a.TOOLBOX_GROUP_SPAN,e=this.top+(this.labelsOnTop?a.TOOLBOX_MARGIN_Y:3)+t*a.TOOLBOX_GATE_SPAN;return new c(Math.round(r-.5)+.5,Math.round(e-.5)+.5,2*a.GATE_RADIUS,2*a.GATE_RADIUS)},groupLabelRect:function(e){var t;return this.labelsOnTop?(t=this.gateDrawRect(e,0),t=new d(t.x+a.TOOLBOX_GATE_SPAN-a.TOOLBOX_GATE_SPACING/2,t.y-18),new c(t.x-a.TOOLBOX_GATE_SPAN,t.y,2*a.TOOLBOX_GATE_SPAN,20)):(t=this.gateDrawRect(e,2*this.groupHeight-2),e=new d(t.x+a.TOOLBOX_GATE_SPAN-a.TOOLBOX_GATE_SPACING/2,t.bottom()),new c(e.x-a.TOOLBOX_GATE_SPAN,e.y+2,2*a.TOOLBOX_GATE_SPAN,20))},findGateAt:function(e){if(void 0!==e)for(var t=0;t<this.toolboxGroups.length;t++)for(var r=this.toolboxGroups[t],n=0;n<r.gates.length;n++){var i=r.gates[n],a=this.gateDrawRect(t,n);if(void 0!==i&&a.containsPoint(e))return{groupIndex:t,gateIndex:n,gate:i,rect:a}}},isEqualTo:function(e){return e instanceof h&&this.name===e.name&&this.top===e.top&&this.toolboxGroups===e.toolboxGroups&&this.labelsOnTop===e.labelsOnTop},withTop:function(e){return new h(this.name,e,this.toolboxGroups,this.labelsOnTop,this._originalGroups,this._standardApperance)},curArea:function(e){return new c(0,this.top,e,this.desiredHeight())},paint:function(e,t,r){e.fillRect(this.curArea(e.canvas.width),a.BACKGROUND_COLOR_TOOLBOX),this._standardApperance.paint(0,this.top,e),this._paintDeviations(e,t,r)},_paintStandardContents:function(e){for(var t=0;t<this.toolboxGroups.length;t++)this._paintGatesInGroup(e,o.EMPTY,t);var r=this.curArea(a.TOOLBOX_MARGIN_X),n=r.center(),i=n.x,n=n.y;e.ctx.save(),e.ctx.translate(i,n),e.ctx.rotate(-Math.PI/2),e.printLine(this.name,new c(-r.h/2,-r.w/2,r.h,r.w),.5,"black",24),e.ctx.restore()},_paintDeviations:function(e,t,r){for(var n=0;n<this.toolboxGroups.length;n++){n>=this._originalGroups.length&&this._paintGatesInGroup(e,r,n);for(var i=this.toolboxGroups[n],a=0;a<i.gates.length;a++)void 0!==i.gates[a]&&e.noteTouchBlocker({rect:this.gateDrawRect(n,a),cursor:"pointer"})}this._paintFocus(e,t,r)},_paintGatesInGroup:function(e,t,r){var n=this.toolboxGroups[r],i=this.groupLabelRect(r);e.print(n.hint,i.x+i.w/2,i.y+i.h/2,"center","middle","black","16px sans-serif",i.w,i.h);for(var a=0;a<n.gates.length;a++){var o,u=n.gates[a];void 0!==u&&(o=this.gateDrawRect(r,a),h._paintGate(e,t,u,o,!1,s.EMPTY))}},_paintFocus:function(e,t,r){var n,i,a,o,u=this.findGateAt(r.pos);void 0===u||void 0!==r.heldGate&&u.gate.symbol!==r.heldGate.symbol||(h._paintGate(e,r,u.gate,u.rect,!0,t),e.ctx.save(),e.ctx.globalAlpha=0,e.ctx.translate(-1e4,-1e4),n=(r=f.paintGateTooltip(e,new c(0,0,500,300),u.gate,t.time,!0)).maxW,r=r.maxH,i=500<=n||300<=r,e.ctx.restore(),a=u.rect.right()+1,o=new c(a,u.rect.center().y,n,r).snapInside(e.paintableArea().skipRight(10).skipBottom(20)),e.defer(function(){return f.paintGateTooltip(e,o,u.gate,t.time,i)}))},desiredWidth:function(){return this.gateDrawRect(this.toolboxGroups.length-1,5).right()+5},desiredHeight:function(){return(1+this.groupHeight)*(2*a.GATE_RADIUS+2)-a.GATE_RADIUS},tryGrab:function(e){var t,r=this;return void 0===e.pos||e.isBusy()||void 0===(t=this.findGateAt(e.pos))?e:(t.gate.symbol===n&&setTimeout(function(){r.toolboxGroups[t.groupIndex].gates[t.gateIndex]=i()},.1),e.withHeldGate(t.gate,new d(a.GATE_RADIUS,a.GATE_RADIUS)))},stableDuration:function(e){var t=this;return r(e.hoverPoints()).map(function(e){return t.findGateAt(e)}).filter(function(e){return void 0!==e}).map(function(e){return e.gate.stableDuration()}).min(1/0)}},{_paintGate:function(e,t,r,n,i,a){var o=r.customDrawer||l.DEFAULT_DRAWER;e.startIgnoringIncomingTouchBlockers(),o(new u(e,t,!0,i,!1,!1,n,r,a,void 0,[],void 0)),e.stopIgnoringIncomingTouchBlockers()}});function h(t,r,e,n){var i=arguments[4],a=arguments[5],o=this,u=(this.name=t,this.top=r,this.toolboxGroups=e,this.labelsOnTop=n,this._originalGroups=i||this.toolboxGroups,this._standardApperance=a||new m(function(){return{width:o.desiredWidth(),height:o.desiredHeight()}},function(e){e.ctx.save(),e.ctx.translate(0,-o.top),o._paintStandardContents(e),e.ctx.restore()}),!0),t=!(this.groupHeight=1),r=void 0;try{for(var s,l=e[Symbol.iterator]();!(u=(s=l.next()).done);u=!0){var c=s.value,d=Math.ceil(c.gates.length/2);this.groupHeight=Math.max(this.groupHeight,d)}}catch(e){t=!0,r=e}finally{try{u||null==l.return||l.return()}finally{if(t)throw r}}}return{get DisplayedToolbox(){return t}}}),$traceurRuntime.registerModule("src/ui/exports.js",[],function(){"use strict";var g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/ui/exports.js")).Config,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Obs.js","src/ui/exports.js")).ObservableValue,p=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Serializer.js","src/ui/exports.js")).Serializer,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../browser/Clipboard.js","src/ui/exports.js")).selectAndCopyToClipboard),v=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Serializer.js","src/ui/exports.js")).fromJsonText_CircuitDefinition,y=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../browser/SaveFile.js","src/ui/exports.js")).saveFile,b=new e(!1),R=b.observable().whenDifferent();function t(e,t,r){function n(e,t,r){var n=arguments[3];e.addEventListener("click",function(){void 0!==n&&(t.innerText=n());try{p(t),r.innerText="Done!"}catch(e){r.innerText="It didn't work...",console.warn("Clipboard copy failed.",e)}e.disabled=!0,setTimeout(function(){r.innerText="",e.disabled=!1},1e3)})}var i,a,o,u,s,l,c,d,m,f;i=document.getElementById("export-button"),l=document.getElementById("export-overlay"),a=document.getElementById("export-div"),i.addEventListener("click",function(){return b.set(!0)}),r.subscribe(function(e){i.disabled=e}),l.addEventListener("click",function(){return b.set(!1)}),document.addEventListener("keydown",function(e){27===e.keyCode&&b.set(!1)}),R.subscribe(function(e){a.style.display=e?"block":"none",e&&document.getElementById("export-link-copy-button").focus()});function h(e){try{var t=v(e);if(!t.isEmpty())return"Quirk with Circuit - "+t.readableHash()+".html"}catch(e){}return"Quirk.html"}o=document.getElementById("export-escaped-anchor"),l=document.getElementById("export-link-copy-button"),c=document.getElementById("export-link-copy-result"),n(l,o,c),e.latestActiveCommit().subscribe(function(e){e="#"+g.URL_CIRCUIT_PARAM_KEY+"="+encodeURIComponent(e);o.href=e,o.innerText=document.location.href.split("#")[0]+e}),u=document.getElementById("export-circuit-json-pre"),l=document.getElementById("export-json-copy-button"),c=document.getElementById("export-json-copy-result"),n(l,u,c),e.latestActiveCommit().subscribe(function(t){try{var e=JSON.parse(t);u.innerText=JSON.stringify(e,null,"  ")}catch(e){u.innerText=t}}),s=document.getElementById("export-amplitudes-pre"),l=document.getElementById("export-amplitudes-button"),c=document.getElementById("export-amplitudes-result"),d=document.getElementById("export-amplitudes-use-amps"),r.subscribe(function(e){s.innerText="[not generated yet]"}),n(l,s,c,function(){return JSON.stringify(t.get().toReadableJson(!d.checked),null," ").replace(/{\s*"r": /g,'{"r":').replace(/,\s*"i":\s*([-e\d\.]+)\s*}/g,',"i":$1}')}),f=document.getElementById("download-offline-copy-button"),e.latestActiveCommit().subscribe(function(e){f.innerText='Download "'+h(e)+'"',m=e}),f.addEventListener("click",function(){f.disabled=!0,setTimeout(function(){f.disabled=!1},1e3);var e=document.QUIRK_QUINE_ALL_HTML_ORIGINAL,t="//DEFAULT_CIRCUIT_START\n",r=e.indexOf(t),n=e.indexOf("//DEFAULT_CIRCUIT_END\n",r),r=e.substring(0,r)+t+"document.DEFAULT_CIRCUIT = "+JSON.stringify(m)+";\n"+e.substring(n),t="\x3c!-- Start Analytics --\x3e\n",e=r.indexOf(t);-1!==e&&-1!==(n=r.indexOf("\x3c!-- End Analytics --\x3e\n",e))&&(r=r.substring(0,e)+t+r.substring(n)),y(h(m),r)})}return{get initExports(){return t},get obsExportsIsShowing(){return R}}}),$traceurRuntime.registerModule("src/ui/forge.js",[],function(){"use strict";var c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Axis.js","src/ui/forge.js")).Axis,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/CircuitDefinition.js","src/ui/forge.js")).CircuitDefinition,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/CircuitComputeUtil.js","src/ui/forge.js")).setGateBuilderEffectToCircuit,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Complex.js","src/ui/forge.js")).Complex,$=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/ui/forge.js")).Config,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/DetailedError.js","src/ui/forge.js")).DetailedError,P=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../ui/DisplayedCircuit.js","src/ui/forge.js")).drawCircuitTooltip,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Format.js","src/ui/forge.js")).Format,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/ui/forge.js")),G=(e.Gate,e.GateBuilder),l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/GateColumn.js","src/ui/forge.js")).GateColumn,k=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../ui/sim.js","src/ui/forge.js")).getCircuitCycleTime,N=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/MathPainter.js","src/ui/forge.js")).MathPainter,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/ui/forge.js")).Matrix,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Obs.js","src/ui/forge.js")),D=e.Observable,F=e.ObservableValue,O=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../draw/Painter.js","src/ui/forge.js")).Painter,z=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Point.js","src/ui/forge.js")).Point,B=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Rect.js","src/ui/forge.js")).Rect,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Serializer.js","src/ui/forge.js")),L=e.fromJsonText_CircuitDefinition,U=e.Serializer,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Seq.js","src/ui/forge.js")).seq,W=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../browser/EventUtil.js","src/ui/forge.js")).textEditObservable,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/ui/forge.js")).Util,H=new F(!1),q=H.observable().whenDifferent();function n(r,e){var n,t,i,a,o=q.filter(function(e){return!0===e});function u(t,e,r){r.disabled=!0;var n=new O(t),i=(n.clear(),Math.min((t.width-5)/2,t.height)),a=new B(0,0,i,i),i=new B(i+5,0,i,i);try{var o=e(),u=(N.paintMatrix(n,o,a,$.OPERATION_FORE_COLOR,"black",void 0,$.OPERATION_BACK_COLOR,void 0,"transparent"),o.isUnitary(.009)?2!==o.width()?n.printParagraph("(Not a 1-qubit rotation)",i,new z(.5,.5),"#666",20):N.paintBlochSphereRotation(n,o,i,$.OPERATION_BACK_COLOR,$.OPERATION_FORE_COLOR):n.printParagraph("NOT UNITARY",i,new z(.5,.5),"red",24),(a.right()+i.x)/2);n.strokeLine(new z(u,0),new z(u,t.height),"black",2),o.hasNaN()||(r.disabled=!1)}catch(e){n.printParagraph(e+"",new B(0,0,t.width,t.height),new z(.5,.5),"red",24)}}function s(e,t){t=t||L(n);r.commit(JSON.stringify(U.toJson(t.withCustomGate(e)),null,0)),H.set(!1)}r.latestActiveCommit().subscribe(function(e){n=e}),t=document.getElementById("gate-forge-button"),i=document.getElementById("gate-forge-overlay"),a=document.getElementById("gate-forge-div"),t.addEventListener("click",function(){return H.set(!0)}),i.addEventListener("click",function(){return H.set(!1)}),e.subscribe(function(e){t.disabled=e}),document.addEventListener("keydown",function(e){27===e.keyCode&&H.set(!1)}),q.subscribe(function(e){a.style.display=e?"block":"none",e&&document.getElementById("gate-forge-rotation-axis").focus()});var l=document.getElementById("gate-forge-rotation-canvas"),c=document.getElementById("gate-forge-rotation-button"),d=document.getElementById("gate-forge-rotation-axis"),m=document.getElementById("gate-forge-rotation-angle"),f=document.getElementById("gate-forge-rotation-phase"),h=document.getElementById("gate-forge-rotation-name");function g(){return Y(X(m),X(f),X(d))}o.subscribe(function(){h.value=""}),D.of.apply(D,$traceurRuntime.spread([o],[f,d,m].map(W))).flatten().throttleLatest(100).subscribe(function(){return u(l,g,c)}),c.addEventListener("click",function(){var e;try{e=g()}catch(e){return void console.warn(e)}s((new G).setSerializedId("~"+Math.floor(Math.random()*(1<<20)).toString(32)).setSymbol(h.value).setTitle("Custom Rotation Gate").setKnownEffectToMatrix(e).gate)});var p=document.getElementById("gate-forge-matrix-canvas"),v=document.getElementById("gate-forge-matrix"),y=document.getElementById("gate-forge-matrix-fix"),b=document.getElementById("gate-forge-matrix-button"),R=document.getElementById("gate-forge-matrix-name");function w(){return K(X(v),y.checked)}o.subscribe(function(){R.value=""}),D.of(o,W(v),D.elementEvent(y,"change")).flatten().throttleLatest(100).subscribe(function(){return u(p,w,b)}),b.addEventListener("click",function(){var e;try{e=w()}catch(e){return void console.warn(e)}var t=R.value.trim(),r=Math.round(Math.log2(e.height()));s((new G).setSerializedId("~"+Math.floor(Math.random()*(1<<20)).toString(32)).setSymbol(t).setTitle("Custom Matrix Gate").setHeight(r).setWidth(""===t?r:1).setKnownEffectToMatrix(e).gate)});var M=document.getElementById("gate-forge-circuit-canvas"),_=document.getElementById("gate-forge-circuit-cols"),x=document.getElementById("gate-forge-circuit-rows"),S=document.getElementById("gate-forge-circuit-inputs"),T=document.getElementById("gate-forge-circuit-weight"),A=document.getElementById("gate-forge-circuit-button"),C=document.getElementById("gate-forge-circuit-name");function E(){var e=L(n);return{gate:V(e,X(_),X(x),C.value.trim()),circuit:e}}o.subscribe(function(){C.value=""});var I=new F(void 0),j=function(e,t){return P(e,t.knownCircuitNested,new B(0,0,M.width,M.height),!0,k())};I.observable().zipLatest(q,function(e,t){return t?e:void 0}).map(function(t){return void 0===t||t.gate.stableDuration()===1/0?D.of():D.requestAnimationTicker().map(function(e){return t})}).flattenLatest().subscribe(function(e){var t=new O(M);t.clear(),j(t,e.gate)}),D.of(o,W(_),W(x)).flatten().throttleLatest(100).subscribe(function(){A.disabled=!0;var t=new O(M);t.clear();try{var e=E().gate,r=e.getUnmetContextKeys();S.innerText=0===r.size?"(none)":$traceurRuntime.spread(r).map(function(e){return e.replace("Input Range ","").replace("Input NO_DEFAULT Range ","")}).join(", "),T.innerText=""+e.knownCircuit.gateWeight(),j(t,e),A.disabled=!1,I.set({gate:e})}catch(e){I.set(void 0),S.innerText="(err)",T.innerText="(err)",t.printParagraph(e+"",new B(0,0,M.width,M.height),new z(.5,.5),"red",24)}}),A.addEventListener("click",function(){try{var e=E();s(e.gate,e.circuit)}catch(e){console.warn(e)}})}function X(e){return""===e.value?e.placeholder:e.value}function g(e){e=d.parse(e);if(0!==e.imag||isNaN(e.imag))throw new Error("You just had to make it complicated, didn't you?");return e.real*Math.PI/180}function p(e){return f.parse(e.toString(new t(!0,1e-7,7,",")))}function Y(e,t,r){var e=g(e),t=g(t),r=c.parse(r),n=r.x,i=r.y,r=r.z,a=Math.sqrt(n*n+i*i+r*r);n/=a,i/=a,r/=a;var o=(l=(a=[f.identity(2),f.PAULI_X,f.PAULI_Y,f.PAULI_Z][Symbol.iterator]()).next()).done?void 0:l.value,u=(l=a.next()).done?void 0:l.value,s=(l=a.next()).done?void 0:l.value,a=(l=a.next()).done?void 0:l.value,l=u.times(n).plus(s.times(i)).plus(a.times(r)),u=o.times(Math.cos(e/2)).plus(l.times(d.I.neg()).times(Math.sin(e/2))).times(d.polar(1,t));if(u.hasNaN())throw new m("NaN",{x:n,y:i,z:r,result:u});return p(u)}function K(e,t){e=function(e){if(e.match(/[\{}\[\]]/))return f.parse(e.split(/[\{\[]/).join("{").split(/[}\]]/).join("}"));1===(e=(e=(e=(e=e.split(/,?\s*\n\s*(?!$)/).join(",")).trim()).endsWith(",")?e.substring(0,e.length-1):e).split(",").map(function(e){return""===e?0:d.parse(e)})).length&&e.push(0,0,e[0]);var t=Math.max(4,1<<2*Math.max(1,r.floorLg2(Math.sqrt(e.length))));if(t<e.length&&(t<<=2),256<t)throw Error("Max custom matrix operation size is 4 qubits.");return f.square.apply(f,$traceurRuntime.spread(e,new Array(t-e.length).fill(0)))}(e);if(e.width()!==e.height()||e.width()<2||16<e.width()||!r.isPowerOf2(e.width()))throw Error("Matrix must be 2x2, 4x4, 8x8, or 16x16.");return e=t&&!e.hasNaN()?p(e=e.closestUnitary(1e-4)):e}function v(e,t){e=e.split(":").map(function(e){return e.trim()});if(2<e.length)throw new Error("Too many colons.");var r=[void 0,"","∞"],n=parseInt(e[0]||"1"),r=-1!==r.indexOf(e[1])?1/0:parseInt(e[1]);if(isNaN(n))throw new Error("Not a number: "+e[0]);if(isNaN(r))throw new Error("Not a number: "+e[1]);e=Math.min(t,Math.max(0,n-1));return{start:e,end:Math.min(t,Math.max(e,r))}}function V(e,t,r,n){var t=v(t,e.columns.length),i=v(r,e.numWires);if(i.end===i.start)throw new Error("Empty wire range.");var a,o,r=e.columns.slice(t.start,t.end).map(function(e){return new l(e.gates.slice(i.start,i.end))}),e=new u(i.end-i.start,r);if(a=(t=e).columns.length,o=t.numWires,0===(e=(e=t.withColumns(h(t.columns).mapWithIndex(function(e,r){return new l(h(e.gates).mapWithIndex(function(e,t){return void 0===e||r+e.width>a||t+e.height>o?void 0:e}).toArray())}).toArray())).withUncoveredColumnsRemoved()).columns.length)throw new Error("No gates in included range.");r=n,t="~"+Math.floor(Math.random()*(1<<20)).toString(32);return s(new G,e).setSerializedId(t).setSymbol(r).setTitle(t).setBlurb("A custom gate.").gate}return{get initForge(){return n},get obsForgeIsShowing(){return q},get parseUserRotation(){return Y},get parseUserMatrix(){return K},get parseUserGateFromCircuitRange(){return V}}}),$traceurRuntime.registerModule("src/ui/Hand.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Describe.js","src/ui/Hand.js")).describe,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/DetailedError.js","src/ui/Hand.js")).DetailedError,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Gate.js","src/ui/Hand.js")).Gate,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/GateColumn.js","src/ui/Hand.js")).GateColumn,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Point.js","src/ui/Hand.js")).Point,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/ui/Hand.js")).Util,r=$traceurRuntime.createClass(n,{isHoldingSomething:function(){return void 0!==this.heldGate||void 0!==this.heldColumn||void 0!==this.heldRow},paintCursor:function(e){void 0!==this.heldGate||void 0!==this.heldColumn?e.setDesiredCursor("move"):void 0!==this.resizingGateSlot&&e.setDesiredCursor("ns-resize")},isBusy:function(){return void 0!==this.heldGate||void 0!==this.heldColumn||void 0!==this.resizingGateSlot||void 0!==this.heldRow},hoverPoints:function(){return void 0===this.pos||this.isBusy()?[]:[this.pos]},isEqualTo:function(e){return this===e||e instanceof n&&t.CUSTOM_IS_EQUAL_TO_EQUALITY(this.pos,e.pos)&&t.CUSTOM_IS_EQUAL_TO_EQUALITY(this.holdOffset,e.holdOffset)&&t.CUSTOM_IS_EQUAL_TO_EQUALITY(this.heldGate,e.heldGate)&&t.CUSTOM_IS_EQUAL_TO_EQUALITY(this.heldColumn,e.heldColumn)&&t.CUSTOM_IS_EQUAL_TO_EQUALITY(this.heldRow,e.heldRow)&&t.CUSTOM_IS_EQUAL_TO_EQUALITY(this.resizingGateSlot,e.resizingGateSlot)},toString:function(){return"Hand("+e({pos:this.pos,heldGate:this.heldGate,holdOffset:this.holdOffset,heldColumn:this.heldColumn,heldRow:this.heldRow,resizingGateSlot:this.resizingGateSlot})},withPos:function(e){return new n(e,this.heldGate,this.holdOffset,this.heldColumn,this.heldRow,this.resizingGateSlot)},withDrop:function(){return new n(this.pos,void 0,void 0,void 0,void 0,void 0)},withHeldGate:function(e,t){return new n(this.pos,e,t,void 0,void 0,void 0)},withHeldGateColumn:function(e,t){return new n(this.pos,void 0,t,e,void 0,void 0)},withHeldRow:function(e,t){return new n(this.pos,void 0,t,void 0,e,void 0)},withResizeSlot:function(e,t){return new n(this.pos,void 0,t,void 0,void 0,e)},stableDuration:function(){return void 0!==this.heldGate?this.heldGate.stableDuration():void 0!==this.heldColumn?this.heldColumn.stableDuration():void 0!==this.heldRow?new l(this.heldRow.gates).stableDuration():1/0}},{});function n(e,t,r,n,i,a){var o={pos:e,heldGate:t,holdOffset:r,heldColumn:n,heldRow:i,resizingGateSlot:a};if(void 0!==e&&!(e instanceof c))throw new u("Bad pos",o);if(void 0!==t&&!(t instanceof s))throw new u("Bad heldGate",o);if(void 0!==r&&!(r instanceof c))throw new u("Bad holdOffset",o);if(void 0!==a&&!(a instanceof c))throw new u("Bad resizingGateSlot",o);if(void 0!==n&&!(n instanceof l))throw new u("Bad heldColumn",o);if(void 0!==i&&!Array.isArray(i.gates))throw new u("Bad heldRow",o);if(void 0!==t&&void 0!==this.resizingGateSlot)throw new u("Holding AND resizing",o);this.pos=e,this.heldGate=t,this.holdOffset=r,this.heldColumn=n,this.heldRow=i,this.resizingGateSlot=a}return r.EMPTY=new r(void 0,void 0,void 0,void 0,void 0,void 0),{get Hand(){return r}}}),$traceurRuntime.registerModule("src/ui/menu.js",[],function(){"use strict";function e(){return R.set(!1)}var R=new($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Obs.js","src/ui/menu.js")).ObservableValue)(!0),w=R.observable().whenDifferent(),M={cols:[["X","X","X","X","X"],["H","H","H","H","H"],["Chance5"],["~vn6c"],["⊖","⊖","⊖","⊖","X"],["Chance5"],["~vn6c"],["⊖","⊖","⊖","⊖","X"],["Chance5"],["~vn6c"],["⊖","⊖","⊖","⊖","X"],["Chance5"],["~vn6c"],["⊖","⊖","⊖","⊖","X"],["Chance5"]],gates:[{id:"~vn6c",name:"Oracle",circuit:{cols:[["Z","•","◦","•","•"]]}}]},_={cols:[[1,"H"],[1,"•",1,1,"X"],["…","…",1,1,"…"],["…","…",1,1,"…"],["~87lj"],["Bloch"],["•","X"],["H"],["Measure","Measure"],[1,"•",1,1,"X"],["•",1,1,1,"Z"],[1,1,1,1,"Bloch"],[1,1,1,1,"~f7c0"]],gates:[{id:"~87lj",name:"message",circuit:{cols:[["e^-iYt"],["X^t"]]}},{id:"~f7c0",name:"received",matrix:"{{1,0},{0,1}}"}]},x={cols:[[1,"H"],[1,"•",1,1,"X"],[1,"~slits","QFT7"],[1,1,"Measure","Measure","Measure","Measure","Measure","Measure","Measure"],["…","…","Chance7"],["…","…"],["…","…"],["…","…"],["H"],["Measure"],["~choice"],["•","X^½"],[1,"Measure"],[1,"~result",1,1,1,"~flat"],["◦","◦","Chance7"],["◦","•","Chance7"],[1,1,1,1,1,"~waves"],["•","◦","Chance7"],["•","•","Chance7"]],gates:[{id:"~choice",name:"choice",matrix:"{{1,0},{0,1}}"},{id:"~result",name:"result",matrix:"{{1,0},{0,1}}"},{id:"~flat",name:"flat",matrix:"{{1,0},{0,1}}"},{id:"~waves",name:"waves",matrix:"{{1,0},{0,1}}"},{id:"~slits",name:"slits",matrix:"{{1,0},{0,1}}"}]},S={cols:[["H"],["◦",1,1,1,"X"],["X^-¼"],["…","…","…","…","…"],["~da85","~5s2n",1,"~5s2n","~ahov"],[1,"H",1,"H"],[1,"Measure",1,"Measure"],["X^½","•"],[1,1,1,"•","X^½"],["Measure",1,1,1,"Measure"],["…","…","…","…","…"],[1,"•","X","•"],["•",1,"X"],[1,1,"X",1,"•"],[1,1,"Chance"],[1,1,"~q6e"]],gates:[{id:"~da85",name:"Alice",matrix:"{{1,0},{0,1}}"},{id:"~ahov",name:"Bob",matrix:"{{1,0},{0,1}}"},{id:"~5s2n",name:"Referee",matrix:"{{1,0},{0,1}}"},{id:"~q6e",name:"Win?",matrix:"{{1,0},{0,1}}"}]},T={cols:[["Counting5",1,1,1,1,1,1,1,"X"],["Chance5",1,1,1,1,"Chance5"],["X","X","X","X","•","X","X","X","X","X"],[1,1,1,1,"•","X"],["Swap",1,1,1,"Swap","•"],[1,1,1,1,"•",1,"X"],[1,"Swap",1,1,"Swap",1,"•"],[1,1,1,1,"•",1,1,"X"],[1,1,"Swap",1,"Swap",1,1,"•"],[1,1,1,1,"•",1,1,1,"X"],[1,1,1,"Swap","Swap",1,1,1,"•"],[1,1,1,1,"•",1,1,1,1,"X"],[1,1,1,"Swap","Swap",1,1,1,"•"],[1,1,1,"•",1,1,1,1,"X"],[1,1,"Swap",1,"Swap",1,1,"•"],[1,1,"•",1,1,1,1,"X"],[1,"Swap",1,1,"Swap",1,"•"],[1,"•",1,1,1,1,"X"],["Swap",1,1,1,"Swap","•"],["•",1,1,1,1,"X"],["X","X","X","X","•","X","X","X","X","X"],["Chance5",1,1,1,1,"Chance5"]]},A={cols:[["Counting8"],["Chance8"],["…","…","…","…","…","…","…","…"],["Swap",1,1,1,1,1,1,"Swap"],[1,"Swap",1,1,1,1,"Swap"],[1,1,"Swap",1,1,"Swap"],[1,1,1,"Swap","Swap"],["H"],["Z^½","•"],[1,"H"],["Z^¼","Z^½","•"],[1,1,"H"],["Z^⅛","Z^¼","Z^½","•"],[1,1,1,"H"],["Z^⅟₁₆","Z^⅛","Z^¼","Z^½","•"],[1,1,1,1,"H"],["Z^⅟₃₂","Z^⅟₁₆","Z^⅛","Z^¼","Z^½","•"],[1,1,1,1,1,"H"],["Z^⅟₆₄","Z^⅟₃₂","Z^⅟₁₆","Z^⅛","Z^¼","Z^½","•"],[1,1,1,1,1,1,"H"],["Z^⅟₁₂₈","Z^⅟₆₄","Z^⅟₃₂","Z^⅟₁₆","Z^⅛","Z^¼","Z^½","•"],[1,1,1,1,1,1,1,"H"]]},C={cols:[[1,1,"H"],[1,1,"•",1,1,1,"X"],["…","…","…","…","…","…","…"],["Counting2"],["Measure","Measure"],["~msg"],["Chance","Chance"],["~enc"],[1,"•","X"],["•",1,"Z"],[1,1,1,"~send"],[1,1,"Swap",1,1,"Swap"],[1,1,1,1,1,"~dec"],[1,1,1,1,1,"•","X"],[1,1,1,1,1,"H"],[1,1,1,1,1,"Measure","Measure"],[1,1,1,1,1,"~msg"],[1,1,1,1,1,"Chance","Chance"]],gates:[{id:"~msg",name:"message",matrix:"{{1,0,0,0},{0,1,0,0},{0,0,1,0},{0,0,0,1}}"},{id:"~enc",name:"encode",matrix:"{{1,0,0,0},{0,1,0,0},{0,0,1,0},{0,0,0,1}}"},{id:"~send",name:"send",matrix:"{{1,0,0,0},{0,1,0,0},{0,0,1,0},{0,0,0,1}}"},{id:"~dec",name:"decode",matrix:"{{1,0,0,0},{0,1,0,0},{0,0,1,0},{0,0,0,1}}"}]},E={cols:[["~tpqg",1,"~r2ku"],["…","…","…","…"],["H"],[1,1,"H"],["•","X"],[1,1,"•","X"],[1,"Swap",1,"Swap"],["•","X"],[1,1,"•","X"],["X^½","◦"],[1,1,"X^½","◦"],[1,"X^½"],[1,1,1,"X^½"],["Measure","Measure","Measure","Measure"],[1,"~57au"],["•",1,"Chance"],[1,"•",1,"Chance"],["◦",1,"Chance"],[1,"◦",1,"Chance"]],gates:[{id:"~tpqg",name:"Alice^1",matrix:"{{1,0,0,0},{0,1,0,0},{0,0,1,0},{0,0,0,1}}"},{id:"~r2ku",name:"Alice^2",matrix:"{{1,0,0,0},{0,1,0,0},{0,0,1,0},{0,0,0,1}}"},{id:"~57au",name:"disagree",matrix:"{{1,0,0,0},{0,1,0,0},{0,0,1,0},{0,0,0,1}}"}]},I={cols:[[1,1,1,1,1,1,1,1,1,1,"~input",1,1,1,"~guess"],[1,1,1,1,1,1,1,1,1,1,{id:"setR",arg:55},1,1,1,{id:"setB",arg:26}],[],["H","H","H","H","H","H","H","H","H","H","X"],["inputA10",1,1,1,1,1,1,1,1,1,"*BToAmodR6"],["QFT†10"],[1,1,1,1,"~out"],["Chance10"]],gates:[{id:"~guess",name:"guess:",matrix:"{{1,0,0,0},{0,1,0,0},{0,0,1,0},{0,0,0,1}}"},{id:"~input",name:"input:",matrix:"{{1,0,0,0},{0,1,0,0},{0,0,1,0},{0,0,0,1}}"},{id:"~out",name:"out:",matrix:"{{1,0,0,0},{0,1,0,0},{0,0,1,0},{0,0,0,1}}"}]},j={cols:[["H","H","H","H","H"],[1,"Z","Z","Z",1,"⊖"],[1,"Z","Z",1,"Z",1,"⊖"],[1,"Z",1,"Z","Z",1,1,"⊖"],[1,1,"Z","Z","Z",1,1,1,"⊖"],["Z","Z","Z","Z","Z",1,1,1,1,"⊖"],["Z",1,1,"Z","Z",1,1,1,1,1,"⊖"],["Z",1,"Z",1,"Z",1,1,1,1,1,1,"⊖"],["Z","Z",1,1,"Z",1,1,1,1,1,1,1,"⊖"],["Z",1,"Z","Z",1,1,1,1,1,1,1,1,1,"⊖"],["Z","Z",1,"Z",1,1,1,1,1,1,1,1,1,1,"⊖"],["Z","Z","Z",1,1,1,1,1,1,1,1,1,1,1,1,"⊖"],[1,"Z^¼","Z^¼","Z^¼","Z^¼","Z^¼","Z^¼","Z^¼","Z^¼","Z^¼","Z^¼","Z^¼","Z^¼","Z^¼","Z^¼","Z^¼"],[1,"H","H","H","H","H","H","H","H","H","H","H","H","H","H","H"],[1,"Measure","Measure","Measure","Measure","Measure","Measure","Measure","Measure","Measure","Measure","Measure","Measure","Measure","Measure","Measure"],[1,"X","X","X",1,"•"],[1,"X","X",1,"X",1,"•"],[1,"X",1,"X","X",1,1,"•"],[1,1,"X","X","X",1,1,1,"•"],["Z","X","X","X","X",1,1,1,1,"•"],["Z",1,1,"X","X",1,1,1,1,1,"•"],["Z",1,"X",1,"X",1,1,1,1,1,1,"•"],["Z","X",1,1,"X",1,1,1,1,1,1,1,"•"],["Z",1,"X","X",1,1,1,1,1,1,1,1,1,"•"],["Z","X",1,"X",1,1,1,1,1,1,1,1,1,1,"•"],["Z","X","X",1,1,1,1,1,1,1,1,1,1,1,1,"•"],["X","Chance4"],["Amps1","|0⟩⟨0|","|0⟩⟨0|","|0⟩⟨0|","|0⟩⟨0|"]]};function t(n,e){t=document.getElementById("menu-button"),u=document.getElementById("close-menu-button"),o=document.getElementById("menu-overlay"),r=document.getElementById("menu-div"),t.addEventListener("click",function(){return R.set(!0)}),e.subscribe(function(e){t.disabled=e}),o.addEventListener("click",function(){return R.set(!1)}),u.addEventListener("click",function(){return R.set(!1)}),document.addEventListener("keydown",function(e){27===e.keyCode&&R.set(!1)}),w.subscribe(function(e){r.style.display=e?"block":"none",e&&document.getElementById("export-link-copy-button").focus()});var i,a,t,r,e=document.getElementById("example-anchor-grover"),o=document.getElementById("example-anchor-teleport"),u=document.getElementById("example-anchor-delayed-eraser"),s=document.getElementById("example-addition"),l=document.getElementById("example-superdense-coding"),c=document.getElementById("example-symmetry-break"),d=document.getElementById("example-chsh-test"),m=document.getElementById("example-qft"),f=document.getElementById("example-anchor-shor"),h=document.getElementById("example-anchor-distill"),g=!0,p=!1,v=void 0;try{for(var y,b=[[e,M],[f,I],[o,_],[u,x],[s,T],[l,C],[c,E],[d,S],[m,A],[h,j]][Symbol.iterator]();!(g=(y=b.next()).done);g=!0)!function(){var e=y.value,e=(i=e[Symbol.iterator](),(a=i.next()).done?void 0:a.value),t=(a=i.next()).done?void 0:a.value,r=JSON.stringify(t);e.href="#circuit="+r,e.onclick=function(e){if(!(e.shiftKey||e.ctrlKey||e.altKey||1!==e.which))return n.commit(r),R.set(!1),!1}}()}catch(e){p=!0,v=e}finally{try{g||null==b.return||b.return()}finally{if(p)throw v}}}return{get initMenu(){return t},get obsMenuIsShowing(){return w},get closeMenu(){return e}}}),$traceurRuntime.registerModule("src/ui/sim.js",[],function(){"use strict";$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/CircuitDefinition.js","src/ui/sim.js")).CircuitDefinition;var r,n,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/ui/sim.js")).Config,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/CircuitStats.js","src/ui/sim.js")).CircuitStats,o=(r=0,n=performance.now(),function(){var e=performance.now(),t=(e-n)/i.CYCLE_DURATION_MS;return n=e,r=(r+t)%1}),u=void 0;function e(e){if(void 0!==u&&u.circuitDefinition.isEqualTo(e))return u.withTime(o());u=void 0;var t=a.fromCircuitAtTime(e,o());return e.stableDuration()===1/0&&(u=t),t}return{get simulate(){return e},get getCircuitCycleTime(){return o}}}),$traceurRuntime.registerModule("src/ui/title.js",[],function(){"use strict";var r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/ui/title.js")).Config,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Serializer.js","src/ui/title.js")).fromJsonText_CircuitDefinition;function e(e){e.latestActiveCommit().subscribe(function(e){setTimeout(function(){document.title=function(e){try{var t=n(e);if(!t.isEmpty())return"Quirk: "+t.readableHash()}catch(e){}return r.EMPTY_CIRCUIT_TITLE}(e)},0)})}return{get initTitleSync(){return e}}}),$traceurRuntime.registerModule("src/ui/undo.js",[],function(){"use strict";function e(s,e){var l=[document.getElementById("gate-forge-div"),document.getElementById("export-div")],t=document.getElementById("undo-button"),r=document.getElementById("redo-button");s.latestActiveCommit().zipLatest(e,function(e,t){return t}).subscribe(function(e){t.disabled=s.isAtBeginningOfHistory()||e,r.disabled=s.isAtEndOfHistory()||e}),t.addEventListener("click",function(){return s.undo()}),r.addEventListener("click",function(){return s.redo()}),document.addEventListener("keydown",function(e){var t=!0,r=!1,n=void 0;try{for(var i,a=l[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;if("NONE"!==o.style.display&&"none"!==o.style.display)return}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}var r=90===e.keyCode&&e.ctrlKey&&!e.shiftKey&&!e.altKey&&!e.metaKey,n=90===e.keyCode&&e.ctrlKey&&e.shiftKey&&!e.altKey&&!e.metaKey,u=89===e.keyCode&&e.ctrlKey&&!e.shiftKey&&!e.altKey&&!e.metaKey;r&&(s.undo(),e.preventDefault()),(n||u)&&(s.redo(),e.preventDefault())})}return{get initUndoRedo(){return e}}}),$traceurRuntime.registerModule("src/ui/url.js",[],function(){"use strict";var s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../fallback.js","src/ui/url.js")).notifyAboutRecoveryFromUnexpectedError,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/CircuitDefinition.js","src/ui/url.js")).CircuitDefinition,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/ui/url.js")).Config,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../browser/HistoryPusher.js","src/ui/url.js")).HistoryPusher,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../circuit/Serializer.js","src/ui/url.js")),d=e.fromJsonText_CircuitDefinition,m=e.Serializer;function f(e){return-1===e.indexOf("%")&&-1===e.indexOf("&")||(e=encodeURIComponent(e)),"#"+c.URL_CIRCUIT_PARAM_KEY+"="+e}function r(o){function e(){try{u.currentStateIsMemorableButUnknown();var e,t,r=function(){var e=document.location.hash.substr(1),t=new Map;if(""!==e){var r=!0,n=!1,i=void 0;try{for(var a,o=e.split("&")[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var u,s,l=a.value,c=l.indexOf("=");-1!==c&&(u=l.substring(0,c),s=decodeURIComponent(l.substring(c+1)),t.set(u,s))}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}}return t}(),n=(r.has(c.URL_CIRCUIT_PARAM_KEY)||(e=document.DEFAULT_CIRCUIT||JSON.stringify(m.toJson(l.EMPTY)),r.set(c.URL_CIRCUIT_PARAM_KEY,e)),r.get(c.URL_CIRCUIT_PARAM_KEY)),i=(u.currentStateIsMemorableAndEqualTo(n),d(n)),a=JSON.stringify(m.toJson(i));o.clear(a),i.isEmpty()&&1===r.size?u.currentStateIsNotMemorable():(t=f(n),u.stateChange(n,t))}catch(e){s("Defaulted to an empty circuit. Failed to understand circuit from URL.",{document_location_hash:document.location.hash},e)}}var u=new t;window.addEventListener("popstate",e),e(),o.latestActiveCommit().whenDifferent().skip(1).subscribe(function(e){u.stateChange(e,f(e))})}return{get initUrlCircuitSync(){return r}}}),$traceurRuntime.registerModule("src/webgl/ShaderCoders_Base.js",[],function(){"use strict";var r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./WglArg.js","src/webgl/ShaderCoders_Base.js")).WglArg,n=$traceurRuntime.createClass(function(e,t,r){this.code=e,this.libs=t,this.argsFor=r},{},{}),e=$traceurRuntime.createClass(function(e,t,r,n,i,a,o){this.inputPartGetter=e,this.outputPart=t,this.powerSizeOverhead=r,this.pixelType=n,this.dataToPixels=i,this.pixelsToData=a,this.needRearrangingToBeInVec4Format=o},{arrayPowerSizeOfTexture:function(e){return Math.max(0,e.sizePower()-this.powerSizeOverhead)}},{}),t=$traceurRuntime.createClass(function(e,t,r,n){this.bool=e,this.float=t,this.vec2=r,this.vec4=n},{},{});var i=new n("\n    ///////////// BOOL_OUTPUT_AS_FLOAT ////////////\n    bool outputFor(float k);\n\n    uniform vec2 _gen_output_size;\n    uniform float _gen_secret_half;\n\n    float len_output() {\n        return _gen_output_size.x * _gen_output_size.y;\n    }\n\n    void main() {\n        vec2 xy = gl_FragCoord.xy - vec2(_gen_secret_half, _gen_secret_half);\n        float k = xy.y * _gen_output_size.x + xy.x;\n        gl_FragColor = vec4(float(outputFor(k)), 0.0, 0.0, 0.0);\n    }",[],function(e){return[r.vec2("_gen_output_size",e.width,e.height),r.float("_gen_secret_half",.5)]}),a=new e(function(e){var t="_gen_"+e;return new n("\n        ///////////// boolInput("+e+") ////////////\n        uniform sampler2D "+t+"_tex;\n        uniform vec2 "+t+"_size;\n\n        float read_"+e+"(float k) {\n            vec2 uv = vec2(mod(k, "+t+"_size.x) + 0.5,\n                           floor(k / "+t+"_size.x) + 0.5) / "+t+"_size;\n            return float(texture2D("+t+"_tex, uv).x == 1.0);\n        }\n\n        float len_"+e+"() {\n            return "+t+"_size.x * "+t+"_size.y * 4.0;\n        }",[],function(e){return[r.texture(t+"_tex",e),r.vec2(t+"_size",e.width,e.height)]})},i,0,WebGLRenderingContext.UNSIGNED_BYTE,function(e){return e},function(e){return e},!1);return{get SingleTypeCoder(){return e},get ShaderCoder(){return t},get ShaderPart(){return n},get BOOL_TYPE_CODER(){return a}}}),$traceurRuntime.registerModule("src/webgl/ShaderCoders_intoBytes.js",[],function(){"use strict";var i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/DetailedError.js","src/webgl/ShaderCoders_intoBytes.js")).DetailedError,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./WglArg.js","src/webgl/ShaderCoders_intoBytes.js")).WglArg,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Seq.js","src/webgl/ShaderCoders_intoBytes.js")).Seq,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ShaderCoders_Base.js","src/webgl/ShaderCoders_intoBytes.js")),u=e.ShaderPart,t=e.SingleTypeCoder,r=e.ShaderCoder,e=e.BOOL_TYPE_CODER;function n(e){if(e instanceof Float64Array)return new Uint8Array(new Float32Array(e).buffer,0,e.length<<2);if(e instanceof Float32Array)return new Uint8Array(e.buffer,0,e.length<<2);throw new i("Not a Float32Array or Float64Array",{type:void 0===e?"undefined":$traceurRuntime.typeof(e),floats:e})}function s(e){if(e instanceof Uint8Array)return new Float32Array(e.buffer,0,e.length>>2);throw new i("Not a Uint8Array",{type:void 0===e?"undefined":$traceurRuntime.typeof(e),bytes:e})}var l="\n    //////////// PACK_FLOAT_INTO_BYTES /////////////\n    vec4 _gen_packFloatIntoBytes(float val) {\n        if (val == 0.0) {\n            // If log2(0) returns -Infinity, then the logic below would work out just right and this IF block\n            // wouldn't be needed. Unfortunately, log2(0) isn't guaranteed to do that (it's undefined by the spec).\n            return vec4(0.0, 0.0, 0.0, 0.0);\n        }\n\n        float mag = abs(val);\n        float exponent = floor(log2(mag));\n        // Correct log2 approximation errors.\n        exponent += float(exp2(exponent) <= mag / 2.0);\n        exponent -= float(exp2(exponent) > mag);\n\n        float mantissa;\n        if (exponent > 100.0) {\n            // Not sure why this needs to be done in two steps for the largest float to work. Best guess is the\n            // optimizer is rewriting '/ exp2(e)' into '* exp2(-e)', but exp2(-128.0) is too small to represent.\n            mantissa = mag / 1024.0 / exp2(exponent - 10.0) - 1.0;\n        } else {\n            mantissa = mag / float(exp2(exponent)) - 1.0;\n        }\n\n        exponent += 127.0;\n        float a = float(val < 0.0) * 128.0 + floor(exponent / 2.0);\n        mantissa *= 128.0;\n        float b = mod(exponent, 2.0) * 128.0 + floor(mantissa);\n        mantissa -= floor(mantissa);\n        mantissa *= 256.0;\n        float c = floor(mantissa);\n        mantissa -= c;\n        mantissa *= 256.0;\n        float d = floor(mantissa);\n\n        return vec4(d, c, b, a) / 255.0;\n    }",c="\n    //////////// UNPACK_BYTES_INTO_FLOAT_CODE /////////////\n    float _gen_unpackBytesIntoFloat(vec4 v) {\n        float d = floor(v.r * 255.0 + 0.5);\n        float c = floor(v.g * 255.0 + 0.5);\n        float b = floor(v.b * 255.0 + 0.5);\n        float a = floor(v.a * 255.0 + 0.5);\n\n        float sign = floor(a / 128.0);\n        sign = 1.0 - sign * 2.0;\n\n        float exponent = mod(a, 128.0) * 2.0 + floor(b / 128.0) - 127.0;\n        float mantissa = float(exponent > -127.0)\n                       + mod(b, 128.0) / 128.0\n                       + c / 32768.0\n                       + d / 8388608.0;\n        return sign * mantissa * exp2(exponent);\n    }";function d(e,t){var r=["float","vec2","vec3","vec4"][e-1],n="_gen_"+t;return new u("\n        ///////////// makeByteCoderInput("+e+", "+t+") ////////////\n        uniform sampler2D "+n+"_tex;\n        uniform vec2 "+n+"_size;\n\n        "+r+" read_"+t+"(float k) {\n            k *= "+e+".0;\n            vec2 uv = vec2(mod(k, "+n+"_size.x) + 0.5,\n                           floor(k / "+n+"_size.x) + 0.5) / "+n+"_size;\n\n            "+o.range(e).map(function(e){return"\n                vec2 uv"+e+" = uv + vec2("+e+".0 / "+n+"_size.x, 0.0);\n                vec4 bytes"+e+" = texture2D("+n+"_tex, uv"+e+");"}).join("")+"\n\n            return "+r+"("+o.range(e).map(function(e){return"\n                _gen_unpackBytesIntoFloat(bytes"+e+")"}).join(",")+");\n        }\n\n        float len_"+t+"() {\n            return "+n+"_size.x * "+n+"_size.y / "+e+".0;\n        }",[c],function(e){if(e.pixelType!==WebGLRenderingContext.UNSIGNED_BYTE)throw new i("vec2Input_Byte requires byte texture",{name:t,texture:e});return[a.texture(n+"_tex",e),a.vec2(n+"_size",e.width,e.height)]})}function m(e){var t=["float","vec2","vec3","vec4"][e-1];return new u("\n        ///////////// makeByteCoderOutput"+e+" ////////////\n        "+t+" outputFor(float k);\n\n        uniform vec2 _gen_output_size;\n        uniform float _gen_secret_half;\n\n        float len_output() {\n            return _gen_output_size.x * _gen_output_size.y / "+e+".0;\n        }\n\n        void main() {\n            vec2 xy = gl_FragCoord.xy - vec2(_gen_secret_half, _gen_secret_half);\n            float k = xy.y * _gen_output_size.x + xy.x;\n            float r = mod(k, "+e+".0);\n            "+(1===e?"float component = outputFor(k);":t+" result = outputFor(floor(k / "+e+".0));\n                 "+t+" picker = "+t+"("+o.range(e).map(function(e){return"float(r == "+e+".0)"}).join(", ")+");\n                 float component = dot(result, picker);")+"\n            gl_FragColor = _gen_packFloatIntoBytes(component);\n        }",[l],function(e){return[a.vec2("_gen_output_size",e.width,e.height),a.float("_gen_secret_half",.5)]})}var f=new r(e,new t(function(e){return d(1,e)},m(1),0,WebGLRenderingContext.UNSIGNED_BYTE,n,s,!1),new t(function(e){return d(2,e)},m(2),1,WebGLRenderingContext.UNSIGNED_BYTE,n,s,!1),new t(function(e){return d(4,e)},m(4),2,WebGLRenderingContext.UNSIGNED_BYTE,n,s,!1));return{get SHADER_CODER_BYTES(){return f},get floatsAsBytes(){return n},get bytesAsFloats(){return s},get UNPACK_BYTES_INTO_FLOAT_CODE(){return c},get PACK_FLOAT_INTO_BYTES_CODE(){return l}}}),$traceurRuntime.registerModule("src/webgl/ShaderCoders_intoFloats.js",[],function(){"use strict";var i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/DetailedError.js","src/webgl/ShaderCoders_intoFloats.js")).DetailedError,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ShaderCoders_Base.js","src/webgl/ShaderCoders_intoFloats.js")),a=e.ShaderPart,t=e.SingleTypeCoder,r=e.ShaderCoder,e=e.BOOL_TYPE_CODER,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./WglArg.js","src/webgl/ShaderCoders_intoFloats.js")).WglArg;function n(t,r){var n="_gen_"+r;return new a("\n        ///////////// makeFloatCoderInput("+t+", "+r+") ////////////\n        uniform sampler2D "+n+"_tex;\n        uniform vec2 "+n+"_size;\n\n        "+["float","vec2","vec3","vec4"][t-1]+" read_"+r+"(float k) {\n            vec2 uv = vec2(mod(k, "+n+"_size.x) + 0.5,\n                           floor(k / "+n+"_size.x) + 0.5) / "+n+"_size;\n            return texture2D("+n+"_tex, uv)."+"xyzw".substring(0,t)+";\n        }\n\n        float len_"+r+"() {\n            return "+n+"_size.x * "+n+"_size.y;\n        }",[],function(e){if(e.pixelType!==WebGLRenderingContext.FLOAT)throw new i("vecInput"+t+"_Float requires float texture",{name:r,texture:e});return[o.texture(n+"_tex",e),o.vec2(n+"_size",e.width,e.height)]})}function u(e){var t=["float","vec2","vec3","vec4"][e-1];return new a("\n        ///////////// makeFloatCoderOutput"+e+" ////////////\n        "+t+" outputFor(float k);\n\n        uniform vec2 _gen_output_size;\n        uniform float _gen_secret_half;\n\n        float len_output() {\n            return _gen_output_size.x * _gen_output_size.y;\n        }\n\n        void main() {\n            vec2 xy = gl_FragCoord.xy - vec2(_gen_secret_half, _gen_secret_half);\n            float k = xy.y * _gen_output_size.x + xy.x;\n\n            "+t+" v = outputFor(k);\n\n            gl_FragColor = "+["vec4(v, 0.0, 0.0, 0.0)","vec4(v.x, v.y, 0.0, 0.0)","vec4(v.x, v.y, v.z, 0.0)","v"][e-1]+";\n        }",[],function(e){return[o.vec2("_gen_output_size",e.width,e.height),o.float("_gen_secret_half",.5)]})}var s=new r(e,new t(function(e){return n(1,e)},u(1),0,WebGLRenderingContext.FLOAT,function(e){for(var t=new Float32Array(e.length<<2),r=0;r<e.length;r++)t[4*r]=e[r];return t},function(e){for(var t=new Float32Array(e.length>>2),r=0;r<t.length;r++)t[r]=e[4*r];return t},!0),new t(function(e){return n(2,e)},u(2),0,WebGLRenderingContext.FLOAT,function(e){for(var t=new Float32Array(e.length<<1),r=0;2*r<e.length;r++)t[4*r]=e[2*r],t[4*r+1]=e[2*r+1];return t},function(e){for(var t=new Float32Array(e.length>>1),r=0;2*r<t.length;r++)t[2*r]=e[4*r],t[2*r+1]=e[4*r+1];return t},!0),new t(function(e){return n(4,e)},u(4),0,WebGLRenderingContext.FLOAT,function(e){return e},function(e){return e},!1));return{get SHADER_CODER_FLOATS(){return s}}}),$traceurRuntime.registerModule("src/webgl/ShaderCoders.js",[],function(){"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./WglArg.js","src/webgl/ShaderCoders.js")).WglArg,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./WglShader.js","src/webgl/ShaderCoders.js")).WglShader,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./WglTexture.js","src/webgl/ShaderCoders.js")).WglTexture,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./WglContext.js","src/webgl/ShaderCoders.js")).initializedWglContext,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./WglConfiguredShader.js","src/webgl/ShaderCoders.js")),r=e.provideWorkingShaderCoderToWglConfiguredShader,i=e.WglConfiguredShader,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ShaderCoders_Base.js","src/webgl/ShaderCoders.js")).ShaderPart,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ShaderCoders_intoBytes.js","src/webgl/ShaderCoders.js")).SHADER_CODER_BYTES,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ShaderCoders_intoFloats.js","src/webgl/ShaderCoders.js")).SHADER_CODER_FLOATS,l=$traceurRuntime.createClass(function(e,t){this._partMaker=e,this.description=t},{toConcretePart:function(){return this._partMaker(arguments[0]||g)},toString:function(){return"ShaderPartDescription("+this.description+")"}},{}),c=$traceurRuntime.createClass(function(){},{},{bool:function(t){return new l(function(e){return e.bool.inputPartGetter(t)},"Inputs.bool("+t+")")},float:function(t){return new l(function(e){return e.float.inputPartGetter(t)},"Inputs.float("+t+")")},vec2:function(t){return new l(function(e){return e.vec2.inputPartGetter(t)},"Inputs.vec2("+t+")")},vec4:function(t){return new l(function(e){return e.vec4.inputPartGetter(t)},"Inputs.vec4("+t+")")}}),d=$traceurRuntime.createClass(function(){},{},{bool:function(){return new l(function(e){return e.bool.outputPart},"Outputs.bool()")},float:function(){return new l(function(e){return e.float.outputPart},"Outputs.float()")},vec2:function(){return new l(function(e){return e.vec2.outputPart},"Outputs.vec2()")},vec4:function(){return new l(function(e){return e.vec4.outputPart},"Outputs.vec4()")},vec4WithOutputCoder:function(){return new l(function(e){return p.vec4.outputPart},"Outputs.vec4WithOutputCoder()")}});function m(e,h){var g=e.map(function(t){return t instanceof n?new l(function(e){return t},"fixed"):t});return new o(function(){var e=new Set,t=!0,r=!1,n=void 0;try{for(var i,a=g[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value,u=!0,s=!1,l=void 0;try{for(var c,d=o.toConcretePart().libs[Symbol.iterator]();!(u=(c=d.next()).done);u=!0){var m=c.value;e.add(m)}}catch(e){s=!0,l=e}finally{try{u||null==d.return||d.return()}finally{if(s)throw l}}}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}var r=$traceurRuntime.spread(e,g.map(function(e){return e.toConcretePart().code})).join(""),n="\n//////// body ////////\n"+h+"\n",f=r.indexOf("void main()");return-1!==f?r.substring(0,f)+n+r.substring(f):r+n})}function f(i,a,e){var o=m($traceurRuntime.spread(i,[a]),e);return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=[],n=0;n<i.length;n++)r.push.apply(r,$traceurRuntime.spread(i[n].toConcretePart().argsFor(e[n])));return r.push.apply(r,$traceurRuntime.spread(e.slice(i.length))),h(o,a.toConcretePart(),r)}}function h(t,r,n){return new i(function(e){return t.withArgs.apply(t,$traceurRuntime.spread(n,r.argsFor(e))).renderTo(e)})}var g=s,p=e;function v(){return g}function y(){return p}function b(e){try{t().invalidateExistingResources()}catch(e){}p=g=e}function R(){var e=new u(1,1,WebGLRenderingContext.FLOAT),t=new o("void main() { gl_FragColor = vec4(2.0, 3.5, 7.0, -7654321.0); }");try{t.withArgs().renderTo(e);var r=e.readPixels(!1);return r instanceof Float32Array&&4===r.length&&2===r[0]&&3.5===r[1]&&7===r[2]&&-7654321===r[3]}catch(e){return console.warn(e),!1}finally{e.ensureDeinitialized(),t.ensureDeinitialized()}}var w=void 0;function M(){return w=void 0===w?R():w}return p=R()?g=s:function(){var e=new u(1,1,WebGLRenderingContext.FLOAT),t=new u(1,1,WebGLRenderingContext.UNSIGNED_BYTE),r=new o("void main() { gl_FragColor = vec4(1.1, 3.0, 5.0, -7654321.0); }"),n=new o("uniform sampler2D t; void main() {\n        vec4 v = texture2D(t, gl_FragCoord.xy);\n        if (v == vec4(2.0, 3.0, 5.0, -7654321.0)) { // Testing that expected precision is present.\n            gl_FragColor = vec4(2.0, 3.0, 5.0, 254.0) / 255.0;\n        } else {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n        }\n    }");try{r.withArgs().renderTo(e),n.withArgs(a.texture("t",e)).renderTo(t);var i=t.readPixels(!1);return i instanceof Uint8Array&&4===i.length&&2===i[0]&&3===i[1]&&5===i[2]&&254===i[3]}catch(e){console.warn(e)}finally{e.ensureDeinitialized(),t.ensureDeinitialized(),r.ensureDeinitialized(),n.ensureDeinitialized()}}()?(console.warn("Wrote but failed to read a floating point texture. Falling back to float-as-byte output coding."),g=s,e):(console.warn("Failed to write a floating point texture. Falling back to float-as-byte coding everywhere."),g=e),r(v),{get combinedShaderPartsWithCode(){return m},get shaderWithOutputPartAndArgs(){return h},get currentShaderCoder(){return v},get makePseudoShaderWithInputsAndOutputAndCode(){return f},get changeShaderCoder(){return b},get Inputs(){return c},get Outputs(){return d},get outputShaderCoder(){return y},get canTestFloatShaders(){return M}}}),$traceurRuntime.registerModule("src/webgl/Shaders.js",[],function(){"use strict";var u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/DetailedError.js","src/webgl/Shaders.js")).DetailedError,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./WglArg.js","src/webgl/Shaders.js")).WglArg,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./WglContext.js","src/webgl/Shaders.js")).initializedWglContext,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./WglShader.js","src/webgl/Shaders.js")).WglShader,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./WglConfiguredShader.js","src/webgl/Shaders.js")).WglConfiguredShader,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ShaderCoders.js","src/webgl/Shaders.js")),n=t.currentShaderCoder,i=t.Inputs,a=t.Outputs,t=t.makePseudoShaderWithInputsAndOutputAndCode,o=$traceurRuntime.createClass(function(){},{},{}),c=(o.color=function(e,t,r,n){return c.withArgs(s.vec4("color",e,t,r,n))},new e("\n    uniform vec4 color;\n    void main() {\n        gl_FragColor = color;\n    }")),d=(o.passthrough=function(t){return new r(function(e){if(e.width!==t.width||e.height!==t.height||e.pixelType!==t.pixelType)throw new u("Expected same-shaped textures.",{inp:t,dst:e});d.withArgs(s.vec2("textureSize",t.width,t.height),s.texture("dataTexture",t)).renderTo(e)})},new e("\n    uniform vec2 textureSize;\n    uniform sampler2D dataTexture;\n    void main() {\n        gl_FragColor = texture2D(dataTexture, gl_FragCoord.xy / textureSize.xy);\n    }"));return o.data=function(o){return new r(function(e){var t=(n=(r=[e.width,e.height][Symbol.iterator]()).next()).done?void 0:n.value,r=(n=r.next()).done?void 0:n.value;if(o.length!==t*r*4)throw new u("rgbaData.length isn't w * h * 4",{w:t,h:r,len:o.length,rgbaData:o});var n=WebGLRenderingContext,i=l().gl,a=i.createTexture();try{i.bindTexture(WebGLRenderingContext.TEXTURE_2D,a),i.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),i.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),i.texImage2D(n.TEXTURE_2D,0,n.RGBA,t,r,0,n.RGBA,o instanceof Uint8Array?n.UNSIGNED_BYTE:n.FLOAT,o),d.withArgs(s.vec2("textureSize",t,r),s.webGlTexture("dataTexture",a)).renderTo(e)}finally{i.deleteTexture(a)}})},o.floatData=function(e){return o.data(n().float.dataToPixels(e))},o.vec2Data=function(e){return o.data(n().vec2.dataToPixels(e))},o.vec4Data=function(e){return o.data(n().vec4.dataToPixels(e))},o.packFloatIntoVec4=t([i.float("input")],a.vec4(),"vec4 outputFor(float k) {\n        return vec4(\n            read_input(k*4.0),\n            read_input(k*4.0 + 1.0),\n            read_input(k*4.0 + 2.0),\n            read_input(k*4.0 + 3.0));\n    }"),o.packVec2IntoVec4=t([i.vec2("input")],a.vec4(),"vec4 outputFor(float k) { return vec4(read_input(k*2.0), read_input(k*2.0 + 1.0)); }"),o.sumFoldFloat=t([i.float("input")],a.float(),"float outputFor(float k) {\n         return read_input(k) + read_input(k + len_output());\n     }"),o.sumFoldFloatAdjacents=t([i.float("input")],a.float(),"float outputFor(float k) {\n         return read_input(k*2.0) + read_input(k*2.0 + 1.0);\n     }"),o.sumFoldVec2=t([i.vec2("input")],a.vec2(),"vec2 outputFor(float k) {\n         return read_input(k) + read_input(k + len_output());\n     }"),o.sumFoldVec2Adjacents=t([i.vec2("input")],a.vec2(),"vec2 outputFor(float k) {\n         return read_input(k*2.0) + read_input(k*2.0 + 1.0);\n     }"),o.sumFoldVec4=t([i.vec4("input")],a.vec4(),"vec4 outputFor(float k) {\n        return read_input(k) + read_input(k + len_output());\n    }"),o.convertVec4CodingForOutput=t([i.vec4("input")],a.vec4WithOutputCoder(),"vec4 outputFor(float k) { return read_input(k); }"),{get Shaders(){return o}}}),$traceurRuntime.registerModule("src/webgl/WglArg.js",[],function(){"use strict";var e=$traceurRuntime.createClass(a,{toString:function(){return this.type+" "+this.name+" = "+JSON.stringify(this.value)}},{bool:function(e,t){return new a(a.BOOL_TYPE,e,t)},float:function(e,t){return new a(a.FLOAT_TYPE,e,t)},int:function(e,t){return new a(a.INT_TYPE,e,t)},vec2:function(e,t,r){return new a(a.VEC2_TYPE,e,[t,r])},float_array:function(e,t){return t instanceof Float64Array&&(t=new Float32Array(t)),new a(a.FLOAT_ARRAY_TYPE,e,t)},vec2_array:function(e,t){return t instanceof Float64Array&&(t=new Float32Array(t)),new a(a.VEC2_ARRAY_TYPE,e,t)},vec4_array:function(e,t){return t instanceof Float64Array&&(t=new Float32Array(t)),new a(a.VEC4_ARRAY_TYPE,e,t)},mat4_array:function(e,t){return t instanceof Float64Array&&(t=new Float32Array(t)),new a(a.MAT4_ARRAY_TYPE,e,t)},vec4:function(e,t,r,n,i){return new a(a.VEC4_TYPE,e,[t,r,n,i])},mat4:function(e,t){return new a(a.MAT4_TYPE,e,t)},texture:function(e,t){return new a(a.WGL_TEXTURE_TYPE,e,t)},webGlTexture:function(e,t){return new a(a.WEB_GL_TEXTURE_TYPE,e,t)}});function a(e,t,r){this.type=e,this.name=t,this.value=r}return e.BOOL_TYPE="bool",e.FLOAT_TYPE="float",e.INT_TYPE="int",e.VEC2_TYPE="vec2",e.FLOAT_ARRAY_TYPE="float[]",e.VEC2_ARRAY_TYPE="vec2[]",e.VEC4_ARRAY_TYPE="vec4[]",e.MAT4_ARRAY_TYPE="mat4[]",e.VEC4_TYPE="vec4",e.MAT4_TYPE="mat4",e.WGL_TEXTURE_TYPE="wgl_texture",e.WEB_GL_TEXTURE_TYPE="web_gl_texture",e.INPUT_ACTION_MAP=new Map([[e.BOOL_TYPE,function(e,t,r){return e.gl.uniform1f(t,r?1:0)}],[e.INT_TYPE,function(e,t,r){return e.gl.uniform1i(t,r)}],[e.FLOAT_TYPE,function(e,t,r){return e.gl.uniform1f(t,r)}],[e.VEC2_TYPE,function(e,t,r){var n,i=(n=(r=r[Symbol.iterator]()).next()).done?void 0:n.value,r=(n=r.next()).done?void 0:n.value;return e.gl.uniform2f(t,i,r)}],[e.FLOAT_ARRAY_TYPE,function(e,t,r){return e.gl.uniform1fv(t,r)}],[e.VEC2_ARRAY_TYPE,function(e,t,r){return e.gl.uniform2fv(t,r)}],[e.VEC4_ARRAY_TYPE,function(e,t,r){return e.gl.uniform4fv(t,r)}],[e.MAT4_ARRAY_TYPE,function(e,t,r){return e.gl.uniformMatrix4fv(t,!1,r)}],[e.VEC4_TYPE,function(e,t,r){var n,i=(n=(r=r[Symbol.iterator]()).next()).done?void 0:n.value,a=(n=r.next()).done?void 0:n.value,o=(n=r.next()).done?void 0:n.value,r=(n=r.next()).done?void 0:n.value;return e.gl.uniform4f(t,i,a,o,r)}],[e.MAT4_TYPE,function(e,t,r){return e.gl.uniformMatrix4fv(t,!1,r)}],[e.WGL_TEXTURE_TYPE,function(e,t,r,n){n=n.coopTextureUnit++;if(n>=e.maxTextureUnits)throw new Error("Uniform texture argument uses texture unit "+n+" but max is "+e.maxTextureUnits+".");if(r.width>e.maxTextureSize||r.height>e.maxTextureSize)throw new Error("Uniform texture argument is "+r.width+"x"+r.height+", but max texture diameter is "+e.maxTextureSize+".");e=e.gl;e.uniform1i(t,n),e.activeTexture(WebGLRenderingContext.TEXTURE0+n),e.bindTexture(WebGLRenderingContext.TEXTURE_2D,r.initializedTexture())}],[e.WEB_GL_TEXTURE_TYPE,function(e,t,r,n){n=n.coopTextureUnit++;if(n>=e.maxTextureUnits)throw new Error("Uniform texture argument uses texture unit "+n+" but max is "+e.maxTextureUnits+".");e=e.gl;e.uniform1i(t,n),e.activeTexture(WebGLRenderingContext.TEXTURE0+n),e.bindTexture(WebGLRenderingContext.TEXTURE_2D,r)}]]),{get WglArg(){return e}}}),$traceurRuntime.registerModule("src/webgl/WglConfiguredShader.js",[],function(){"use strict";var i,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../math/Matrix.js","src/webgl/WglConfiguredShader.js")).Matrix,r=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./WglTexture.js","src/webgl/WglConfiguredShader.js")).WglTexture,void 0);function e(e){r=e}function n(e){i=e}var a=$traceurRuntime.createClass(o,{renderTo:function(e){if(this.renderToFunc(e)instanceof o)throw new Error("Returned a WglConfiguredShader instead of calling renderTo on it.")},_renderToElseDealloc:function(e){var t=!1;try{this.renderTo(e),t=!0}finally{t||e.deallocByDepositingInPool("_renderToElseDealloc")}},_renderReadDealloc:function(e){try{return this.renderTo(e),e.readPixels()}finally{e.deallocByDepositingInPool()}},toRawByteTexture:function(e){e=i.takeRawByteTex(e);return this._renderToElseDealloc(e),e},toRawFloatTexture:function(e){e=i.takeRawFloatTex(e);return this._renderToElseDealloc(e),e},readRawFloatOutputs:function(e){return this._renderReadDealloc(i.takeRawFloatTex(e))},readRawByteOutputs:function(e){return this._renderReadDealloc(i.takeRawByteTex(e))},readBoolOutputs:function(e){for(var t=this._renderReadDealloc(i.takeBoolTex(e)),r=new Uint8Array(t.length>>2),n=0;n<r.length;n++)r[n]=1&t[n<<2];return r},readVecFloatOutputs:function(e){return r().float.pixelsToData(this._renderReadDealloc(i.takeVecFloatTex(e)))},readVec2Outputs:function(e){return r().vec2.pixelsToData(this._renderReadDealloc(i.takeVec2Tex(e)))},readVec2OutputsAsKet:function(e){return new t(1,1<<e,this.readVec2Outputs(e))},readVec4Outputs:function(e){return r().vec4.pixelsToData(this._renderReadDealloc(i.takeVec4Tex(e)))},toVecFloatTexture:function(e){e=i.takeVecFloatTex(e);return this._renderToElseDealloc(e),e},toVec2Texture:function(e){e=i.takeVec2Tex(e);return this._renderToElseDealloc(e),e},toVec4Texture:function(e){e=i.takeVec4Tex(e);return this._renderToElseDealloc(e),e},toBoolTexture:function(e){e=i.takeBoolTex(e);return this._renderToElseDealloc(e),e}},{});function o(e){this.renderToFunc=e}return{get WglConfiguredShader(){return a},get provideWorkingShaderCoderToWglConfiguredShader(){return e},get provideWglTexturePoolToWglConfiguredShader(){return n}}}),$traceurRuntime.registerModule("src/webgl/WglContext.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../issues.js","src/webgl/WglContext.js")),t=e.canvasCreatedForTesting,r=e.webglContextCreatedForTesting,n=$traceurRuntime.createClass(function(){var e=arguments[0],t=arguments[1],r=this;if(void 0===e&&(e=document.createElement("canvas"),t=void 0),void 0===t&&(t=e.getContext("webgl")||e.getContext("experimental-webgl")),this.canvas=e,this.gl=t,null===this.gl)throw new Error("Error creating WebGL context.");void 0===this.gl.getExtension("OES_texture_float")&&console.warn("OES_texture_float webgl extension not present."),void 0===this.gl.getExtension("WEBGL_color_buffer_float")&&console.warn("WEBGL_color_buffer_float webgl extension not present."),this.onContextRestored=void 0,this.lifetimeCounter=0,this.canvas.addEventListener("webglcontextrestored",function(e){e.preventDefault(),r.recomputeProperties(),void 0!==r.onContextRestored&&r.onContextRestored()},!1),this.canvas.addEventListener("webglcontextlost",function(e){e.preventDefault(),r.lifetimeCounter++},!1),this.recomputeProperties()},{invalidateExistingResources:function(){this.lifetimeCounter++},recomputeProperties:function(){this.lifetimeCounter++,this.maxTextureUnits=this.gl.getParameter(WebGLRenderingContext.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=this.gl.getParameter(WebGLRenderingContext.MAX_TEXTURE_SIZE),this.maximumShaderFloatPrecision=this._getMaximumShaderFloatPrecision()},_getMaximumShaderFloatPrecision:function(){function e(e,t){return e=r.getShaderPrecisionFormat(e,t),r.getError()===n.NO_ERROR&&null!=e&&0<e.precision}var r=this.gl,n=WebGLRenderingContext;return e(n.VERTEX_SHADER,n.HIGH_FLOAT)&&e(n.FRAGMENT_SHADER,n.HIGH_FLOAT)?"highp":(console.warn("WebGL high precision not available."),e(n.VERTEX_SHADER,n.MEDIUM_FLOAT)&&e(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT)?"mediump":(console.warn("WebGL medium precision not available."),"lowp"))}},{}),i=void 0;function a(){return i=void 0===i?new n(t,r):i}return{get initializedWglContext(){return a}}}),$traceurRuntime.registerModule("src/webgl/WglMortalValueSlot.js",[],function(){"use strict";var e=$traceurRuntime.createClass(function(e,t){this.initializer=e,this.deinitializer=t,this.lifetimeId=void 0,this.mortalValue=void 0},{initializedValue:function(e){return this.lifetimeId!==e&&(this.ensureDeinitialized(),this.mortalValue=this.initializer(),this.lifetimeId=e),this.mortalValue},ensureInitialized:function(e){this.initializedValue(e)},ensureDeinitialized:function(){var e;void 0!==this.lifetimeId&&(e=this.mortalValue,this.lifetimeId=void 0,this.mortalValue=void 0,this.deinitializer(e))}},{});return{get WglMortalValueSlot(){return e}}}),$traceurRuntime.registerModule("src/webgl/WglShader.js",[],function(){"use strict";var d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/webgl/WglShader.js")).Config,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/DetailedError.js","src/webgl/WglShader.js")).DetailedError,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./WglArg.js","src/webgl/WglShader.js")).WglArg,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./WglContext.js","src/webgl/WglShader.js")).initializedWglContext,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./WglMortalValueSlot.js","src/webgl/WglShader.js")).WglMortalValueSlot,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./WglUtil.js","src/webgl/WglShader.js")),o=e.checkGetErrorResult,u=e.checkFrameBufferStatusResult,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Seq.js","src/webgl/WglShader.js")).Seq,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./WglConfiguredShader.js","src/webgl/WglShader.js")).WglConfiguredShader,l=new r(function(){var e=WebGLRenderingContext,t=h().gl,r=t.createBuffer(),n=new Float32Array([-1,1,1,1,-1,-1,1,-1]),n=(t.bindBuffer(e.ARRAY_BUFFER,r),t.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW),t.createBuffer()),i=new Uint16Array([0,2,1,2,3,1]);return t.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n),t.bufferData(e.ELEMENT_ARRAY_BUFFER,i,e.STATIC_DRAW),{positionBuffer:r,indexBuffer:n}},function(){}),t=$traceurRuntime.createClass(function(e){var t;"string"==typeof e&&(t=e,e=function(){return t}),this.fragmentShaderSourceGenerator=e,this._compiledShaderSlot=void 0},{withArgs:function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];var t,a=this;return void 0===this._compiledShaderSlot&&(t=i.map(function(e){return e.name}),this._compiledShaderSlot=new r(function(){return new c(a.fragmentShaderSourceGenerator(),t)},function(e){return e.free()})),new n(function(e){var t,r,n;0!==e.width&&0!==e.height&&(t=WebGLRenderingContext,n=(r=h()).gl,l.ensureInitialized(r.lifetimeCounter),n.bindFramebuffer(t.FRAMEBUFFER,e.initializedFramebuffer()),o(n,"framebufferTexture2D",!0),u(n,!0),a._compiledShaderSlot.initializedValue(r.lifetimeCounter).useWithArgs(i),n.viewport(0,0,e.width,e.height),n.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),o(n,"drawElements",!0),e.markRendered())})},ensureDeinitialized:function(){void 0!==this._compiledShaderSlot&&this._compiledShaderSlot.ensureDeinitialized()},toString:function(){return"WglShader(fragmentShaderSource: "+this.fragmentShaderSourceGenerator()+")"}},{}),c=$traceurRuntime.createClass(g,{useWithArgs:function(e){var t=h(),r=t.gl,n=(r.useProgram(this.program),{coopTextureUnit:0}),i=!0,a=!1,o=void 0;try{for(var u,s=e[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var l=u.value,c=this.uniformLocations.get(l.name);if(void 0===c)throw new m("Unexpected uniform argument",{arg:l,uniformArgs:e});f.INPUT_ACTION_MAP.get(l.type)(t,c,l.value,n)}}catch(e){a=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(a)throw o}}r.enableVertexAttribArray(this.positionAttributeLocation),r.vertexAttribPointer(this.positionAttributeLocation,2,WebGLRenderingContext.FLOAT,!1,0,0)},free:function(){h().gl.deleteProgram(this.program)}},{compileShader:function(e,t,r){var t=e.createShader(t),n=(e.shaderSource(t,r),e.compileShader(t),e.getShaderInfoLog(t));if(""!==n){var i=!1,a=!0,o=!1,u=void 0;try{for(var s,l=d.IGNORED_WEBGL_INFO_TERMS[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value;n.indexOf(c)&&(i=!0)}}catch(e){o=!0,u=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw u}}i||(console.warn("WebGLShader: gl.getShaderInfoLog() wasn't empty: "+e.getShaderInfoLog(t)),console.warn("Source code was: "+r))}if(!1===e.getShaderParameter(t,WebGLRenderingContext.COMPILE_STATUS))throw new Error("WebGLShader: Shader compile failed.\n                Info: "+n+"\n                Source: "+r);return t}});function g(e,t){var r=h(),n=r.maximumShaderFloatPrecision,e="\n            precision "+n+" float;\n            precision "+n+" int;\n            "+e,i=WebGLRenderingContext,a=r.gl,r=g.compileShader(a,i.VERTEX_SHADER,"\n            precision "+n+" float;\n            precision "+n+" int;\n            attribute vec2 position;\n            void main() {\n              gl_Position = vec4(position, 0, 1);\n            }"),n=g.compileShader(a,i.FRAGMENT_SHADER,e),o=a.createProgram(),u=(a.attachShader(o,r),a.attachShader(o,n),a.linkProgram(o),(a.getProgramInfoLog(o)||"").trim());if(""!==u&&"\0"!==u&&d.SUPPRESSED_GLSL_WARNING_PATTERNS.every(function(e){return!e.test(u)})&&console.warn("Shader compile caused warnings","gl.getProgramInfoLog()",u),!1===a.getProgramParameter(o,i.LINK_STATUS))throw new Error("Failed to link shader program.\n\ngl.VALIDATE_STATUS: "+a.getProgramParameter(o,i.VALIDATE_STATUS)+"\ngl.getError(): "+a.getError());a.deleteShader(r),a.deleteShader(n),this.uniformLocations=new s(t).toMap(function(e){return e},function(e){return a.getUniformLocation(o,e)}),this.positionAttributeLocation=a.getAttribLocation(o,"position"),this.program=o}return{get WglShader(){return t}}}),$traceurRuntime.registerModule("src/webgl/WglTexture.js",[],function(){"use strict";var i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/DetailedError.js","src/webgl/WglTexture.js")).DetailedError,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/Util.js","src/webgl/WglTexture.js")).Util,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./WglMortalValueSlot.js","src/webgl/WglTexture.js")).WglMortalValueSlot,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./WglContext.js","src/webgl/WglTexture.js")).initializedWglContext,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./WglUtil.js","src/webgl/WglTexture.js")),s=e.checkGetErrorResult,l=e.checkFrameBufferStatusResult,t=$traceurRuntime.createClass(c,{sizePower:function(){return 0===this.width?-1/0:Math.round(Math.log2(this.width*this.height))},toString:function(){return"Texture("+[this.width+"x"+this.height,this.pixelType===WebGLRenderingContext.FLOAT?"FLOAT":this.pixelType===WebGLRenderingContext.UNSIGNED_BYTE?"UNSIGNED_BYTE":this.pixelType,this._hasBeenRenderedTo?"rendered":"not rendered"].join(", ")+")"},markRendered:function(){this._hasBeenRenderedTo=!0},invalidateButMoveToNewInstance:function(e){function t(){throw new i("WglTexture's value accessed after invalidation.",e)}var r=new c(this.width,this.height,this.pixelType);r._textureAndFrameBufferSlot=this._textureAndFrameBufferSlot;return this._textureAndFrameBufferSlot=new o(t,t),r},initializedTexture:function(){if(this._hasBeenRenderedTo)return this._textureAndFrameBufferSlot.initializedValue(u().lifetimeCounter).texture;throw new Error("Called initializedTexture on a texture that hasn't been rendered to.")},initializedFramebuffer:function(){return this._textureAndFrameBufferSlot.initializedValue(u().lifetimeCounter).framebuffer},ensureDeinitialized:function(){this._textureAndFrameBufferSlot.ensureDeinitialized()},_textureAndFramebufferInitializer:function(){var e=WebGLRenderingContext,t=u().gl,r={texture:t.createTexture(),framebuffer:t.createFramebuffer()};t.bindTexture(e.TEXTURE_2D,r.texture),t.bindFramebuffer(e.FRAMEBUFFER,r.framebuffer);try{t.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),t.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),t.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),t.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,this.pixelType,null),s(t,"texImage2D"),t.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r.texture,0),s(t,"framebufferTexture2D"),l(t)}finally{t.bindTexture(e.TEXTURE_2D,null),t.bindFramebuffer(e.FRAMEBUFFER,null)}return r},readPixels:function(){var e,t,r=void 0===arguments[0]||arguments[0],n=WebGLRenderingContext;if(!this._hasBeenRenderedTo)throw new Error("Called readPixels on a texture that hasn't been rendered to.");switch(this.pixelType){case n.UNSIGNED_BYTE:e=new Uint8Array(this.width*this.height*4);break;case n.FLOAT:e=new Float32Array(this.width*this.height*4);break;default:throw new Error("Unrecognized pixel type.")}return 0!==this.width&&0!==this.height&&((t=u().gl).bindFramebuffer(n.FRAMEBUFFER,this.initializedFramebuffer()),s(t,"framebufferTexture2D",r),l(t,r),t.readPixels(0,0,this.width,this.height,n.RGBA,this.pixelType,e),s(t,"readPixels(..., RGBA, "+this.pixelType+", ...)",r)),e}},{preferredWidthHeightForSizePower:function(e){var t=1<<Math.ceil(e/2),e=1<<Math.floor(e/2);return 2===t&&2===e&&(t=4,e=1),{w:t,h:e}},_deinitialize:function(e){var t=e.texture,e=e.framebuffer,r=u().gl;r.deleteTexture(t),r.deleteFramebuffer(e)}});function c(e,t){var r=void 0!==arguments[2]?arguments[2]:WebGLRenderingContext.FLOAT,n=this;if(0===e&&0===t)this.width=0,this.height=0,this.pixelType=r,this._hasBeenRenderedTo=!0,this._textureAndFrameBufferSlot=new o(function(){throw new i("Touched a zero-size texture.",n)},function(){throw new i("Touched a zero-size texture.",n)});else{if(!a.isPowerOf2(e)||!a.isPowerOf2(t))throw new i("Sizes must be a power of 2.",{width:e,height:t,pixelType:r});this.width=e,this.height=t,this.pixelType=r,this._hasBeenRenderedTo=!1,this._textureAndFrameBufferSlot=new o(function(){return n._textureAndFramebufferInitializer()},function(e){return c._deinitialize(e)})}}return{get WglTexture(){return t}}}),$traceurRuntime.registerModule("src/webgl/WglTexturePool.js",[],function(){"use strict";var n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../base/DetailedError.js","src/webgl/WglTexturePool.js")).DetailedError,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./WglTexture.js","src/webgl/WglTexturePool.js")).WglTexture,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./WglConfiguredShader.js","src/webgl/WglTexturePool.js")).provideWglTexturePoolToWglConfiguredShader,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ShaderCoders.js","src/webgl/WglTexturePool.js")).currentShaderCoder,a=[],o=[],u=0,r=$traceurRuntime.createClass(s,{},{_bucketFor:function(e,t){if(!Number.isInteger(e)||e<0||50<e)throw new n("Bad sizePower",{sizePower:e,pixelType:t});for(var r=t===WebGLRenderingContext.FLOAT?a:o;r.length<=e;)r.push([]);return r[e]},take:function(e,t){var r;return e===-1/0?new i(0,0,t):(r=s._bucketFor(e,t),1e3<++u&&console.warn("High borrowed texture count: "+u+". (Maybe a leak?)"),0<r.length?r.pop():(e=(r=i.preferredWidthHeightForSizePower(e)).w,r=r.h,new i(e,r,t)))},deposit:function(e){var t,r=void 0!==arguments[1]?arguments[1]:"[no dealloc details]";if(!(e instanceof i))throw new n("Not a texture",{texture:e,detailsShownWhenUsedAfterDone:r});0!==e.width&&(t=s._bucketFor(e.sizePower(),e.pixelType),u--,t.push(e.invalidateButMoveToNewInstance(r)))},takeSame:function(e){return s.take(e.sizePower(),e.pixelType)},getUnReturnedTextureCount:function(){return u},takeRawFloatTex:function(e){return s.take(e,WebGLRenderingContext.FLOAT)},takeRawByteTex:function(e){return s.take(e,WebGLRenderingContext.UNSIGNED_BYTE)},takeBoolTex:function(e){return s.take(e,WebGLRenderingContext.UNSIGNED_BYTE)},takeVecFloatTex:function(e){return s.take(e+t().float.powerSizeOverhead,t().float.pixelType)},takeVec2Tex:function(e){return s.take(e+t().vec2.powerSizeOverhead,t().vec2.pixelType)},takeVec4Tex:function(e){return s.take(e+t().vec4.powerSizeOverhead,t().vec4.pixelType)}});function s(){}return i.prototype.deallocByDepositingInPool=function(){r.deposit(this,arguments[0])},e(r),{get WglTexturePool(){return r}}}),$traceurRuntime.registerModule("src/webgl/WglTextureTrader.js",[],function(){"use strict";var i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./WglConfiguredShader.js","src/webgl/WglTextureTrader.js")).WglConfiguredShader,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./WglTexture.js","src/webgl/WglTextureTrader.js")).WglTexture,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./WglTexturePool.js","src/webgl/WglTextureTrader.js")).WglTexturePool,n=$traceurRuntime.createClass(function(e){this.currentTexture=e,this._dontDeallocFlag=!1},{dontDeallocCurrentTexture:function(){return this._dontDeallocFlag=!0,this.currentTexture},shadeAndTrade:function(e){var t=this.currentTexture,r=!this._dontDeallocFlag,n=arguments[1]||a.takeSame(t);(e instanceof i?e:e(t)).renderTo(n),this.currentTexture=n,this._dontDeallocFlag=!1,r&&t.deallocByDepositingInPool("WglTexturePool shadeAndTrade")},shadeHalveAndTrade:function(e){this.shadeAndTrade(e,a.take(Math.max(0,this.currentTexture.sizePower()-1),this.currentTexture.pixelType))},shadeQuarterAndTrade:function(e){this.shadeAndTrade(e,a.take(Math.max(0,this.currentTexture.sizePower()-2),this.currentTexture.pixelType))}},{});return e.prototype.tradeThrough=function(e){var t=void 0!==arguments[1]&&arguments[1],r=new n(this);return t&&r.dontDeallocCurrentTexture(),e(r),r.currentTexture},{get WglTextureTrader(){return n}}}),$traceurRuntime.registerModule("src/webgl/WglUtil.js",[],function(){"use strict";var i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../Config.js","src/webgl/WglUtil.js")).Config;function e(e,t){var r,n=void 0!==arguments[2]&&arguments[2];if(!n||i.CHECK_WEB_GL_ERRORS_EVEN_ON_HOT_PATHS){var n=e.getError(),e=WebGLRenderingContext;if(n!==e.NO_ERROR)throw r={},Object.defineProperty(r,1280,{value:"INVALID_ENUM [+constant not found]",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(r,1281,{value:"INVALID_VALUE [+constant not found]",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(r,1282,{value:"INVALID_OPERATION [+constant not found]",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(r,1285,{value:"OUT_OF_MEMORY [+constant not found]",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(r,1286,{value:"INVALID_FRAMEBUFFER_OPERATION [+constant not found]",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(r,37442,{value:"CONTEXT_LOST_WEBGL [+constant not found]",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(r,e.INVALID_ENUM,{value:"INVALID_ENUM",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(r,e.INVALID_VALUE,{value:"INVALID_VALUE",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(r,e.INVALID_OPERATION,{value:"INVALID_OPERATION",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(r,e.OUT_OF_MEMORY,{value:"OUT_OF_MEMORY",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(r,e.INVALID_FRAMEBUFFER_OPERATION,{value:"INVALID_FRAMEBUFFER_OPERATION",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(r,e.CONTEXT_LOST_WEBGL,{value:"CONTEXT_LOST_WEBGL",configurable:!0,enumerable:!0,writable:!0}),e=void 0!==r[n]?r[n]:"?",new Error("gl.getError() returned 0x"+n.toString(16)+" ("+e+") after "+t+".")}}function t(e){var t,r=void 0!==arguments[1]&&arguments[1];if(!r||i.CHECK_WEB_GL_ERRORS_EVEN_ON_HOT_PATHS){var r=WebGLRenderingContext,e=e.checkFramebufferStatus(r.FRAMEBUFFER);if(e!==r.FRAMEBUFFER_COMPLETE)throw t={},Object.defineProperty(t,0,{value:"Argument wasn't a frame buffer",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(t,1280,{value:"INVALID_ENUM [+constant not found]",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(t,36054,{value:"FRAMEBUFFER_INCOMPLETE_ATTACHMENT [+constant not found]",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(t,36055,{value:"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT [+constant not found]",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(t,36057,{value:"FRAMEBUFFER_INCOMPLETE_DIMENSIONS [+constant not found]",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(t,36061,{value:"FRAMEBUFFER_UNSUPPORTED [+constant not found]",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(t,r.INVALID_ENUM,{value:"INVALID_ENUM",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(t,r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT,{value:"FRAMEBUFFER_INCOMPLETE_ATTACHMENT",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(t,r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT,{value:"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(t,r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS,{value:"FRAMEBUFFER_INCOMPLETE_DIMENSIONS",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(t,r.FRAMEBUFFER_UNSUPPORTED,{value:"FRAMEBUFFER_UNSUPPORTED",configurable:!0,enumerable:!0,writable:!0}),r=void 0!==t[e]?t[e]:"?",new Error("gl.checkFramebufferStatus() returned 0x"+e.toString(16)+" ("+r+").")}}return{get checkGetErrorResult(){return e},get checkFrameBufferStatusResult(){return t}}}),$traceurRuntime.getModule("src/main.js");

        </script>
    </body>
</html>
